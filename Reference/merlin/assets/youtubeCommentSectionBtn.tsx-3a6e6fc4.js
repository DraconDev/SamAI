import{r as i,E as D,j as n,a as Y}from"./localStorage-70c0cae5.js";import{a as F}from"./client-4954293f.js";import{u as W,q as V,Q as z,a as Q}from"./browserPolyfillWrapper-bb116cae.js";import{C as $,R as X}from"./reactQueryProviderExtension-4a0c189d.js";import{C as Z}from"./index-82f4bfa1.js";import{c as C}from"./index-f3a3d194.js";import{B as J}from"./button-274f6d28.js";import{s as M,d as N,P as b,c as K,T as ee,a as te,b as se,Y as I}from"./tooltip-d01590d2.js";import{o as ne,i as oe}from"./index-eedd1636.js";import{f as re,U as S,n as ie}from"./helpers-589a895b.js";import{u as ae}from"./useTranslation-24cdda08.js";import{I as ce}from"./IconLoader-280e82e6.js";import{c as le}from"./index-82b528a6.js";import"./persist-4b6dccac.js";import"./index-6e4841df.js";import"./analytics-910dabef.js";import"./createReactComponent-640fc4e6.js";const ue={adsState:!1,errorType:"",queryCost:0,summaryState:null};function de(){const o=W(),s=re(),{t}=ae(),[l,a]=i.useState(0),[m,f]=i.useState(!0),[L,g]=i.useState(!1),[E,y]=i.useState(!1),[_,A]=i.useState(!1),[d,U]=i.useState(ue),[O,j]=i.useState(!1),[P,R]=i.useState(!1),T=i.useRef(null),H=e=>{if(e.preventDefault(),!o.isAuthenticated){ne(Y);return}E?R(!0):k(),M({action:N.INITIATE_COMMENT_PROCESS,type:b.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON})},k=()=>{a(10),g(!0);const e=ie();T.current=window.setInterval(()=>{a(r=>r<80?r+10:(clearInterval(T.current),85))},e)},w=e=>{if(e.data.type===b.FROM_YT_SUMMARIZER)switch(e.data.action){case I.SET_HIGHLIGHTS_SUCCESS:G();break;case I.UPDATE_COST_AND_ADS_STATE:q(e.data.context);break;case I.RESET_HIGHLIGHTS_BUTTON:B();break}},G=()=>{E?(R(!1),f(!1)):(a(100),clearInterval(T.current),setTimeout(()=>f(!1),3e3),setTimeout(()=>a(0),3500)),y(!0),g(!1)},q=e=>{U(e),e.summaryState===S.SUCCESS&&y(!0),e.summaryState===S.ERROR&&g(!1)},B=()=>{a(0),clearInterval(T.current),f(!0),g(!1),y(!1)};if(i.useEffect(()=>(window.addEventListener("message",w),()=>window.removeEventListener("message",w)),[E]),i.useEffect(()=>{const e=new MutationObserver(u=>{for(const p of u)if(p.type==="childList"&&document.getElementById("contenteditable-root")){A(!0),e.disconnect();return}}),r=document.getElementById("comment-dialog");return r&&e.observe(r,{childList:!0,subtree:!0}),()=>e.disconnect()},[]),i.useEffect(()=>{if(_){const e=document.getElementById("contenteditable-root"),r=document.querySelector("#buttons #cancel-button"),u=document.querySelector("#buttons #submit-button"),p=()=>{f(((e==null?void 0:e.innerText.trim())??"")==="")},h=()=>{f(!0)};return e==null||e.addEventListener("input",p),r==null||r.addEventListener("click",h),u==null||u.addEventListener("click",h),()=>{e==null||e.removeEventListener("input",p),r==null||r.removeEventListener("click",h),u==null||u.removeEventListener("click",h)}}},[_]),i.useEffect(()=>{M({action:N.GET_SHARED_STATE_ON_MOUNTING,type:b.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON})},[]),i.useEffect(()=>{let e="";const r=new MutationObserver(()=>{if(location.href!==e){e=location.href;const p=document.domain.replace("www.","")||location.hostname.replace("www.","");j(p==="youtube.com"&&location.pathname.startsWith("/shorts"))}}),u=document.querySelector("title");return u&&r.observe(u,{childList:!0}),()=>r.disconnect()},[]),O)return null;const x=!m||d.adsState;return i.useEffect(()=>{d.summaryState===S.ERROR&&d.errorType===D.RATE_LIMITED&&window.scrollTo({behavior:"smooth",top:0})},[d]),n.jsx("div",{className:"absolute right-[16px] top-[-20px]",children:n.jsx(K,{children:n.jsxs(ee,{children:[n.jsx(te,{children:n.jsx("div",{className:C("rounded-full p-[1px]",x?"bg-transparent":"bg-gradient-to-r from-purple-500 to-pink-500"),children:n.jsx(J,{className:C("rounded-full border !border-none border-purple-500 hover:bg-secondary",s==="dark"&&"dark"),variant:"secondary",disabled:x,type:"button",onClick:H,children:L||P?n.jsxs("span",{className:"flex items-center justify-center gap-2",children:[n.jsx("span",{className:"relative animate-loader-spin",children:n.jsx(ce,{className:"stroke-black dark:stroke-white",width:18,height:18})}),t("yt_lib.highlights")]}):t(l===100?"yt_lib.highlights_success":"yt_lib.cmnt_highlights")})})}),n.jsx(se,{className:"rounded-lg border border-muted-foreground/20",sideOffset:8,children:n.jsx("p",{children:d.adsState?t("yt_lib.wait_ad"):d.summaryState===S.SUMMARY?t("yt_lib.highlights_gen"):d.summaryState===S.LOADING?t("yt_lib.highlights_gen1"):`${t("yt_lib.will_use")} ${d.queryCost??4} ${o.isTeams?t("yt_lib.words"):t("yt_lib.free_summ")}`})})]})})})}let c=null;function me(){var s,t;return(t=(s=Q().details)==null?void 0:s.youtube)!=null&&t.isEnabled?n.jsx($,{children:n.jsx(X,{children:n.jsx(Z,{children:n.jsx(de,{})})})}):null}function pe(){return new Promise(o=>{const s=new MutationObserver(oe(()=>{const l=document.querySelector("ytd-comments");l&&(o(l),s.disconnect())},50)),t=document.getElementById("page-manager");s.observe(t,{childList:!0,subtree:!0})})}const fe=async o=>{const s=document.createElement("merlin-component");s.id="merlin-yt-comment-button",s.className="merlin yt-comment-button";const t=s.attachShadow({mode:"open"}),l=document.createElement("style");l.textContent=`${le}
:host(#merlin-yt-comment-button) {
    all: initial; /* 1st rule so subsequent properties are reset. */
    margin: 0;
    padding: 0;
    width: 100%;
    position: absolute;
    box-sizing: border-box;
}
.ytReactAppRoot {
    position: relative;
  z-index: 2000;
  font-family:
		"DM Sans Merlin",
		system-ui,
		-apple-system,
		BlinkMacSystemFont,
		Ubuntu,
		sans-serif !important;
}
`;const a=document.createElement("div");a.id="ytReactAppRoot",a.className="ytReactAppRoot",t.appendChild(l),t.appendChild(a),o(s),F(a).render(n.jsx(me,{}))},v=()=>{c=new MutationObserver(s=>{s.map(t=>t.addedNodes.forEach(l=>{var a;l.nodeName==="YTD-COMMENT-SIMPLEBOX-RENDERER"&&((a=c==null?void 0:c.disconnect)==null||a.call(c),fe(m=>l.appendChild(m)))}))});const o=document.querySelector("ytd-comments");c==null||c.observe(o,{childList:!0,subtree:!0})},he=()=>{let o="",s=!0;const t=new MutationObserver(a=>{var m;location.href!==o&&(o=location.href,s||((m=c==null?void 0:c.disconnect)==null||m.call(c),v()),s=!1)}),l=document.querySelector("title");t.observe(l,{childList:!0})},Se=async()=>{const o=await V.fetchQuery(z.MerlinConfig);o&&!o.summarizer.youtube.visible||(await pe(),v(),he())};Se();
