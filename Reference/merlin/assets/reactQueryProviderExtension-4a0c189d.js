import{r as o,j as n}from"./localStorage-70c0cae5.js";import{p as S,a as q,d as C}from"./persist-4b6dccac.js";import{X as K,Y as A,q as E,Z as I,b as v,F as d,u as T,d as O,i as R,G as _,e as u,Q as s,$ as x,a0 as N}from"./browserPolyfillWrapper-bb116cae.js";const b=({children:r})=>r;var D=({client:r,children:a,persistOptions:t,onSuccess:c,...e})=>{const[i,h]=o.useState(!0),y=o.useRef({persistOptions:t,onSuccess:c}),l=o.useRef(!1);return o.useEffect(()=>{y.current={persistOptions:t,onSuccess:c}}),o.useEffect(()=>{const f={...y.current.persistOptions,queryClient:r};return l.current||(l.current=!0,S(f).then(async()=>{var Q,p;try{await((p=(Q=y.current).onSuccess)==null?void 0:p.call(Q))}finally{h(!1)}})),i?void 0:q(f)},[r,i]),n.jsx(K,{client:r,...e,children:n.jsx(A,{value:i,children:a})})};function M(){const r=v();return o.useEffect(()=>{function a(t,c,e){t.from===_.BACKGROUND_SCRIPT&&(t.action===u.RQ_CLEAR&&(r.clear(),e({status:"success"})),t.action===u.RQ_INVALIDATE&&(t.payload.queryOptionKey&&t.payload.queryOptionKey.length>0?t.payload.queryOptionKey.forEach(i=>r.invalidateQueries(QOAll[i])):r.invalidateQueries(),e({status:"success"})),t.action===u.RQ_REFETCH&&(t.payload.queryOptionKey&&t.payload.queryOptionKey.length>0?t.payload.queryOptionKey.forEach(i=>r.refetchQueries(QOAll[i])):r.refetchQueries(),e({status:"success"})),t.action===u.RQ_FETCH&&(t.payload.forceFetch?r.fetchQuery({...s[t.payload.queryOptionKey],staleTime:0}).then(()=>e({status:"success"})).catch(()=>e({status:"error"})):r.fetchQuery(s[t.payload.queryOptionKey]).then(()=>e({status:"success"})).catch(()=>e({status:"error"}))),t.action===u.RQ_CLEAR&&(r.clear(),e({status:"success"})),t.action===u.RQ_INVALIDATE&&(t.payload.queryOptionKey&&t.payload.queryOptionKey.length>0?t.payload.queryOptionKey.forEach(i=>r.invalidateQueries(QOAll[i])):r.invalidateQueries(),e({status:"success"})),t.action===u.RQ_REMOVE&&(t.payload.queryOptionKey&&t.payload.queryOptionKey.length>0?t.payload.queryOptionKey.forEach(i=>r.removeQueries(QOAll[i])):r.invalidateQueries(),e({status:"success"})),t.action===u.RQ_RESET&&(t.payload.queryOptionKey&&t.payload.queryOptionKey.length>0?t.payload.queryOptionKey.forEach(i=>r.resetQueries(QOAll[i])):r.resetQueries(),e({status:"success"})),t.action===u.RQ_QUERYDATA_SET&&(E.setQueryData([t.payload.queryKey],t.payload.queryData),e({status:"success"})),t.action===u.SIGNIN&&x().then(()=>e({status:"success"})).catch(()=>e({status:"error"})),t.action===u.SIGNOUT&&(N(),e({status:"success"})))}return d.runtime.onMessage.addListener(a),()=>d.runtime.onMessage.removeListener(a)},[]),null}function P(){const{signOut:r,...a}=T();return O(s.MerlinConfig),O(s.MerlinConstants),o.useEffect(()=>{R.setState(a)},[a]),null}function G(r){return n.jsxs(D,{client:E,persistOptions:{buster:"v2.99",dehydrateOptions:{shouldDehydrateQuery:a=>{var t;return C(a)&&!!((t=a.meta)!=null&&t.persist)}},persister:I},children:[n.jsx(M,{}),n.jsx(P,{}),r.children]})}export{b as C,G as R};
