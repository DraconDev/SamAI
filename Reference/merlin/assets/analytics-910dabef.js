import{B as i,q as p,Q as u,e as l}from"./browserPolyfillWrapper-bb116cae.js";import{L as f}from"./localStorage-70c0cae5.js";const C="https://www.google-analytics.com/mp/collect",O="https://www.google-analytics.com/debug/mp/collect",R="G-JZS898GQ18",D="9Sv1BQIYSX2647_jkbulrA",_=100,S=30,g=async()=>{let{clientId:e}=await i.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await i.storage.local.set({clientId:e})),e},d=async()=>{let{sessionData:e}=await i.storage.local.get("sessionData");const t=Date.now();return e&&e.timestamp&&((t-e.timestamp)/6e4>S?e=null:(e.timestamp=t,await i.storage.local.set({sessionData:e}))),e||(e={session_id:t.toString(),timestamp:t.toString()},await i.storage.local.set({sessionData:e})),e.session_id},E=async()=>{const e=await p.ensureQueryData(u.UserSession).catch(t=>console.error(t));return e!=null&&e.uid?e==null?void 0:e.uid:null};function A(e,t=500){const a=new Map;function o(n){return JSON.stringify(n.map(s=>typeof s=="object"?JSON.stringify(s):s))}return function(...n){const s=this,r=o(n),c=a.get(r);clearTimeout(c);const m=setTimeout(()=>{e.apply(s,n),a.delete(r)},t);a.set(r,m)}}const G=A(async e=>{const t=await p.fetchQuery(u.MerlinConfig);if(t&&!t.ga4Config.active)return;const a=await f.get("installedAt"),o=await E();a&&o&&(i.runtime.sendMessage({action:l.REPORT_ANALYTICS,payload:{client_id:await g(),events:[{name:"FirstInteraction",params:{engagement_time_msec:_,session_id:await d(),timestamp:Date.now(),user_id:o}}]}}),await f.remove("installedAt")),e.session_id&&(e.session_id=await d()),e.engagement_time_msec&&(e.engagement_time_msec=_);const{engagement_time_msec:n,eventData:s,eventName:r,eventType:c,feature:m,firedFromFile:w,session_id:I}=e,y={engagement_time_msec:n,eventData:s,eventType:c,feature:m,firedFromFile:w,session_id:I};try{i.runtime.sendMessage({action:l.REPORT_ANALYTICS,payload:{client_id:await g(),events:[{name:r,params:y}]}})}catch(T){console.error(T)}}),v=A(async e=>{const t=await p.fetchQuery(u.MerlinConfig);if(t&&!t.ga4Config.active)return;e.session_id&&(e.session_id=await d()),e.engagement_time_msec&&(e.engagement_time_msec=_);const{engagement_time_msec:a,page_location:o,page_title:n,session_id:s}=e,r={engagement_time_msec:a,page_location:o,page_title:n,session_id:s};try{i.runtime.sendMessage({action:l.REPORT_ANALYTICS,payload:{client_id:await g(),events:[{name:"page_view",params:r}]}})}catch(c){console.error(c)}}),L=A(async e=>{const t=await p.fetchQuery(u.MerlinConfig);if(t&&!t.ga4Config.active)return;const a=await f.get("installedAt"),o=await E();a&&o&&(i.runtime.sendMessage({action:l.REPORT_ANALYTICS,payload:{client_id:await g(),events:[{name:"FirstInteraction",params:{engagement_time_msec:_,session_id:await d(),timestamp:Date.now(),user_id:o}}]}}),await f.remove("installedAt")),e.session_id&&(e.session_id=await d()),e.engagement_time_msec&&(e.engagement_time_msec=_);const{engagement_time_msec:n,feature:s,firedFromFile:r,prompt_text:c,prompt_type:m,session_id:w}=e,I={engagement_time_msec:n,feature:s,firedFromFile:r,prompt_text:c,prompt_type:m,session_id:w};try{i.runtime.sendMessage({action:l.REPORT_ANALYTICS,payload:{client_id:await g(),events:[{name:s+m+"Prompt",params:I}]}})}catch(y){console.error(y)}});export{D as A,_ as D,O as G,R as M,v as a,L as b,d as c,C as d,G as f,g};
