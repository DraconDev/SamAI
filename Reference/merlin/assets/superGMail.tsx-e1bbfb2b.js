import{r as E,g as mr,b as le,j as n,o as hr,s as Ue,e as ve,c as Ht,d as vr,E as gr,f as xr,a as At,h as yr,R as Ke,i as Fe}from"./localStorage-70c0cae5.js";import{a as ce}from"./client-4954293f.js";import{c as br,u as rt,a as je,d as wr,q as jr,Q as Sr}from"./browserPolyfillWrapper-bb116cae.js";import{C as nt,R as at}from"./reactQueryProviderExtension-4a0c189d.js";import{F as $e}from"./foyerLogo-6509e919.js";import{B as q,c as Et}from"./button-274f6d28.js";import{C as zt}from"./index-82f4bfa1.js";import{I as Nr,a as Cr,b as Ar,S as _,u as Er,t as Rr,C as oe,c as Oe,d as qe,e as Ut,f as Tr,F as Ir,g as Ve,h as Ye,i as Qe,j as Or,k as Mr,l as Br,m as Lr,n as Rt,o as Tt,p as Vt,q as It,r as Me,s as Pr,M as Yt}from"./select-456431be.js";import{E as Qt,T as ot}from"./themeContext-5e650432.js";import{o as Be,g as Ot,i as st}from"./index-eedd1636.js";import{S as se,I as qr,T as it,a as Mt,f as kr,l as Fr}from"./textarea-53b4381a.js";import{B as Je,A as $r,a as Gr}from"./avatar-638bb5ce.js";import{f as k}from"./analytics-910dabef.js";import{a as _r,b as Wr,u as Dr,I as Ze,A as Xt}from"./useSSE-f967edd7.js";import{C as Hr,I as zr}from"./index-e4326246.js";import{F as Ur}from"./index-6f85b927.js";import{u as Ge}from"./useTranslation-24cdda08.js";import{I as Vr,v as ie}from"./IconCheck-e595c264.js";import{I as Xe,m as Se}from"./motion-6c2f4b83.js";import{c as Yr}from"./createReactComponent-640fc4e6.js";import{g as Qr}from"./backend-0efbfbef.js";import{c as re}from"./index-82b528a6.js";/* empty css             */import"./persist-4b6dccac.js";import"./index-6e4841df.js";import"./index-f3a3d194.js";var Xr=Yr("square","IconSquare",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]),Bt=function(t){return t.reduce(function(r,a){var s=a[0],o=a[1];return r[s]=o,r},{})},Lt=typeof window<"u"&&window.document&&window.document.createElement?E.useLayoutEffect:E.useEffect,$="top",H="bottom",z="right",G="left",lt="auto",Ne=[$,H,z,G],ue="start",be="end",Kr="clippingParents",Kt="viewport",ge="popper",Jr="reference",Pt=Ne.reduce(function(e,t){return e.concat([t+"-"+ue,t+"-"+be])},[]),Jt=[].concat(Ne,[lt]).reduce(function(e,t){return e.concat([t,t+"-"+ue,t+"-"+be])},[]),Zr="beforeRead",en="read",tn="afterRead",rn="beforeMain",nn="main",an="afterMain",on="beforeWrite",sn="write",ln="afterWrite",cn=[Zr,en,tn,rn,nn,an,on,sn,ln];function V(e){return e?(e.nodeName||"").toLowerCase():null}function W(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function ne(e){var t=W(e).Element;return e instanceof t||e instanceof Element}function D(e){var t=W(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function ct(e){if(typeof ShadowRoot>"u")return!1;var t=W(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function un(e){var t=e.state;Object.keys(t.elements).forEach(function(r){var a=t.styles[r]||{},s=t.attributes[r]||{},o=t.elements[r];!D(o)||!V(o)||(Object.assign(o.style,a),Object.keys(s).forEach(function(i){var c=s[i];c===!1?o.removeAttribute(i):o.setAttribute(i,c===!0?"":c)}))})}function pn(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(a){var s=t.elements[a],o=t.attributes[a]||{},i=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:r[a]),c=i.reduce(function(l,m){return l[m]="",l},{});!D(s)||!V(s)||(Object.assign(s.style,c),Object.keys(o).forEach(function(l){s.removeAttribute(l)}))})}}const dn={name:"applyStyles",enabled:!0,phase:"write",fn:un,effect:pn,requires:["computeStyles"]};function U(e){return e.split("-")[0]}var te=Math.max,ke=Math.min,pe=Math.round;function et(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Zt(){return!/^((?!chrome|android).)*safari/i.test(et())}function de(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=e.getBoundingClientRect(),s=1,o=1;t&&D(e)&&(s=e.offsetWidth>0&&pe(a.width)/e.offsetWidth||1,o=e.offsetHeight>0&&pe(a.height)/e.offsetHeight||1);var i=ne(e)?W(e):window,c=i.visualViewport,l=!Zt()&&r,m=(a.left+(l&&c?c.offsetLeft:0))/s,f=(a.top+(l&&c?c.offsetTop:0))/o,u=a.width/s,h=a.height/o;return{width:u,height:h,top:f,right:m+u,bottom:f+h,left:m,x:m,y:f}}function ut(e){var t=de(e),r=e.offsetWidth,a=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:a}}function er(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&ct(r)){var a=t;do{if(a&&e.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Y(e){return W(e).getComputedStyle(e)}function fn(e){return["table","td","th"].indexOf(V(e))>=0}function K(e){return((ne(e)?e.ownerDocument:e.document)||window.document).documentElement}function _e(e){return V(e)==="html"?e:e.assignedSlot||e.parentNode||(ct(e)?e.host:null)||K(e)}function qt(e){return!D(e)||Y(e).position==="fixed"?null:e.offsetParent}function mn(e){var t=/firefox/i.test(et()),r=/Trident/i.test(et());if(r&&D(e)){var a=Y(e);if(a.position==="fixed")return null}var s=_e(e);for(ct(s)&&(s=s.host);D(s)&&["html","body"].indexOf(V(s))<0;){var o=Y(s);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||t&&o.willChange==="filter"||t&&o.filter&&o.filter!=="none")return s;s=s.parentNode}return null}function Ce(e){for(var t=W(e),r=qt(e);r&&fn(r)&&Y(r).position==="static";)r=qt(r);return r&&(V(r)==="html"||V(r)==="body"&&Y(r).position==="static")?t:r||mn(e)||t}function pt(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function xe(e,t,r){return te(e,ke(t,r))}function hn(e,t,r){var a=xe(e,t,r);return a>r?r:a}function tr(){return{top:0,right:0,bottom:0,left:0}}function rr(e){return Object.assign({},tr(),e)}function nr(e,t){return t.reduce(function(r,a){return r[a]=e,r},{})}var vn=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,rr(typeof t!="number"?t:nr(t,Ne))};function gn(e){var t,r=e.state,a=e.name,s=e.options,o=r.elements.arrow,i=r.modifiersData.popperOffsets,c=U(r.placement),l=pt(c),m=[G,z].indexOf(c)>=0,f=m?"height":"width";if(!(!o||!i)){var u=vn(s.padding,r),h=ut(o),g=l==="y"?$:G,y=l==="y"?H:z,x=r.rects.reference[f]+r.rects.reference[l]-i[l]-r.rects.popper[f],w=i[l]-r.rects.reference[l],T=Ce(o),I=T?l==="y"?T.clientHeight||0:T.clientWidth||0:0,O=x/2-w/2,b=u[g],N=I-h[f]-u[y],d=I/2-h[f]/2+O,j=xe(b,d,N),R=l;r.modifiersData[a]=(t={},t[R]=j,t.centerOffset=j-d,t)}}function xn(e){var t=e.state,r=e.options,a=r.element,s=a===void 0?"[data-popper-arrow]":a;s!=null&&(typeof s=="string"&&(s=t.elements.popper.querySelector(s),!s)||er(t.elements.popper,s)&&(t.elements.arrow=s))}const yn={name:"arrow",enabled:!0,phase:"main",fn:gn,effect:xn,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function fe(e){return e.split("-")[1]}var bn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function wn(e,t){var r=e.x,a=e.y,s=t.devicePixelRatio||1;return{x:pe(r*s)/s||0,y:pe(a*s)/s||0}}function kt(e){var t,r=e.popper,a=e.popperRect,s=e.placement,o=e.variation,i=e.offsets,c=e.position,l=e.gpuAcceleration,m=e.adaptive,f=e.roundOffsets,u=e.isFixed,h=i.x,g=h===void 0?0:h,y=i.y,x=y===void 0?0:y,w=typeof f=="function"?f({x:g,y:x}):{x:g,y:x};g=w.x,x=w.y;var T=i.hasOwnProperty("x"),I=i.hasOwnProperty("y"),O=G,b=$,N=window;if(m){var d=Ce(r),j="clientHeight",R="clientWidth";if(d===W(r)&&(d=K(r),Y(d).position!=="static"&&c==="absolute"&&(j="scrollHeight",R="scrollWidth")),d=d,s===$||(s===G||s===z)&&o===be){b=H;var p=u&&d===N&&N.visualViewport?N.visualViewport.height:d[j];x-=p-a.height,x*=l?1:-1}if(s===G||(s===$||s===H)&&o===be){O=z;var v=u&&d===N&&N.visualViewport?N.visualViewport.width:d[R];g-=v-a.width,g*=l?1:-1}}var S=Object.assign({position:c},m&&bn),A=f===!0?wn({x:g,y:x},W(r)):{x:g,y:x};if(g=A.x,x=A.y,l){var C;return Object.assign({},S,(C={},C[b]=I?"0":"",C[O]=T?"0":"",C.transform=(N.devicePixelRatio||1)<=1?"translate("+g+"px, "+x+"px)":"translate3d("+g+"px, "+x+"px, 0)",C))}return Object.assign({},S,(t={},t[b]=I?x+"px":"",t[O]=T?g+"px":"",t.transform="",t))}function jn(e){var t=e.state,r=e.options,a=r.gpuAcceleration,s=a===void 0?!0:a,o=r.adaptive,i=o===void 0?!0:o,c=r.roundOffsets,l=c===void 0?!0:c,m={placement:U(t.placement),variation:fe(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,kt(Object.assign({},m,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:i,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,kt(Object.assign({},m,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const Sn={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:jn,data:{}};var Ie={passive:!0};function Nn(e){var t=e.state,r=e.instance,a=e.options,s=a.scroll,o=s===void 0?!0:s,i=a.resize,c=i===void 0?!0:i,l=W(t.elements.popper),m=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&m.forEach(function(f){f.addEventListener("scroll",r.update,Ie)}),c&&l.addEventListener("resize",r.update,Ie),function(){o&&m.forEach(function(f){f.removeEventListener("scroll",r.update,Ie)}),c&&l.removeEventListener("resize",r.update,Ie)}}const Cn={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Nn,data:{}};var An={left:"right",right:"left",bottom:"top",top:"bottom"};function Le(e){return e.replace(/left|right|bottom|top/g,function(t){return An[t]})}var En={start:"end",end:"start"};function Ft(e){return e.replace(/start|end/g,function(t){return En[t]})}function dt(e){var t=W(e),r=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:r,scrollTop:a}}function ft(e){return de(K(e)).left+dt(e).scrollLeft}function Rn(e,t){var r=W(e),a=K(e),s=r.visualViewport,o=a.clientWidth,i=a.clientHeight,c=0,l=0;if(s){o=s.width,i=s.height;var m=Zt();(m||!m&&t==="fixed")&&(c=s.offsetLeft,l=s.offsetTop)}return{width:o,height:i,x:c+ft(e),y:l}}function Tn(e){var t,r=K(e),a=dt(e),s=(t=e.ownerDocument)==null?void 0:t.body,o=te(r.scrollWidth,r.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),i=te(r.scrollHeight,r.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),c=-a.scrollLeft+ft(e),l=-a.scrollTop;return Y(s||r).direction==="rtl"&&(c+=te(r.clientWidth,s?s.clientWidth:0)-o),{width:o,height:i,x:c,y:l}}function mt(e){var t=Y(e),r=t.overflow,a=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+s+a)}function ar(e){return["html","body","#document"].indexOf(V(e))>=0?e.ownerDocument.body:D(e)&&mt(e)?e:ar(_e(e))}function ye(e,t){var r;t===void 0&&(t=[]);var a=ar(e),s=a===((r=e.ownerDocument)==null?void 0:r.body),o=W(a),i=s?[o].concat(o.visualViewport||[],mt(a)?a:[]):a,c=t.concat(i);return s?c:c.concat(ye(_e(i)))}function tt(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function In(e,t){var r=de(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function $t(e,t,r){return t===Kt?tt(Rn(e,r)):ne(t)?In(t,r):tt(Tn(K(e)))}function On(e){var t=ye(_e(e)),r=["absolute","fixed"].indexOf(Y(e).position)>=0,a=r&&D(e)?Ce(e):e;return ne(a)?t.filter(function(s){return ne(s)&&er(s,a)&&V(s)!=="body"}):[]}function Mn(e,t,r,a){var s=t==="clippingParents"?On(e):[].concat(t),o=[].concat(s,[r]),i=o[0],c=o.reduce(function(l,m){var f=$t(e,m,a);return l.top=te(f.top,l.top),l.right=ke(f.right,l.right),l.bottom=ke(f.bottom,l.bottom),l.left=te(f.left,l.left),l},$t(e,i,a));return c.width=c.right-c.left,c.height=c.bottom-c.top,c.x=c.left,c.y=c.top,c}function or(e){var t=e.reference,r=e.element,a=e.placement,s=a?U(a):null,o=a?fe(a):null,i=t.x+t.width/2-r.width/2,c=t.y+t.height/2-r.height/2,l;switch(s){case $:l={x:i,y:t.y-r.height};break;case H:l={x:i,y:t.y+t.height};break;case z:l={x:t.x+t.width,y:c};break;case G:l={x:t.x-r.width,y:c};break;default:l={x:t.x,y:t.y}}var m=s?pt(s):null;if(m!=null){var f=m==="y"?"height":"width";switch(o){case ue:l[m]=l[m]-(t[f]/2-r[f]/2);break;case be:l[m]=l[m]+(t[f]/2-r[f]/2);break}}return l}function we(e,t){t===void 0&&(t={});var r=t,a=r.placement,s=a===void 0?e.placement:a,o=r.strategy,i=o===void 0?e.strategy:o,c=r.boundary,l=c===void 0?Kr:c,m=r.rootBoundary,f=m===void 0?Kt:m,u=r.elementContext,h=u===void 0?ge:u,g=r.altBoundary,y=g===void 0?!1:g,x=r.padding,w=x===void 0?0:x,T=rr(typeof w!="number"?w:nr(w,Ne)),I=h===ge?Jr:ge,O=e.rects.popper,b=e.elements[y?I:h],N=Mn(ne(b)?b:b.contextElement||K(e.elements.popper),l,f,i),d=de(e.elements.reference),j=or({reference:d,element:O,strategy:"absolute",placement:s}),R=tt(Object.assign({},O,j)),p=h===ge?R:d,v={top:N.top-p.top+T.top,bottom:p.bottom-N.bottom+T.bottom,left:N.left-p.left+T.left,right:p.right-N.right+T.right},S=e.modifiersData.offset;if(h===ge&&S){var A=S[s];Object.keys(v).forEach(function(C){var M=[z,H].indexOf(C)>=0?1:-1,P=[$,H].indexOf(C)>=0?"y":"x";v[C]+=A[P]*M})}return v}function Bn(e,t){t===void 0&&(t={});var r=t,a=r.placement,s=r.boundary,o=r.rootBoundary,i=r.padding,c=r.flipVariations,l=r.allowedAutoPlacements,m=l===void 0?Jt:l,f=fe(a),u=f?c?Pt:Pt.filter(function(y){return fe(y)===f}):Ne,h=u.filter(function(y){return m.indexOf(y)>=0});h.length===0&&(h=u);var g=h.reduce(function(y,x){return y[x]=we(e,{placement:x,boundary:s,rootBoundary:o,padding:i})[U(x)],y},{});return Object.keys(g).sort(function(y,x){return g[y]-g[x]})}function Ln(e){if(U(e)===lt)return[];var t=Le(e);return[Ft(e),t,Ft(t)]}function Pn(e){var t=e.state,r=e.options,a=e.name;if(!t.modifiersData[a]._skip){for(var s=r.mainAxis,o=s===void 0?!0:s,i=r.altAxis,c=i===void 0?!0:i,l=r.fallbackPlacements,m=r.padding,f=r.boundary,u=r.rootBoundary,h=r.altBoundary,g=r.flipVariations,y=g===void 0?!0:g,x=r.allowedAutoPlacements,w=t.options.placement,T=U(w),I=T===w,O=l||(I||!y?[Le(w)]:Ln(w)),b=[w].concat(O).reduce(function(ae,Q){return ae.concat(U(Q)===lt?Bn(t,{placement:Q,boundary:f,rootBoundary:u,padding:m,flipVariations:y,allowedAutoPlacements:x}):Q)},[]),N=t.rects.reference,d=t.rects.popper,j=new Map,R=!0,p=b[0],v=0;v<b.length;v++){var S=b[v],A=U(S),C=fe(S)===ue,M=[$,H].indexOf(A)>=0,P=M?"width":"height",L=we(t,{placement:S,boundary:f,rootBoundary:u,altBoundary:h,padding:m}),F=M?C?z:G:C?H:$;N[P]>d[P]&&(F=Le(F));var B=Le(F),J=[];if(o&&J.push(L[A]<=0),c&&J.push(L[F]<=0,L[B]<=0),J.every(function(ae){return ae})){p=S,R=!1;break}j.set(S,J)}if(R)for(var Ae=y?3:1,We=function(Q){var he=b.find(function(Re){var Z=j.get(Re);if(Z)return Z.slice(0,Q).every(function(De){return De})});if(he)return p=he,"break"},me=Ae;me>0;me--){var Ee=We(me);if(Ee==="break")break}t.placement!==p&&(t.modifiersData[a]._skip=!0,t.placement=p,t.reset=!0)}}const qn={name:"flip",enabled:!0,phase:"main",fn:Pn,requiresIfExists:["offset"],data:{_skip:!1}};function Gt(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function _t(e){return[$,z,H,G].some(function(t){return e[t]>=0})}function kn(e){var t=e.state,r=e.name,a=t.rects.reference,s=t.rects.popper,o=t.modifiersData.preventOverflow,i=we(t,{elementContext:"reference"}),c=we(t,{altBoundary:!0}),l=Gt(i,a),m=Gt(c,s,o),f=_t(l),u=_t(m);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:m,isReferenceHidden:f,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":u})}const Fn={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:kn};function $n(e,t,r){var a=U(e),s=[G,$].indexOf(a)>=0?-1:1,o=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,i=o[0],c=o[1];return i=i||0,c=(c||0)*s,[G,z].indexOf(a)>=0?{x:c,y:i}:{x:i,y:c}}function Gn(e){var t=e.state,r=e.options,a=e.name,s=r.offset,o=s===void 0?[0,0]:s,i=Jt.reduce(function(f,u){return f[u]=$n(u,t.rects,o),f},{}),c=i[t.placement],l=c.x,m=c.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=m),t.modifiersData[a]=i}const _n={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Gn};function Wn(e){var t=e.state,r=e.name;t.modifiersData[r]=or({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Dn={name:"popperOffsets",enabled:!0,phase:"read",fn:Wn,data:{}};function Hn(e){return e==="x"?"y":"x"}function zn(e){var t=e.state,r=e.options,a=e.name,s=r.mainAxis,o=s===void 0?!0:s,i=r.altAxis,c=i===void 0?!1:i,l=r.boundary,m=r.rootBoundary,f=r.altBoundary,u=r.padding,h=r.tether,g=h===void 0?!0:h,y=r.tetherOffset,x=y===void 0?0:y,w=we(t,{boundary:l,rootBoundary:m,padding:u,altBoundary:f}),T=U(t.placement),I=fe(t.placement),O=!I,b=pt(T),N=Hn(b),d=t.modifiersData.popperOffsets,j=t.rects.reference,R=t.rects.popper,p=typeof x=="function"?x(Object.assign({},t.rects,{placement:t.placement})):x,v=typeof p=="number"?{mainAxis:p,altAxis:p}:Object.assign({mainAxis:0,altAxis:0},p),S=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(d){if(o){var C,M=b==="y"?$:G,P=b==="y"?H:z,L=b==="y"?"height":"width",F=d[b],B=F+w[M],J=F-w[P],Ae=g?-R[L]/2:0,We=I===ue?j[L]:R[L],me=I===ue?-R[L]:-j[L],Ee=t.elements.arrow,ae=g&&Ee?ut(Ee):{width:0,height:0},Q=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:tr(),he=Q[M],Re=Q[P],Z=xe(0,j[L],ae[L]),De=O?j[L]/2-Ae-Z-he-v.mainAxis:We-Z-he-v.mainAxis,lr=O?-j[L]/2+Ae+Z+Re+v.mainAxis:me+Z+Re+v.mainAxis,He=t.elements.arrow&&Ce(t.elements.arrow),cr=He?b==="y"?He.clientTop||0:He.clientLeft||0:0,gt=(C=S==null?void 0:S[b])!=null?C:0,ur=F+De-gt-cr,pr=F+lr-gt,xt=xe(g?ke(B,ur):B,F,g?te(J,pr):J);d[b]=xt,A[b]=xt-F}if(c){var yt,dr=b==="x"?$:G,fr=b==="x"?H:z,ee=d[N],Te=N==="y"?"height":"width",bt=ee+w[dr],wt=ee-w[fr],ze=[$,G].indexOf(T)!==-1,jt=(yt=S==null?void 0:S[N])!=null?yt:0,St=ze?bt:ee-j[Te]-R[Te]-jt+v.altAxis,Nt=ze?ee+j[Te]+R[Te]-jt-v.altAxis:wt,Ct=g&&ze?hn(St,ee,Nt):xe(g?St:bt,ee,g?Nt:wt);d[N]=Ct,A[N]=Ct-ee}t.modifiersData[a]=A}}const Un={name:"preventOverflow",enabled:!0,phase:"main",fn:zn,requiresIfExists:["offset"]};function Vn(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Yn(e){return e===W(e)||!D(e)?dt(e):Vn(e)}function Qn(e){var t=e.getBoundingClientRect(),r=pe(t.width)/e.offsetWidth||1,a=pe(t.height)/e.offsetHeight||1;return r!==1||a!==1}function Xn(e,t,r){r===void 0&&(r=!1);var a=D(t),s=D(t)&&Qn(t),o=K(t),i=de(e,s,r),c={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(a||!a&&!r)&&((V(t)!=="body"||mt(o))&&(c=Yn(t)),D(t)?(l=de(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):o&&(l.x=ft(o))),{x:i.left+c.scrollLeft-l.x,y:i.top+c.scrollTop-l.y,width:i.width,height:i.height}}function Kn(e){var t=new Map,r=new Set,a=[];e.forEach(function(o){t.set(o.name,o)});function s(o){r.add(o.name);var i=[].concat(o.requires||[],o.requiresIfExists||[]);i.forEach(function(c){if(!r.has(c)){var l=t.get(c);l&&s(l)}}),a.push(o)}return e.forEach(function(o){r.has(o.name)||s(o)}),a}function Jn(e){var t=Kn(e);return cn.reduce(function(r,a){return r.concat(t.filter(function(s){return s.phase===a}))},[])}function Zn(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function ea(e){var t=e.reduce(function(r,a){var s=r[a.name];return r[a.name]=s?Object.assign({},s,a,{options:Object.assign({},s.options,a.options),data:Object.assign({},s.data,a.data)}):a,r},{});return Object.keys(t).map(function(r){return t[r]})}var Wt={placement:"bottom",modifiers:[],strategy:"absolute"};function Dt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function ta(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,a=r===void 0?[]:r,s=t.defaultOptions,o=s===void 0?Wt:s;return function(c,l,m){m===void 0&&(m=o);var f={placement:"bottom",orderedModifiers:[],options:Object.assign({},Wt,o),modifiersData:{},elements:{reference:c,popper:l},attributes:{},styles:{}},u=[],h=!1,g={state:f,setOptions:function(T){var I=typeof T=="function"?T(f.options):T;x(),f.options=Object.assign({},o,f.options,I),f.scrollParents={reference:ne(c)?ye(c):c.contextElement?ye(c.contextElement):[],popper:ye(l)};var O=Jn(ea([].concat(a,f.options.modifiers)));return f.orderedModifiers=O.filter(function(b){return b.enabled}),y(),g.update()},forceUpdate:function(){if(!h){var T=f.elements,I=T.reference,O=T.popper;if(Dt(I,O)){f.rects={reference:Xn(I,Ce(O),f.options.strategy==="fixed"),popper:ut(O)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(v){return f.modifiersData[v.name]=Object.assign({},v.data)});for(var b=0;b<f.orderedModifiers.length;b++){if(f.reset===!0){f.reset=!1,b=-1;continue}var N=f.orderedModifiers[b],d=N.fn,j=N.options,R=j===void 0?{}:j,p=N.name;typeof d=="function"&&(f=d({state:f,options:R,name:p,instance:g})||f)}}}},update:Zn(function(){return new Promise(function(w){g.forceUpdate(),w(f)})}),destroy:function(){x(),h=!0}};if(!Dt(c,l))return g;g.setOptions(m).then(function(w){!h&&m.onFirstUpdate&&m.onFirstUpdate(w)});function y(){f.orderedModifiers.forEach(function(w){var T=w.name,I=w.options,O=I===void 0?{}:I,b=w.effect;if(typeof b=="function"){var N=b({state:f,name:T,instance:g,options:O}),d=function(){};u.push(N||d)}})}function x(){u.forEach(function(w){return w()}),u=[]}return g}}var ra=[Cn,Dn,Sn,dn,_n,qn,Un,yn,Fn],na=ta({defaultModifiers:ra}),aa=typeof Element<"u",oa=typeof Map=="function",sa=typeof Set=="function",ia=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Pe(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,a,s;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(a=r;a--!==0;)if(!Pe(e[a],t[a]))return!1;return!0}var o;if(oa&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o=e.entries();!(a=o.next()).done;)if(!t.has(a.value[0]))return!1;for(o=e.entries();!(a=o.next()).done;)if(!Pe(a.value[1],t.get(a.value[0])))return!1;return!0}if(sa&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o=e.entries();!(a=o.next()).done;)if(!t.has(a.value[0]))return!1;return!0}if(ia&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(a=r;a--!==0;)if(e[a]!==t[a])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[a]))return!1;if(aa&&e instanceof Element)return!1;for(a=r;a--!==0;)if(!((s[a]==="_owner"||s[a]==="__v"||s[a]==="__o")&&e.$$typeof)&&!Pe(e[s[a]],t[s[a]]))return!1;return!0}return e!==e&&t!==t}var la=function(t,r){try{return Pe(t,r)}catch(a){if((a.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw a}};const ca=mr(la);var ua=[],sr=function(t,r,a){a===void 0&&(a={});var s=E.useRef(null),o={onFirstUpdate:a.onFirstUpdate,placement:a.placement||"bottom",strategy:a.strategy||"absolute",modifiers:a.modifiers||ua},i=E.useState({styles:{popper:{position:o.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),c=i[0],l=i[1],m=E.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(g){var y=g.state,x=Object.keys(y.elements);le.flushSync(function(){l({styles:Bt(x.map(function(w){return[w,y.styles[w]||{}]})),attributes:Bt(x.map(function(w){return[w,y.attributes[w]]}))})})},requires:["computeStyles"]}},[]),f=E.useMemo(function(){var h={onFirstUpdate:o.onFirstUpdate,placement:o.placement,strategy:o.strategy,modifiers:[].concat(o.modifiers,[m,{name:"applyStyles",enabled:!1}])};return ca(s.current,h)?s.current||h:(s.current=h,h)},[o.onFirstUpdate,o.placement,o.strategy,o.modifiers,m]),u=E.useRef();return Lt(function(){u.current&&u.current.setOptions(f)},[f]),Lt(function(){if(!(t==null||r==null)){var h=a.createPopper||na,g=h(t,r,f);return u.current=g,function(){g.destroy(),u.current=null}}},[t,r,a.createPopper]),{state:u.current?u.current.state:null,styles:c.styles,attributes:c.attributes,update:u.current?u.current.update:null,forceUpdate:u.current?u.current.forceUpdate:null}};const X=br(e=>({quickPromptAIReply:"",setQuickPromptAIReply:t=>e({quickPromptAIReply:t}),toggleUsingAIComposeBtn:()=>e(t=>({usingAIComposeBtn:!t.usingAIComposeBtn})),usingAIComposeBtn:!1}));function pa({chat:e,handleInsert:t,handleRegenerateLastMessage:r,handleSSE:a,idx:s,isLastMessage:o,isSSESuccessOrIdle:i,mountOn:c,msg:l,requestIdHeader:m}){var I,O,b;const{t:f}=Ge(),[u,h]=E.useState(!1),g=rt();function y(N){navigator.clipboard.writeText(N),h(!0),setTimeout(()=>h(!1),1200)}const[x,w]=E.useState(!1),T=E.useMemo(()=>e.activeThread[e.activeThread.length-1].content,[e.activeThread.length]);if(l.content!==void 0){if(l.role=="user")return n.jsxs("div",{style:{zIndex:10+s},className:`${s===e.activeThread.length-2?"sticky top-0":""} mr-3 bg-background`,id:"user-msg-container",children:[n.jsxs("div",{className:"flex items-start justify-between space-x-2 pl-2",id:`${s===e.activeThread.length-2?"user-msg-body":""}`,children:[n.jsxs("div",{className:"flex items-start space-x-2",children:[n.jsx(Je,{className:"relative -left-1",variant:"secondary",children:f("super_gmail.prompt")}),n.jsx("span",{className:`my-auto max-w-80 text-sm font-light text-foreground transition-all duration-500 ease-in-out ${x?"":"line-clamp-1"}`,children:l.content})]}),l.content.length>52&&n.jsx("span",{onClick:()=>w(!x),className:"w-24 cursor-pointer text-sm text-ds-icon-info underline",children:x?n.jsx(Nr,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"}):n.jsx(Cr,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"})})]},l.id),n.jsx(se,{className:"my-2"})]});if(l.role==="assistant")return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex min-h-[262px] flex-grow flex-col justify-between px-2",children:[n.jsx(Hr,{className:"!text-sm",content:l.content.trim()}),i&&n.jsxs("div",{className:"mt-2 flex items-center gap-2 bg-white py-1 text-sm",children:[n.jsx(q,{className:"text-xs",onClick:()=>{k({eventName:"Insert",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/GMailMessage"});const N=e.activeThread[s].content;N&&t(N)},children:f("super_gmail.insert")}),n.jsx("button",{type:"button",className:"bg-transparent p-1 only:rounded-md",onClick:()=>{l.content&&y(l.content)},disabled:u,children:u?n.jsx(Vr,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"}):n.jsx(zr,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"})}),o&&n.jsx(Ar,{className:"plain-icon-color h-4 w-4 cursor-pointer stroke-[1.5]",onClick:()=>{k({eventName:"Regenerate",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),r()}}),l.totSiblings>0&&n.jsxs("div",{className:"flex items-center",children:[n.jsx("button",{type:"button",className:"group/btn bg-transparent",onClick:()=>e.switchLeft(l),disabled:l.idx===0,children:n.jsx(_r,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})}),n.jsxs("span",{className:"mx-0.5 flex items-end",children:[l.idx+1,n.jsx("span",{className:"relative -top-[1px]",children:"/"}),l.totSiblings]}),n.jsx("button",{type:"button",className:"group/btn bg-transparent",onClick:()=>e.switchRight(l),disabled:l.idx===l.totSiblings-1,children:n.jsx(Wr,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})})]}),o&&T&&m&&n.jsx("div",{className:"mr-auto",children:n.jsx(Ur,{hideText:!0,queryTerms:JSON.stringify({feature:c,mountOn:c,query:e.activeThread[e.activeThread.length-2].content}),promptResult:T,callingSite:window.location.href,email:!((I=g.details)!=null&&I.email)||((O=g.details)==null?void 0:O.email)===""?"EMAIL_NOT_FOUND":(b=g.details)==null?void 0:b.email,requestId:m})})]})]}),n.jsx(se,{className:"my-2"})]});if(l.role==="system")return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex h-[262px] flex-col justify-between px-2",children:n.jsxs("div",{className:"",children:[n.jsx(_,{className:"mb-4 h-2 w-16"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(_,{className:"h-2 w-72"}),n.jsx(_,{className:"h-2 w-32"}),n.jsx(_,{className:"h-2 w-10"}),n.jsx(_,{className:"h-2 w-16"}),n.jsx(_,{className:"h-2 w-96"}),n.jsx(_,{className:"h-2 w-72"}),n.jsx(_,{className:"h-2 w-32"}),n.jsx(_,{className:"h-2 w-10"}),n.jsx(_,{className:"h-2 w-16"}),n.jsx(_,{className:"h-2 w-96"})]}),n.jsx(_,{className:"my-1 mt-4 h-2 w-16"}),n.jsx(_,{className:"h-2 w-20"})]})}),n.jsx(se,{className:"my-2"})]})}}const da=hr({bio:Ue(),model:ve(["GPT 3","GPT 4"]),name:Ue(),occupation:Ue(),outputLang:ve(["english","hindi"]),outputLength:ve(["short","medium","long"]),tone:ve(["empathetic","optimistic","sincere","enthusiastic"]),writingStyle:ve(["professional","casual","neutral"])});function fa({setCurrentMode:e}){var c,l,m,f,u,h,g;const{t}=Ge(),r=rt(),[a,s]=Qt({instance:new Ht({area:"local"}),key:"gmailPersona"},y=>y===void 0?{bio:"",model:`${r.isPaid?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:y),o=Er({defaultValues:{bio:"",model:`${r.isPaid?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"},resolver:Rr(da)});E.useEffect(()=>{o.reset(a)},[o,a]);function i(y){s(y),e("CHAT")}return n.jsx(oe,{className:"relative mx-auto w-[502px] p-0 shadow-lg",children:n.jsxs(Oe,{className:"flex p-0",children:[n.jsxs("div",{className:"-left-1 bottom-0 top-0 flex w-12 flex-col items-end justify-between gap-2 border-r p-1 py-2",children:[n.jsx("div",{className:"flex flex-col gap-2",children:n.jsx(q,{variant:"ghost",size:"icon",onClick:()=>{e("CHAT")},children:n.jsx(qr,{})})}),n.jsx(q,{variant:"ghost",size:"icon",onClick:()=>Be(vr),children:n.jsx($r,{className:"h-6 w-6",children:n.jsx(Gr,{children:((f=(m=(l=(c=r.details)==null?void 0:c.name)==null?void 0:l.split(" "))==null?void 0:m.map(y=>y[0]))==null?void 0:f.join(""))??((g=(h=(u=r.details)==null?void 0:u.email)==null?void 0:h[0])==null?void 0:g.toUpperCase())??"U"})})})]}),n.jsxs("div",{className:"mt-3 w-full",children:[n.jsxs(qe,{className:"h-[320px]",children:[n.jsx(Ut,{className:"p-3",children:n.jsx(Tr,{className:"text-lg",children:t("super_gmail.config")})}),n.jsx(Ir,{...o,children:n.jsx("form",{onSubmit:o.handleSubmit(i),children:n.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[n.jsx("div",{className:"",children:n.jsx(Ve,{control:o.control,name:"model",render:({field:y})=>n.jsxs(Ye,{children:[n.jsx(Qe,{children:t("super_gmail.ai_model")}),n.jsxs(Or,{onValueChange:y.onChange,value:y.value,children:[n.jsx(Mr,{className:"w-96",children:n.jsx(Br,{})}),n.jsxs(Lr,{children:[n.jsx(Rt,{value:"GPT 3",children:"GPT 3"}),n.jsx(Rt,{value:"GPT 4",children:"GPT 4"})]})]})]})})}),n.jsx("div",{className:"flex items-center gap-1",children:n.jsx("h3",{className:"text-md font-semibold",children:t("super_gmail.persona")})}),n.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:n.jsx(Ve,{control:o.control,name:"name",render:({field:y})=>n.jsxs(Ye,{children:[n.jsx(Qe,{children:t("super_gmail.name")}),n.jsx(Tt,{children:n.jsx(Vt,{placeholder:"Ashutosh Kumar",...y})}),n.jsx(It,{})]})})}),n.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:n.jsx(Ve,{control:o.control,name:"bio",render:({field:y})=>n.jsxs(Ye,{children:[n.jsx(Qe,{children:t("super_gmail.bio")}),n.jsx(Tt,{children:n.jsx(it,{placeholder:t("super_gmail.bio_placeholder"),className:"resize-none",...y})}),n.jsx(It,{})]})})})]})})})]}),n.jsx(Me,{className:"flex justify-end gap-2 p-2",children:n.jsx(q,{onClick:o.handleSubmit(i),children:t("super_gmail.save")})})]})]})})}const ir=()=>{const e=document.getElementById("merlin-gmail-uicomponentportal");if(!e)return null;const{shadowRoot:t}=e;return t},ma=()=>{const e=ir();if(!e)return;const t=e.querySelector("[data-radix-scroll-area-viewport]");t&&setTimeout(()=>t.scrollTo({behavior:"smooth",left:0,top:t.scrollHeight}),100)};function ht({handleInsert:e,id:t,mailThread:r=[],mountOn:a,setIsVisible:s}){var R;const{t:o}=Ge(),i=rt(),[c,l]=E.useState("CHAT"),[m,f]=E.useState(null),u=Pr(),h=X(p=>p.quickPromptAIReply),g=X(p=>p.setQuickPromptAIReply),y=je(),[x,w]=E.useState(""),[T]=Qt({instance:new Ht({area:"local"}),key:"gmailPersona"},p=>p===void 0?{bio:"",model:`${i.isPaid?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:p),[I,O]=E.useState(null),{handleGMailSSE:b}=Dr(`${xr.DOMAIN}/generative/gmail`,"handleGMailSSE",{method:"POST",onClose:()=>{u.editMessageNodeById(u.getLastMessage().id,p=>{var v;return p.status="SUCCESS",p.attachments=(v=p.attachments)==null?void 0:v.filter(S=>S.type==="IMAGE"&&S.url||S.type!=="IMAGE"),p}),u.setIsPromptingAvailable(!0)},onError:p=>{u.setIsPromptingAvailable(!0),console.error(p),u.deleteLastMessage(),(p==null?void 0:p.name)==="CUSTOM_ERROR"?p.type===gr.RATE_LIMITED?u.setError(i.isPaid?o("request_context.queries_exhausted"):o("request_context.queries_exhausted_for_today")):u.setError(p.message||o("request_context.something_wrong")):u.setError(o("request_context.something_wrong"))},onMessage:p=>{var A,C,M,P,L,F;const v=JSON.parse(p.data),S=v.data.content;((A=v==null?void 0:v.data)==null?void 0:A.eventType)==="SYSTEM"&&(v!=null&&v.data.hasOwnProperty("settings")&&(u.setChatId((M=(C=v==null?void 0:v.data)==null?void 0:C.settings)==null?void 0:M.chatId),u.editMessageNodeById(u.getLastMessage().parentId,B=>(B={...B,id:v.data.settings.userMessage.id},B)),u.editMessageNodeById(u.getLastMessage().id,B=>(B={...B,id:v.data.settings.assistantMessage.id,parentId:v.data.settings.userMessage.id},B))),v!=null&&v.data.hasOwnProperty("questions")&&u.setQuestions((P=v==null?void 0:v.data)==null?void 0:P.questions),(L=v==null?void 0:v.data)!=null&&L.metadata&&u.editMessageNodeById(u.getLastMessage().id,B=>(B={...B,metadata:{...B.metadata,...v.data.metadata}},B)),(F=v==null?void 0:v.data)!=null&&F.attachments&&u.editMessageNodeById(u.getLastMessage().id,B=>(B={...B,attachments:[...v.data.attachments]},B))),u.editMessageNodeById(u.getLastMessage().id,B=>(B.status==="LOADING"?(B.content=S,B.role="assistant",B.status="STREAMING"):B.status==="STREAMING"&&(B.content=`${B.content}${S}`),B))},onOpen:async p=>{const v=p.headers.get("X-Request-Id");p.ok&&v&&f(v)}}),N=(b==null?void 0:b.status)==="success"||(b==null?void 0:b.status)==="idle",d=async p=>{var A,C,M,P,L;u.setIsPromptingAvailable(!1),b.reset(),u.setError(null),u.setQuestions([]);const v=(A=y.details)==null?void 0:A.aiLanguage;u.appendMessageThread([{content:p,id:ie(),parentId:((C=u.activeThread[u.activeThread.length-1])==null?void 0:C.id)??"root",role:"user",status:"SUCCESS"},{content:"",id:ie(),parentId:"",role:"system",status:"LOADING"}]);const S={context:{forwarding:!1,messages:r,signature:"",thread:u.activeThread,user:(L=(P=(M=document==null?void 0:document.querySelector("div.gb_Z.gb_C a"))==null?void 0:M.getAttribute("aria-label"))==null?void 0:P.replace("Google Account: ",""))==null?void 0:L.replace(`
`,"")},gmailPersona:T,language:v,modelId:T.model??`${i.isPaid?"GPT 4":"GPT 3"}`,mountOn:a,query:p};u.setContext(""),b.execute(S),u.setContext(""),ma()},j=async()=>{var S,A,C,M;u.setIsPromptingAvailable(!1);const p=(S=y.details)==null?void 0:S.aiLanguage;u.setError(null),u.insertMessageNode(u.activeThread[u.activeThread.length-2].id,{content:"",id:ie(),parentId:u.activeThread[u.activeThread.length-2].id,role:"system",status:"LOADING"});const v={context:{forwarding:!1,messages:r,signature:"",thread:u.activeThread.splice(0,u.activeThread.length-2),user:(M=(C=(A=document==null?void 0:document.querySelector("div.gb_Z.gb_C a"))==null?void 0:A.getAttribute("aria-label"))==null?void 0:C.replace("Google Account: ",""))==null?void 0:M.replace(`
`,"")},gmailPersona:T,language:p,modelId:(T==null?void 0:T.model)??`${i.isPaid?"GPT 4":"GPT 3"}`,mountOn:a,query:u.activeThread[u.activeThread.length-2].content};b.execute(v)};return E.useEffect(()=>{h&&i.isAuthenticated&&(d(h),g(""))},[]),E.useEffect(()=>{I&&I.disconnect();const p=ir();if(!p)return;const v=p.getElementById("reactAppRoot");if(!v)return;const S=v.querySelector(`.${t}`);if(!S)return;const A=S.querySelector("#user-msg-body");if(!A)return;const C=new IntersectionObserver(function(M){const P=S.querySelector("#user-msg-body");P&&(M[0].isIntersecting?P.classList.add("line-clamp-1"):P.classList.remove("line-clamp-1"))},{root:v.querySelector(`.intersection-observer-root.${t}`),rootMargin:"0% 0% -95% 0%",threshold:[0,1]});C.observe(A),O(C)},[u.activeThread.length]),i.isAuthenticated?c==="SETTINGS"?n.jsx(fa,{setCurrentMode:l}):u.activeThread.length===0?n.jsxs(oe,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[n.jsx("div",{className:"absolute -right-3 -top-3 cursor-pointer rounded-full bg-secondary p-1 shadow-lg",onClick:()=>s(!1),children:n.jsx(Xe,{className:"h-4 w-4"})}),n.jsx(Oe,{className:"p-0",children:n.jsx(it,{placeholder:o("super_gmail.draft_nice"),onChange:p=>w(p.target.value),value:x,className:"h-48 resize-none border-transparent focus-visible:border-transparent focus-visible:ring-0",onKeyUp:p=>{p.key==="Enter"&&x.trim()&&!p.shiftKey&&(d(x.trim()),w(""))}})}),n.jsxs(Me,{className:"mt-2 flex justify-between gap-2 p-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Je,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{k({eventName:"IntroduceMyselfQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Write an email introducing myself.")},children:o("super_gmail.introduce")}),n.jsx(Je,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{k({eventName:"ColdEmailQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Write a cold email")},children:o("super_gmail.cold_email")})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx(q,{variant:"ghost",size:"icon",className:"rounded-none border-r px-1 hover:bg-transparent",onClick:()=>{x.trim()&&d(x.trim()),w("")},children:n.jsx(Ze,{className:"cursor-pointer text-primary"})}),n.jsx(q,{variant:"ghost",size:"icon",onClick:()=>l("SETTINGS"),children:n.jsx(Mt,{className:"cursor-pointer"})})]})]})]}):n.jsx(n.Fragment,{children:n.jsxs(oe,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[n.jsx("div",{className:"absolute -right-3 -top-3 cursor-pointer rounded-full bg-secondary p-1 shadow-lg",onClick:()=>s(!1),children:n.jsx(Xe,{className:"h-4 w-4"})}),n.jsx(Oe,{className:"p-0",children:n.jsx(qe,{className:`intersection-observer-root h-[320px] ${t}`,children:n.jsxs("div",{className:"flex min-h-[320px] flex-col",children:[(R=u.activeThread)==null?void 0:R.map((p,v)=>n.jsx(pa,{msg:p,handleRegenerateLastMessage:j,chat:u,idx:v,handleInsert:e,handleSSE:b,isSSESuccessOrIdle:N,isLastMessage:u.activeThread.length-1===v&&p.role==="assistant",requestIdHeader:m,mountOn:a},p.id)),u.error&&!u.error.includes("Your queries have exhausted")&&n.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2 text-red-500",children:[n.jsx("div",{className:"p-0 text-sm",children:u.error}),n.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:n.jsx(q,{onClick:()=>{const p=u.activeThread[u.activeThread.length-1].content;p&&d(p)},children:o("super_gmail.retry")})})]}),u.error&&u.error.includes("Your queries have exhausted")&&n.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"flex",children:[n.jsx("img",{className:"h-8 w-8",src:Ot(kr),alt:"face-in-cloud"}),n.jsx("img",{className:"h-8 w-8",src:Ot(Fr),alt:"lightning"})]}),n.jsx("div",{className:"p-0 text-sm",children:o("super_gmail.out_of_queries")})]}),n.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:n.jsx(q,{onClick:()=>Be(yr),children:o("super_gmail.go_pro")})})]})]})})}),n.jsxs(Me,{className:"flex justify-between gap-2 p-0 pt-1",children:[n.jsxs("div",{className:"relative flex w-full items-center",children:[n.jsx(Vt,{onChange:p=>w(p.target.value),value:x,id:"promptInput",className:"pr-8",placeholder:o("super_gmail.follow_up_prompt"),autoComplete:"off",onKeyUp:p=>{p.key==="Enter"&&N&&x.trim()&&(d(x.trim()),w(""))}}),N?n.jsx(Ze,{onClick:()=>{x.trim()&&N&&(d(x.trim()),w(""))},className:"absolute right-2 cursor-pointer bg-background text-primary"}):n.jsx(q,{size:"icon",variant:"ghost",className:"absolute right-2 h-5 w-5 text-xs",onClick:()=>{k({eventName:"StopGenerating",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),u.getLastMessage().content==""&&u.deleteLastMessage(),b.close()},children:n.jsx(Xr,{className:"plain-icon-color h-5 w-5 animate-pulse fill-red-600 stroke-[1.5]"})}),n.jsx(Xt,{children:N&&(o("super_gmail.shorten").toLowerCase().includes(x.toLowerCase())||o("super_gmail.lengthen").toLowerCase().includes(x.toLowerCase())||o("super_gmail.improve").toLowerCase().includes(x.toLowerCase())||o("super_gmail.simplify").toLowerCase().includes(x.toLowerCase())||o("super_gmail.fix_spelling").toLowerCase().includes(x.toLowerCase()))&&n.jsx(Se.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"absolute top-10 w-4/5",children:n.jsx(oe,{className:"rounded-md py-2",children:n.jsx(qe,{className:"max-h-28 overflow-y-scroll",children:n.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[o("super_gmail.shorten").toLowerCase().includes(x.toLowerCase())&&n.jsx("div",{onClick:()=>{k({eventName:"ShortenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Shorten it to 50 words")},className:"cursor-pointer px-2 py-1 hover:bg-secondary",children:o("super_gmail.shorten")}),o("super_gmail.improv").toLowerCase().includes(x.toLowerCase())&&n.jsx("span",{onClick:()=>{k({eventName:"ImproveWritingQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Improve writing")},className:"cursor-pointer px-2 py-1 hover:bg-secondary",children:o("super_gmail.improve")}),o("super_gmail.simplify").toLowerCase().includes(x.toLowerCase())&&n.jsx("span",{onClick:()=>{k({eventName:"SimplifyQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Simplify the language")},className:"cursor-pointer px-2 py-1 hover:bg-secondary",children:o("super_gmail.simplify")}),o("super_gmail.lengthen").toLowerCase().includes(x.toLowerCase())&&n.jsx("span",{onClick:()=>{k({eventName:"LengthenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Make it longer and verbose")},className:"cursor-pointer px-2 py-1 hover:bg-secondary",children:o("super_gmail.lengthen")}),o("super_gmail.fix_spelling").toLowerCase().includes(x.toLowerCase())&&n.jsx("span",{onClick:()=>{k({eventName:"FixSpellingGrammarQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("Fix spelling & grammar")},className:"cursor-pointer px-2 py-1 hover:bg-secondary",children:o("super_gmail.fix_spelling")})]})})})})})]}),n.jsx(q,{variant:"ghost",size:"icon",onClick:()=>{k({eventName:"SettingsBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),l("SETTINGS")},children:n.jsx(Mt,{className:"cursor-pointer"})})]})]})}):n.jsxs(oe,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[n.jsx("div",{className:"absolute -right-3 -top-3 cursor-pointer rounded-full bg-secondary p-1 shadow-lg",onClick:()=>s(!1),children:n.jsx(Xe,{className:"h-4 w-4"})}),n.jsx(Ut,{className:"mb-2 p-0",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"h-5 w-5",children:n.jsx($e,{})}),n.jsx("span",{className:"text-lg",children:o("merlin")})]})}),n.jsx(se,{}),n.jsx(Oe,{className:"px-2 py-3 text-sm",children:o("super_gmail.login")}),n.jsx(Me,{className:"flex justify-between gap-2 px-2 py-0",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(q,{onClick:()=>Be(At),children:o("super_gmail.login2")}),n.jsx(q,{variant:"ghost",onClick:()=>Be(At),children:o("super_gmail.signup")})]})})]})}const ha=({attributes:e,forceUpdate:t,handleInsert:r,id:a,setIsVisible:s,setPopperElement:o,styles:i})=>{const[c,l]=E.useState(!0),[m,f]=E.useState(!0);return E.useEffect(()=>{const u=new MutationObserver(st(()=>{if(t&&t(),!document.querySelector(`.${a}`)){l(!1),u.disconnect();return}},100));return u.observe(document.body,{childList:!0,subtree:!0}),()=>u.disconnect()},[a,t]),E.useEffect(()=>{const u=document.querySelector(`.${a}`);if(!u)return;const h=u.closest(".nH");if(!h)return;const g=new MutationObserver(()=>{try{const y=u.closest(".nH");if(!y)return;y.style.display==="none"?f(!1):f(!0)}catch{}});return g.observe(h,{attributeFilter:["style"],attributes:!0}),()=>g.disconnect()},[a]),c?n.jsx("div",{ref:o,style:i.popper,...e.popper,className:`mb-48 ${m?"":"hidden"}`,children:n.jsx(Se.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:n.jsx(ht,{handleInsert:r,setIsVisible:s,mountOn:"GMAIL_COMPOSE",id:a})})}):null};function va({id:e}){var I,O;const[t,r]=Ke.useState(null),[a,s]=E.useState(null),{attributes:o,forceUpdate:i,styles:c}=sr(t,a,{placement:"top"}),[l,m]=E.useState(!1),f=X(b=>b.usingAIComposeBtn),u=X(b=>b.toggleUsingAIComposeBtn),[h,g]=E.useState(null),[y,x]=E.useState(null),w=je(),T=b=>{try{const N=/^Subject: .*(\r?\n|\r)/,R=b.trim().replace(N,"").split(`
`).map(C=>C===""?"<div></div><br/>":`<div>${C}</div>`),p=document.querySelector(`.fab-writer.${e}`);if(!p)return;const v=p.closest(".nH.Hd");if(!v)return;const S=v.querySelector("[contenteditable=true]");if(!S)return;S.innerHTML=R.join(`
`)+`
`+S.innerHTML;const A=v.querySelector("[name='subjectbox']");if(A){const C=b.trim().match(N);C&&(A.value=C[0])}m(!1)}catch{}};if(E.useEffect(()=>{f&&(m(!0),u());const b=document.getElementById("merlin-gmail-uicomponentportal");if(b&&b.shadowRoot){const d=b.shadowRoot.getElementById("reactAppRoot");x(d)}const N=document.querySelector(`.merlin.fab-btn.${e}`);if(N&&N.shadowRoot){const d=N.shadowRoot.getElementById("reactAppRootBtn");g(d)}},[]),(O=(I=w.details)==null?void 0:I.gmail)!=null&&O.isEnabled)return n.jsx(nt,{children:n.jsx(at,{children:n.jsx(zt,{children:n.jsx(Yt,{children:n.jsx(ot,{overrideThemeForWebsite:!0,children:n.jsxs("div",{className:"flex w-full justify-center",children:[n.jsx("div",{ref:r,className:`${e}`}),y&&l&&le.createPortal(n.jsx(ha,{setPopperElement:s,styles:c,attributes:o,setIsVisible:m,id:e,handleInsert:T,forceUpdate:i}),y),h&&le.createPortal(n.jsxs(q,{type:"button",onClick:()=>m(b=>!b),className:"px-2",children:[n.jsx("div",{className:"mr-1 h-5 w-5",children:n.jsx($e,{})}),n.jsx("span",{children:"AI"})]}),h)]})})})})})})}const vt=(e,t)=>{var a,s,o,i,c,l,m,f,u;const r=e.querySelector("blockquote.gmail_quote");if(r){const h=((s=(a=r.parentNode)==null?void 0:a.querySelector(".gmail_attr"))==null?void 0:s.textContent)??((o=r.parentNode)==null?void 0:o.textContent)??"",g=new RegExp("(?<=<)(.*?)(?=>)"),y=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,x=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),w=new RegExp("(?<=<)(.*?)(?=>)"),T=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,I=((c=(i=h.match(x))==null?void 0:i[0])==null?void 0:c.replace(/\b(?:AM|PM)\b/g,""))??"",O=((l=h.match(g))==null?void 0:l[0])??((m=h.match(w))==null?void 0:m[0]),b=((f=h.match(y))==null?void 0:f[0])??((u=h.match(T))==null?void 0:u[0]),N=r.querySelector("blockquote.gmail_quote"),d=r.querySelector(".gmail_attr");let j="";r.textContent&&(j=r.textContent,N&&N.textContent&&(j=j.replace(N.textContent,"")),d&&d.textContent&&(j=j.replace(d.textContent,""))),t.push({content:j==null?void 0:j.replace(/\s\s+/gm," "),email:O,name:I,timestamp:b}),vt(r,t)}},ga=/^Subject: .*(\r?\n|\r)/,xa=({attributes:e,forceUpdate:t,handleInsert:r,id:a,mailThread:s,setIsVisible:o,setPopperElement:i,styles:c})=>{const[l,m]=E.useState(!0),[f,u]=E.useState(!0);return E.useEffect(()=>{const h=new MutationObserver(st(()=>{if(t&&t(),!document.querySelector(`.${a}`)){m(!1),h.disconnect();return}},100));return h.observe(document.body,{childList:!0,subtree:!0}),()=>h.disconnect()},[a,t]),E.useEffect(()=>{const h=document.querySelector(`.${a}`);if(!h)return;const g=h.closest(".nH");if(!g)return;const y=new MutationObserver(()=>{try{const x=h.closest(".nH");if(!x)return;x.style.display==="none"?u(!1):u(!0)}catch{}});return y.observe(g,{attributeFilter:["style"],attributes:!0}),()=>y.disconnect()},[a]),l?n.jsx("div",{ref:i,style:c.popper,...e.popper,className:`mb-48 ${f?"":"hidden"}`,children:n.jsx(Se.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:n.jsx(ht,{handleInsert:r,setIsVisible:o,mountOn:"GMAIL_REPLY",id:a,mailThread:s})})}):null};function ya({aiReplyMountId:e}){var b,N;const[t,r]=Ke.useState(null),[a,s]=Ke.useState(null),{attributes:o,forceUpdate:i,styles:c}=sr(t,a,{placement:"top"}),[l,m]=E.useState(null),[f,u]=E.useState(null),h=je(),[g,y]=E.useState([]),[x,w]=E.useState(!1),T=X(d=>d.usingAIComposeBtn),I=X(d=>d.toggleUsingAIComposeBtn);E.useEffect(()=>{(()=>{var S,A;const j=[],R=(S=document.querySelector(`.merlin.fab-btn.${e}`))==null?void 0:S.closest(".ip.adB");if(!R)return;const p=R.querySelector("img.ajT");p&&((A=p==null?void 0:p.parentElement)==null||A.click());const v=R.querySelector(".gmail_quote");v&&(vt(v,j),y(j.reverse()))})()},[e]);const O=d=>{try{d=d.trim().replace(ga,"");const R=d.split(`
`).map(A=>A===""?"<div></div><br/>":`<div>${A}</div>`),p=document.querySelector(`.fab-writer.${e}`);if(!p)return;const v=p.closest(".ip.adB");if(!v)return;const S=v.querySelector("[contenteditable=true]");if(!S)return;S.innerHTML=R.join(`
`)+`
`+S.innerHTML,w(!1)}catch{}};if(E.useEffect(()=>{T&&(w(!0),I());const d=document.getElementById("merlin-gmail-uicomponentportal");if(d&&d.shadowRoot){const R=d.shadowRoot.getElementById("reactAppRoot");R&&m(R)}const j=document.querySelector(`.merlin.fab-btn.${e}`);if(j&&j.shadowRoot){const R=j.shadowRoot.getElementById("reactAppRootBtn");R&&u(R)}},[]),(N=(b=h.details)==null?void 0:b.gmail)!=null&&N.isEnabled)return n.jsx(nt,{children:n.jsx(at,{children:n.jsx(zt,{children:n.jsx(Yt,{children:n.jsx(ot,{overrideThemeForWebsite:!0,children:n.jsxs("div",{className:"flex w-full justify-center",children:[x&&l&&le.createPortal(n.jsx(xa,{setPopperElement:s,styles:c,attributes:o,setIsVisible:w,id:e,handleInsert:O,forceUpdate:i,mailThread:g}),l),f&&le.createPortal(n.jsxs(q,{type:"button",onClick:()=>w(d=>!d),className:`z-50 px-2 ${e}`,ref:r,children:[n.jsx("div",{className:"mr-1 h-5 w-5",children:n.jsx($e,{})}),n.jsx("span",{children:"AI"})]}),f)]})})})})})})}const ba=()=>({getUserPrompts:wr({queryFn:async()=>await Qr(),queryKey:["userPrompts"]})}),wa=[{promptName:"Friendly",promptTag:"GmailReply",promptText:"Write a friendly reply in an informal tone"},{promptName:"Funny",promptTag:"GmailReply",promptText:"Write a funny reply"},{promptName:"Professional",promptTag:"GmailReply",promptText:"Write a professional reply"}],ja=({handleInsert:e,id:t,mailThread:r,setIsVisible:a})=>n.jsx("div",{className:"absolute translate-x-[60vw] translate-y-1/4",children:n.jsx(Se.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},children:n.jsx(ht,{setIsVisible:a,mailThread:r,handleInsert:e,mountOn:"GMAIL_REPLY",id:t})})}),Sa=({id:e})=>{var I,O,b,N;const{t}=Ge(),[r,a]=E.useState(!1),[s,o]=E.useState([]),[i,c]=E.useState(""),l=X(d=>d.setQuickPromptAIReply),m=E.useRef(null),[f,u]=E.useState(null),{getUserPrompts:h}=ba(),g=E.useMemo(()=>{var d,j,R;return(R=(j=(d=h==null?void 0:h.data)==null?void 0:d.userPrompts)==null?void 0:j.userMade)==null?void 0:R.filter(p=>{var v,S,A,C,M;return((v=p==null?void 0:p.promptTag)==null?void 0:v.includes("GmailReply"))&&(((A=(S=p==null?void 0:p.promptName)==null?void 0:S.toLocaleLowerCase())==null?void 0:A.includes(i==null?void 0:i.toLocaleLowerCase()))||((M=(C=p==null?void 0:p.promptText)==null?void 0:C.toLocaleLowerCase())==null?void 0:M.includes(i==null?void 0:i.toLocaleLowerCase())))})},[i,(O=(I=h==null?void 0:h.data)==null?void 0:I.userPrompts)==null?void 0:O.userMade]),y=E.useMemo(()=>{var d,j,R;return(R=(j=(d=h==null?void 0:h.data)==null?void 0:d.userPrompts)==null?void 0:j.userMade)==null?void 0:R.filter(p=>{var v,S,A,C,M;return!((v=p==null?void 0:p.promptTag)!=null&&v.includes("GmailReply"))&&(((A=(S=p==null?void 0:p.promptName)==null?void 0:S.toLocaleLowerCase())==null?void 0:A.includes(i==null?void 0:i.toLocaleLowerCase()))||((M=(C=p==null?void 0:p.promptText)==null?void 0:C.toLocaleLowerCase())==null?void 0:M.includes(i==null?void 0:i.toLocaleLowerCase())))})},[i,(N=(b=h==null?void 0:h.data)==null?void 0:b.userPrompts)==null?void 0:N.userMade]),x=wa.filter(d=>{var j,R,p,v,S;return((j=d==null?void 0:d.promptTag)==null?void 0:j.includes("GmailReply"))&&(((p=(R=d==null?void 0:d.promptName)==null?void 0:R.toLocaleLowerCase())==null?void 0:p.includes(i==null?void 0:i.toLocaleLowerCase()))||((S=(v=d==null?void 0:d.promptText)==null?void 0:v.toLocaleLowerCase())==null?void 0:S.includes(i==null?void 0:i.toLocaleLowerCase())))}),w=async({prompt:d})=>{const j=[],R=document.querySelector(`.merlin-external.${e}`);if(R){const p=R.closest('[role="listitem"]');if(p){const v=p.querySelector(".a3s.aiL"),S=p.querySelector("blockquote.gmail_quote"),A=p.querySelector("[name][email]"),C=p.querySelector("[alt][title]");let M="";v&&v.textContent&&(M=v.textContent),S&&S.textContent&&M&&(M=M.replace(S.textContent,""));const P=(A==null?void 0:A.getAttribute("email"))||"",L=(A==null?void 0:A.getAttribute("name"))||"",F=(C==null?void 0:C.getAttribute("title"))||"";j.push({content:M,email:P,name:L,timestamp:F}),S&&vt(S,j)}}o(j.reverse()),l(d),await new Promise(p=>{a(v=>!v),setTimeout(()=>p(!0),50)}),await new Promise(p=>{a(!0),setTimeout(()=>p(!0),50)})},T=d=>{try{const j=/^Subject: .*(\r?\n|\r)/;d=d.trim().replace(j,"");const p=d.split(`
`).map(C=>C===""?"<div></div><br/>":`<div>${C}</div>`),v=document.querySelector(`.merlin-external.${e}`);if(!v)return;const S=v.closest(".gA.gt");if(!S)return;const A=S.querySelector(".ams.bkI, .ams.bkH");if(!A)return;A.click(),setTimeout(()=>{const C=S.querySelector("[contenteditable=true]");C&&(C.innerHTML=p.join(`
`)+`

`+(C.innerHTML??""))},50),a(!1)}catch{}};return E.useEffect(()=>{m.current&&(m.current.style.height="auto",m.current.style.height=m.current.scrollHeight+"px")},[i]),E.useEffect(()=>{const d=document.getElementById("merlin-gmail-uicomponentportal");if(d&&d.shadowRoot){const j=d.shadowRoot.getElementById("reactAppRoot");j&&u(j)}},[]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"relative mb-2.5 ml-24 flex items-end gap-3 py-1",id:"ai-reply",children:[n.jsx("div",{className:"absolute -left-10 top-1.5 h-7 w-7",children:n.jsx($e,{})}),n.jsx(it,{onChange:d=>c(String(d.target.value)),rows:1,value:i,ref:m,placeholder:"Write your reply to generate with AI",className:Et("peer min-h-1 w-80 transition-all duration-200 ease-in-out focus:w-[26.68rem]",i.length&&"w-[26.68rem]"),onKeyDown:d=>{d.key==="Enter"&&i.trim()&&!d.shiftKey&&(w({prompt:i.trim()}),setTimeout(()=>{c("")},0))}}),n.jsxs(q,{onClick:()=>{k({eventName:"GenerateAIReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),w({prompt:i}),c("")},variant:"default",className:Et("items-center justify-center peer-focus:flex",!i.length&&"hidden"),children:[t("Generate"),n.jsx(Ze,{className:"ml-2 h-5 w-5"})]}),!i.length&&n.jsxs(n.Fragment,{children:[n.jsx(q,{onClick:()=>{k({eventName:"YesQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),w({prompt:"Respond to these matters affirmatively, expressing your interest."})},variant:"outline",className:"peer-focus:hidden",children:t("yes")}),n.jsx(q,{onClick:()=>{k({eventName:"NoQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),w({prompt:"Respond to these matters saying no, expressing your rejection or dis-interest."})},variant:"outline",className:"peer-focus:hidden",children:t("no")}),n.jsx(q,{onClick:()=>{k({eventName:"FollowUpQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),w({prompt:"Write a email to follow up again"})},variant:"outline",className:"peer-focus:hidden",children:t("super_gmail.follow_up")})]}),n.jsx(Xt,{children:(i==null?void 0:i.length)&&((x==null?void 0:x.length)||g&&(g==null?void 0:g.length)||y&&(y==null?void 0:y.length))&&n.jsx(Se.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"left-26 absolute top-12 z-10 ml-0 w-[26.68rem]",children:n.jsx(oe,{className:"rounded-md py-2",children:n.jsx(qe,{className:"max-h-28 overflow-scroll",children:n.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[n.jsxs(n.Fragment,{children:[g&&(g==null?void 0:g.length)!==0&&n.jsx("p",{className:"ml-2 text-xs text-muted-foreground",children:"Gmail Prompts"}),g&&(g==null?void 0:g.map(d=>n.jsx("div",{onClick:()=>{w({prompt:d.promptText}),c("")},className:"cursor-pointer px-3 py-1 hover:bg-secondary",children:t(d.promptName)},d.id)))]}),g&&(g==null?void 0:g.length)!==0&&(x==null?void 0:x.length)!==0&&n.jsx(se,{}),n.jsxs(n.Fragment,{children:[(x==null?void 0:x.length)!==0&&n.jsx("p",{className:"ml-2 mt-1 text-xs text-muted-foreground",children:"Recommended Prompts"}),x==null?void 0:x.map((d,j)=>n.jsx("div",{onClick:()=>{k({eventName:`${d.promptName}QuickReply`,eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),w({prompt:d.promptText}),c("")},className:"cursor-pointer px-3 py-1 hover:bg-secondary",children:t(`${d.promptName} Reply`)},j))]}),(x==null?void 0:x.length)!==0&&y&&(y==null?void 0:y.length)!==0&&n.jsx(se,{}),n.jsxs(n.Fragment,{children:[y&&(y==null?void 0:y.length)!==0&&n.jsx("p",{className:"ml-2 mt-1 text-xs text-muted-foreground",children:"Other Prompts"}),y&&(y==null?void 0:y.map(d=>n.jsx("div",{onClick:()=>{w({prompt:d.promptText}),c("")},className:"cursor-pointer px-3 py-1 hover:bg-secondary",children:t(d.promptName)},d.id)))]})]})})})})})]}),f&&r&&le.createPortal(n.jsx(ja,{setIsVisible:a,mailThread:s,handleInsert:T,id:e}),f)]})};function Na({id:e}){var r,a;return(a=(r=je().details)==null?void 0:r.gmail)!=null&&a.isEnabled?n.jsx(nt,{children:n.jsx(at,{children:n.jsx(ot,{overrideThemeForWebsite:!0,children:n.jsx(Sa,{id:e})})})}):null}function Ca(){var s,o;const e=X(i=>i.toggleUsingAIComposeBtn),t=je(),[r,a]=E.useState(!0);return E.useEffect(()=>{var l;const i=(l=document.querySelector(".T-I-KE"))==null?void 0:l.closest("[role='navigation']"),c=document.querySelector("[aria-label='Main menu']");if(i&&c){a(!1);const m=new MutationObserver(()=>{i.classList.contains("bym")||c.getAttribute("aria-expanded")==="true"?a(!0):a(!1)});m.observe(i,{attributeFilter:["class"],attributes:!0}),m.observe(c,{attributeFilter:["class"],attributes:!0}),c.getAttribute("aria-expanded")==="true"&&!i.classList.contains("bhz")&&a(!0)}},[]),E.useEffect(()=>{const i=document.querySelector(".T-I-KE");i&&(i.style.zIndex="1",i.parentElement&&(i.parentElement.style.position="relative"))},[]),(o=(s=t.details)==null?void 0:s.gmail)!=null&&o.isEnabled?n.jsx("button",{type:"button",onClick:()=>{k({eventName:"GlobalAiComposeBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/AIComposeBtn"}),e(),document.querySelector(".T-I-KE").click()},className:`absolute bottom-0 left-32 top-0 animate-border items-stretch rounded-r-2xl bg-gradient-to-t from-fuchsia-200 via-purple-300 to-indigo-100 p-0.5 shadow-lg active:shadow-sm ${r?"":"hidden"}`,children:n.jsx("div",{className:"flex h-full items-center rounded-r-2xl bg-background px-5 pl-7 text-primary transition-all hover:pl-8",children:"AI"})}):null}const Aa=()=>new Promise(e=>{if(window.location.origin.includes("mail.google.com")){const t=new MutationObserver(()=>{const r=document.getElementById("loading");r&&r.style.display==="none"&&(e(r),t.disconnect())});t.observe(document.body,{childList:!0,subtree:!1})}}),Ea=async e=>{var u;const t=`u${ie()}`,r=document.createElement("merlin-component"),a=document.createElement("merlin-button-component");r.className=`merlin fab-writer ${t}`,a.className=`merlin fab-btn ${t}`;const s=r.attachShadow({mode:"open"}),o=a.attachShadow({mode:"open"}),i=document.createElement("style"),c=document.createElement("style");i.textContent=`${re}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,c.textContent=`${re}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const l=document.createElement("div");l.id="reactAppRoot",l.className="reactAppRoot fabStrip";const m=document.createElement("div");m.id="reactAppRootBtn",m.className="reactAppRootBtn fabBtn center-with-flex",s.appendChild(i),s.appendChild(l),(u=e.querySelector("#sbddm"))==null||u.insertAdjacentElement("afterend",r),o.appendChild(c),o.appendChild(m);try{const h=e.querySelector(".gU.aYL");h&&(h.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",h.append(a))}catch{}Fe.forEach(h=>{l.addEventListener(h,g=>{g.stopPropagation()})});const f=ce(l);ce(m),f.render(n.jsx(va,{id:t}))},Ra=async e=>{var u;const t=`u${ie()}`,r=document.createElement("merlin-component"),a=document.createElement("merlin-button-component");r.className=`merlin fab-writer ${t}`,a.className=`merlin fab-btn ${t}`;const s=r.attachShadow({mode:"open"}),o=a.attachShadow({mode:"open"}),i=document.createElement("style"),c=document.createElement("style");i.textContent=`${re}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,c.textContent=`${re}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const l=document.createElement("div");l.id="reactAppRoot",l.className="reactAppRoot fabStrip";const m=document.createElement("div");m.id="reactAppRootBtn",m.className="reactAppRootBtn fabBtn center-with-flex",s.appendChild(i),s.appendChild(l),(u=e.querySelector("#sbddm"))==null||u.insertAdjacentElement("afterend",r),o.appendChild(c),o.appendChild(m);try{const h=e.querySelector(".gU.aYL");h&&(h.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",h.append(a))}catch{}Fe.forEach(h=>{l.addEventListener(h,g=>{g.stopPropagation()})});const f=ce(l);ce(m),f.render(n.jsx(ya,{aiReplyMountId:t}))},Ta=async e=>{const t=`u${ie()}`,r=document.createElement("merlin-component");r.className=`merlin fab-writer merlin-external ${t}`;const a=r.attachShadow({mode:"open"}),s=document.createElement("style");s.textContent=`${re}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `;const o=document.createElement("div");o.id="reactAppRoot",o.className="reactAppRoot fabStrip",Fe.forEach(c=>{o.addEventListener(c,l=>{l.stopPropagation()})}),a.appendChild(s),a.appendChild(o),e.prepend(r),ce(o).render(n.jsx(Na,{id:t}))},Ia=async()=>{const e=document.createElement("merlin-component");e.className="merlin ai-compose-btn";const t=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`${re}
      .ai-compose-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const a=document.createElement("div");a.id="reactAppRootBtn",a.className="reactAppRootBtn",t.appendChild(r),t.appendChild(a);const s=document.querySelector(".T-I-KE");if(s&&s.parentNode)s.parentNode.append(e);else{const o=document.querySelector(".z0");o&&o.append(e)}ce(a).render(n.jsx(Ca,{}))},Oa=async()=>{if(document.getElementById("merlin-gmail-uicomponentportal"))return;const e=document.createElement("merlin-component");e.id="merlin-gmail-uicomponentportal",e.className="merlin merlin-gmail-uicomponentportal";const t=e.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`${re}
    :host(#merlin-gmail-uicomponentportal) {
    }   
    .reactAppRoot {
      all: initial; /* 1st rule so subsequent properties are reset. */
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 2147483640;
    }
    `.replaceAll(":root",":host");const a=document.createElement("div");a.id="reactAppRoot",a.className="reactAppRoot",Fe.forEach(s=>{a.addEventListener(s,o=>{o.stopPropagation()})}),t.appendChild(r),t.appendChild(a),document.documentElement.append(e)},Ma=async()=>{Oa();const e=await jr.fetchQuery(Sr.MerlinConfig);if(e&&!e.fabStrip.gmail.visible)return;await Aa();const t=new MutationObserver(st(()=>{const a=document.querySelectorAll(".nH.Hd");if(a.length>0)for(let i=0;i<a.length;i+=1){const c=a[i].querySelector("merlin-component"),l=a[i].querySelector("merlin-button-component");!c&&!l&&Ea(a[i])}const s=document.querySelectorAll(".ip.adB");if(s.length>0)for(let i=0;i<s.length;i+=1){const c=s[i].querySelector("merlin-component"),l=s[i].querySelector("merlin-button-component");!c&&!l&&Ra(s[i])}const o=document.querySelectorAll(".gA.gt");if(o.length>0){const i=o[o.length-1];let c=document.querySelector(".merlin.fab-writer.merlin-external");!i.querySelector(".merlin.fab-writer.merlin-external")&&c&&(c.remove(),c=null),c||Ta(i)}},300)),r={attributes:!0,childList:!0,subtree:!1};t.observe(document.body,r),Ia()};Ma();
