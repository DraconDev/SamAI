function Q(e){return e}function O(e){return{mutationKey:e.options.mutationKey,state:e.state,...e.options.scope&&{scope:e.options.scope},...e.meta&&{meta:e.meta}}}function E(e,t,a){var r;return{state:{...e.state,...e.state.data!==void 0&&{data:t(e.state.data)}},queryKey:e.queryKey,queryHash:e.queryHash,...e.state.status==="pending"&&{promise:(r=e.promise)==null?void 0:r.then(t).catch(s=>a(s)?Promise.reject(new Error("redacted")):Promise.reject(s))},...e.meta&&{meta:e.meta}}}function S(e){return e.state.isPaused}function z(e){return e.state.status==="success"}function P(e){return!0}function w(e,t={}){var l,f,d,n;const a=t.shouldDehydrateMutation??((l=e.getDefaultOptions().dehydrate)==null?void 0:l.shouldDehydrateMutation)??S,r=e.getMutationCache().getAll().flatMap(i=>a(i)?[O(i)]:[]),s=t.shouldDehydrateQuery??((f=e.getDefaultOptions().dehydrate)==null?void 0:f.shouldDehydrateQuery)??z,u=t.shouldRedactErrors??((d=e.getDefaultOptions().dehydrate)==null?void 0:d.shouldRedactErrors)??P,c=t.serializeData??((n=e.getDefaultOptions().dehydrate)==null?void 0:n.serializeData)??Q,o=e.getQueryCache().getAll().flatMap(i=>s(i)?[E(i,c,u)]:[]);return{mutations:r,queries:o}}function R(e,t,a){var l,f;if(typeof t!="object"||t===null)return;const r=e.getMutationCache(),s=e.getQueryCache(),u=((l=a==null?void 0:a.defaultOptions)==null?void 0:l.deserializeData)??((f=e.getDefaultOptions().hydrate)==null?void 0:f.deserializeData)??Q,c=t.mutations||[],o=t.queries||[];c.forEach(({state:d,...n})=>{var i,y;r.build(e,{...(i=e.getDefaultOptions().hydrate)==null?void 0:i.mutations,...(y=a==null?void 0:a.defaultOptions)==null?void 0:y.mutations,...n},d)}),o.forEach(({queryKey:d,state:n,queryHash:i,meta:y,promise:m})=>{var D,b;let h=s.get(i);const C=n.data===void 0?n.data:u(n.data);if(h){if(h.state.dataUpdatedAt<n.dataUpdatedAt){const{fetchStatus:g,...M}=n;h.setState({...M,data:C})}}else h=s.build(e,{...(D=e.getDefaultOptions().hydrate)==null?void 0:D.queries,...(b=a==null?void 0:a.defaultOptions)==null?void 0:b.queries,queryKey:d,queryHash:i,meta:y},{...n,data:C,fetchStatus:"idle"});if(m){const g=Promise.resolve(m).then(u);h.fetch(void 0,{initialPromise:g})}})}var A=["added","removed","updated"];function v(e){return A.includes(e)}async function K({queryClient:e,persister:t,maxAge:a=1e3*60*60*24,buster:r="",hydrateOptions:s}){try{const u=await t.restoreClient();if(u)if(u.timestamp){const c=Date.now()-u.timestamp>a,o=u.buster!==r;c||o?t.removeClient():R(e,u.clientState,s)}else t.removeClient()}catch{t.removeClient()}}async function p({queryClient:e,persister:t,buster:a="",dehydrateOptions:r}){const s={buster:a,timestamp:Date.now(),clientState:w(e,r)};await t.persistClient(s)}function j(e){const t=e.queryClient.getQueryCache().subscribe(r=>{v(r.type)&&p(e)}),a=e.queryClient.getMutationCache().subscribe(r=>{v(r.type)&&p(e)});return()=>{t(),a()}}function q(e){let t=!1,a;const r=()=>{t=!0,a==null||a()},s=K(e).then(()=>{t||(a=j(e))});return[r,s]}export{j as a,q as b,z as d,K as p};
