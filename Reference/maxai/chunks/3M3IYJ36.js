import{b as q,d as qt}from"./DKMNSB2V.js";import{i as R,k as Te,x as z,y as k}from"./WINLMBYH.js";import{n as Ut,s as Wt,t as Xt,u as $t,x as Yt}from"./HKBWT4XT.js";import{H as Ft,I as kt,J as G,P as Bt,S as Gt,U as Ze,b as Pt,c as Dt,j as Ot,m as Ht,v as ge,zb as Vt}from"./NO5PF2KS.js";import{c as Je,f as Qe,h as b}from"./GAV6HCJA.js";var Ln=Je((ga,dt)=>{function Rn(t,e){if(e&&e.documentElement)t=e,e=arguments[2];else if(!t||!t.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(e=e||{},this._doc=t,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._debug=!!e.debug,this._maxElemsToParse=e.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=e.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=e.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(e.classesToPreserve||[]),this._keepClasses=!!e.keepClasses,this._serializer=e.serializer||function(n){return n.innerHTML},this._disableJSONLD=!!e.disableJSONLD,this._allowedVideoRegex=e.allowedVideoRegex||this.REGEXPS.videos,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let n=function(r){if(r.nodeType==r.TEXT_NODE)return`${r.nodeName} ("${r.textContent}")`;let i=Array.from(r.attributes||[],function(o){return`${o.name}="${o.value}"`}).join(" ");return`<${r.localName} ${i}>`};this.log=function(){if(typeof console<"u")Array.from(arguments,o=>o&&o.nodeType==this.ELEMENT_NODE?n(o):o).unshift("Reader: (Readability)");else if(typeof dump<"u"){var r=Array.prototype.map.call(arguments,function(i){return i&&i.nodeName?n(i):i}).join(" ");dump("Reader: (Readability) "+r+`
`)}}}else this.log=function(){}}Rn.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent:function(t){this._fixRelativeUris(t),this._simplifyNestedElements(t),this._keepClasses||this._cleanClasses(t)},_removeNodes:function(t,e){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var n=t.length-1;n>=0;n--){var r=t[n],i=r.parentNode;i&&(!e||e.call(this,r,n,t))&&i.removeChild(r)}},_replaceNodeTags:function(t,e){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(let n of t)this._setNodeTag(n,e)},_forEachNode:function(t,e){Array.prototype.forEach.call(t,e,this)},_findNode:function(t,e){return Array.prototype.find.call(t,e,this)},_someNode:function(t,e){return Array.prototype.some.call(t,e,this)},_everyNode:function(t,e){return Array.prototype.every.call(t,e,this)},_concatNodeLists:function(){var t=Array.prototype.slice,e=t.call(arguments),n=e.map(function(r){return t.call(r)});return Array.prototype.concat.apply([],n)},_getAllNodesWithTag:function(t,e){return t.querySelectorAll?t.querySelectorAll(e.join(",")):[].concat.apply([],e.map(function(n){var r=t.getElementsByTagName(n);return Array.isArray(r)?r:Array.from(r)}))},_cleanClasses:function(t){var e=this._classesToPreserve,n=(t.getAttribute("class")||"").split(/\s+/).filter(function(r){return e.indexOf(r)!=-1}).join(" ");for(n?t.setAttribute("class",n):t.removeAttribute("class"),t=t.firstElementChild;t;t=t.nextElementSibling)this._cleanClasses(t)},_fixRelativeUris:function(t){var e=this._doc.baseURI,n=this._doc.documentURI;function r(a){if(e==n&&a.charAt(0)=="#")return a;try{return new URL(a,e).href}catch{}return a}var i=this._getAllNodesWithTag(t,["a"]);this._forEachNode(i,function(a){var s=a.getAttribute("href");if(s)if(s.indexOf("javascript:")===0)if(a.childNodes.length===1&&a.childNodes[0].nodeType===this.TEXT_NODE){var c=this._doc.createTextNode(a.textContent);a.parentNode.replaceChild(c,a)}else{for(var l=this._doc.createElement("span");a.firstChild;)l.appendChild(a.firstChild);a.parentNode.replaceChild(l,a)}else a.setAttribute("href",r(s))});var o=this._getAllNodesWithTag(t,["img","picture","figure","video","audio","source"]);this._forEachNode(o,function(a){var s=a.getAttribute("src"),c=a.getAttribute("poster"),l=a.getAttribute("srcset");if(s&&a.setAttribute("src",r(s)),c&&a.setAttribute("poster",r(c)),l){var m=l.replace(this.REGEXPS.srcsetUrl,function(d,u,h,p){return r(u)+(h||"")+p});a.setAttribute("srcset",m)}})},_simplifyNestedElements:function(t){for(var e=t;e;){if(e.parentNode&&["DIV","SECTION"].includes(e.tagName)&&!(e.id&&e.id.startsWith("readability"))){if(this._isElementWithoutContent(e)){e=this._removeAndGetNext(e);continue}else if(this._hasSingleTagInsideElement(e,"DIV")||this._hasSingleTagInsideElement(e,"SECTION")){for(var n=e.children[0],r=0;r<e.attributes.length;r++)n.setAttribute(e.attributes[r].name,e.attributes[r].value);e.parentNode.replaceChild(n,e),e=n;continue}}e=this._getNextNode(e)}},_getArticleTitle:function(){var t=this._doc,e="",n="";try{e=n=t.title.trim(),typeof e!="string"&&(e=n=this._getInnerText(t.getElementsByTagName("title")[0]))}catch{}var r=!1;function i(m){return m.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(e))r=/ [\\\/>»] /.test(e),e=n.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"),i(e)<3&&(e=n.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"));else if(e.indexOf(": ")!==-1){var o=this._concatNodeLists(t.getElementsByTagName("h1"),t.getElementsByTagName("h2")),a=e.trim(),s=this._someNode(o,function(m){return m.textContent.trim()===a});s||(e=n.substring(n.lastIndexOf(":")+1),i(e)<3?e=n.substring(n.indexOf(":")+1):i(n.substr(0,n.indexOf(":")))>5&&(e=n))}else if(e.length>150||e.length<15){var c=t.getElementsByTagName("h1");c.length===1&&(e=this._getInnerText(c[0]))}e=e.trim().replace(this.REGEXPS.normalize," ");var l=i(e);return l<=4&&(!r||l!=i(n.replace(/[\|\-\\\/>»]+/g,""))-1)&&(e=n),e},_prepDocument:function(){var t=this._doc;this._removeNodes(this._getAllNodesWithTag(t,["style"])),t.body&&this._replaceBrs(t.body),this._replaceNodeTags(this._getAllNodesWithTag(t,["font"]),"SPAN")},_nextNode:function(t){for(var e=t;e&&e.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(e.textContent);)e=e.nextSibling;return e},_replaceBrs:function(t){this._forEachNode(this._getAllNodesWithTag(t,["br"]),function(e){for(var n=e.nextSibling,r=!1;(n=this._nextNode(n))&&n.tagName=="BR";){r=!0;var i=n.nextSibling;n.parentNode.removeChild(n),n=i}if(r){var o=this._doc.createElement("p");for(e.parentNode.replaceChild(o,e),n=o.nextSibling;n;){if(n.tagName=="BR"){var a=this._nextNode(n.nextSibling);if(a&&a.tagName=="BR")break}if(!this._isPhrasingContent(n))break;var s=n.nextSibling;o.appendChild(n),n=s}for(;o.lastChild&&this._isWhitespace(o.lastChild);)o.removeChild(o.lastChild);o.parentNode.tagName==="P"&&this._setNodeTag(o.parentNode,"DIV")}})},_setNodeTag:function(t,e){if(this.log("_setNodeTag",t,e),this._docJSDOMParser)return t.localName=e.toLowerCase(),t.tagName=e.toUpperCase(),t;for(var n=t.ownerDocument.createElement(e);t.firstChild;)n.appendChild(t.firstChild);t.parentNode.replaceChild(n,t),t.readability&&(n.readability=t.readability);for(var r=0;r<t.attributes.length;r++)try{n.setAttribute(t.attributes[r].name,t.attributes[r].value)}catch{}return n},_prepArticle:function(t){this._cleanStyles(t),this._markDataTables(t),this._fixLazyImages(t),this._cleanConditionally(t,"form"),this._cleanConditionally(t,"fieldset"),this._clean(t,"object"),this._clean(t,"embed"),this._clean(t,"footer"),this._clean(t,"link"),this._clean(t,"aside");var e=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(t.children,function(n){this._cleanMatchedNodes(n,function(r,i){return this.REGEXPS.shareElements.test(i)&&r.textContent.length<e})}),this._clean(t,"iframe"),this._clean(t,"input"),this._clean(t,"textarea"),this._clean(t,"select"),this._clean(t,"button"),this._cleanHeaders(t),this._cleanConditionally(t,"table"),this._cleanConditionally(t,"ul"),this._cleanConditionally(t,"div"),this._replaceNodeTags(this._getAllNodesWithTag(t,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(t,["p"]),function(n){var r=n.getElementsByTagName("img").length,i=n.getElementsByTagName("embed").length,o=n.getElementsByTagName("object").length,a=n.getElementsByTagName("iframe").length,s=r+i+o+a;return s===0&&!this._getInnerText(n,!1)}),this._forEachNode(this._getAllNodesWithTag(t,["br"]),function(n){var r=this._nextNode(n.nextSibling);r&&r.tagName=="P"&&n.parentNode.removeChild(n)}),this._forEachNode(this._getAllNodesWithTag(t,["table"]),function(n){var r=this._hasSingleTagInsideElement(n,"TBODY")?n.firstElementChild:n;if(this._hasSingleTagInsideElement(r,"TR")){var i=r.firstElementChild;if(this._hasSingleTagInsideElement(i,"TD")){var o=i.firstElementChild;o=this._setNodeTag(o,this._everyNode(o.childNodes,this._isPhrasingContent)?"P":"DIV"),n.parentNode.replaceChild(o,n)}}})},_initializeNode:function(t){switch(t.readability={contentScore:0},t.tagName){case"DIV":t.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":t.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":t.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":t.readability.contentScore-=5;break}t.readability.contentScore+=this._getClassWeight(t)},_removeAndGetNext:function(t){var e=this._getNextNode(t,!0);return t.parentNode.removeChild(t),e},_getNextNode:function(t,e){if(!e&&t.firstElementChild)return t.firstElementChild;if(t.nextElementSibling)return t.nextElementSibling;do t=t.parentNode;while(t&&!t.nextElementSibling);return t&&t.nextElementSibling},_textSimilarity:function(t,e){var n=t.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),r=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!n.length||!r.length)return 0;var i=r.filter(a=>!n.includes(a)),o=i.join(" ").length/r.join(" ").length;return 1-o},_checkByline:function(t,e){if(this._articleByline)return!1;if(t.getAttribute!==void 0)var n=t.getAttribute("rel"),r=t.getAttribute("itemprop");return(n==="author"||r&&r.indexOf("author")!==-1||this.REGEXPS.byline.test(e))&&this._isValidByline(t.textContent)?(this._articleByline=t.textContent.trim(),!0):!1},_getNodeAncestors:function(t,e){e=e||0;for(var n=0,r=[];t.parentNode&&(r.push(t.parentNode),!(e&&++n===e));)t=t.parentNode;return r},_grabArticle:function(t){this.log("**** grabArticle ****");var e=this._doc,n=t!==null;if(t=t||this._doc.body,!t)return this.log("No body found in document. Abort."),null;for(var r=t.innerHTML;;){this.log("Starting grabArticle loop");var i=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),o=[],a=this._doc.documentElement;let Rt=!0;for(;a;){a.tagName==="HTML"&&(this._articleLang=a.getAttribute("lang"));var s=a.className+" "+a.id;if(!this._isProbablyVisible(a)){this.log("Removing hidden node - "+s),a=this._removeAndGetNext(a);continue}if(a.getAttribute("aria-modal")=="true"&&a.getAttribute("role")=="dialog"){a=this._removeAndGetNext(a);continue}if(this._checkByline(a,s)){a=this._removeAndGetNext(a);continue}if(Rt&&this._headerDuplicatesTitle(a)){this.log("Removing header: ",a.textContent.trim(),this._articleTitle.trim()),Rt=!1,a=this._removeAndGetNext(a);continue}if(i){if(this.REGEXPS.unlikelyCandidates.test(s)&&!this.REGEXPS.okMaybeItsACandidate.test(s)&&!this._hasAncestorTag(a,"table")&&!this._hasAncestorTag(a,"code")&&a.tagName!=="BODY"&&a.tagName!=="A"){this.log("Removing unlikely candidate - "+s),a=this._removeAndGetNext(a);continue}if(this.UNLIKELY_ROLES.includes(a.getAttribute("role"))){this.log("Removing content with role "+a.getAttribute("role")+" - "+s),a=this._removeAndGetNext(a);continue}}if((a.tagName==="DIV"||a.tagName==="SECTION"||a.tagName==="HEADER"||a.tagName==="H1"||a.tagName==="H2"||a.tagName==="H3"||a.tagName==="H4"||a.tagName==="H5"||a.tagName==="H6")&&this._isElementWithoutContent(a)){a=this._removeAndGetNext(a);continue}if(this.DEFAULT_TAGS_TO_SCORE.indexOf(a.tagName)!==-1&&o.push(a),a.tagName==="DIV"){for(var c=null,l=a.firstChild;l;){var m=l.nextSibling;if(this._isPhrasingContent(l))c!==null?c.appendChild(l):this._isWhitespace(l)||(c=e.createElement("p"),a.replaceChild(c,l),c.appendChild(l));else if(c!==null){for(;c.lastChild&&this._isWhitespace(c.lastChild);)c.removeChild(c.lastChild);c=null}l=m}if(this._hasSingleTagInsideElement(a,"P")&&this._getLinkDensity(a)<.25){var d=a.children[0];a.parentNode.replaceChild(d,a),a=d,o.push(a)}else this._hasChildBlockElement(a)||(a=this._setNodeTag(a,"P"),o.push(a))}a=this._getNextNode(a)}var u=[];this._forEachNode(o,function(Y){if(!(!Y.parentNode||typeof Y.parentNode.tagName>"u")){var K=this._getInnerText(Y);if(!(K.length<25)){var Lt=this._getNodeAncestors(Y,5);if(Lt.length!==0){var Ee=0;Ee+=1,Ee+=K.split(this.REGEXPS.commas).length,Ee+=Math.min(Math.floor(K.length/100),3),this._forEachNode(Lt,function(Z,Ke){if(!(!Z.tagName||!Z.parentNode||typeof Z.parentNode.tagName>"u")){if(typeof Z.readability>"u"&&(this._initializeNode(Z),u.push(Z)),Ke===0)var ze=1;else Ke===1?ze=2:ze=Ke*3;Z.readability.contentScore+=Ee/ze}})}}}});for(var h=[],p=0,f=u.length;p<f;p+=1){var E=u[p],T=E.readability.contentScore*(1-this._getLinkDensity(E));E.readability.contentScore=T,this.log("Candidate:",E,"with score "+T);for(var N=0;N<this._nbTopCandidates;N++){var S=h[N];if(!S||T>S.readability.contentScore){h.splice(N,0,E),h.length>this._nbTopCandidates&&h.pop();break}}}var g=h[0]||null,F=!1,y;if(g===null||g.tagName==="BODY"){for(g=e.createElement("DIV"),F=!0;t.firstChild;)this.log("Moving child out:",t.firstChild),g.appendChild(t.firstChild);t.appendChild(g),this._initializeNode(g)}else if(g){for(var D=[],L=1;L<h.length;L++)h[L].readability.contentScore/g.readability.contentScore>=.75&&D.push(this._getNodeAncestors(h[L]));var W=3;if(D.length>=W)for(y=g.parentNode;y.tagName!=="BODY";){for(var $=0,oe=0;oe<D.length&&$<W;oe++)$+=Number(D[oe].includes(y));if($>=W){g=y;break}y=y.parentNode}g.readability||this._initializeNode(g),y=g.parentNode;for(var Xe=g.readability.contentScore,xr=Xe/3;y.tagName!=="BODY";){if(!y.readability){y=y.parentNode;continue}var Nt=y.readability.contentScore;if(Nt<xr)break;if(Nt>Xe){g=y;break}Xe=y.readability.contentScore,y=y.parentNode}for(y=g.parentNode;y.tagName!="BODY"&&y.children.length==1;)g=y,y=g.parentNode;g.readability||this._initializeNode(g)}var O=e.createElement("DIV");n&&(O.id="readability-content");var br=Math.max(10,g.readability.contentScore*.2);y=g.parentNode;for(var $e=y.children,pe=0,At=$e.length;pe<At;pe++){var P=$e[pe],ae=!1;if(this.log("Looking at sibling node:",P,P.readability?"with score "+P.readability.contentScore:""),this.log("Sibling has score",P.readability?P.readability.contentScore:"Unknown"),P===g)ae=!0;else{var wt=0;if(P.className===g.className&&g.className!==""&&(wt+=g.readability.contentScore*.2),P.readability&&P.readability.contentScore+wt>=br)ae=!0;else if(P.nodeName==="P"){var It=this._getLinkDensity(P),Mt=this._getInnerText(P),Ye=Mt.length;(Ye>80&&It<.25||Ye<80&&Ye>0&&It===0&&Mt.search(/\.( |$)/)!==-1)&&(ae=!0)}}ae&&(this.log("Appending node:",P),this.ALTER_TO_DIV_EXCEPTIONS.indexOf(P.nodeName)===-1&&(this.log("Altering sibling:",P,"to div."),P=this._setNodeTag(P,"DIV")),O.appendChild(P),$e=y.children,pe-=1,At-=1)}if(this._debug&&this.log("Article content pre-prep: "+O.innerHTML),this._prepArticle(O),this._debug&&this.log("Article content post-prep: "+O.innerHTML),F)g.id="readability-page-1",g.className="page";else{var he=e.createElement("DIV");for(he.id="readability-page-1",he.className="page";O.firstChild;)he.appendChild(O.firstChild);O.appendChild(he)}this._debug&&this.log("Article content after paging: "+O.innerHTML);var je=!0,se=this._getInnerText(O,!0).length;if(se<this._charThreshold)if(je=!1,t.innerHTML=r,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:O,textLength:se});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:O,textLength:se});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:O,textLength:se});else{if(this._attempts.push({articleContent:O,textLength:se}),this._attempts.sort(function(Y,K){return K.textLength-Y.textLength}),!this._attempts[0].textLength)return null;O=this._attempts[0].articleContent,je=!0}if(je){var Cr=[y,g].concat(this._getNodeAncestors(y));return this._someNode(Cr,function(Y){if(!Y.tagName)return!1;var K=Y.getAttribute("dir");return K?(this._articleDir=K,!0):!1}),O}}},_isValidByline:function(t){return typeof t=="string"||t instanceof String?(t=t.trim(),t.length>0&&t.length<100):!1},_unescapeHtmlEntities:function(t){if(!t)return t;var e=this.HTML_ESCAPE_MAP;return t.replace(/&(quot|amp|apos|lt|gt);/g,function(n,r){return e[r]}).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi,function(n,r,i){var o=parseInt(r||i,r?16:10);return String.fromCharCode(o)})},_getJSONLD:function(t){var e=this._getAllNodesWithTag(t,["script"]),n;return this._forEachNode(e,function(r){if(!n&&r.getAttribute("type")==="application/ld+json")try{var i=r.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),o=JSON.parse(i);if(!o["@context"]||!o["@context"].match(/^https?\:\/\/schema\.org$/)||(!o["@type"]&&Array.isArray(o["@graph"])&&(o=o["@graph"].find(function(l){return(l["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes)})),!o||!o["@type"]||!o["@type"].match(this.REGEXPS.jsonLdArticleTypes)))return;if(n={},typeof o.name=="string"&&typeof o.headline=="string"&&o.name!==o.headline){var a=this._getArticleTitle(),s=this._textSimilarity(o.name,a)>.75,c=this._textSimilarity(o.headline,a)>.75;c&&!s?n.title=o.headline:n.title=o.name}else typeof o.name=="string"?n.title=o.name.trim():typeof o.headline=="string"&&(n.title=o.headline.trim());o.author&&(typeof o.author.name=="string"?n.byline=o.author.name.trim():Array.isArray(o.author)&&o.author[0]&&typeof o.author[0].name=="string"&&(n.byline=o.author.filter(function(l){return l&&typeof l.name=="string"}).map(function(l){return l.name.trim()}).join(", "))),typeof o.description=="string"&&(n.excerpt=o.description.trim()),o.publisher&&typeof o.publisher.name=="string"&&(n.siteName=o.publisher.name.trim()),typeof o.datePublished=="string"&&(n.datePublished=o.datePublished.trim());return}catch(l){this.log(l.message)}}),n||{}},_getArticleMetadata:function(t){var e={},n={},r=this._doc.getElementsByTagName("meta"),i=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,o=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[\.:]\s*)?(author|creator|description|title|site_name)\s*$/i;return this._forEachNode(r,function(a){var s=a.getAttribute("name"),c=a.getAttribute("property"),l=a.getAttribute("content");if(l){var m=null,d=null;c&&(m=c.match(i),m&&(d=m[0].toLowerCase().replace(/\s/g,""),n[d]=l.trim())),!m&&s&&o.test(s)&&(d=s,l&&(d=d.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),n[d]=l.trim()))}}),e.title=t.title||n["dc:title"]||n["dcterm:title"]||n["og:title"]||n["weibo:article:title"]||n["weibo:webpage:title"]||n.title||n["twitter:title"],e.title||(e.title=this._getArticleTitle()),e.byline=t.byline||n["dc:creator"]||n["dcterm:creator"]||n.author,e.excerpt=t.excerpt||n["dc:description"]||n["dcterm:description"]||n["og:description"]||n["weibo:article:description"]||n["weibo:webpage:description"]||n.description||n["twitter:description"],e.siteName=t.siteName||n["og:site_name"],e.publishedTime=t.datePublished||n["article:published_time"]||null,e.title=this._unescapeHtmlEntities(e.title),e.byline=this._unescapeHtmlEntities(e.byline),e.excerpt=this._unescapeHtmlEntities(e.excerpt),e.siteName=this._unescapeHtmlEntities(e.siteName),e.publishedTime=this._unescapeHtmlEntities(e.publishedTime),e},_isSingleImage:function(t){return t.tagName==="IMG"?!0:t.children.length!==1||t.textContent.trim()!==""?!1:this._isSingleImage(t.children[0])},_unwrapNoscriptImages:function(t){var e=Array.from(t.getElementsByTagName("img"));this._forEachNode(e,function(r){for(var i=0;i<r.attributes.length;i++){var o=r.attributes[i];switch(o.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(o.value))return}r.parentNode.removeChild(r)});var n=Array.from(t.getElementsByTagName("noscript"));this._forEachNode(n,function(r){var i=t.createElement("div");if(i.innerHTML=r.innerHTML,!!this._isSingleImage(i)){var o=r.previousElementSibling;if(o&&this._isSingleImage(o)){var a=o;a.tagName!=="IMG"&&(a=o.getElementsByTagName("img")[0]);for(var s=i.getElementsByTagName("img")[0],c=0;c<a.attributes.length;c++){var l=a.attributes[c];if(l.value!==""&&(l.name==="src"||l.name==="srcset"||/\.(jpg|jpeg|png|webp)/i.test(l.value))){if(s.getAttribute(l.name)===l.value)continue;var m=l.name;s.hasAttribute(m)&&(m="data-old-"+m),s.setAttribute(m,l.value)}}r.parentNode.replaceChild(i.firstElementChild,o)}}})},_removeScripts:function(t){this._removeNodes(this._getAllNodesWithTag(t,["script","noscript"]))},_hasSingleTagInsideElement:function(t,e){return t.children.length!=1||t.children[0].tagName!==e?!1:!this._someNode(t.childNodes,function(n){return n.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(n.textContent)})},_isElementWithoutContent:function(t){return t.nodeType===this.ELEMENT_NODE&&t.textContent.trim().length==0&&(t.children.length==0||t.children.length==t.getElementsByTagName("br").length+t.getElementsByTagName("hr").length)},_hasChildBlockElement:function(t){return this._someNode(t.childNodes,function(e){return this.DIV_TO_P_ELEMS.has(e.tagName)||this._hasChildBlockElement(e)})},_isPhrasingContent:function(t){return t.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.indexOf(t.tagName)!==-1||(t.tagName==="A"||t.tagName==="DEL"||t.tagName==="INS")&&this._everyNode(t.childNodes,this._isPhrasingContent)},_isWhitespace:function(t){return t.nodeType===this.TEXT_NODE&&t.textContent.trim().length===0||t.nodeType===this.ELEMENT_NODE&&t.tagName==="BR"},_getInnerText:function(t,e){e=typeof e>"u"?!0:e;var n=t.textContent.trim();return e?n.replace(this.REGEXPS.normalize," "):n},_getCharCount:function(t,e){return e=e||",",this._getInnerText(t).split(e).length-1},_cleanStyles:function(t){if(!(!t||t.tagName.toLowerCase()==="svg")){for(var e=0;e<this.PRESENTATIONAL_ATTRIBUTES.length;e++)t.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[e]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(t.tagName)!==-1&&(t.removeAttribute("width"),t.removeAttribute("height"));for(var n=t.firstElementChild;n!==null;)this._cleanStyles(n),n=n.nextElementSibling}},_getLinkDensity:function(t){var e=this._getInnerText(t).length;if(e===0)return 0;var n=0;return this._forEachNode(t.getElementsByTagName("a"),function(r){var i=r.getAttribute("href"),o=i&&this.REGEXPS.hashUrl.test(i)?.3:1;n+=this._getInnerText(r).length*o}),n/e},_getClassWeight:function(t){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var e=0;return typeof t.className=="string"&&t.className!==""&&(this.REGEXPS.negative.test(t.className)&&(e-=25),this.REGEXPS.positive.test(t.className)&&(e+=25)),typeof t.id=="string"&&t.id!==""&&(this.REGEXPS.negative.test(t.id)&&(e-=25),this.REGEXPS.positive.test(t.id)&&(e+=25)),e},_clean:function(t,e){var n=["object","embed","iframe"].indexOf(e)!==-1;this._removeNodes(this._getAllNodesWithTag(t,[e]),function(r){if(n){for(var i=0;i<r.attributes.length;i++)if(this._allowedVideoRegex.test(r.attributes[i].value))return!1;if(r.tagName==="object"&&this._allowedVideoRegex.test(r.innerHTML))return!1}return!0})},_hasAncestorTag:function(t,e,n,r){n=n||3,e=e.toUpperCase();for(var i=0;t.parentNode;){if(n>0&&i>n)return!1;if(t.parentNode.tagName===e&&(!r||r(t.parentNode)))return!0;t=t.parentNode,i++}return!1},_getRowAndColumnCount:function(t){for(var e=0,n=0,r=t.getElementsByTagName("tr"),i=0;i<r.length;i++){var o=r[i].getAttribute("rowspan")||0;o&&(o=parseInt(o,10)),e+=o||1;for(var a=0,s=r[i].getElementsByTagName("td"),c=0;c<s.length;c++){var l=s[c].getAttribute("colspan")||0;l&&(l=parseInt(l,10)),a+=l||1}n=Math.max(n,a)}return{rows:e,columns:n}},_markDataTables:function(t){for(var e=t.getElementsByTagName("table"),n=0;n<e.length;n++){var r=e[n],i=r.getAttribute("role");if(i=="presentation"){r._readabilityDataTable=!1;continue}var o=r.getAttribute("datatable");if(o=="0"){r._readabilityDataTable=!1;continue}var a=r.getAttribute("summary");if(a){r._readabilityDataTable=!0;continue}var s=r.getElementsByTagName("caption")[0];if(s&&s.childNodes.length>0){r._readabilityDataTable=!0;continue}var c=["col","colgroup","tfoot","thead","th"],l=function(d){return!!r.getElementsByTagName(d)[0]};if(c.some(l)){this.log("Data table because found data-y descendant"),r._readabilityDataTable=!0;continue}if(r.getElementsByTagName("table")[0]){r._readabilityDataTable=!1;continue}var m=this._getRowAndColumnCount(r);if(m.rows>=10||m.columns>4){r._readabilityDataTable=!0;continue}r._readabilityDataTable=m.rows*m.columns>10}},_fixLazyImages:function(t){this._forEachNode(this._getAllNodesWithTag(t,["img","picture","figure"]),function(e){if(e.src&&this.REGEXPS.b64DataUrl.test(e.src)){var n=this.REGEXPS.b64DataUrl.exec(e.src);if(n[1]==="image/svg+xml")return;for(var r=!1,i=0;i<e.attributes.length;i++){var o=e.attributes[i];if(o.name!=="src"&&/\.(jpg|jpeg|png|webp)/i.test(o.value)){r=!0;break}}if(r){var a=e.src.search(/base64\s*/i)+7,s=e.src.length-a;s<133&&e.removeAttribute("src")}}if(!((e.src||e.srcset&&e.srcset!="null")&&e.className.toLowerCase().indexOf("lazy")===-1)){for(var c=0;c<e.attributes.length;c++)if(o=e.attributes[c],!(o.name==="src"||o.name==="srcset"||o.name==="alt")){var l=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(o.value)?l="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(o.value)&&(l="src"),l){if(e.tagName==="IMG"||e.tagName==="PICTURE")e.setAttribute(l,o.value);else if(e.tagName==="FIGURE"&&!this._getAllNodesWithTag(e,["img","picture"]).length){var m=this._doc.createElement("img");m.setAttribute(l,o.value),e.appendChild(m)}}}}})},_getTextDensity:function(t,e){var n=this._getInnerText(t,!0).length;if(n===0)return 0;var r=0,i=this._getAllNodesWithTag(t,e);return this._forEachNode(i,o=>r+=this._getInnerText(o,!0).length),r/n},_cleanConditionally:function(t,e){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(t,[e]),function(n){var r=function(y){return y._readabilityDataTable},i=e==="ul"||e==="ol";if(!i){var o=0,a=this._getAllNodesWithTag(n,["ul","ol"]);this._forEachNode(a,y=>o+=this._getInnerText(y).length),i=o/this._getInnerText(n).length>.9}if(e==="table"&&r(n)||this._hasAncestorTag(n,"table",-1,r)||this._hasAncestorTag(n,"code"))return!1;var s=this._getClassWeight(n);this.log("Cleaning Conditionally",n);var c=0;if(s+c<0)return!0;if(this._getCharCount(n,",")<10){for(var l=n.getElementsByTagName("p").length,m=n.getElementsByTagName("img").length,d=n.getElementsByTagName("li").length-100,u=n.getElementsByTagName("input").length,h=this._getTextDensity(n,["h1","h2","h3","h4","h5","h6"]),p=0,f=this._getAllNodesWithTag(n,["object","embed","iframe"]),E=0;E<f.length;E++){for(var T=0;T<f[E].attributes.length;T++)if(this._allowedVideoRegex.test(f[E].attributes[T].value))return!1;if(f[E].tagName==="object"&&this._allowedVideoRegex.test(f[E].innerHTML))return!1;p++}var N=this._getLinkDensity(n),S=this._getInnerText(n).length,g=m>1&&l/m<.5&&!this._hasAncestorTag(n,"figure")||!i&&d>l||u>Math.floor(l/3)||!i&&h<.9&&S<25&&(m===0||m>2)&&!this._hasAncestorTag(n,"figure")||!i&&s<25&&N>.2||s>=25&&N>.5||p===1&&S<75||p>1;if(i&&g){for(var F=0;F<n.children.length;F++)if(n.children[F].children.length>1)return g;let y=n.getElementsByTagName("li").length;if(m==y)return!1}return g}return!1})},_cleanMatchedNodes:function(t,e){for(var n=this._getNextNode(t,!0),r=this._getNextNode(t);r&&r!=n;)e.call(this,r,r.className+" "+r.id)?r=this._removeAndGetNext(r):r=this._getNextNode(r)},_cleanHeaders:function(t){let e=this._getAllNodesWithTag(t,["h1","h2"]);this._removeNodes(e,function(n){let r=this._getClassWeight(n)<0;return r&&this.log("Removing header with low class weight:",n),r})},_headerDuplicatesTitle:function(t){if(t.tagName!="H1"&&t.tagName!="H2")return!1;var e=this._getInnerText(t,!1);return this.log("Evaluating similarity of header:",e,this._articleTitle),this._textSimilarity(this._articleTitle,e)>.75},_flagIsActive:function(t){return(this._flags&t)>0},_removeFlag:function(t){this._flags=this._flags&~t},_isProbablyVisible:function(t){return(!t.style||t.style.display!="none")&&(!t.style||t.style.visibility!="hidden")&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||t.getAttribute("aria-hidden")!="true"||t.className&&t.className.indexOf&&t.className.indexOf("fallback-image")!==-1)},parse:function(){if(this._maxElemsToParse>0){var t=this._doc.getElementsByTagName("*").length;if(t>this._maxElemsToParse)throw new Error("Aborting parsing document; "+t+" elements found")}this._unwrapNoscriptImages(this._doc);var e=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var n=this._getArticleMetadata(e);this._articleTitle=n.title;var r=this._grabArticle();if(!r)return null;if(this.log("Grabbed: "+r.innerHTML),this._postProcessContent(r),!n.excerpt){var i=r.getElementsByTagName("p");i.length>0&&(n.excerpt=i[0].textContent.trim())}var o=r.textContent;return{title:this._articleTitle,byline:n.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(r),textContent:o,length:o.length,excerpt:n.excerpt,siteName:n.siteName||this._articleSiteName,publishedTime:n.publishedTime}}};typeof dt=="object"&&(dt.exports=Rn)});var Dn=Je((Ta,ft)=>{var Pn={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function fi(t){return(!t.style||t.style.display!="none")&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||t.getAttribute("aria-hidden")!="true"||t.className&&t.className.indexOf&&t.className.indexOf("fallback-image")!==-1)}function pi(t,e={}){typeof e=="function"&&(e={visibilityChecker:e});var n={minScore:20,minContentLength:140,visibilityChecker:fi};e=Object.assign(n,e);var r=t.querySelectorAll("p, pre, article"),i=t.querySelectorAll("div > br");if(i.length){var o=new Set(r);[].forEach.call(i,function(s){o.add(s.parentNode)}),r=Array.from(o)}var a=0;return[].some.call(r,function(s){if(!e.visibilityChecker(s))return!1;var c=s.className+" "+s.id;if(Pn.unlikelyCandidates.test(c)&&!Pn.okMaybeItsACandidate.test(c)||s.matches("li p"))return!1;var l=s.textContent.trim().length;return l<e.minContentLength?!1:(a+=Math.sqrt(l-e.minContentLength),a>e.minScore)})}typeof ft=="object"&&(ft.exports=pi)});var Le=Je((ya,On)=>{var hi=Ln(),Ei=Dn();On.exports={Readability:hi,isProbablyReaderable:Ei}});var te=42,le=140,vr=40,ye=class extends q{constructor(){super(...arguments);this.currentScale=1;this.containerElement=null;this.scrollList=null;this.file=null;this.headers=[];this.rows=[];this.workbook=null;this.currentSheetName=""}get scrollElement(){return this.scrollList?this.scrollList._outerRef:null}reset(){this.file=null,this.headers=[],this.rows=[]}setCurrentScale(n){this.currentScale!==n&&(this.currentScale=n,this.emit("onChangeScale",{scale:n}))}setData(n){this.file=n.file,this.headers=n.headers,this.rows=n.rows}setContainerElement(n){this.containerElement=n}setScrollList(n){this.scrollList=n}setWorkbook(n){this.workbook=n}setCurrentSheetName(n){this.currentSheetName=n}getRowOffsetTop(n,r){let i=this.scrollElement;if(!i)return 0;let o=i.clientHeight-te,a=Math.max(n*te-(o-te)/2,0);return r==="start"?a=n*te:r==="end"&&(a=Math.max(n*te-o+te,0)),a}getColOffsetLeft(n,r){let i=this.scrollElement;if(!i)return 0;let o=i.clientWidth-vr,a=Math.max(n*le-(o-le)/2,0);return r==="start"?a=n*le:r==="end"&&(a=Math.max(n*le-o+le,0)),a}gotoCell(n,r,i="center"){if(!this.scrollList||!this.scrollElement)return;let o=this.scrollElement,a=this.getRowOffsetTop(n,i),s=this.getColOffsetLeft(r,i);o.scrollTo({top:a,left:s,behavior:"smooth"})}async changeSheet(n){if(this.workbook&&this.workbook.SheetNames.includes(n))try{let{utils:r}=await import("./HDDDA5UD.js"),i=this.workbook.Sheets[n]?r.sheet_to_json(this.workbook.Sheets[n],{header:1,raw:!0,defval:null}):[],o=i.length?Math.max(...i.map(s=>s.length)):0,a=Array.from({length:o},(s,c)=>c);this.setCurrentSheetName(n),this.headers=a,this.rows=i,this.emit("onChangeSheet",{sheetName:n})}catch{}}};var _e=class extends q{constructor(){super(...arguments);this.currentScale=.95;this.currentPage=0;this.totalPage=0;this.pdfDocument=null;this.containerElement=null;this.scrollList=null}setCurrentScale(n){this.currentScale!==n&&(this.currentScale=n,this.emit("onChangeScale",{scale:n}))}setCurrentPage(n,r="scroll-list"){this.currentPage!==n&&(this.currentPage=n,this.emit("onChangePage",{page:this.currentPage,total:this.totalPage,reason:r}))}setPDFDocument(n){this.pdfDocument!==n&&(this.pdfDocument=n,this.totalPage=n.numPages,this.currentPage=1,this.emit("onChangePage",{page:this.currentPage,total:this.totalPage,reason:"init-document"}))}setContainerElement(n){this.containerElement=n}setScrollList(n){this.scrollList=n}reset(){this.currentPage=0,this.totalPage=0,this.pdfDocument?.destroy(),this.pdfDocument=null,this.emit("onChangePage",{page:this.currentPage,total:this.totalPage,reason:"reset-document"})}gotoPage(n,r="scroll-list",i="center"){this.setCurrentPage(n,r),this.scrollList?.scrollToItem(n-1,i)}};var ro=new ye;var xe=class extends q{constructor(){super(...arguments);this.containerElement=null;this.scrollList=null;this.file=null}reset(){this.file=null}setFile(n){this.file=n}setContainerElement(n){this.containerElement=n}setScrollList(n){this.scrollList=n}};var uo=new xe;var be=class extends q{constructor(){super(...arguments);this.containerElement=null;this.iframeElement=null;this.codeElement=null;this.isCodeMode=!1}setContainerElement(n){this.containerElement=n}setIframeElement(n){this.iframeElement=n}setCodeElement(n){this.codeElement=n}setIsCodeMode(n){this.isCodeMode!==n&&(this.isCodeMode=n,this.emit("onChangeCodeMode",{isCodeMode:n}))}};var yo=new be;var Ce=class extends q{constructor(){super();this.currentScale=.95;this.currentMode="original";this.currentRotate=0;this.imageData={originalWidth:0,originalHeight:0,src:""};this.transformComponent=null;this.containerElement=null;this.bestFitMode="contain"}setCurrentScale(n){this.currentScale!==n&&(this.transformComponent&&this.transformComponent.instance.setTransformState(n,0,0),this.currentScale=n,this.emit("onChangeScale",{scale:n}))}setCurrentMode(n){if(this.currentMode=n,n==="original"&&this.setCurrentScale(1),n==="bestFit"){let r=this.containerElement?.getBoundingClientRect(),i=r?.width,o=r?.height,a=this.imageData.originalWidth,s=this.imageData.originalHeight;if(!i||!o||a===0&&s===0)this.setCurrentScale(1);else{let c=i/a,l=o/s,m=.95;this.bestFitMode==="contain"?m=Math.min(c,l):this.bestFitMode==="cover"&&(m=Math.max(c,l)),this.setCurrentScale(m)}}this.emit("onChangeMode",{scale:this.currentScale,mode:this.currentMode})}setCurrentRotate(n){n%360===0&&(n=0),this.currentRotate!==n&&(this.currentRotate=n,this.emit("onChangeRotate",{rotate:n}))}setImageData(n){if(Xt(this.imageData,n))return;this.imageData=n,n.originalWidth/n.originalHeight<1?this.bestFitMode="cover":this.bestFitMode="contain",this.emit("onChangeImage",this.imageData)}setTransformComponent(n){this.transformComponent=n}setContainerElement(n){this.containerElement=n}};var wo=new Ce;var Po=new _e;var Fo=["shortcuts","options","daemon_process","current_page","chatgpt","manage_extension","app_upload_file","immersive_chat"],ve="BROWSER_EXTENSION_FEATURES_SERVICE_SEND_ID",Ne="BROWSER_EXTENSION_FEATURES_SERVICE_RECEIVE_ID";var v=async(t,e,...n)=>ce(t,e,30*1e3,...n),jt=async(t,e)=>{let{eventType:n,postWindow:r,timeout:i=30*1e3}=t;return ce(n,r,i,...e)},ce=async(t,e,n,...r)=>new Promise(i=>{let o=Te(),a=null,s=c=>{let{result:l,id:m,taskId:d}=c.data||{};m===Ne&&o===d&&(a&&clearTimeout(a),window.removeEventListener("message",s),i(l))};window.addEventListener("message",s),e.postMessage({id:ve,eventType:t,taskId:o,data:r},"*"),a=setTimeout(()=>{window.removeEventListener("message",s),i(null)},n)}),Kt=(t,e,n)=>{let r=new qt(n.url);return r.fileInfo=n,r.init=async()=>n,r.getNextChunk=async i=>{let o=await t.getFileNextChunk(e,i),a={...o,done:o?.done??!0,value:new Uint8Array(o?.value||[]),progress:o?.progress??100};return r.bytesRead+=a.value.byteLength,a},r.destroy=async()=>{await t.destroyFileStreamer(e)},r};var Nr="USE_CHAT_GPT_AI",Ae=`${Nr}_ROOT`,Uo=`${Ae}_Post_Message_With_Web_Page`,zt=`${Ae}_Wrapper`,et="MAXAI_EXTENSION_ALERT_EVENT_ID";var Jt=()=>{window.postMessage({id:et,action:"open",type:"install"},"*")};var Qt=()=>{window.postMessage({id:et,action:"open",type:"upgrade"},"*")};var Zt=()=>document.getElementById(Ae),Ko=()=>Zt()?.shadowRoot?.querySelector(`#${zt}`),Ar=()=>{if(typeof window>"u")return null;if(window.__MAXAI__EXTENSION__VERSION__)return window.__MAXAI__EXTENSION__VERSION__;let t=Zt();return t&&t.getAttribute("data-version")||null},en=(t,e=!0,n=!0)=>{let r=Ar();return r?Ft(r,t)?(n&&Qt(),!1):!0:(e&&Jt(),!1)};var wr=new Set(["a","abbr","b","bdi","bdo","cite","code","dfn","em","i","img","input","kbd","label","mark","q","s","samp","small","span","strong","sub","sup","time","tt","u","var"]),tn=(t,e)=>{e=e||window.getComputedStyle(t);let n=e.overflowY,r=e.overflowX;return n==="auto"||n==="scroll"||r==="auto"||r==="scroll"},j=t=>t.nodeType===Node.ELEMENT_NODE,nn=t=>j(t)?wr.has(t.tagName.toLowerCase()):!1,Qo=t=>j(t)&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"),me=(t,e)=>(e||(e=window.getComputedStyle(t)),e.display!=="none"&&e.visibility!=="hidden"&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||t.getAttribute("aria-hidden")!="true"||t.className&&t.className.includes&&t.className.includes("fallback-image"))),rn=(t,e)=>{let n=t.parentElement;for(;n;){if(n===e)return!0;n=n.parentElement}return!1};var Zo=(t,e)=>!t||!e?!1:t.top===e.top&&t.right===e.right&&t.bottom===e.bottom&&t.left===e.left&&t.width===e.width&&t.height===e.height;var ue=new Set(["link","style","script","noscript","canvas","iframe","object","video","header","footer","select","maxai-trans"]),tt=new Set(["onetrust-consent-sdk"]),an=[...ue,...Array.from(tt).map(t=>`#${t}`),'[style*="display: none"]',"[hidden]",'[aria-hidden="true"]','[style*="visibility: hidden"]'],sn=(t,e)=>{let{formatMultipleSpaces:n,formatMultipleNewlines:r,formatMultipleWhitespaces:i}=e||{};return n&&(t=t.replace(/ {2,}/g,n)),r&&(t=t.replace(/(\s*\n\s*){2,}/g,r)),i&&(t=t.replace(/\s+/g,i)),t},we=(t,e)=>{let n=[],{selectable:r=!1}=e||{};function i(o){if(o.nodeType===Node.TEXT_NODE&&o.textContent?.trim()!=="")n.push(o);else if(j(o)){if(ue.has(o.tagName.toLowerCase())||tt.has(o.id))return;let a=o.style,s=me(o,a),c=s&&a.userSelect!=="none";if(s)try{a=window.getComputedStyle(o),s=me(o,a),c=s&&a.userSelect!=="none"}catch{}(r?c:s)&&(!nn(o)&&n[n.length-1]&&(n[n.length-1].hasEOL=!0),o.childNodes.forEach(m=>i(m)))}}return i(t),n},on=t=>{let e=t.textContent?.replace(/\s+/g," ")||"";return t.hasEOL&&(e+=`
`),e},ln=t=>{let e="";return t.forEach((n,r)=>{if(e[e.length-1]===`
`||e[e.length-1]===" ")e+=on(n).trimStart();else{let i=on(n);t[r-1]&&t[r-1].parentNode!==n.parentNode&&i&&i[0]!==" "?e+=` ${i}`:e+=i}}),e},na=(t,e,n,r=document.body)=>{let i="",o={formatMultipleSpaces:" ",formatMultipleNewlines:`
`};function a(s,c){if(!(i.length>=n||!s)){if(s.nodeType===Node.TEXT_NODE){let l=s.textContent?.substring(0,c)||"",m=Math.min(l.length,n-i.length);i=sn(l.substring(l.length-m)+i,o)}else if(j(s)&&!ue.has(s.tagName.toLowerCase())){let l=c!==void 0?c-1:s.childNodes.length-1;if(s.childNodes[l]){a(s.childNodes[l]);return}}if(s.previousSibling){a(s.previousSibling);return}if(s.parentNode&&s.parentNode!==r&&s!==r&&s.parentNode!==document.body&&s!==document.body){let l=Array.from(s.parentNode.childNodes).indexOf(s);a(s.parentNode,l)}}}return a(t,e),i},ra=(t,e,n,r=document.body)=>{let i="",o={formatMultipleSpaces:" ",formatMultipleNewlines:`
`};function a(s,c){if(!(i.length>=n||!s)){if(s.nodeType===Node.TEXT_NODE){let l=s.textContent?.substring(c||0)||"",m=Math.min(l.length,n-i.length);i=sn(i+l.substring(0,m),o)}else if(j(s)&&!ue.has(s.tagName.toLowerCase())){let l=c!=null?c+1:0;if(s.childNodes[l]){a(s.childNodes[l]);return}}if(s.nextSibling){a(s.nextSibling);return}if(s.parentNode&&s.parentNode!==r&&s!==r&&s.parentNode!==document.body&&s!==document.body){let l=Array.from(s.parentNode.childNodes).indexOf(s);a(s.parentNode,l)}}}return a(t,e),i},ne=t=>{let e=t.cloneNode();function n(r,i){if(i.nodeType===Node.TEXT_NODE&&i.textContent?.trim()!=="")r.appendChild(i.cloneNode());else if(j(i)){if(ue.has(i.tagName.toLowerCase())||tt.has(i.id))return;let o=i.style,a=me(i,o);if(a)try{o=window.getComputedStyle(i),a=me(i,o)}catch{}if(a){let s=i.cloneNode();r.appendChild(s),i.childNodes.forEach(c=>n(s,c))}}}return t.childNodes.forEach(r=>n(e,r)),e};function Ir(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t}function ot(t,e){return Array(e+1).join(t)}function Mr(t){return t.replace(/^\n*/,"")}function Rr(t){for(var e=t.length;e>0&&t[e-1]===`
`;)e--;return t.substring(0,e)}var Lr=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function at(t){return st(t,Lr)}var un=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function dn(t){return st(t,un)}function Pr(t){return pn(t,un)}var fn=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Dr(t){return st(t,fn)}function Or(t){return pn(t,fn)}function st(t,e){return e.indexOf(t.nodeName)>=0}function pn(t,e){return t.getElementsByTagName&&e.some(function(n){return t.getElementsByTagName(n).length})}var H={};H.paragraph={filter:"p",replacement:function(t){return`

`+t+`

`}};H.lineBreak={filter:"br",replacement:function(t,e,n){return n.br+`
`}};H.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(t,e,n){var r=Number(e.nodeName.charAt(1));if(n.headingStyle==="setext"&&r<3){var i=ot(r===1?"=":"-",t.length);return`

`+t+`
`+i+`

`}else return`

`+ot("#",r)+" "+t+`

`}};H.blockquote={filter:"blockquote",replacement:function(t){return t=t.replace(/^\n+|\n+$/g,""),t=t.replace(/^/gm,"> "),`

`+t+`

`}};H.list={filter:["ul","ol"],replacement:function(t,e){var n=e.parentNode;return n.nodeName==="LI"&&n.lastElementChild===e?`
`+t:`

`+t+`

`}};H.listItem={filter:"li",replacement:function(t,e,n){t=t.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var r=n.bulletListMarker+"   ",i=e.parentNode;if(i.nodeName==="OL"){var o=i.getAttribute("start"),a=Array.prototype.indexOf.call(i.children,e);r=(o?Number(o)+a:a+1)+".  "}return r+t+(e.nextSibling&&!/\n$/.test(t)?`
`:"")}};H.indentedCodeBlock={filter:function(t,e){return e.codeBlockStyle==="indented"&&t.nodeName==="PRE"&&t.firstChild&&t.firstChild.nodeName==="CODE"},replacement:function(t,e,n){return`

    `+e.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};H.fencedCodeBlock={filter:function(t,e){return e.codeBlockStyle==="fenced"&&t.nodeName==="PRE"&&t.firstChild&&t.firstChild.nodeName==="CODE"},replacement:function(t,e,n){for(var r=e.firstChild.getAttribute("class")||"",i=(r.match(/language-(\S+)/)||[null,""])[1],o=e.firstChild.textContent,a=n.fence.charAt(0),s=3,c=new RegExp("^"+a+"{3,}","gm"),l;l=c.exec(o);)l[0].length>=s&&(s=l[0].length+1);var m=ot(a,s);return`

`+m+i+`
`+o.replace(/\n$/,"")+`
`+m+`

`}};H.horizontalRule={filter:"hr",replacement:function(t,e,n){return`

`+n.hr+`

`}};H.inlineLink={filter:function(t,e){return e.linkStyle==="inlined"&&t.nodeName==="A"&&t.getAttribute("href")},replacement:function(t,e){var n=e.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var r=Ie(e.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+t+"]("+n+r+")"}};H.referenceLink={filter:function(t,e){return e.linkStyle==="referenced"&&t.nodeName==="A"&&t.getAttribute("href")},replacement:function(t,e,n){var r=e.getAttribute("href"),i=Ie(e.getAttribute("title"));i&&(i=' "'+i+'"');var o,a;switch(n.linkReferenceStyle){case"collapsed":o="["+t+"][]",a="["+t+"]: "+r+i;break;case"shortcut":o="["+t+"]",a="["+t+"]: "+r+i;break;default:var s=this.references.length+1;o="["+t+"]["+s+"]",a="["+s+"]: "+r+i}return this.references.push(a),o},references:[],append:function(t){var e="";return this.references.length&&(e=`

`+this.references.join(`
`)+`

`,this.references=[]),e}};H.emphasis={filter:["em","i"],replacement:function(t,e,n){return t.trim()?n.emDelimiter+t+n.emDelimiter:""}};H.strong={filter:["strong","b"],replacement:function(t,e,n){return t.trim()?n.strongDelimiter+t+n.strongDelimiter:""}};H.code={filter:function(t){var e=t.previousSibling||t.nextSibling,n=t.parentNode.nodeName==="PRE"&&!e;return t.nodeName==="CODE"&&!n},replacement:function(t){if(!t)return"";t=t.replace(/\r?\n|\r/g," ");for(var e=/^`|^ .*?[^ ].* $|`$/.test(t)?" ":"",n="`",r=t.match(/`+/gm)||[];r.indexOf(n)!==-1;)n=n+"`";return n+e+t+e+n}};H.image={filter:"img",replacement:function(t,e){var n=Ie(e.getAttribute("alt")),r=e.getAttribute("src")||"",i=Ie(e.getAttribute("title")),o=i?' "'+i+'"':"";return r?"!["+n+"]("+r+o+")":""}};function Ie(t){return t?t.replace(/(\n+\s*)+/g,`
`):""}function hn(t){this.options=t,this._keep=[],this._remove=[],this.blankRule={replacement:t.blankReplacement},this.keepReplacement=t.keepReplacement,this.defaultRule={replacement:t.defaultReplacement},this.array=[];for(var e in t.rules)this.array.push(t.rules[e])}hn.prototype={add:function(t,e){this.array.unshift(e)},keep:function(t){this._keep.unshift({filter:t,replacement:this.keepReplacement})},remove:function(t){this._remove.unshift({filter:t,replacement:function(){return""}})},forNode:function(t){if(t.isBlank)return this.blankRule;var e;return(e=nt(this.array,t,this.options))||(e=nt(this._keep,t,this.options))||(e=nt(this._remove,t,this.options))?e:this.defaultRule},forEach:function(t){for(var e=0;e<this.array.length;e++)t(this.array[e],e)}};function nt(t,e,n){for(var r=0;r<t.length;r++){var i=t[r];if(Hr(i,e,n))return i}}function Hr(t,e,n){var r=t.filter;if(typeof r=="string"){if(r===e.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(e.nodeName.toLowerCase())>-1)return!0}else if(typeof r=="function"){if(r.call(t,e,n))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function Fr(t){var e=t.element,n=t.isBlock,r=t.isVoid,i=t.isPre||function(d){return d.nodeName==="PRE"};if(!(!e.firstChild||i(e))){for(var o=null,a=!1,s=null,c=cn(s,e,i);c!==e;){if(c.nodeType===3||c.nodeType===4){var l=c.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!a&&l[0]===" "&&(l=l.substr(1)),!l){c=rt(c);continue}c.data=l,o=c}else if(c.nodeType===1)n(c)||c.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,a=!1):r(c)||i(c)?(o=null,a=!0):o&&(a=!1);else{c=rt(c);continue}var m=cn(s,c,i);s=c,c=m}o&&(o.data=o.data.replace(/ $/,""),o.data||rt(o))}}function rt(t){var e=t.nextSibling||t.parentNode;return t.parentNode.removeChild(t),e}function cn(t,e,n){return t&&t.parentNode===e||n(e)?e.nextSibling||e.parentNode:e.firstChild||e.nextSibling||e.parentNode}var lt=typeof window<"u"?window:{};function kr(){var t=lt.DOMParser,e=!1;try{new t().parseFromString("","text/html")&&(e=!0)}catch{}return e}function Br(){var t=function(){};return Gr()?t.prototype.parseFromString=function(e){var n=new window.ActiveXObject("htmlfile");return n.designMode="on",n.open(),n.write(e),n.close(),n}:t.prototype.parseFromString=function(e){var n=document.implementation.createHTMLDocument("");return n.open(),n.write(e),n.close(),n},t}function Gr(){var t=!1;try{document.implementation.createHTMLDocument("").open()}catch{lt.ActiveXObject&&(t=!0)}return t}var qr=kr()?lt.DOMParser:Br();function Ur(t,e){var n;if(typeof t=="string"){var r=Wr().parseFromString('<x-turndown id="turndown-root">'+t+"</x-turndown>","text/html");n=r.getElementById("turndown-root")}else n=t.cloneNode(!0);return Fr({element:n,isBlock:at,isVoid:dn,isPre:e.preformattedCode?Vr:null}),n}var it;function Wr(){return it=it||new qr,it}function Vr(t){return t.nodeName==="PRE"||t.nodeName==="CODE"}function Xr(t,e){return t.isBlock=at(t),t.isCode=t.nodeName==="CODE"||t.parentNode.isCode,t.isBlank=$r(t),t.flankingWhitespace=Yr(t,e),t}function $r(t){return!dn(t)&&!Dr(t)&&/^\s*$/i.test(t.textContent)&&!Pr(t)&&!Or(t)}function Yr(t,e){if(t.isBlock||e.preformattedCode&&t.isCode)return{leading:"",trailing:""};var n=jr(t.textContent);return n.leadingAscii&&mn("left",t,e)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&mn("right",t,e)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}}function jr(t){var e=t.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:e[1],leadingAscii:e[2],leadingNonAscii:e[3],trailing:e[4],trailingNonAscii:e[5],trailingAscii:e[6]}}function mn(t,e,n){var r,i,o;return t==="left"?(r=e.previousSibling,i=/ $/):(r=e.nextSibling,i=/^ /),r&&(r.nodeType===3?o=i.test(r.nodeValue):n.preformattedCode&&r.nodeName==="CODE"?o=!1:r.nodeType===1&&!at(r)&&(o=i.test(r.textContent))),o}var Kr=Array.prototype.reduce,zr=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Me(t){if(!(this instanceof Me))return new Me(t);var e={rules:H,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(n,r){return r.isBlock?`

`:""},keepReplacement:function(n,r){return r.isBlock?`

`+r.outerHTML+`

`:r.outerHTML},defaultReplacement:function(n,r){return r.isBlock?`

`+n+`

`:n}};this.options=Ir({},e,t),this.rules=new hn(this.options)}Me.prototype={turndown:function(t){if(!Zr(t))throw new TypeError(t+" is not a string, or an element/document/fragment node.");if(t==="")return"";var e=En.call(this,new Ur(t,this.options));return Jr.call(this,e)},use:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.use(t[e]);else if(typeof t=="function")t(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(t,e){return this.rules.add(t,e),this},keep:function(t){return this.rules.keep(t),this},remove:function(t){return this.rules.remove(t),this},escape:function(t){return zr.reduce(function(e,n){return e.replace(n[0],n[1])},t)}};function En(t){var e=this;return Kr.call(t.childNodes,function(n,r){r=new Xr(r,e.options);var i="";return r.nodeType===3?i=r.isCode?r.nodeValue:e.escape(r.nodeValue):r.nodeType===1&&(i=Qr.call(e,r)),gn(n,i)},"")}function Jr(t){var e=this;return this.rules.forEach(function(n){typeof n.append=="function"&&(t=gn(t,n.append(e.options)))}),t.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function Qr(t){var e=this.rules.forNode(t),n=En.call(this,t),r=t.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+e.replacement(n,t,this.options)+r.trailing}function gn(t,e){var n=Rr(t),r=Mr(e),i=Math.max(t.length-n.length,e.length-r.length),o=`

`.substring(0,i);return n+o+r}function Zr(t){return t!=null&&(typeof t=="string"||t.nodeType&&(t.nodeType===1||t.nodeType===9||t.nodeType===11))}var Re=Me;var Tn=t=>{t.addRule("filterBase64Images",{filter:"img",replacement:function(e,n){let r=n.getAttribute("src")||"";r.startsWith("data:image/")&&(r="");let i=n.getAttribute("alt")||"";return!r&&!i?"":`![${i}](${r})`}})};var yn=t=>{t.addRule("filterEmptyLinks",{filter:"a",replacement:function(e,n){let r=n.getAttribute("href")||"";if(r&&!r.startsWith("http")&&n.ownerDocument?.URL)try{new URL(r,n.ownerDocument.URL).protocol.startsWith("http")||(r="")}catch{}return r?`[${e.replace(/(\r\n|\r|\n){2,}/g,`
`).trim()}](${r})`:e.trim()}})};var _n=/highlight-(?:text|source)-([a-z0-9]+)/;function ei(t){t.addRule("highlightedCodeBlock",{filter:function(e){let n=e.firstChild;return e.nodeName==="DIV"&&_n.test(e.className)&&n&&n.nodeName==="PRE"},replacement:function(e,n,r){let o=((n.className||"").match(_n)||[null,""])[1];return`

`+r.fence+o+`
`+n.firstChild.textContent+`
`+r.fence+`

`}})}function ti(t){t.addRule("strikethrough",{filter:["del","s","strike"],replacement:function(e){return"~~"+e+"~~"}})}var ni=Array.prototype.indexOf,ri=Array.prototype.every,J={},ii={left:":---",right:"---:",center:":---:"},ct=null,xn=null,Sn=new WeakMap;function oi(t){return t?(t.getAttribute("align")||t.style.textAlign||"").toLowerCase():""}function bn(t){return t?ii[t]:"---"}function Cn(t,e){let n={left:0,right:0,center:0,"":0},r="";for(let i=0;i<t.rows.length;++i){let o=t.rows[i];if(e<o.childNodes.length){let a=oi(o.childNodes[e]);++n[a],n[a]>n[r]&&(r=a)}}return r}J.tableCell={filter:["th","td"],replacement:function(t,e){return ut(wn(e))?t:vn(t,e)}};J.tableRow={filter:"tr",replacement:function(t,e){let n=wn(e);if(ut(n))return t;let r="";if(ai(e)){let i=In(n);for(let o=0;o<i;o++){let a=o<e.childNodes.length?e.childNodes[o]:null,s=bn(Cn(n,o));r+=vn(s,a,o)}}return`
`+t+(r?`
`+r:"")}};J.table={filter:function(t,e){return t.nodeName==="TABLE"},replacement:function(t,e){if(An(e,xn)){let n=e.outerHTML,r=ci(e);return r===null||!r.classList.contains("joplin-table-wrapper")?`

<div class="joplin-table-wrapper">${n}</div>

`:n}else{if(ut(e))return t;t=t.replace(/\n+/g,`
`);let n=t.trim().split(`
`);n.length>=2&&(n=n[1]);let r=/\| :?---/.test(n),i=In(e),o="";if(i&&!r){o="|"+"     |".repeat(i)+`
|`;for(let l=0;l<i;++l)o+=" "+bn(Cn(e,l))+" |"}let a=e.caption&&e.caption.textContent||"",s=a?`${a}

`:"",c=`${o}${t}`.trimStart();return`

${s}${c}

`}}};J.tableCaption={filter:["caption"],replacement:()=>""};J.tableColgroup={filter:["colgroup","col"],replacement:()=>""};J.tableSection={filter:["thead","tbody","tfoot"],replacement:function(t){return t}};function ai(t){let e=t.parentNode;return e.nodeName==="THEAD"||e.firstChild===t&&(e.nodeName==="TABLE"||si(e))&&ri.call(t.childNodes,function(n){return n.nodeName==="TH"})}function si(t){let e=t.previousSibling;return t.nodeName==="TBODY"&&(!e||e.nodeName==="THEAD"&&/^\s*$/i.test(e.textContent))}function vn(t,e=null,n=null){n===null&&(n=ni.call(e.parentNode.childNodes,e));let r=" ";n===0&&(r="| ");let i=t.trim().replace(/\n\r/g,"<br>").replace(/\n/g,"<br>");for(i=i.replace(/\|+/g,"\\|");i.length<3;)i+=" ";return e&&(i=mi(i,e," ")),r+i+" |"}function Nn(t){if(!t.childNodes)return!1;for(let e=0;e<t.childNodes.length;e++){let n=t.childNodes[e];if(n.nodeName==="TABLE"||Nn(n))return!0}return!1}var mt=(t,e)=>{if(!t.childNodes)return!1;for(let n=0;n<t.childNodes.length;n++){let r=t.childNodes[n];if(e==="code"&&ct&&ct(r)||e.includes(r.nodeName)||mt(r,e))return!0}return!1},An=(t,e)=>{let n=["UL","OL","H1","H2","H3","H4","H5","H6","HR","BLOCKQUOTE"];return e.preserveNestedTables&&n.push("TABLE"),mt(t,"code")||mt(t,n)};function ut(t){let e=Sn.get(t);if(e!==void 0)return e;let n=li(t);return Sn.set(t,n),n}function li(t){return!!(!t||!t.rows||t.rows.length===1&&t.rows[0].childNodes.length<=1||Nn(t))}function ci(t){let e=t.parentNode;for(;e.nodeName!=="DIV";)if(e=e.parentNode,!e)return null;return e}function wn(t){let e=t.parentNode;for(;e.nodeName!=="TABLE";)if(e=e.parentNode,!e)return null;return e}function mi(t,e,n){let r=e.getAttribute("colspan")||1;for(let i=1;i<r;i++)t+=" | "+n.repeat(3);return t}function In(t){let e=0;for(let n=0;n<t.rows.length;n++){let i=t.rows[n].childNodes.length;i>e&&(e=i)}return e}function ui(t){ct=t.isCodeBlock,xn=t.options,t.keep(function(e){return!!(e.nodeName==="TABLE"&&An(e,t.options))});for(let e in J)t.addRule(e,J[e])}function di(t){t.addRule("taskListItems",{filter:function(e){return e.type==="checkbox"&&e.parentNode.nodeName==="LI"},replacement:function(e,n){return(n.checked?"[x]":"[ ]")+" "}})}function Mn(t){t.use([ei,ti,ui,di])}var de=t=>{let e=new Re({hr:"---",br:`
`,blankReplacement:(n,r)=>"",...t});return e.use(Mn),e.use(Tn),e.use(yn),e};var Bn=Qe(Le());var Fn=(t,e="smooth")=>{let n=t.startContainer,r=t.getBoundingClientRect(),i=n;for(;i;){if(j(i)){let o=window.getComputedStyle(i);if(tn(i,o)&&(Hn(i,r,e),r=t.getBoundingClientRect()),o.position==="fixed")return}i=i.parentNode}(document.body.clientHeight>window.innerHeight||document.body.offsetHeight>window.innerHeight||document.documentElement.scrollHeight>window.innerHeight||document.documentElement.scrollTop!==0||!document.body.clientHeight)&&Hn(document.body,r,e)},Hn=(t,e,n)=>{let r=t.getBoundingClientRect(),i=e instanceof Element?e.getBoundingClientRect():e,o=i.top-r.top,a=t===document.body?window.innerHeight:t.clientHeight,s=o;i.height<a?s=t.scrollTop+o-a/2+i.height/2:s=t.scrollTop+o,t===document.body&&window.scrollTo({top:s,behavior:n}),t.scrollTo({top:s,behavior:n})},U=(t,e)=>new Promise(n=>setTimeout(()=>{if(e){let i=window.innerHeight/10;e.scrollIntoView(!1),window.scrollBy(0,i)}n(!0)},t));var fe=async(t,e=3,n=1e3)=>{try{return await t()}catch{return e<=0?void 0:(await R(n),fe(t,e-1,n))}};var Pe=(t,e,n)=>new Promise(r=>{let i=setTimeout(()=>{r(n)},e);t.then(o=>{clearTimeout(i),r(o)})});var Oa=(t,e,n)=>{let{timeout:r=ge.SECOND*20,skipWhitespace:i=!0,skipChars:o}=n||{},a=Date.now(),s=[],c="";try{we(t).some(m=>{if(Date.now()-a>r&&!Ht)throw new Error("Element find text timeout");let d=0,u=0,h=!1,p=m.textContent||"";for(let f=0;f<p.length;f++)if(!(o&&o.includes(p[f]))&&!(i&&p[f].trim()===""))if(p[f]===e[c.length]){if(c.length||(d=f,u=f,h=!0),c+=p[f],c.length===e.length){u=f;break}}else c&&(h?f=d:f--),s=[],c="",h=!1;if(c.length){let f=m;s.push({text:p,textNode:f,startOffset:s.length?0:d,endOffset:c.length===e.length?u:p.length-1,parentElement:f.parentElement})}if(c.length===e.length)return!0})}catch{}return s},gi=t=>t.parentElement?t.parentElement:typeof t.parentSelector=="string"?document.querySelector(t.parentSelector):null,Ti=async(t,e=250)=>{t.dispatchEvent(new MouseEvent("mousedown",{cancelable:!0,bubbles:!0})),await R(e),t.dispatchEvent(new MouseEvent("mouseup",{cancelable:!0,bubbles:!0}))};var Ha=async(t,e)=>{if(!t?.length)return;let{classname:n="maxai-reading-highlight",strictMatch:r=!1,behavior:i}=e||{};yi();let o=Wt(t.map(m=>{let d=gi(m);if(!d)return null;let u=d,h=f=>{f.stopPropagation(),f.preventDefault();let E=document.createRange();E.setStart(u.firstChild,0),E.setEnd(u.lastChild,u.lastChild?.nodeValue?.length||0);let T=window.getSelection();T&&(T.removeAllRanges(),T.addRange(E),Ti(u))},p=()=>{u.classList.remove(n),u.removeEventListener("click",h)};if(r&&m.textNode){let f=document.createElement("span");if(m.startOffset>0||m.endOffset<m.text.length-1){let E=m.text.slice(0,m.startOffset),T=m.text.slice(m.endOffset+1);E&&f.appendChild(document.createTextNode(E)),u=document.createElement("span"),u.textContent=m.text.slice(m.startOffset,m.endOffset+1),f.appendChild(u),T&&f.appendChild(document.createTextNode(T))}else u=f,u.textContent=m.textNode.nodeValue;return d.replaceChild(f,m.textNode),u.classList.add(n),u.addEventListener("click",h),{element:u,restore:()=>{p(),d.replaceChild(m.textNode,f)}}}return(u.innerText||u.innerHTML).length>m.text.length*4&&m.textNode?(u=document.createElement("span"),u.textContent=m.textNode.nodeValue,d.replaceChild(u,m.textNode),u.classList.add(n),u.addEventListener("click",h),{element:u,restore:()=>{p(),d.replaceChild(m.textNode,u)}}):(u.classList.add(n),u.addEventListener("click",h),{element:u,restore:p})}).filter(m=>m!==null),m=>m.element).filter((m,d,u)=>u.find(h=>h!==m&&rn(m.element,h.element))?(m.restore(),!1):!0);if(!o.length)return;let a=document.createRange(),s=o[0]?.element,c=o[o.length-1]?.element;s===c?a.selectNode(s):(s&&a.setStart(s.firstChild,0),c&&a.setEnd(c.lastChild,c.lastChild?.nodeValue?.length||0)),Fn(a,i);let l=m=>{m.target&&o.find(d=>d.element===m.target)||(o.forEach(({restore:d})=>{d()}),document.body.removeEventListener("mousedown",l))};document.body.addEventListener("mousedown",l)},Fa=()=>{document.body.dispatchEvent(new MouseEvent("mousedown",{cancelable:!0,bubbles:!0}))},yi=()=>{let t="maxai-reading-highlight";if(document.getElementById(t))return;let e=document.createElement("style");e.id=t,e.innerHTML=`
.maxai-reading-highlight {
  background: linear-gradient(
      0deg,
      rgba(215, 164, 253, 0.4),
      rgba(215, 164, 253, 0.4)
    ),
    linear-gradient(0deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2));
  box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.04);
}
.maxai-reading-highlight:hover {
  background: linear-gradient(
      0deg,
      rgba(215, 164, 253, 0.4),
      rgba(215, 164, 253, 0.4)
    ),
    linear-gradient(0deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2)),
    linear-gradient(0deg, rgba(215, 164, 253, 0.4), rgba(215, 164, 253, 0.4));
  cursor: pointer;
}
`,document.head.appendChild(e)};var w=(t,e,n=20)=>{let r=e,i=0;for(;i<n&&!r?.querySelector(t);)r=r?.parentElement,i++;return r?.querySelector(t)||null},ee=(t,e,n=20)=>{let r=e,i=0;for(;r?.querySelector(t)?.isSameNode(e)||i<n&&!r?.querySelector(t);)r=r?.parentElement,i++;return r?.querySelector(t)||null},I=(t,e,n=20)=>{try{let r=e,i=0;for(;i<n&&!r?.matches(t);)r=r?.parentElement,i++;return r?.matches(t)?r:null}catch{return null}},kn=(t,e)=>e.closest(t),_i=async(t,e=5e3,n=0)=>new Promise((i,o)=>{let a=t();if(a)i(a);else{if(n>e)return i(null);setTimeout(()=>i(_i(t,e,n+500)),500)}});var Gn=(t,e,n,r)=>new Promise(i=>{let o=!1,a=setTimeout(()=>{o=!0,clearInterval(c),i(void 0)},r),s=()=>{if(!o){let l=t.querySelector(e);l&&(clearInterval(c),clearTimeout(a),i(l))}},c=setInterval(s,n);s()}),qn=()=>window.location.host==="dribbble.com"?!1:"customElements"in window,pt=t=>{if(!t||!t.isConnected)return!1;let e=t.getBoundingClientRect();if(e.width===0&&e.height===0)return!1;let n=window.getComputedStyle(t);if(n.display==="none"||n.visibility==="hidden"||n.opacity==="0")return!1;let r=t.parentElement;for(;r;){let i=window.getComputedStyle(r);if(i.display==="none"||i.opacity==="0")return!1;r=r.parentElement}return!0},Si=(t,e)=>{let n=l=>{let m=l.getAttribute("srcset");return m?m.split(",").reduce((u,h)=>{let[p,f]=h.trim().split(" "),E=parseInt(f,10);return!isNaN(E)&&E>u.size?{size:E,src:p}:u},{size:0,src:""}):{src:"",size:0}},r=[],{originalURL:i="",slice:o=-1,minWidth:a=200,minHeight:s=200}=e||{},c=t.querySelectorAll("img");return Array.from(c).forEach(l=>{let m=l.getAttribute("title")||"",d=n(l),u=d.src||l.src.toLowerCase();if(u.startsWith("/")||u.trim()==="")try{u=new URL(u,i).href}catch{}if(/chrome-extension:|icon|menu|logo|svg/.test(u)||u==="")return;let p=l.getAttribute("alt")||"";if(["icon","menu","logo","load","search"].some(S=>p.toLowerCase().includes(S)))return;let f=l.attributes,E="",T="";for(let S=0;S<f.length;S++){let g=f[S].name.toLowerCase();g.includes("width")&&(E=f[S].value),g.includes("height")&&(T=f[S].value)}(E&&Number(E)>a||T&&Number(E)>s)&&r.push({width:parseInt(E)||0,height:parseInt(T)||0,src:u,alt:p==="undefined"?"":p,title:m==="undefined"?"":m,responsiveSize:d.size})}),r=Ut(r,["responsiveSize",l=>Math.max(l.width,l.height)],["desc","desc"]),o>0&&(r=r.slice(0,o)),r},xi=(t,e)=>{let n=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,r=/youtube.com\/live\/([^"&?\/\s]{11})/i,i=l=>{if(l.length===11)return l;let m=l.match(n);if(m&&m.length)return m[1]||"";let d=l.match(r);return d&&d.length&&d[1]||""},o=[],{originalURL:a=""}=e||{};return["data-surl","href"].forEach(l=>{t.querySelectorAll(`[${l}]`).forEach(d=>{let u=d.getAttribute(l)||"";i(u)&&(u.startsWith("https://www.youtube.com")||u.startsWith("https://youtube.com"))&&o.push({src:u,poster:"",title:""})})}),t.querySelectorAll("video").forEach(l=>{let m=l.getAttribute("src")||"",d=l.getAttribute("poster")||"",u=l.getAttribute("title")||"";(m.endsWith(".mp4")||m.endsWith(".webm")||m.endsWith(".ogg"))&&o.push({src:m,poster:d,title:u})}),o.map(l=>{if(l.src.startsWith("/")||l.src.trim()==="")try{l.src=new URL(l.src,a).href}catch{}if(i(l.src)&&l.src.includes("youtube.com")){let m=i(l.src);l.poster=`https://i.ytimg.com/vi/${m}/hqdefault.jpg`}return l}),o},bi=(t,e)=>{try{let{title:n="",removeInvisible:r=!1,...i}=e||{},o=t instanceof Document,a=o?t.cloneNode(!0):document.implementation.createHTMLDocument(n);o?r&&(a.body=ne(a.body)):r?a.body=ne(t):a.body=t.cloneNode(!0);let c=new Bn.Readability(a,{...i,serializer:l=>l}).parse();return!c||!c?.content?a.body?.innerText||"":Un(c.content,{...e,removeInvisible:!1})}catch{return""}},Un=(t,e)=>{let n=r=>r.split(`
`).filter(s=>!s.startsWith("![")&&!s.startsWith("**![")&&!s.startsWith("[![")&&!s.startsWith("![![")).join(`
`);try{let{title:r="",removeImages:i=!1,removeInvisible:o=!1}=e||{},a=t.cloneNode(!0);o&&(a=ne(a));let l=`${de().turndown(a||"")}`;return r&&(l=`# ${r}

${l}`),i&&(l=n(l)),l.trim()}catch{return""}},De=(t,e)=>ln(we(t)),Wa=(t,e)=>{let{image:n=!0,video:r=!0,readability:i=!0,pureText:o=!0,markdown:a=!0,imageOptions:s,videoOptions:c,readabilityOptions:l,pureTextOptions:m,markdownOptions:d}=e||{},u={images:[],videos:[],readability:"",pureText:"",markdown:""};return n&&(u.images=Si(t,s)),r&&(u.videos=xi(t,c)),i&&(u.readability=bi(t,l)),o&&(u.pureText=De(t,m)),a&&(u.markdown=Un(t,d)),u},Va=t=>{t.stopPropagation()},Xa=t=>{let e=t.getRootNode();return e instanceof ShadowRoot?e:null};var Q=()=>{let t=document.querySelector('maxai-instant-reply-data-helper, div[role="maxai-instant-reply-data-helper"]');return t||(qn()?t=document.createElement("maxai-instant-reply-data-helper"):(t=document.createElement("div"),t.setAttribute("role","maxai-instant-reply-data-helper")),t.style.cssText="width:0!important;height:0!important;display:none!important;position:absolute!important;opacity:0!important;visibility:hidden!important;z-index:-9999!important;overflow:hidden!important;pointer-events:none!important;",document.body.appendChild(t)),t};var Wn=Qe(Le());function Ci(t){return t.split(`
`).filter(i=>!i.startsWith("![")&&!i.startsWith("**![")&&!i.startsWith("[![")&&!i.startsWith("![![")).join(`
`)}var vi=async(t,e)=>{try{let n=document.cloneNode(!0);n&&t&&(n.body.innerHTML=t.innerHTML);let i=new Wn.Readability(n,e).parse();if(!i||!i?.content)return document.body.innerText||"";let a=new Re().turndown(i?.content||""),s=`# ${i?.title}

${a}
`;return Ci(s)}catch{return""}},Vn=vi;var V=/[\w.-]+@[\w.-]+\.[A-Za-z]{2,}/g,Xn=t=>{let e=[];for(let n=0;n<t.length;n++){let r=t[n],{from:i,to:o,subject:a,date:s,content:c}=r;e.push({text:`## Email #${n+1}
**From:** ${i.name}<${i.email}>
**To:** ${o.map(l=>`${l.name}<${l.email}>`).join(", ")}
**Date:** ${s}
**Subject:** ${a}

${c}

---
`,data:r})}return e},A=class{constructor(e){this.selector="body";this.user={email:"",name:""};this.sender=null;this.receiver=null;this.emails=[];e&&this.setSelector(e)}clear(){this.selector="",this.user={email:"",name:""},this.sender=null,this.receiver=null,this.emails=[]}setSelector(e){this.selector=e}setUser(e){this.user=e}setSender(e){this.sender=e}setReceiver(e){this.receiver=e}addEmail(e){this.emails.push(e)}addEmailByAddress(e,n){this.sender&&this.receiver&&(e===this.sender?.email?this.addEmail({from:this.sender,to:[this.receiver],...n}):this.emails.push({from:this.receiver,to:[this.sender],...n}))}sortEmails(){return this.emails.sort((e,n)=>new Date(e.date).getTime()-new Date(n.date).getTime()),this.emails}get data(){return this.buildData()}buildData(){let e=Xn(this.sortEmails()),n=null,r="",i=e.map(({data:a,text:s})=>(a.from.email!==this.user.email&&(n=a,r=s),s)).join(`
`);n||(n=e.at(-1)?.data||null),r||(r=e.at(-1)?.text||"");let o=e.at(-1)?.text||"";return{selector:this.selector,user:this.user,sender:this.sender,receiver:this.receiver,emails:this.emails,replyEmail:n,replyEmailText:r,allEmailText:i,lastEmailText:o}}async buildPageData(e=[document.documentElement]){let n="";try{n=(await Promise.all(e.map(async o=>{let a=o?.contentDocument||o?.ownerDocument||document;return a?.querySelector&&a.querySelector(this.selector)?.innerText||""}))).join(""),n||(n=await Vn())}catch{}let i=Xn(this.sortEmails()).at(-1)?.text||"";return{selector:this.selector,user:this.user,sender:this.sender,receiver:this.receiver,emails:this.emails,replyEmail:null,replyEmailText:n,allEmailText:n,lastEmailText:i}}};var X=t=>{if(!t)return"";let e=t.cloneNode(!0);Array.from(e.querySelectorAll("br")).forEach(s=>{s.replaceWith(`

`)});let n=[],r=G(),i=!1;if(r==="mail.google.com"){let s=e.querySelector("div.gmail_attr");s&&s.childNodes[0]?.textContent?.includes("Forwarded message")&&(i=!0,n.push(...Array.from(e.querySelectorAll("div.gmail_attr")))),n.push(...Array.from(e.querySelectorAll(".adL"))),n.push(...Array.from(e.querySelectorAll(".adm")).map(c=>c.parentElement)),i||n.push(...Array.from(e.querySelectorAll("div.gmail_quote"))),n.push(...Array.from(e.querySelectorAll(".iX")))}return e.querySelectorAll("div[id]").forEach(s=>{if(s.id.includes("mail-quote")){n.push(s);return}if(s.id.includes("RplyFwdMsg")){n.push(s.nextElementSibling),n.push(s);return}}),e.querySelectorAll("div[class]").forEach(s=>{if(!i&&s.className.includes("gmail_quote")){n.push(s);return}}),e.querySelectorAll("style").forEach(s=>{n.push(s)}),n.forEach(s=>{try{s.remove()}catch{}}),e.style.whiteSpace="pre-wrap",Array.from(e.querySelectorAll("br")).forEach(s=>{s.replaceWith(`
`)}),e.outerText.trim().replace(/\s*\n\s*/g,`
`);let o=document.createElement("div");o.style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.zIndex="-9999",o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.appendChild(e);let a=o.innerText;return o.remove(),a};var re='div[role="main"] div[role="list"]',$n=()=>document.querySelector(re)!==null;var Ni=t=>t.length===0?[{email:"",name:""}]:Array.from(t).map(e=>({email:(e.getAttribute("email")||e.getAttribute("data-hovercard-id")||"").toLowerCase(),name:e.getAttribute("name")||e.getAttribute("data-name")||e.textContent||""})),Ai=async t=>{let e=new A;e.setSelector(re);try{let n=Array.from(document.querySelectorAll(re)).pop();if(n){let r=document.querySelector('header a[aria-label][role="button"]:has(> img)')?.getAttribute("aria-label")?.match(V)?.[0]||"";e.setUser({email:r,name:""});let i=n.querySelector('span[role="button"][aria-expanded][aria-label][tabindex]');i&&pt(i)&&(i.click(),await U(3e3,t));let o=document.querySelector('div[role="main"] h2[data-thread-perm-id]')?.textContent||document.title,a=null,s=Array.from(n.querySelectorAll('div[role="listitem"] > div > div > div > [id]'));for(let c=0;c<s.length;c++){let l=s[c],m=l.contains(t),d=!!(l.querySelector("div[data-message-id]")||l.querySelector("div[data-legacy-message-id]")),u=!1,h=()=>{let p=l.querySelector("div[data-message-id]")||l.querySelector("div[data-legacy-message-id]");if(p){let f=p.querySelectorAll("table span[email]");if(f.length>0&&!u){let[E,...T]=Ni(f),N=l.querySelector('span[tabindex="-1"][alt]'),S=p.querySelector("div[id][jslog] > div[id]");e.addEmail({from:E,to:T,subject:o,date:N?.title||"",content:X(S),dateElement:N,contentElement:S}),u=!0}}return u};if(d?h():(a||(a=document.createElement("style"),a.innerHTML='div[role="listitem"]>div>div>div>[id]>div:nth-child(1){display:flex!important;} div[role="listitem"]>div>div>div>[id]>div:nth-child(2){display:none!important;}',document.getElementsByTagName("head")[0].appendChild(a)),await new Promise(p=>{let f=0,E=new MutationObserver(()=>{f++,(h()||f===30)&&(E.disconnect(),p())});E.observe(l,{childList:!0,subtree:!0}),l.querySelector("& > div:nth-child(1)")?.click(),setTimeout(()=>{u||(h(),E.disconnect(),p())},2e3)})),d||l.querySelector("& > div:nth-child(2) [data-message-id] > div:nth-child(2) > div > table")?.click(),m)break}a&&a?.remove()}}catch{}return e.data},wi=async t=>{let e=new A;e.setSelector(re);try{let n=Array.from(document.querySelectorAll(re)).pop();if(n){e.clear();let r=n.querySelector('span[role="button"][aria-expanded][tabindex="-1"]');r&&pt(r)&&(r.click(),await R(3e3));let i=[];Array.from(n.querySelectorAll('div[role="listitem"]')).find(a=>a.contains(t)?(i.push(a),!0):(i.push(a),!1));for(let a=0;a<i.length;a++)if(i[a].querySelectorAll("table span[email]").length>=2){let s=Array.from(i[a].querySelectorAll("table span[email]")),c="";document.querySelectorAll('a[aria-label][role="button"]').forEach(d=>{d?.getAttribute("aria-label")?.includes("@gmail.com")&&(c=d?.getAttribute("aria-label")?.match(V)?.[0]||"")});let l=s.find(d=>d.getAttribute("email")===c),m=s.find(d=>d.getAttribute("email")!==c);e.setSender({email:l?.getAttribute("email")||"",name:l?.getAttribute("name")||""}),e.setReceiver({email:m?.getAttribute("email")||"",name:m?.getAttribute("name")||""});break}let o=document.querySelector("h2[data-thread-perm-id]")?.textContent||document.title;i.forEach(a=>{let s=a.querySelector("div[data-message-id]")||a.querySelector("div[data-legacy-message-id]"),c=a.querySelector('span[tabindex="-1"][alt]'),l=c?.title||"",m=a.querySelector("h3 span[email]")?.getAttribute("email")||a.querySelector("span[email]")?.getAttribute("email");if(m)if(s){let d=a.querySelector("div[id][jslog] > div[id]"),u=X(d);e.addEmailByAddress(m,{content:u,date:l,subject:o,contentElement:d,dateElement:c})}else{let d=a.querySelector('div[role="gridcell"] span'),u=d?.textContent||"";e.addEmailByAddress(m,{content:u,date:l,subject:o,contentElement:d,dateElement:c})}})}}catch{}return e.data},Yn=async t=>{try{let e=await Ai(t);if(e.emails||(e=await wi(t),e.emails))return e}catch{}return new A(re).buildPageData()},ht=class{constructor(){this.mutationObserver=null;this.eventConfigs=[{name:"view_thread",type:"added",callbacks:[]},{name:"close_email",type:"removed",callbacks:[]}]}startMutationObserver(){this.mutationObserver||(this.mutationObserver=new MutationObserver(e=>{for(let n of e)this.trigger(n.addedNodes,"added"),this.trigger(n.removedNodes,"removed")}),this.mutationObserver.observe(document.body,{subtree:!0,childList:!0}))}trigger(e,n){for(let r=0;r<e.length;r++){let i=e[r];i.nodeType===Node.ELEMENT_NODE&&this.eventConfigs.forEach(({name:o,type:a,callbacks:s})=>{s.length&&a===n&&this[o](i)&&s.forEach(c=>c(i))})}}addEventListeners(e,n){this.startMutationObserver();let r=this.eventConfigs.find(({name:i})=>i===e);r&&r.callbacks.push(n)}removeEventListeners(e,n){let r=this.eventConfigs.find(({name:i})=>i===e);r&&(r.callbacks=r.callbacks.filter(i=>i!==n))}view_thread(e){let n=e.className||"",r=n.trim?n.trim().split(/\s+/):[];return r.includes("Bu")||r.includes("nH")?e.tagName.toLowerCase()==="div"&&e.classList.contains("iY")||e.querySelectorAll("div.iY").length>0:!1}close_email(e){let n=e.className||"",r=n.trim?n.trim().split(/\s+/):[];return r.includes("Bu")||r.includes("nH")?e.tagName.toLowerCase()==="div"&&e.classList.contains("iY")||e.querySelectorAll("div.iY").length>0:!1}},ms=new ht;var Et=t=>{if(document.createEvent){let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!1),t.dispatchEvent(e)}else typeof t.onclick=="function"&&t.onclick()},Oe=t=>{if(t){let e=t,n=0;for(;!e.querySelector("#divRplyFwdMsg")&&n<10;)n++,e=e.parentElement;let r=e.cloneNode(!0),i=new A,o=r.querySelector("#divRplyFwdMsg")||r.querySelector("#RplyFwdMsg"),a=document.createElement("div"),s=o?.nextElementSibling;for(;s;)a.appendChild(s.cloneNode(!0)),s=s.nextElementSibling;if(o){let c=Array.from(o.querySelector('[style*="font"]')?.childNodes||[]).filter(l=>!l.tagName);if(c.length===4){let l=c[0].textContent?.match(V)?.[0],m=c[0].textContent?.replace(` <${l}>`,""),d=c[2].textContent?.match(V)?.[0],u=c[2].textContent?.replace(` <${d}>`,""),h=c[1].textContent||"",p=c[3].textContent||"";if(l&&m&&d&&u&&h&&p){i.setSender({email:l,name:m}),i.setReceiver({email:d,name:u}),o.remove();let f=X(a);return i.addEmailByAddress(l,{date:h,subject:p,content:f,contentElement:a}),i}}}}return null},Ii=async t=>{let e="";try{let n=document.querySelector('#ReadingPaneContainerId div[role="heading"][aria-level="2"]')?.textContent||document.title,r=document.querySelector('div[tabindex] > div[role="button"][aria-label]');r?.click();let i=document.querySelector('div[data-app-section="ConversationContainer"]')||document.querySelector('div[data-app-section="MailReadCompose"] div[data-app-section="ItemContainer"]'),o=document.querySelector('#ReadingPaneContainerId div[id] > div[role="textbox"]');if(i&&(!t||i.contains(t))){let l=[],m=Array.from(i.querySelectorAll("& > div > div:has(div[tabindex])")),d=m.find(p=>t&&p.contains(t))?.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";if(m.forEach(p=>{let f=p.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";t?new Date(f).getTime()<=new Date(d).getTime()&&l.push(p):l.push(p),p.querySelectorAll("& > div > div").forEach(T=>{T.querySelector('i[data-icon-name="ArrowReplyRegular"]')&&Et(T)})}),!document.querySelector("#mectrl_currentAccount_primary")){let p=document.createElement("style");p.innerHTML="#mectrl_main_body{display:none!important;}",document.getElementsByTagName("head")[0].appendChild(p);let f=document.querySelector("#meInitialsButton");for(;!document.querySelector("#mectrl_currentAccount_primary");)f.click(),await R(2e3);p.remove()}let u=document.querySelector("#mectrl_currentAccount_secondary")?.textContent||"",h=new A;h.setUser({email:u,name:""});for(let p=0;p<l.length;p++){let f=l[p],E='& > div:nth-child(1) span[data-lpc-hover-target-id]:not([class*="undefined"])';r&&f.contains(r)&&(E='span[data-lpc-hover-target-id]:not([class*="undefined"])');let T=Array.from(f.querySelectorAll(E)),N=f.querySelector('div[data-testid="RecipientWell"]');if(!N||T.length===0)continue;let S=f.querySelector('div[data-testid="SentReceivedSavedTime"]')?.innerText||"",g=f.querySelector("#UniqueMessageBody")||f.querySelector('div[role="document"]'),F=X(g),y={from:{email:"",name:""},to:[],date:S,subject:n,content:F,contentElement:g};T.forEach(D=>{let L=D.textContent||"",W=L.match(V)?.[0]||D?.getAttribute("aria-label")?.match(V)?.[0]||"",$=L.replace(` <${W}>`,"").replace(";","");N?.contains(D)?y.to.push({email:W,name:$}):(y.from.email=W,y.from.name=$)}),h.addEmail(y)}if(h.sortEmails(),h.emails.forEach(({from:p,to:f},E)=>{if(p.email===""){let T=u;if(E===0){let N=document.querySelector('[role="listbox"] .epBmH span[title*="@"]');N?.textContent===p.name&&(T=N.getAttribute("title")?.match(V)?.[0]||"")}p.email=T}f.forEach(T=>{T.email===""&&(T.email=u)})}),e='div[data-app-section="ConversationContainer"]',h.emails.length>0)return h.setSelector(e),h.data}let a=document.querySelector('div[role="dialog"] div[role="textbox"][textprediction]')||document.querySelector('div[role="dialog"] div[id] > div[role="textbox"]'),s=Array.from(document.querySelectorAll('div[role="dialog"]')).find(l=>l.contains(a));if(s&&(!t||s.contains(t))){e="#ReadingPaneContainerId";let l=Oe(a);if(l)return l.setSelector(e),l.data}let c=document.querySelector("#ReadingPaneContainerId");if(c&&(!t||c.contains(t))){e="#ReadingPaneContainerId";let l=Oe(o);if(l)return l.setSelector(e),l.data}}catch{e='div[data-app-section="ConversationContainer"]'}return new A(e).buildData()},Mi=async t=>{let e="";try{let n=document.querySelector('#ReadingPaneContainerId div[role="heading"][aria-level="2"]')?.textContent||document.title;document.querySelector('div[role="button"][aria-label="See more messages"]')?.click();let i=document.querySelector('div[data-app-section="ConversationContainer"]');if(i&&i.contains(t)){let o=new A,a=[],s=Array.from(i.querySelectorAll("& > div > div")),c=s.find(u=>u.contains(t))?.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";s.forEach(u=>{let h=u.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";new Date(h).getTime()<=new Date(c).getTime()&&a.push(u),u.querySelectorAll("& > div > div").forEach(f=>{f.querySelector('i[data-icon-name="ArrowReplyRegular"]')&&Et(f)})});let l=document.querySelector("#meInitialsButton");for(;!document.querySelector("#mectrl_currentAccount_primary");)l.click(),await R(2e3);let m=document.querySelector("#mectrl_currentAccount_primary")?.textContent||"",d=document.querySelector("#mectrl_currentAccount_secondary")?.textContent||"";for(let u=0;u<a.length;u++){let h=Array.from(a[u].querySelectorAll("span[data-lpc-hover-target-id]")),p=a[u].querySelector('div[data-testid="RecipientWell"]');if(!p||h.length===0)continue;let f=a[u].querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"",E=a[u].querySelector("#UniqueMessageBody")||a[u].querySelector('div[role="document"]'),T=X(E);h.find(N=>{let S=N.textContent||"",g=S.match(V)?.[0];if(!g&&S===o.sender?.name?g=o.sender.email:!g&&S===o.receiver?.name&&(g=o.receiver.email),g){let F=!1;p?.contains(N)&&(F=!0);let y=S.replace(` <${g}>`,"");if(y&&g){if((!o.receiver||!o.sender)&&(F?(o.setReceiver({name:y,email:g}),o.setSender({name:m,email:d})):(o.setSender({name:y,email:g}),o.setReceiver({name:m,email:d}))),F){let D=o.sender?.email===g?o.receiver.email:o.sender.email;o.addEmailByAddress(D,{date:f,subject:n,content:T,contentElement:E})}else o.addEmailByAddress(g,{date:f,subject:n,content:T,contentElement:E});return!0}}return!1})}if(e='div[data-app-section="ConversationContainer"]',o.setSelector(e),o.sortEmails(),o.emails.length>0)return o.data}}catch{e='div[data-app-section="ConversationContainer"]'}return new A(e).buildData()},jn=async t=>{let e=await Mi(t);return e.emails.length||(e=await Ii(t),e.emails)?e:new A(e.selector).buildPageData()},Kn=async t=>{let e="";try{let n=document.querySelector('#ReadingPaneContainerId div[role="heading"][aria-level="2"]')?.textContent||document.title;document.querySelector('div[role="button"][aria-label="See more messages"]')?.click();let i=document.querySelector('div[data-app-section="ConversationContainer"]');if(i&&(!t||i.contains(t))){let l=new A,m=[],d=Array.from(i.querySelectorAll("& > div > div")),u=d.find(E=>t&&E.contains(t))?.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";d.forEach(E=>{let T=E.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";t?new Date(T).getTime()<=new Date(u).getTime()&&m.push(E):m.push(E),E.querySelectorAll("& > div > div").forEach(S=>{S.querySelector('i[data-icon-name="ArrowReplyRegular"]')&&Et(S)})});let h=document.querySelector("#meInitialsButton");for(;!document.querySelector("#mectrl_currentAccount_primary");)h.click(),await R(2e3);let p=document.querySelector("#mectrl_currentAccount_primary")?.textContent||"",f=document.querySelector("#mectrl_currentAccount_secondary")?.textContent||"";for(let E=0;E<m.length;E++){let T=Array.from(m[E].querySelectorAll("span[data-lpc-hover-target-id]")),N=m[E].querySelector('div[data-testid="RecipientWell"]');if(!N||T.length===0)continue;let S=m[E].querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"",g=m[E].querySelector("#UniqueMessageBody")||m[E].querySelector('div[role="document"]'),F=X(g);T.find(y=>{let D=y.textContent||"",L=D.match(V)?.[0];if(!L&&D===l.sender?.name?L=l.sender.email:!L&&D===l.receiver?.name&&(L=l.receiver.email),L){let W=!1;N?.contains(y)&&(W=!0);let $=D.replace(` <${L}>`,"");if($&&L){if((!l.receiver||!l.sender)&&(W?(l.setReceiver({name:$,email:L}),l.setSender({name:p,email:f})):(l.setSender({name:$,email:L}),l.setReceiver({name:p,email:f}))),W){let oe=l.sender?.email===L?l.receiver.email:l.sender.email;l.addEmailByAddress(oe,{date:S,subject:n,content:F,contentElement:g})}else l.addEmailByAddress(L,{date:S,subject:n,content:F,contentElement:g});return!0}}return!1})}if(e='div[data-app-section="ConversationContainer"]',l.setSelector(e),l.sortEmails(),l.emails.length>0)return l.data}let o=document.querySelector('div[role="dialog"] div[role="textbox"][textprediction]')||document.querySelector('div[role="dialog"] div[id] > div[role="textbox"]'),a=Array.from(document.querySelectorAll('div[role="dialog"]')).find(l=>l.contains(o));if(a&&(!t||a.contains(t))){e="#ReadingPaneContainerId";let l=Oe(o);if(l)return l.setSelector(e),l.data}let s=document.querySelector('#ReadingPaneContainerId div[id] > div[role="textbox"]'),c=document.querySelector("#ReadingPaneContainerId");if(c&&(!t||c.contains(t))){e="#ReadingPaneContainerId";let l=Oe(s);if(l)return l.setSelector(e),l.data}}catch{e='div[data-app-section="ConversationContainer"]'}return new A(e).buildPageData()};var zn=async()=>{let t="iframe[sandbox]",e="div#proton-root",n=!1;document.querySelectorAll("div.scroll-inner .message-header").forEach(i=>{n=!0,i.click()}),n&&await R(3e3);let r=Array.from(document.querySelectorAll(t));return new A(e).buildPageData(r)};var Jn=()=>new A("div.container").buildPageData();var Qn=async()=>new A('div[data-test-id="message-group-view-scroller"]').buildPageData();var Zn=async()=>{let t="div.zmPVContent",e=!1;return document.querySelectorAll("div.zmPVContent .zmTMailList .zmMHdrSumContent").forEach(n=>{e=!0,n.click()}),e&&await R(3e3),new A(t).buildPageData()};var He=async t=>{let e=G();return e==="mail.google.com"?Yn(t):e==="outlook.live.com"?jn(t):e==="outlook.office.com"||e==="outlook.office365.com"?Kn(t):e==="mail.yahoo.com"?Qn():e==="wx.mail.qq.com"?Jn():e==="mail.proton.me"?zn():e==="mail.zoho.com"?Zn():new A().buildPageData()};var Ri=[{website:"mail.google.com",traffic:4.57},{website:"mail.yahoo.com",traffic:1.79},{website:"outlook.live.com",traffic:1.63},{website:"outlook.office.com",traffic:1.63},{website:"outlook.office365.com",traffic:1.63},{website:"navigator-lxa.mail.com",traffic:1.51},{website:"mail.proton.me",traffic:.54},{website:"icloud.com",traffic:.51},{website:"mail.zoho.com",traffic:.45},{website:"mail.qq.com",traffic:.37},{website:"wx.mail.qq.com",traffic:.36}],Li=Ri.map(t=>t.website),Pi=t=>/^https:\/\/mail\.google\.com\/mail\/u\/\d+\/popout.+/.test(t),Di=t=>["https://mail.google.com/mail/u/0/#inbox","https://mail.google.com/mail/u/0/#all"].indexOf(t)>=0,Oi=t=>/^https:\/\/mail\.google\.com\/mail\/u\/\d+\/.+\/.+/.test(t),er=t=>{let e=G(t);return Li.includes(e)?e==="mail.google.com"?window.location.href.includes("#settings")?!1:window.location.href.includes("#category")?/^https:\/\/mail\.google\.com\/mail\/u\/\d+\/.+\/.+\/.+/.test(window.location.href):Di(t||window.location.href)?$n():Pi(t||window.location.href)?!0:Oi(t||window.location.href):e==="icloud.com"?window.location.href.includes("icloud.com/mail"):e==="outlook.live.com"?/^https:\/\/outlook.live.com\/mail\/\d+\/\w+\/id\/.+/.test(window.location.href):e==="outlook.office.com"?window.location.href.includes("outlook.office.com/mail"):e==="outlook.office365.com"?window.location.href.includes("outlook.office365.com"):!0:!1},$s=async t=>{let e=document.querySelector(t),n=G(),r="",i=document.documentElement;if(n==="mail.google.com"&&(document.querySelectorAll('table[role="presentation"]').forEach(o=>{o.contains(e)&&(i=o)}),r='div[role="textbox"]'),n==="outlook.office.com"||n==="outlook.live.com"||n==="outlook.office365.com"){let a=e.parentElement,s=null,c=0;for(;!s&&c<20;)a=a?.parentElement,s=a?.querySelector('div[role="textbox"][textprediction]')||a?.querySelector('div[id] > div[role="textbox"]')||null,c++;return s?X(s):""}try{if(r){let o=i.querySelector(r);return X(o)}return""}catch{return""}},Ys=async t=>{let e=Q(),n=t?document.querySelector(t):null;if(n){let i=n.getAttribute("maxai-input-assistant-button-id");if(e.getAttribute("aria-operation-selector-id")===i){let o=e.getAttribute("data-full-context-cache"),a=e.getAttribute("data-target-context-cache"),s=e.getAttribute("data-last-reply-email-context-cache");if(a)return{targetReplyEmailContext:a,emailContext:o||a,lastReplyEmailContext:s||""}}e.setAttribute("aria-operation-selector-id",i)}let r=await He(n);return r.emails.length&&(e.setAttribute("data-full-context-cache",r.allEmailText),e.setAttribute("data-target-context-cache",r.replyEmailText),e.setAttribute("data-last-reply-email-context-cache",r.lastEmailText)),{...r,targetReplyEmailContext:r.replyEmailText,emailContext:r.allEmailText,lastReplyEmailContext:r.lastEmailText}};var Fe=t=>{if(t.length>0){let e=[];t.forEach((i,o)=>{let{content:a,author:s,like:c}=i;e.push({text:`[Comment ${o+1}]
**Author:** ${s}
${c?`**like:** ${c}`:""}
**Comment:**
${a}`,data:i})});let n=e[e.length-1],r=e.slice(0,e.length-1);return{last:n,lastText:e[e.length-1].text,previous:r,previousText:r.map(i=>i.text).join(`

`),fullText:e.map(i=>i.text).join(`

`)}}return null},_=class{constructor(e,n){this.commentList=[];let{postTitle:r="Post",postContentTagName:i="Post caption/description",meta:o={}}=n||{};this.config={postTitle:r,postContentTagName:i,meta:o},this.post=e}static get emptyData(){return{SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:"",SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:"",SOCIAL_MEDIA_PAGE_CONTENT:"",postText:""}}addCommentList(e){this.commentList.push(e)}get data(){let{content:e,author:n,title:r}=this.post,i=Fe(this.commentList?.[0]||[]),o="";o+=`[${this.config.postTitle}]`,o+=`
**Post author:** ${n||"N/A"}`,o+=`
**Post title:** ${r||"N/A"}`,o+=`
**${this.config.postContentTagName}:**
${e||"N/A"}`;let a="";return a+=`[Page title]: ${r||"N/A"}`,a+=`
[Page author]: ${n||"N/A"}`,a+=`
[Page content]:
${e||"N/A"}`,Object.keys(this.config.meta||{}).forEach(s=>{o+=`
**${s}:**
${this.config.meta?.[s]||"N/A"}`,a+=`
[${s}]:
${this.config.meta?.[s]||"N/A"}`}),i?.lastText?{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:i.lastText,SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:i.previousText?`${o}

${i.previousText}

${i.lastText}`:`${o}

${i.lastText}`,post:this.post,postText:o,replyCommentText:i.last.text,replyComment:i.last.data,previousComments:this.commentList?.[0]||[],previousCommentsText:i.previousText,SOCIAL_MEDIA_PAGE_CONTENT:a}:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:o,SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:o,post:this.post,postText:o,previousComments:this.commentList?.[0]||[],previousCommentsText:i?.previousText,SOCIAL_MEDIA_PAGE_CONTENT:a}}};var Hi=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,Fi=/youtube.com\/live\/([^"&?\/\s]{11})/i,ke=new Map,B=class t{static async fetchTranscriptByCaptionUrl(e){let n=await M.proxyFetch(e,{method:"GET",parse:"text"});if(n?.success){let r=n.data;return this.parseXml(r)}return[]}static async fetchTranscriptByCaptionTracks(e){let n="en",r=[...e].sort((i,o)=>i.languageCode===n?-1:o.languageCode===n||i.languageCode.includes(n)?1:o.languageCode.includes(n)?-1:0);for(let i=0;i<r.length;i++){let{baseUrl:o}=r[i],a=await this.fetchTranscriptByCaptionUrl(o);if(a.length)return a}return[]}static async fetchTranscript(e,n){let r=this.retrieveVideoId(e),i=[];try{if(ke.has(r)&&ke.get(r)?.length)return ke.get(r)||[];let o=n||"";if(!o){if(!r)return i;let s=await M.proxyFetch("https://www.youtube.com/watch?v="+r,{method:"GET",parse:"text"});s?.success&&s.data&&(o=s.data)}let a=o.split('"captions":');if(a.length>=2){let s=JSON.parse(a[1].split(',"videoDetails')[0].replace(/\n/,"")).playerCaptionsTracklistRenderer.captionTracks;i=await this.fetchTranscriptByCaptionTracks(s)}}catch{i=[]}return i.length===0&&(i=await this.fetchYouTubeVideoTranscriptByShowTranscriptButton()),i.length>2&&ke.set(r,i),i}static{this.fetchYouTubeVideoTranscriptByShowTranscriptButton=async()=>{try{let e=document.querySelector("#segments-container")!==null,n=document.documentElement.scrollTop,r=Array.from(document.querySelectorAll("ytd-video-description-transcript-section-renderer #primary-button .yt-spec-button-shape-next[aria-label]"));if(r.length===0)return[];let i=Array.from(document.querySelectorAll("#segments-container ytd-transcript-segment-renderer"));if(i.length===0&&(r.forEach(c=>c.click()),await Gn(document.body,"#segments-container",100,5e3),i=Array.from(document.querySelectorAll("#segments-container ytd-transcript-segment-renderer"))),i.length===0)return[];let o=c=>{let l=c.split(":").reverse(),m=0;for(let d=0;d<l.length;d++){let u=parseInt(l[d],10);isNaN(u)||(m+=u*Math.pow(60,d))}return m.toFixed(2)},a=i.map((c,l)=>{let m=(c.querySelector(".segment-timestamp")?.innerText||"").trim(),d=(c.querySelector("yt-formatted-string")?.innerText||"").trim();return{timestamp:o(m),text:d}}),s=[];if(a.forEach((c,l)=>{if(l!==a.length-1){let m=a[l+1];s.push({start:c.timestamp,duration:(parseFloat(m.timestamp)-parseFloat(c.timestamp)).toFixed(2),text:c.text})}else{let m=(document.querySelector(".ytp-time-duration")?.innerText||"").trim();if(m){let d=o(m);s.push({start:c.timestamp,duration:(parseFloat(d)-parseFloat(c.timestamp)).toFixed(2),text:c.text})}else s.push({start:c.timestamp,duration:"0.00",text:c.text})}}),!e){let c=document.querySelector("ytd-engagement-panel-section-list-renderer:has(#segments-container) button.yt-spec-button-shape-next");c&&(c.click(),document.documentElement.scrollTop=n,setTimeout(()=>{document.documentElement.scrollTop=n},0))}return s}catch{return[]}}}static async fetchYouTubeVideoInfo(e,n){let r=null,i=await M.proxyFetch("https://www.youtube.com/watch?v="+e,{method:"GET",parse:"text"},n);if(i?.success){r={title:"",author:"",account:"",date:"",content:"",transcriptText:""},r.transcriptText=await t.transcriptFormat(await t.fetchTranscript(e,i.data));let o=new DOMParser().parseFromString(i.data,"text/html");r.title=o.querySelector('meta[itemprop="name"]')?.getAttribute("content")||"",r.author=o.querySelector('span[itemprop="author"] link[itemprop="name"]')?.getAttribute("content")||"",r.account=o.querySelector('span[itemprop="author"] link[itemprop="url"]')?.getAttribute("href")?.split("@")?.[1]||"",r.date=o.querySelector('meta[itemprop="datePublished"]')?.getAttribute("content")||"",r.content=o.querySelector('meta[itemprop="description"]')?.getAttribute("content")||"";try{if(o.body.innerHTML){let a=o.body.innerHTML.split('"videoDetails":')?.[1]?.split(',"thumbnail":')?.[0];if(a){let s=JSON.parse(a+"}");s.title&&(r.title=s.title),s.shortDescription&&(r.content=s.shortDescription)}}}catch{}}return r}static async fetchYoutubePageContentWithoutDocument(e,n){try{let r=await t.fetchYouTubeVideoInfo(e,n);if(r){let{title:i,author:o,account:a,date:s,content:c,transcriptText:l}=r;return new _({title:i,author:`${o}(@${a})`,date:s,content:c},{postTitle:"Video post",meta:{"Video transcript":l}}).data}return _.emptyData}catch{return _.emptyData}}static async transcriptFormat(e,n){let r=`${e.map(i=>`${i.start} ${i.text}
`).join("")}`;return n?(await z(r,n)).text:r}static retrieveVideoId(e){if(e.length===11)return e;let n=e.match(Hi);if(n&&n.length)return n[1]||"";let r=e.match(Fi);return r&&r.length&&r[1]||""}static processTranscripts(e,n=2e3){if(!e||e.length===0)return[];let r=0;for(let s=0;s<e.length;s++)r+=e[s].text.length;if(r<1e4)return e;let i=this.computeSectionMaxChars(r),o=this.splitTranscriptArrayByWordCount(e,i),a=o;return o.length>n&&(a=o.slice(0,n)),a}static computeSectionMaxChars(e){return e<=15e3?100:e<=2e4?200:500}static splitTranscriptArrayByWordCount(e,n=500){if(!e||e.length===0)return[];let r=[],i={start:"",duration:0,text:""},o=[],a=0,s=()=>{o.length>0&&(i.text=o.join(" "),r.push({...i,duration:i.duration.toString()}))};return e.forEach((c,l)=>{a+c.text.length<=n?(i.start===""&&(i.start=c.start),i.duration+=parseFloat(c.duration),o.push(c.text),a+=c.text.length):(s(),i={start:c.start,duration:parseFloat(c.duration),text:""},o=[c.text],a=c.text.length),l===e.length-1&&s()}),r}static parseXml(e){let i=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("text"),o=[];for(let a=0;a<i.length;a++){let s=i[a],c=s.getAttribute("start"),l=s.getAttribute("dur")||"",m=s.textContent;c&&m&&o.push({start:c,duration:l,text:m})}return o}};var gt=t=>{let e=t||(typeof window<"u"?window.location.href:"");return G(e)==="youtube.com"&&B.retrieveVideoId(e)?"YOUTUBE_VIDEO_SUMMARY":Bt()?"PDF_CRX_SUMMARY":er(e)?"DEFAULT_EMAIL_SUMMARY":"PAGE_SUMMARY"},Bi=t=>{switch(t){case"DEFAULT_EMAIL_SUMMARY":return"page_content__email";case"PDF_CRX_SUMMARY":return"page_content__pdf";case"YOUTUBE_VIDEO_SUMMARY":return"page_content__youtube";case"PAGE_SUMMARY":default:return"page_content__webpage"}},sl=t=>{let e=gt(t);return Bi(e)};var Gi=async(t,e)=>{let n=t?.querySelector('div[data-visualcompletion="ignore-dynamic"]')?.parentElement?.parentElement;if(n){let r=n.querySelector("& > div:nth-child(2)"),i=n.querySelector("& > div:nth-child(3) div[id] > div:nth-child(1):not(a) > :not(a) span[dir]")||n.querySelector("& > div:nth-child(3):has([id])");if(r){if(i){let c=i?.querySelector('[role="button"]');c&&(c.click(),await U(100,e))}let o=(r.querySelector('h4[id] [role="link"]')||r.querySelector('h3[id] [role="link"]')||r.querySelector('h2[id] [role="link"]'))?.innerText,a=Array.from(r?.querySelectorAll('span[id] [role="link"]')||[]);a.length>1&&a[0]?.innerText&&(o=a[0]?.innerText);let s=a?.pop()?.innerText;return{author:o||"",date:s&&s.length<=30?s:"",content:i?.innerText||"",title:""}}}return null},qi=async t=>{if(t){let e=t?.firstElementChild?.children?.[1];if(e){let n=t?.lastElementChild;if(n){let o=n?.querySelector('[role="button"]');o&&(o.click(),await U(100))}let r=e?.querySelector('h2 [role="link"]')?.innerText,i=(e?.querySelector('span > span > span [aria-label][role="link"]')||e?.querySelector('span > span > span [role="link"] [aria-labelledby]'))?.innerText;return{author:r||"",date:i&&i.length<=30?i:"",content:n?.querySelector?.("div")?.innerText||"",title:document.querySelector("#watch_feed > div > div:nth-child(1) > div > div > div:nth-child(1) > div:nth-child(2) > div:nth-child(1)")?.innerText||""}}}return null},Ui=async(t,e)=>{if(t){let n=t?.firstElementChild?.querySelector('h2 [role="link"][aria-label]')?.innerText,r=t?.children?.[1];if(r){let i=r?.querySelector('[role="button"]');i&&(i.click(),await U(100,e))}return{author:n||"",date:"",content:r?.innerText||"",title:""}}return null},Be=async t=>{let e=t?.querySelector("a > span > span")?.innerText||"",n=t?.querySelector("span[lang][dir]");if(n){let o=n.querySelector('[role="button"]');o&&(o.click(),await U(100))}let r=Array.from(t?.querySelectorAll("a > span")),i=r[r.length-1]?.innerText;return{content:n?.innerText||"",author:e,date:i&&i.length<=30?i:""}},Ge=(t,e=!1)=>{let n=t?.parentElement?.parentElement?.parentElement?.parentElement?.parentElement;return e&&(n=n?.parentElement),n},tr=async t=>{let e=document.querySelector('div:has(> [data-pagelet="WatchPermalinkVideo"]) + div > div')||document.querySelector('div[data-pagelet="TahoeRightRail"] > div > div')||document.querySelector("#watch_feed > div > div:nth-child(1) > div > div > div:nth-child(2) > div:nth-child(1)")||document.querySelector('[role="dialog"][aria-label] div[role="complementary"] > div:nth-child(1) >div >div:nth-child(1) > div > div > div:nth-child(1)'),n=document.querySelector('div[data-pagelet="ReelsCommentPane"]')||document.querySelector('[role="main"]:not(:has([aria-describedby][aria-labelledby])) + [role="complementary"] > div > div:nth-child(1) > div > div:nth-child(1) > div'),r=I('[role="dialog"]:not([aria-label])',t,50),i=I('[role="article"]:not([aria-label]):not(:has( > [aria-label]))',t,30)||I("div[aria-describedby][aria-labelledby]",t,30),o=await(e?qi(e):n?Ui(n,t):Gi(r||i,t));if(o){let a=new _(o),s='div[role="article"][aria-label]',c=w('form[role="presentation"]',t),l=c?.contains(t),m=!0;if(!n&&!r){let d=[];i?((I('div[role="article"] div[data-visualcompletion="ignore-dynamic"] > div:nth-child(1) > div:nth-child(1) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1)',t)||I('div[aria-describedby][aria-labelledby] div[data-visualcompletion="ignore-dynamic"] > div > div:nth-child(1) > div:nth-child(1) div:has(>div>div[aria-label][role="button"])',t))?.contains(t)&&(m=!1),d=Array.from(i?.querySelectorAll('form[role="presentation"]')||[])):e&&l&&(d=Array.from(e?.parentElement?.querySelectorAll('form[role="presentation"]')||[])),m&&l&&d?.at(-1)?.contains(t)&&(m=!1)}if(m){let d=ee(`${s}${l?":has(.xfmpgtx)":""}`,t);if(!d&&l&&(d=ee(s,t)),d){let u=null,h=await Be(d),p=[];if(l){let f=Array.from(Ge(d)?.querySelectorAll(s)||[]);u=f[0],u===d&&(f.shift(),f.length===0&&(u=null));let E=c.querySelector('span[spellcheck="false"][data-lexical-text]');if(E)for(let T=0;T<f.length;T++){let N=f[T],S=await Be(N);if(S.author===E.innerText){d=N,h=S;break}}}for(p.push(h),(!u||u===d)&&(u=ee(s,Ge(d,!0)));d&&u;)if(Ge(u,!0)===Ge(d,!0)){let f=ee(s,u);if(!f||f.isSameNode(u))break;p.unshift(await Be(f)),d=f,u=ee(s,d)}else p.unshift(await Be(u)),d=u,u=ee(s,d);p.length>0&&a.addCommentList(p)}}return a.data}return _.emptyData},nr=t=>w('div[contenteditable="true"]',t,30)?.innerText||"";var qe=async t=>{let e=Array.from(t.querySelectorAll("a")).find(a=>a.innerText.trim()!=="")?.innerText||"",n=t.querySelector("time"),r="",i="",o=t.querySelector('div[role="button"][tabindex="0"]:has(> span[dir])');if(o&&(o.click(),await U(500)),n){i=n?.dateTime||"";let a=I("div",n)?.nextElementSibling;a||(a=t.querySelector("section + div > span[dir]")),r=a?.innerText||""}return r||(r=(t.querySelector("h3")||t.querySelector("h2"))?.nextElementSibling?.innerText||""),r||(r=t.querySelector("span[dir] > span[dir]")?.innerText||""),{content:r,author:e.startsWith("@")?e:`${e?`@${e}`:""}`,date:i}},rr=async t=>{let e=I("section",t),n=e?.querySelector("textarea")?.value||"",r=e?.parentElement?.parentElement;if(r){let i=r.querySelector("hr")?Array.from(r?.querySelectorAll("hr + div > div > div > div")):Array.from(r?.querySelectorAll("section + div > ul > *")),[o,...a]=i;if(!o){let l=r.querySelector("div:has( > span[dir] > span[dir])");if(l||(l=I("article",r,10)),l){let m=await qe(l);return new _({author:m.author,content:m.content,title:"",date:m.date}).data}else return _.emptyData}let s=await qe(o),c=new _({author:s.author,content:s.content,title:"",date:s.date});if(n.startsWith("@")){let l=n.split(" ")?.[0],m=[];a.map(u=>{u?.querySelectorAll("& > div > div > div:has(> ul)")?.forEach(h=>{m.push(h)})}),m.length===0&&(m=a);let d=[];for(let u=0;u<m.length;u++){let h=await qe(m[u]);if(h.author&&l.startsWith(h.author)){d.push(h);break}let p=Array.from(m[u]?.querySelectorAll("ul > div"));if(p.length>0){let f=!1;for(let E=0;E<p.length;E++){let T=await qe(p[E]);if(h.author&&l.startsWith(T.author)){f=!0,d.push(h),d.push(T);break}}if(f)break}}c.addCommentList(d)}return c.data}return _.emptyData},ir=t=>{let e=w('div[contenteditable="true"]',t,20);return e?e?.innerText||"":w("form textarea",t,20)?.value};var or=async t=>{let e=t.querySelector("span.comments-comment-meta__description-title")?.innerText||"",n=t.querySelector("time")?.innerText||"",r=t.nextElementSibling?.querySelector(".comments-comment-item__main-content")?.innerText||"",i=t.parentElement?.querySelector(".comments-comment-social-bar__reactions-count")?.innerText||t.parentElement?.querySelector(".comments-comment-social-bar__reactions-count--cr")?.innerText||"0";return{author:e||"",date:n,content:r,like:i}},ar=async t=>{let e=w('[role="region"][data-urn] > div',t)||w('div[data-view-name="feed-full-update"]',t,50);if(e){let n=e.querySelector(".update-components-actor__meta"),r=e.querySelector(".update-components-update-v2__commentary");if(n&&r){let i=new _({author:n?.querySelector(".update-components-actor__name")?.innerText||n?.querySelector(".update-components-actor__title")?.innerText||"",content:r.innerText||"",title:"",date:n?.querySelector(".update-components-actor__sub-description span[aria-hidden]")?.innerText?.replaceAll(" ","").split("\u2022")?.[0]||""}),o=I(".comments-comment-entity",t),a=o?.querySelector(".comments-comment-meta__container"),c=w("a.ql-mention",t)?.innerText||"";if(o&&a){let l=[];l.push(await or(a));let m=w(".comments-replies-list",t),d=Array.from(m?.querySelectorAll(".comments-comment-entity--reply")||[]);for(let u of d){let h=u?.querySelector(".comments-comment-meta__container");if((h?.querySelector(".comments-comment-meta__description-title")?.innerText||"")===c){l.push(await or(h));break}}i.addCommentList(l)}return i.data}}return _.emptyData},sr=t=>w("div.ql-editor",t,30)?.innerText||"";var lr=async t=>{let e=t.querySelector('a[data-testid="comment_author_link"]')?.innerHTML||"",n=t.querySelector('div[data-testid="comment"]')?.innerText||t.querySelector("div.RichTextJSON-root")?.innerText||"";return{author:e,date:"",content:n}},cr=async t=>{let e=w('div[data-test-id="post-content"]',t,50);if(e){let n=e.querySelector('div[data-adclicklocation="title"]').innerText||e.querySelector("h1")?.innerText||"",r=e.querySelector('a[data-testid="post_author_link"]')?.innerHTML||"",i=e.querySelector(".RichTextJSON-root")?.innerText||"",o=new _({author:r,content:i,title:n,date:""}),a=Array.from(document.querySelectorAll("div:has( > div[data-scroller-first])")).find(s=>s.contains(t));if(a){let s=t;for(let c=0;c<100&&!s?.parentElement?.isSameNode(a);c++)s.parentElement&&(s=s.parentElement);if(s){let c=[];c.push(await lr(s));let l=Number(s.querySelector("div[id][style][tabindex]")?.style?.paddingLeft?.replace("px",""))||0,m=s.previousElementSibling,d=Number(a.querySelector("div[data-scroller-first]")?.style?.paddingLeft?.replace("px",""))||16;for(;m&&l>d;){let u=Number(m.querySelector("div[id][style][tabindex]")?.style?.paddingLeft?.replace("px",""))||0;if(l>u)if(c.unshift(await lr(m)),l=u,m.previousElementSibling)m=m.previousElementSibling;else break;else if(l>d&&m.previousElementSibling)m=m.previousElementSibling;else break}o.addCommentList(c)}}return o.data}return _.emptyData},mr=t=>{let e=w('div[contenteditable="true"]',t,15);return e?e?.innerText||"":w('textarea[rows="1"]:has( + span[id])',t,15)?.value||""};var ur=t=>{let e=t.querySelector('div[data-testid="User-Name"]'),[n,r]=$t(Array.from(e?.querySelectorAll("span")).map(a=>a.textContent||"").filter(a=>a&&a!=="\xB7")),i=t.querySelector("time")?.dateTime||"",o=t.querySelector('div[data-testid="tweetText"]')?.innerText||"";return{author:`${n}(${r})`,date:i,content:o,title:""}},dr=async t=>{let e=Q(),n=t.getAttribute("maxai-input-assistant-button-id")||"";if(n){if(e.getAttribute("aria-operation-selector-id")===n){let i=e.getAttribute("data-full-context-cache"),o=e.getAttribute("data-target-context-cache");if(o)return{postText:i||o,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:o,SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:i||o,SOCIAL_MEDIA_PAGE_CONTENT:""}}e.setAttribute("aria-operation-selector-id",n)}let r=w('article[data-testid="tweet"]',t);if(r){let i=[],o=I('div[data-testid="cellInnerDiv"]',r,5);for(;o;){if(o?.getAttribute("data-testid")==="cellInnerDiv"){let a=o.querySelector('article[data-testid="tweet"]');a&&i.splice(0,0,ur(a))}o=o.previousElementSibling}if(i.length>0){let a=i.shift(),s=new _(a);return s.addCommentList(i),e.setAttribute("data-full-context-cache",s.data.SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT),e.setAttribute("data-target-context-cache",s.data.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT),s.data}else{let a=new _(ur(r));return e.setAttribute("data-full-context-cache",a.data.SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT),e.setAttribute("data-target-context-cache",a.data.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT),a.data}}return _.emptyData},fr=t=>w("div.DraftEditor-editorContainer",t,30)?.innerText||"",Rl=t=>{let e=Array.from(document.querySelectorAll('div[role="progressbar"]')),n=null;for(let r=0;r<e.length;r++){let i=e[r];if(i.parentElement?.contains(t)){n=i.parentElement;break}}return n};var _t=async t=>{let e=t.querySelector("a#author-text")?.innerText||"",n=t.querySelector("#published-time-text")?.innerText||"",r=t.querySelector("#content-text")?.innerText||"",i=t.querySelector("#vote-count-middle")?.innerText||"";return{author:e,date:n,content:r,like:i.trim()}},hr=async t=>{try{let e=Q(),n=t.getAttribute("maxai-input-assistant-button-id")||"";if(n){if(e.getAttribute("aria-operation-selector-id")===n){let o=e.getAttribute("data-full-context-cache"),a=e.getAttribute("data-target-context-cache");if(a)return{postText:o||a,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:a,SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:o||a,SOCIAL_MEDIA_PAGE_CONTENT:""}}e.setAttribute("aria-operation-selector-id",n)}let r=B.retrieveVideoId(window.location.href),i=null;if(r){let o="";e.getAttribute("aria-youtube-video-id")===r&&(o=e.getAttribute("data-youtube-video-transcript-cache")||""),e.setAttribute("aria-youtube-video-id",r),o||(o=await B.transcriptFormat(await B.fetchTranscript(window.location.href)),e.setAttribute("data-youtube-video-transcript-cache",o));let a={},s=document.querySelector("#microformat player-microformat-renderer script")?.textContent;if(s)try{Object.assign(a,JSON.parse(s))}catch{}let c=document.querySelector("ytd-watch-metadata"),l=c?.querySelector("#title > h1")?.innerText||document.title,m=document.querySelector("ytd-video-owner-renderer"),d=m?.querySelector("yt-formatted-string")?.textContent,u=m?.querySelector("a")?.getAttribute("href")?.includes("@")&&m?.querySelector("a")?.getAttribute("href")?.split("/")[1],h=c?.querySelector("#description #info-container yt-formatted-string > span:nth-child(3)")?.innerText||"",p=a.description||"";if(!p){let f=c?.querySelector("tp-yt-paper-button#expand");f&&!f.hidden&&(f.click(),await U(100,t)),p=c?.querySelector("#description ytd-text-inline-expander yt-attributed-string")?.innerText||""}i=new _({title:l,author:`${d}(${u})`,date:h,content:p},{postTitle:"Video post",meta:{"Post video transcript":o}})}else if(window.location.href.startsWith("https://www.youtube.com/shorts")){let a=I("ytd-reel-video-renderer",t,50)?.querySelector("ytd-reel-player-header-renderer");if(a){let s=a?.querySelector(".title > yt-formatted-string")?.innerText||"",c=a?.querySelector("ytd-channel-name #text-container yt-formatted-string")?.innerText||"";i=new _({title:s,author:c,date:"",content:""},{postTitle:"Video post"})}}if(i){let o="#body.ytd-comment-view-model",a=kn(o,t);if(a&&!I("ytd-comment-simplebox-renderer",a,5)){let s=[];if(!!I("#replies.ytd-comment-thread-renderer",a,6)){let l=I("ytd-comment-thread-renderer",a)?.querySelector(`& > ytd-comment-view-model#comment ${o}`);s.push(await _t(l))}s.push(await _t(a)),i.addCommentList(s)}return n&&(e.setAttribute("data-full-context-cache",i.data.SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT),e.setAttribute("data-target-context-cache",i.data.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT)),i.data}}catch{}return _.emptyData},Er=async t=>{try{let e=await Vi();if(e?.commentsData&&e.commitList.length>0){let n=`${t?.postText}
[Post commentList]:
${e?.commentsData.fullText||"N/A"}`,r=`${t?.SOCIAL_MEDIA_PAGE_CONTENT}
[Page commentList]:
${e?.commentsData.fullText||"N/A"}`;return{...t,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:n,SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:n,postText:n,previousComments:e.commitList||[],previousCommentsText:e?.commentsData?.previousText,SOCIAL_MEDIA_PAGE_CONTENT:r}}else return null}catch{return null}},Wi=()=>{let t=document.querySelector("#below ytd-item-section-renderer.style-scope.ytd-comments");t instanceof HTMLElement&&(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.visibility="hidden")},Tt=()=>{let t=document.querySelector("#below ytd-item-section-renderer.style-scope.ytd-comments");t instanceof HTMLElement&&(t.style.position="",t.style.top="",t.style.left="",t.style.display="",t.style.visibility="visible")},Vi=async()=>{try{if(await yt(()=>(document.querySelector("ytd-watch-flexy")||document.querySelector("ytd-watch-grid"))?.getAttribute("video-id")===B.retrieveVideoId(window.location.href),100,1e3*10),document?.querySelector("#sections #count")){let t=await pr();return{commentsData:Fe(t||[]),commitList:t}}else{if(Wi(),document.getElementById("content-pages"))return Tt(),null;let t=document.querySelector("#message a");if(t&&t.getAttribute("href")?.includes("support.google.com/youtube/answer/9706180"))return Tt(),null;let e=0;await yt(()=>{if(e>10)return!0;e+=1;let i=document?.querySelector("#sections #count .style-scope.yt-formatted-string");return!!i&&window.getComputedStyle(i).display!=="none"},300,1e3*10),Tt(),await yt(()=>{let i=document.querySelector("#author-thumbnail img");return!!(i?.clientWidth&&i?.clientHeight&&i?.clientWidth>0&&i?.clientHeight>0)},500,1e3*5);let n=await pr(),r=Fe(n||[]);return Yt({commentsData:r,commitList:n})}}catch{return null}},gr=t=>w('div#contenteditable-root[contenteditable="true"]',t,30)?.innerText||"",yt=async(t,e,n)=>new Promise(r=>{let i=setInterval(async()=>{t&&t()&&(e?setTimeout(()=>{r()},e):r(),clearInterval(i))},200);n&&setTimeout(()=>{i&&clearInterval(i),r()},n)}),pr=async()=>{try{let t=document?.getElementsByTagName("ytd-comment-thread-renderer"),e=[];if(t)for(let n=0;n<t.length;n++){let r=t[n],i=await _t(r);e.push(i)}return e}catch{return[]}};var St=async t=>{let e=t.querySelector("#badge-name")?.innerText||t.querySelector("#name")?.innerText||"",n=t.querySelector("yt-formatted-string.published-time-text")?.innerText||"",r=t?.querySelector("ytcp-button#more");r&&(r.click(),await U(100));let i="";return t.querySelector("#content-text")?.childNodes.forEach(o=>{if(o.tagName==="IMG"){let a=o.getAttribute("alt")||"";i+=a}else i+=o.textContent}),{author:e.replace(/\n/g,"").trim(),date:n,content:i}},Tr=async t=>{try{let e=Q(),n=t.getAttribute("maxai-input-assistant-button-id")||"";if(n){if(e.getAttribute("aria-operation-selector-id")===n){let i=e.getAttribute("data-full-context-cache"),o=e.getAttribute("data-target-context-cache");if(o)return{postText:i||o,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:o,SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT:i||o,SOCIAL_MEDIA_PAGE_CONTENT:""}}e.setAttribute("aria-operation-selector-id",n)}let r=I("ytcp-comment",t);if(r){let i=I("ytcp-comment-thread",r),a=(i?.querySelector("ytcp-comment-button#view-comment-button")).getAttribute("data-ytb-url")||"",s=B.retrieveVideoId(a||"");if(s){let c="",l="",m="",d="";if(e.getAttribute("aria-youtube-video-id")===s&&(c=e.getAttribute("data-youtube-video-title-cache")||"",l=e.getAttribute("data-youtube-video-author-cache")||"",m=e.getAttribute("data-youtube-video-date-cache")||"",d=e.getAttribute("data-youtube-transcript-cache")||""),e.setAttribute("aria-youtube-video-id",s),!d){let h=await B.fetchYouTubeVideoInfo(s,Te());c=h?.title||"",l=h?.author||"",m=h?.date||"",d=h?.transcriptText||""}c||(c=(document.querySelector("#back-button")?document.querySelector("#entity-name"):i?.querySelector("#video-title > yt-formatted-string"))?.innerText||""),l||(l=!document.querySelector("#back-button")&&document.querySelector("#entity-name")?.innerText||""),e.setAttribute("data-youtube-video-title-cache",c),e.setAttribute("data-youtube-video-author-cache",l),e.setAttribute("data-youtube-video-date-cache",m),e.setAttribute("data-youtube-transcript-cache",d);let u=new _({title:c,author:l,date:m,content:""},{postTitle:"Video post",meta:{"Post video transcript":d}});if(r){let h=I("ytcp-comment-thread",r)?.querySelector("& > ytcp-comment");if(h){let p=I("ytcp-comment",r);p&&(w("ytcp-comment-replies",p,5)?.contains(p)&&!p.isSameNode(h)?u.addCommentList([await St(h),await St(p)]):u.addCommentList([await St(h)]))}return n&&(e.setAttribute("data-full-context-cache",u.data.SOCIAL_MEDIA_POST_OR_COMMENT_CONTEXT),e.setAttribute("data-target-context-cache",u.data.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT)),u.data}}}}catch{}return _.emptyData},yr=t=>{let e=w("textarea#textarea",t,30);return e?.innerText||e?.value||""};var xt=async t=>{let e=document.querySelector(t);if(!e)return _.emptyData;let n=G();return n==="twitter.com"?await dr(e):n==="linkedin.com"?await ar(e):n==="facebook.com"?await tr(e):n==="youtube.com"?await hr(e):n==="studio.youtube.com"?await Tr(e):n==="instagram.com"?await rr(e):n==="reddit.com"?await cr(e):_.emptyData},nc=async t=>{let e=G(),n=document.querySelector(t);return n?e==="twitter.com"?fr(n):e==="linkedin.com"?sr(n):e==="facebook.com"?nr(n):e==="youtube.com"?gr(n):e==="studio.youtube.com"?yr(n):e==="instagram.com"?ir(n):e==="reddit.com"?await mr(n):"":""};var Xi=async(t,e)=>{let{timeout:n,abortTaskId:r}=e,i={success:!0,status:200,url:t,redirectedUrl:"",html:""};try{let o=async s=>{try{let c=await M.proxyFetch(s,{method:"GET",parse:"text"},r);if(c&&(c?.responseRaw?.url&&c?.responseRaw?.url!==t&&(i.redirectedUrl=c?.responseRaw?.url),i.status=c.responseRaw?.status||200,c?.responseRaw?.url.includes("www.sogou.com/antispider")&&(i.status=301),c?.data?.includes("java-com-google-gws-common-impl-searchguard-jslayout__broken-text")&&(i.status=301),c.success&&c.data))return c.data;throw new Error("Failed to fetch HTML content")}catch{return null}},a=async s=>{let c=await Pe(o(s),n,"");if(s.includes("https://www.sogou.com")){let l=/window\.location\.replace\("([^"]+)"\)/,m=c.match(l);m&&m[1]&&(c=await Pe(o(m[1]),n,""))}return c};i.html=await a(t)}catch{i.success=!1}return i},_r=Xi;var Sr=Qe(Le()),bt=t=>{let{replaceDocument:e,replaceBody:n,disableReadability:r,readabilityOptions:i,markdownOptions:o}=t||{},a,s=()=>(a||(a=e||document.cloneNode(!0)),a&&n&&(a.body.innerHTML=n.innerHTML),!e&&!n&&(a.body=ne(document.body)),a),c=()=>{try{let m=s().body.cloneNode(!0);if(an.forEach(d=>{m.querySelectorAll(d).forEach(u=>{u.remove()})}),m)return`${de(o).turndown(m)}`}catch{return""}return""};try{if(r)return c();let l=s(),d=new Sr.Readability(l,{...i,serializer:h=>h}).parse(),u=d?.content;if(d&&u){let p=de(o).turndown(u);return`# ${d?.title}

${p}`}return c()}catch{return c()}};var Ue=class{async generateDocument(e,n){let{override:r}=n||{};try{if(!Ze(e,window.location.href))return Gt()?this.generateDocumentWithBackground(e):this.generateDocumentWithIframe(e).catch(()=>this.generateDocumentWithBackground(e));let i=gt(e),o=null;return i==="PAGE_SUMMARY"&&(o=await this.generateNormalURLDocument(e)),i==="YOUTUBE_VIDEO_SUMMARY"&&(o=await this.generateYouTubeURLDocument(e)),i==="DEFAULT_EMAIL_SUMMARY"&&(o=await this.generateEmailURLDocument(e)),o?(r&&(o=Vt([o,r])),o):null}catch{return null}}async generateDocumentFile(e,n,r){return e==="page_content__webpage"?k.createDocFile(e,n,r):k.createDocFile(e,n)}async generateDocumentWithIframe(e){if(!await ie.disableCSPFromUrl(e))return Promise.reject("generate document with iframe add request rule failed");let r=document.createElement("iframe");return r.style.width="680px",r.style.height="1080px",r.style.position="fixed",r.style.left="0",r.style.top="0",r.style.opacity="0",r.style.zIndex="-100",r.style.pointerEvents="none",r.src=e,document.body.appendChild(r),new Promise((i,o)=>{let a=setTimeout(()=>{o("generate document with iframe is timeout"),clearTimeout(a),r.remove()},ge.SECOND*30);r.onload=async()=>{clearTimeout(a);let s=await M.pingIframePage(r),c=0;for(;s===null&&c<4;)s=await M.pingIframePage(r),c+=1;if(s===null){o("generate document with iframe is null document"),r.remove();return}await R(500);let l=await M.createIframePageDocument(r,e);for(c=0;(!l||l.doc_type==="page_content__webpage"&&!l.pure_text)&&c<4;)await R(500),l=await M.createIframePageDocument(r,e),c+=1;l?(i(l),clearTimeout(a),r.remove()):(o("generate document with iframe is null document"),clearTimeout(a),r.remove())},r.onerror=s=>{o(s),clearTimeout(a),r.remove()}})}async generateDocumentWithBackground(e){let{html:n}=await _r(e,{timeout:2e4}),r=new DOMParser().parseFromString(n||"","text/html"),i=De(r.body,{}),o=bt({replaceDocument:r,disableReadability:!0}),{text:a,tokens:s}=await z(i,k.MAX_TEXT_TOKENS),{text:c}=await z(o,k.MAX_TEXT_TOKENS),l={title:r.title.slice(0,200),readabilityMarkdown:c},m=await k.createDocFile("page_content__webpage",l,{pureText:a});return{doc_id:await k.createDocId(m),doc_type:"page_content__webpage",file:m,pure_text:a,tokens:s,link:e,doc_type_dependent_data:l}}async generateDocumentWithBrowser(e,n){if(["https://chrome.google.com/webstore","https://chromewebstore.google.com"].find(l=>e.includes(l)))throw new Error("generate document with tab is null");let{windowId:i,tabId:o}=n||{},a=null;if(o&&(a=await M.runBackgroundFunction("tabs","get",[o])),a&&o?Ze(a.url||"",e)||await M.runBackgroundFunction("tabs","update",[a.id,{url:e}]):a=await M.runBackgroundFunction("tabs","create",[{url:e,windowId:i}]),await fe(async()=>{if(!a?.id||(a=await M.runBackgroundFunction("tabs","get",[a.id]),!a?.id||a.status==="complete"))return null;throw new Error("")},100,200),await R(500),!a?.id)return Promise.reject(new Error("generate document with tab is null"));let s=await M.createTabPageDocument(a.id,e),c=0;for(;(!s||s.doc_type==="page_content__webpage"&&!s.pure_text)&&c<4;)await R(500),s=await M.createTabPageDocument(a.id,e),c+=1;return s||Promise.reject(new Error("generate document with tab is null"))}async generateNormalURLDocument(e,n){let r=n||await M.getSpecialHostPageContent()||"",i=r,o=r;i||(i=De(document.body),o=bt({disableReadability:!0}));let{text:a,tokens:s}=await z(i,k.MAX_TEXT_TOKENS),{text:c}=await z(o,k.MAX_TEXT_TOKENS),l={title:document.title.slice(0,200),readabilityMarkdown:c},m=await k.createDocFile("page_content__webpage",l,{pureText:a});return{doc_id:await k.createDocId(m),doc_type:"page_content__webpage",file:m,pure_text:a,tokens:s,link:e,doc_type_dependent_data:l}}async generateYouTubeURLDocument(e){let n=await xt("ytd-watch-metadata #title");n.post?.title||await fe(async()=>{if(n=await xt("ytd-watch-metadata #title"),!n.post?.title)throw new Error("")},20,200);let r=await Er(n);r&&(n=r);let i=await B.fetchTranscript(B.retrieveVideoId(e)),o={description:n?.post?.content||"",author:n?.post?.author||"",date:n?.post?.date||"",title:(n?.post?.title||document.title||"").slice(0,200),comments:n?.previousComments||[],transcripts:i},a=await k.createDocFile("page_content__youtube",o);return{doc_id:await k.createDocId(a),doc_type:"page_content__youtube",file:a,link:e,pure_text:"",doc_type_dependent_data:o}}async generateEmailURLDocument(e){let n=await M.getSpecialHostPageContent();if(n)return this.generateNormalURLDocument(e,n);let r=await He(null);if(!r.emails.length)return this.generateNormalURLDocument(e);let i=await Promise.all(r.emails.map(async c=>{let{text:l}=await z(c.content,2e3);return{from:c.from,to:c.to,subject:c.subject,date:c.date,content:l}})),o={title:i[0]?.subject&&!document.title.includes(i[0]?.subject)?i[0]?.subject:document.title.slice(0,200),emails:i},a=await k.createDocFile("page_content__email",o,{link:e});return{doc_id:await k.createDocId(a),doc_type:"page_content__email",link:e,pure_text:"",tokens:0,file:a,doc_type_dependent_data:o}}};var Ct=new Ue;var $i=t=>{let e=new t,n=async r=>{let{eventType:i,id:o,data:a,taskId:s}=r.data||{};if(o!==ve)return;if(Ot==="prod"){let l=[Pt,Dt],m=!1;if(l.every(d=>!r.origin.startsWith(d))?(m=!1,r.source&&r.source.__MAXAI_EXTENSION__INIT_BROWSER_EXTENSION__SCRIPT__&&(m=!0)):m=!0,!m)return}let c=null;try{let l=kt(i.replace("BROWSER_EXTENSION_FEATURES__",""));if(!e[l])throw new Error("Browser extension feature not found");c=await e[l](...a)}catch{c=null}window.postMessage({id:Ne,taskId:s,result:c},r.origin==="null"?"*":r.origin)};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}};var x=class{async proxyFetch(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__PROXY_FETCH",window,...e])}async abortProxyFetch(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__ABORT_PROXY_FETCH",window,...e])}async openPage(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__OPEN_PAGE",window,...e])}async closePage(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__CLOSE_PAGE",window,...e])}async getSpecialHostPageContent(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__GET_SPECIAL_HOST_PAGE_CONTENT",window])}async operationPageElement(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__OPERATION_PAGE_ELEMENT",window,...e])}async showSidebar(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__SHOW_SIDEBAR",window])}async hideSidebar(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__HIDE_SIDEBAR",window])}async setPricingClosedRedirectUrl(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__SET_PRICING_CLOSED_REDIRECT_URL",window,...e])}async createFileStreamer(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__CREATE_FILE_STREAMER",window,...e]).then(n=>{if(n instanceof Error)return Promise.reject(n);if(!n||!n.taskId)return null;let{taskId:r,fileInfo:i}=n;return Kt(this,r,i)})}async destroyFileStreamer(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__DESTROY_FILE_STREAMER",window,...e])}async getFileNextChunk(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__GET_FILE_NEXT_CHUNK",window,...e])}async updateCurrentTabNetRequestSessionRules(e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__UPDATE_CURRENT_TAB_NET_REQUEST_SESSION_RULES",window,e])}async clearCurrentTabNetRequestSessionRules(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__CLEAR_CURRENT_TAB_NET_REQUEST_SESSION_RULES",window])}async syncUserTokens(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__SYNC_USER_TOKENS",window,...e])}async injectScript(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__INJECT_SCRIPT",window,...e])}async pingIframePage(...e){let[n,...r]=e,i=[null,...r];return await ce.apply(this,["BROWSER_EXTENSION_FEATURES__PING_IFRAME_PAGE",n?.contentWindow||window,500,...i])}async findIframePageCitation(...e){let[n,...r]=e;if(await this.pingIframePage(n)===null)return null;let o=[null,...r];return await v.apply(this,["BROWSER_EXTENSION_FEATURES__FIND_IFRAME_PAGE_CITATION",n?.contentWindow||window,...o])}async createIframePageDocument(...e){let[n,...r]=e;if(await this.pingIframePage(n)===null)return null;let o=[null,...r];return await v.apply(this,["BROWSER_EXTENSION_FEATURES__CREATE_IFRAME_PAGE_DOCUMENT",n?.contentWindow||window,...o]).then(async a=>{if(a&&!(a.file instanceof File)){let s=await Ct.generateDocumentFile(a.doc_type,a.doc_type_dependent_data,{pureText:a.pure_text});return{...a,file:s}}return a})}async getExtensionPinedStatus(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__GET_EXTENSION_PINED_STATUS",window])}async getExtensionPublicConfig(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__GET_EXTENSION_PUBLIC_CONFIG",window])}async checkSettingsUpdate(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__CHECK_SETTINGS_UPDATE",window])}async getCurrentTabScreenshot(){return await v.apply(this,["GET_CURRENT_TAB_SCREENSHOT",window])}async getExtensionUserTokens(){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__GET_EXTENSION_USER_TOKENS",window])}async openNewTab(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__OPEN_NEW_TAB",window,...e])}async openNewTabAndPollCheckTabAlive(...e){return await jt.apply(this,[{eventType:"BROWSER_EXTENSION_FEATURES__OPEN_NEW_TAB_AND_POLL_CHECK_TAB_ALIVE",postWindow:window,timeout:2147483647},e])}async getCurrentTabInfo(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__GET_CURRENT_TAB_INFO",window,...e])}async runBackgroundFunction(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__RUN_BACKGROUND_FUNCTION",window,...e])}async pingTabPage(...e){return await ce.apply(this,["BROWSER_EXTENSION_FEATURES__PING_TAB_PAGE",window,500,...e])}async findTabPageCitation(...e){return await v.apply(this,["BROWSER_EXTENSION_FEATURES__PING_TAB_PAGE",window,...e])}async createTabPageDocument(...e){let[n]=e;return await this.pingTabPage(n)===null?null:await v.apply(this,["BROWSER_EXTENSION_FEATURES__CREATE_TAB_PAGE_DOCUMENT",window,...e]).then(async i=>{if(i&&!(i.file instanceof File)){let o=await Ct.generateDocumentFile(i.doc_type,i.doc_type_dependent_data,{pureText:i.pure_text});return{...i,file:o}}return i})}};b([C("5.1.0")],x.prototype,"proxyFetch",1),b([C("5.1.0")],x.prototype,"abortProxyFetch",1),b([C("5.1.0")],x.prototype,"openPage",1),b([C("5.1.0")],x.prototype,"closePage",1),b([C("5.1.0")],x.prototype,"getSpecialHostPageContent",1),b([C("5.1.0")],x.prototype,"operationPageElement",1),b([C("5.1.0")],x.prototype,"showSidebar",1),b([C("5.1.0")],x.prototype,"hideSidebar",1),b([C("5.1.8")],x.prototype,"createFileStreamer",1),b([C("5.1.8")],x.prototype,"destroyFileStreamer",1),b([C("5.1.8")],x.prototype,"getFileNextChunk",1),b([C("6.0.0")],x.prototype,"updateCurrentTabNetRequestSessionRules",1),b([C("6.0.0")],x.prototype,"clearCurrentTabNetRequestSessionRules",1),b([C("6.3.0",!1)],x.prototype,"syncUserTokens",1),b([C("6.4.0")],x.prototype,"injectScript",1),b([C("6.4.0")],x.prototype,"pingIframePage",1),b([C("6.4.0")],x.prototype,"findIframePageCitation",1),b([C("6.4.0")],x.prototype,"createIframePageDocument",1),b([C("7.0.0",!1,!1)],x.prototype,"getExtensionPinedStatus",1),b([C("7.0.3",!1,!1)],x.prototype,"getExtensionPublicConfig",1),b([C("7.0.3",!1,!1)],x.prototype,"checkSettingsUpdate",1),b([C("7.4.1")],x.prototype,"getCurrentTabScreenshot",1),b([C("8.7.1",!1,!1)],x.prototype,"getExtensionUserTokens",1),b([C("8.7.1",!1,!1)],x.prototype,"openNewTab",1),b([C("8.7.1",!1,!1)],x.prototype,"openNewTabAndPollCheckTabAlive",1),b([C("8.19.0")],x.prototype,"getCurrentTabInfo",1),b([C("8.19.0")],x.prototype,"runBackgroundFunction",1),b([C("8.19.0")],x.prototype,"pingTabPage",1),b([C("8.19.0")],x.prototype,"findTabPageCitation",1),b([C("8.19.0")],x.prototype,"createTabPageDocument",1);function C(t,e=!0,n=!0){return function(r,i,o){let a=o.value;if(typeof a!="function")throw new Error("VersionControl can only be applied to methods");return o.value=async function(...s){return en(t,e,n)?await a.apply(this,s):null},o}}var M=new x;var ie=class extends q{constructor(){super(...arguments);this.iframeElement=null;this.isReadingMode=!1}static disableCSPFromUrl(n){let r=G(n);return r==="twitter.com"&&(r="x.com"),M.updateCurrentTabNetRequestSessionRules({addRules:[{id:1,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"sec-fetch-dest",operation:"remove"}],responseHeaders:[{header:"content-security-policy",operation:"remove"},{header:"x-frame-options",operation:"remove"}]},condition:{urlFilter:r,isUrlFilterCaseSensitive:!1,resourceTypes:["sub_frame"]}}]})}setIframeElement(n){this.iframeElement=n}setIsReadingMode(n){this.isReadingMode!=n&&(this.isReadingMode=n,this.emit("onChangeReadingMode",{isReadingMode:n}))}};var Yc=new ie;var We=class{async init(){return await import("./S3RPVEA6.js"),!0}async destroy(){}async createPlayer(e,n){return await this.init(),window.YT?.Player?new Promise(r=>{let i=setTimeout(()=>{r(null)},5e3),o=new window.YT.Player(e,{...n,events:{...n.events,onReady:()=>{r(o),clearTimeout(i)}}})}):null}};var vt=new We;var Ve=class extends q{constructor(){super(...arguments);this.destroyed=!1;this.youtubePlayer=null;this.iframeElement=null;this.transcriptsElement=null;this.startTime=null;this.isTranscriptMode=!1}init(){vt.init(),this.destroyed=!1}destroy(){this.destroyed=!0,this.youtubePlayer&&(this.youtubePlayer.destroy(),this.youtubePlayer=null)}setStartTime(n){this.startTime!==n&&(this.startTime=n,this.emit("onChangeStartTime",{startTime:this.startTime}))}setIframeElement(n){this.iframeElement!==n&&(n&&vt.createPlayer(n,{}).then(r=>{if(r){if(this.destroyed){r.destroy();return}this.youtubePlayer=r}}),this.iframeElement=n)}setTranscriptsElement(n){this.transcriptsElement!==n&&(this.transcriptsElement=n)}setIsTranscriptMode(n){this.isTranscriptMode!==n&&(this.isTranscriptMode=n,this.emit("onChangeTranscriptMode",{isTranscriptMode:n}))}playVideo(){this.youtubePlayer?.playVideo()}pauseVideo(){this.youtubePlayer?.pauseVideo()}stopVideo(){this.youtubePlayer?.stopVideo()}seekTo(n){if(this.youtubePlayer)return this.youtubePlayer?.seekTo(n);this.setStartTime(n)}};var am=new Ve;export{Fo as a,ve as b,Ne as c,Ko as d,Ar as e,en as f,j as g,Qo as h,Zo as i,we as j,ln as k,na as l,ra as m,ne as n,Re as o,fe as p,Pe as q,Oa as r,gi as s,Ti as t,Ha as u,Fa as v,w,I as x,_i as y,Gn as z,pt as A,Wa as B,Va as C,Xa as D,$n as E,ms as F,He as G,Di as H,$s as I,Ys as J,B as K,gt as L,sl as M,te as N,le as O,vr as P,ye as Q,ro as R,xe as S,uo as T,Ce as U,wo as V,_e as W,Po as X,ie as Y,Yc as Z,Ve as _,am as $,Rl as aa,Er as ba,xt as ca,nc as da,_r as ea,bt as fa,Ct as ga,$i as ha,x as ia,M as ja};
