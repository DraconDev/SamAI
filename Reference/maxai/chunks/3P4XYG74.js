import{a as W}from"./DQJX4ERA.js";import{a as V,b as X}from"./B5IQJ4CT.js";import{b as T,c as j}from"./7BDZPPQH.js";import{j as D}from"./IOVDQST2.js";import{o as k}from"./JK5JXJMM.js";import{B as U,C as q,D as $,E as G,G as H,I as K}from"./6DSWP2JT.js";import{a as c,g as L,h as O,i as d}from"./NVNEBEEL.js";import{c as w}from"./DIGZHHNW.js";import{C as N,K as B,r as M}from"./F5AXRJSB.js";import{ha as A}from"./3M3IYJ36.js";import{a as E,k as p,y as v}from"./WINLMBYH.js";import{t as b}from"./HKBWT4XT.js";import{Aa as P,J as S,S as h,zb as _}from"./NO5PF2KS.js";import{a as R}from"./PJ57C2TE.js";import{f as F}from"./GAV6HCJA.js";var oe=()=>{K(async(n,e,t)=>{switch(n){case"Client_ping":return{success:!0,data:{},message:""};case"Client_createPageDocument":{let o=await k.generateWebpageURLDocument(window.location.href);return o?{success:!0,data:o,message:""}:{success:!0,data:null,message:""}}case"Client_findPageCitation":{let{citation:o}=e,r=await D.find(o);return{success:r,data:r,message:""}}}})},Y=oe;var C=F(R());var J=async(n,e)=>(n&&n.contentWindow,new Promise(async t=>{let o=new c,r=p();(await o.postMessage({event:"Client_findIframePageCitation",data:{taskId:r,citation:e}})).success||t(!1);let a=setTimeout(()=>{t(!1),C.default.runtime.onMessage.removeListener(i)},1e4),i=u=>{u.id===w&&u.event==="Client_listenFindIframePageCitationResponse"&&u.data.taskId===r&&(t(u.data.isMatched),C.default.runtime.onMessage.removeListener(i),clearTimeout(a))};C.default.runtime.onMessage.addListener(i)}));var f=F(R());var Q=async()=>{if(h())return"";let n=S(),e=typeof window<"u"?window.location.href:"",t="";return n==="docs.google.com"?t=await re():n==="github.com"?t=await ae():e.match("onedrive.live.com/edit")||e.match(/onedrive\.live\.com\/personal\/[^/]+\/.*\.aspx/)||e.match("word.cloud.microsoft/open/onedrive")?t=await y():e.match("icloud.com/mail")?t=await y():e.match("navigator-lxa.mail.com/mail")&&(t=await y()),t.trim()},z=async(n,e)=>(n&&n.contentWindow,new Promise(async t=>{let o=new c,r=p();(await o.postMessage({event:"Client_createIframePageDocument",data:{taskId:r,pageUrl:e}})).success||t(null);let a=setTimeout(()=>{t(null),f.default.runtime.onMessage.removeListener(i)},1e4),i=async u=>{if(u.id===w&&u.event==="Client_listenCreateIframePageDocumentResponse"&&u.data.taskId===r){let m=u.data.pageDocument,l=await v.createDocFile(m.doc_type,m.doc_type_dependent_data||{},m.doc_type==="page_content__webpage"?{pureText:m.pure_text}:void 0);t({...m,file:l}),f.default.runtime.onMessage.removeListener(i),clearTimeout(a)}};f.default.runtime.onMessage.addListener(i)})),y=async()=>new Promise(async n=>{let e=new c,t=p();(await e.postMessage({event:"Client_getIframePageContent",data:{taskId:t}})).success||n("");let r=setTimeout(()=>{n(""),f.default.runtime.onMessage.removeListener(s)},1e4),s=a=>{a.id===w&&a.event==="Client_listenGetIframePageContentResponse"&&a.data.taskId===t&&(n(a.data.pageContent),f.default.runtime.onMessage.removeListener(s),clearTimeout(r))};f.default.runtime.onMessage.addListener(s)}),re=async()=>new Promise(n=>{let e=p(),t=setTimeout(()=>{n(""),window.removeEventListener(`${e}-result`,o)},1e4),o=r=>{n(r.detail.pageContent),clearTimeout(t)};window.addEventListener(`${e}-result`,o,{once:!0}),window.dispatchEvent(new CustomEvent("MAXAI_LOAD_GOOGLE_DOC_CONTENT",{detail:{id:e}}))}),ae=async()=>{let n=new URL(location.href),e=n.pathname,t=e.split("/")[1],o=e.split("/")[2];if(document.querySelector("#copilot-button-positioner")){let r=e.split("/").pop(),s="";s+=`## File Information
`,s+=`- Repository Name: [${o}](${n.origin}/${t}/${o})
`,s+=`- File Name: ${r}
`,s+=`- File Path: ${e}
`,s+=`- File Source link: ${n.href}
`,s+=`## File Content
`;let a="N/A",i=document.querySelector('a[data-testid="raw-button"]'),u="";if(i){let m=await T(i.href,{method:"GET",parse:"text"});m?.success&&(a=m.data||"N/A");let l=i.href.split("/").pop();u=P(l?.split(".").pop()||"")}return s+=`\`\`\`${u}
${a}
\`\`\`
`,s}else if(/issues\/\d+/.test(e)){let r=i=>{if(!i)return{author:"",date:"",content:"",metadata:""};let u=i.querySelector("a.author"),m=i.querySelector("relative-time"),l=i.querySelector(".user-select-contain")||i.querySelector("table"),g=i.querySelector(".timeline-comment-header div > span > span");return{author:u?.innerText||"",date:m?.getAttribute("datetime")||m?.title||"",content:l?.innerText.replace(/\n\s+/g,`
`).replace(/\n{2,}/g,`

`).trim()||"N/A",metadata:g?.innerText||"Commenters"}},s=document.querySelector(".js-issue-title"),a=document.querySelector(".js-discussion > div");if(a){let i=[r(a)],u=new URL(window.location.href);u.pathname=u.pathname+"/partials/load_more";let m=await T(u.href,{method:"GET",parse:"text"});m?.success&&new DOMParser().parseFromString(m?.data||"","text/html").querySelectorAll(".js-timeline-item").forEach(ne=>{i.push(r(ne))});let l="";return l+=`## ${s?.innerText}
`,l+=`- Repository Name: [${o}](${n.origin}/${t}/${o})
`,l+=`- Repository issue link: ${n.href}
`,i.forEach((g,I)=>{l+=`### Comment ${I+1}
`,l+=`- Author: ${g.author}
`,l+=`- Date: ${g.date}
`,l+=`- Metadata: ${g.metadata}
`,l+=`${g.content}
`}),l}}return""};var se=async(n,e)=>(await new c({runtime:"shortcut"}).postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:e,OperationElementTabID:n}})).data,Z=se;var ie=async()=>{let n="MAXAI_CURRENT_TAB_NET_REQUEST_SESSION_RULE_ID",e=Number(await E.getItem(n))||1e3;return e>2e4&&(e=1e3),await E.setItem(n,e+1),e},ee=async n=>{let o=(await new c({runtime:"client"}).postMessage({event:"Client_ping"})).data?.tabId;if(!o)return!1;if(n.addRules){n.addRules=n.addRules.map(a=>_([a,{condition:{tabIds:[o]}}]));let s=await d("declarativeNetRequest","getSessionRules",[]);s?.length&&(n.addRules=n.addRules.filter(a=>!s.find(u=>b(a,{...u,id:a.id}))));for(let a of n.addRules)a.id=await ie()}let r=await d("declarativeNetRequest","updateSessionRules",[n]);return!0},te=async()=>{let t=(await new c({runtime:"client"}).postMessage({event:"Client_ping"})).data?.tabId;if(!t)return!1;let r=(await d("declarativeNetRequest","getSessionRules",[]))?.filter(a=>a.condition.tabIds?.includes(t));if(!r?.length)return!0;let s=await d("declarativeNetRequest","updateSessionRules",[{removeRuleIds:r.map(a=>a.id)}]);return!0};var ce=async n=>(await new c({runtime:"client"}).postMessage({event:"Client_syncAuthInfo",data:n})).data;Y();var x=class{constructor(){this.openPage=L;this.closePage=O;this.proxyFetch=T;this.abortProxyFetch=j;this.getSpecialHostPageContent=Q;this.operationPageElement=Z;this.showSidebar=V;this.hideSidebar=X;this.createFileStreamer=async(e,t)=>{let r=await new c({runtime:"client"}).postMessage({event:"Client_createFileStreamer",data:{fileUrl:e,chunkSize:t}});return r.success?r.data:new Error(r.message)};this.destroyFileStreamer=async e=>(await new c({runtime:"client"}).postMessage({event:"Client_destroyFileStreamer",data:{taskId:e}})).data;this.getFileNextChunk=async(e,t)=>(await new c({runtime:"client"}).postMessage({event:"Client_getFileNextChunk",data:{taskId:e,chunkSize:t}})).data;this.updateCurrentTabNetRequestSessionRules=ee;this.clearCurrentTabNetRequestSessionRules=te;this.syncUserTokens=ce;this.injectScript=async(e,t)=>new Promise(o=>{let r=p(),s=setTimeout(()=>{o(null),window.removeEventListener(`${r}-result`,a)},2e3),a=()=>{o(!0),clearTimeout(s)};window.addEventListener(`${r}-result`,a,{once:!0}),window.dispatchEvent(new CustomEvent("MAXAI_INJECT_SCRIPT",{detail:{id:r,src:e,attrs:t}}))});this.pingIframePage=async()=>!0;this.findIframePageCitation=J;this.createIframePageDocument=z;this.getExtensionPinedStatus=async()=>(await d("action","getUserSettings",[]))?.isOnToolbar||!1;this.getExtensionPublicConfig=async()=>({onboardingMap:await H(),currentActiveModalKey:U,currentActiveTopBarKey:q,currentUploadModalKey:$,currentTourKey:G});this.checkSettingsUpdate=async()=>{try{return await N.isLogin()?(await B.getAppSettings(!0),!0):!1}catch{return!1}};this.getCurrentTabScreenshot=W;this.getExtensionUserTokens=async()=>await M.getAuthTokens();this.openNewTab=async(e,t)=>(await new c().postMessage({event:"Client_openNewTab",data:{url:e,options:t}})).data;this.openNewTabAndPollCheckTabAlive=async(e,t)=>(await new c().postMessage({event:"Client_openNewTabAndPollCheckTabAlive",data:{url:e,options:t}})).data;this.getCurrentTabInfo=async()=>(await new c().postMessage({event:"Client_ping"})).data;this.pingTabPage=async e=>(await new c({runtime:"client"}).postMessage({event:"Client_pingTabPage",data:{tabId:e}})).success;this.findTabPageCitation=async(e,t)=>(await new c({runtime:"client"}).postMessage({event:"Client_findTabPageCitation",data:{tabId:e,citation:t}})).success;this.createTabPageDocument=async(e,t)=>(await new c({runtime:"client"}).postMessage({event:"Client_createTabPageDocument",data:{tabId:e,pageUrl:t}})).data}async setPricingClosedRedirectUrl(...e){return new c({runtime:"client"}).postMessage({event:"Client_createPaymentUrl",data:e[0]}),!0}async runBackgroundFunction(e,t,o){return await d(e,t,o)}};function Ye(){window.__MAXAI_EXTENSION__INIT_BROWSER_EXTENSION__SCRIPT__=!0,A(x)}export{ce as a,Ye as b};
