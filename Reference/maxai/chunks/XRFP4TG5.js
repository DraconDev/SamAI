import{a as GC}from"./DNC6SQVP.js";import{a as ni,b as EC}from"./WMPFE6AN.js";import{A as ay,B as Fm,C as Nm,D as ts,E as Vr,F as ly,G as py,H as Kl,I as cy,J as uy,K as oh,L as ia,M as my,N as dy,O as jl,P as Vm,Q as nc,R as dn,S as Hn,T as ic,V as W7,W as G7,X as Rm,Y as zm,Z as hy,a as Nr,b as PC,c as AC,d as Y1,e as Oi,f as Oo,g as kC,h as Bt,i as jC,j as Za,k as Ul,l as Hs,m as $C,n as Qa,o as qC,p as z7,q as Bi,r as XC,s as YC,t as ZC,u as QC,v as th,w as U7,x as JC,y as iy,z as Hm}from"./336Q5MDV.js";import{a as sr,b as KC,e as km}from"./KNHMBNA7.js";import{a as WC}from"./KIGND2UM.js";import{a as LC,d as OC}from"./M3UQDCQB.js";import{a as N7}from"./SVFJ2TB3.js";import{a as j2,b as $2,c as q2,d as X2,e as Y2,f as Z2,g as MC,h as wC}from"./25VTRN6P.js";import{a as Zu,b as sm,c as lm,d as z1,e as TC}from"./GLUVJUTU.js";import{p as am}from"./WSOUGDJD.js";import{c as R1}from"./IEC6JE54.js";import{a as Qu,i as Jo,n as K2}from"./ONFLPVF7.js";import{$ as Al,$a as lo,A as l_,Aa as xm,Ab as lC,B as p_,Ba as F_,Bb as pC,C as c_,Ca as N_,Cb as Li,D as cm,Da as j1,Db as cC,E as u_,Ea as Ll,Eb as uC,F as Dn,Fa as R_,Fb as mC,Ga as Cm,Gb as dC,H as m_,Ha as ym,Hb as ja,I as d_,Ia as z_,Ib as vm,J as f_,Ja as U_,Jb as fC,K as h_,Ka as W_,Kb as hC,L as um,La as G_,M as g_,Ma as Ol,N as Ei,Na as Ka,Nb as Mm,O as x_,Oa as Bl,Ob as q1,P as __,Pa as bm,Pb as Nl,Qa as ge,Qb as Re,Ra as rt,Rb as gC,Sa as K_,Sb as $a,Ta as er,Tb as xC,Ua as j_,Ub as _C,Va as Ai,Vb as CC,Wa as Tt,Wb as X1,Xa as Ve,Xb as qa,Ya as ki,Yb as Vl,Z as U1,Za as $_,Zb as V7,_ as v_,_a as q_,_b as yC,a as P2,aa as M_,ab as Dl,b as A2,ba as mm,bb as X_,bc as Tm,c as te,ca as E_,cb as Im,cc as wm,d as k2,da as P_,db as Y_,dc as Em,e as za,ea as W1,eb as Z_,ec as Xa,fa as dm,fb as Ds,fc as R7,g as Ml,ga as Ga,gb as Q_,gc as bC,hb as ri,ic as Lo,j as O7,jc as IC,ka as Pi,kb as J_,kc as qe,l as t_,la as kl,lb as Sm,lc as SC,m as o_,ma as fm,mb as Sr,na as Fr,nb as Hl,nc as vC,oa as hm,p as mn,pa as k_,pb as $1,q as r_,qa as G1,qb as eC,qc as Ya,r as wi,ra as L_,rb as Fl,sa as gm,sb as tC,t as n_,ta as O_,tb as oC,u as i_,ua as K1,ub as rC,v as ec,va as B_,vb as nC,w as a_,wb as iC,x as Bn,xa as D_,xb as aC,y as pm,ya as H_,yb as sC,z as s_,za as Ce,zb as ko}from"./DP6NKKZS.js";import{a as G2,b as El}from"./2WYRGMZA.js";import{h as Bs,i as D1,j as Hr,k as Ra,m as Tl,n as Ir,p as Ti,q as O2,r as H1,s as B2,t as F1,u as D2,v as N1,w as Zp,x as H2,y as On}from"./EVCDN77N.js";import{a as un}from"./VM6AHHKV.js";import{a as ra,b as S_,e as T_,f as w_,m as tc,t as A_}from"./2Z5YDK5O.js";import{d as B7,f as rm,g as D7,i as nm,j as H7,l as F7,m as im,p as Qp,q as z}from"./PRI4DNE5.js";import{d as L2}from"./74EYRKBC.js";import{a as r2,b as n2,c as Il,d as Fa,e as B1,f as Sl}from"./SUSBQMNS.js";import{j as ju}from"./3T6N3UXS.js";import{b as qp,d as Wu,e as Mi,f as l2,i as p2,j as Ao,m as f2,o as vl,p as Fe}from"./KSVMQXXA.js";import{b as c2,c as u2,e as m2,f as L7}from"./2BN67YOS.js";import{a as Gu,b as h2,c as Na,e as Ku,g as g2,h as so,i as x2,j as _2,k as C2}from"./F5E7GPVZ.js";import{a as tn}from"./3MCB6OT2.js";import{a as k7}from"./FAXKEQHZ.js";import{a as Xp,b as cn,c as w2}from"./YYNJ5ORL.js";import{d as Co}from"./BTVCBEO2.js";import{a as ql}from"./R6BKBS6G.js";import{a as Q2}from"./QPGJKNBT.js";import{a as Bx}from"./KVGG4OH6.js";import{b as Ox}from"./BGNVWJOE.js";import{a as S2}from"./JJYFTZZZ.js";import{a as Ln}from"./O3PGOLSM.js";import{a as Mx,b as Ls,c as Tx,d as wx}from"./DQJU6P5N.js";import{K as ku}from"./F6B4GLR5.js";import{b as b2,c as I2,d as _t}from"./QDA27QWI.js";import{a as P7}from"./4ZAQU4SR.js";import{a as vi,b as mx,c as dx,d as fx,e as hx,f as gx,g as ks,h as ee,i as bx,j as Ix,k as Sx,l as vx}from"./BJ6OZ2RR.js";import{a as ux}from"./LU2HGRXL.js";import{a as oa,b as d2}from"./QAN7YQ5O.js";import{a as Cr}from"./7ETG7F5K.js";import{a as Au,d as Ba,g as me}from"./K3RX6V6Z.js";import{a as _o}from"./QPKKGBHL.js";import{C as px,D as cx,G as ct,a as Cu,b as q0,c as X0,d as As,e as Z0,f as yu,g as bu,k as yr,l as ox,n as Tu,p as Ea,q as Pa,r as rx,s as ti,x as vt}from"./WOMY7LQF.js";import{u as tx,v as Mu}from"./DXFQZN2P.js";import{b as ix,c as Ii}from"./4L3TOTPW.js";import{D as Da,E as Bu,K as yx,c as je,e as nx,i as Lt,j as xx,m as _x,n as Cx,s as Lu,u as Ou}from"./K5PYBOWW.js";import{c as sx,f as St}from"./W4INSQR4.js";import{c as It,e as Br,f as kn}from"./KOAEEWKV.js";import{C as Ji,N as Jt,X as ax,Y as ka,_ as Pn,f as wa,ga as Pu,ja as An,l as yi,o as _r,pa as La,qa as Oa,r as xl,w as J0,z as ex}from"./DXJBONGG.js";import{i as Aa}from"./CBDTKGC6.js";import{c as Si}from"./6IAOONHC.js";import{b as ea,e as le}from"./Y2RTU6FS.js";import{m as wu,p as Eu,s as lx}from"./IE6X6P55.js";import{f as Y0}from"./F3AKZR3O.js";import{c as L}from"./BJ6PO45I.js";import{a as gl}from"./Y6DWXSB3.js";import{b as bi}from"./HFXK7G4X.js";import{E as Jr,Q as $0,a as G0,b as w7,c as K0,d as E7,h as xo,la as T,na as g,q as j0}from"./URK6S63I.js";import{a as go}from"./PCHDBHHN.js";import{a as gy,b as xy}from"./RBCVDQ72.js";import{a as na,c as es}from"./B5IQJ4CT.js";import{a as V_}from"./4VUWARP7.js";import{a as _m}from"./J63ZRIPB.js";import{A as sy,J as $l,a as Lm,c as ey,d as ii,e as Wl,f as ty,g as Om,h as oy,i as ry,k as ny,l as Bm,m as Ja,n as Gl,o as Dm}from"./3RZ46UQL.js";import{a as rc}from"./ZES4ZAHH.js";import{b as fy,d as Xl}from"./7BDZPPQH.js";import{c as J2,d as e_,j as C_,n as y_,t as b_,u as I_,w as Pl}from"./JK5JXJMM.js";import{a as t2,b as Uu,d as o2,h as E2}from"./VT4ATK36.js";import{I as Am,J as zl,a as BC,b as Rl,c as Z1,e as vr,f as Q1,g as DC,h as HC,i as FC,j as NC,k as VC,l as RC,m as J1,n as zC,o as oc,q as eh,r as UC,s as Pm}from"./6DSWP2JT.js";import{c as Wa,d as Jp}from"./454JMIH7.js";import{b as Ot}from"./MS4OBPZZ.js";import{a as _l,b as Iu,c as Su,d as vu,e as Q0,f as F2,g as V1,i as N2,j as V2,k as R2,l as z2,m as Ju,n as U2,o as em,p as tm,q as Ua,r as wl,t as om,u as W2}from"./RFIQSMEX.js";import{d as s2}from"./IKVWN3LL.js";import{a as $u}from"./ABK4JG3U.js";import{a as qu,b as v2,c as Xu,d as M2,e as br,f as T2,g as Va,j as Os,k as Yu}from"./NVNEBEEL.js";import{a as Dx,b as ta,c as E1}from"./DIGZHHNW.js";import{a as i2,d as k1,e as L1,f as O1,j as a2,l as Yp}from"./Y34OKDQ4.js";import{a as y2}from"./3JI2HIGL.js";import{C as jp,E as Yx,G as Zx,J as Qx,K as $p,M as en,N as Mt,c as Gx,e as Kx,f as jx,g as Po,h as $x,n as qx,r as Ha,s as A1,u as Xx,w as A7,z as zu}from"./F5AXRJSB.js";import{$ as w1,H as v1,I as Gp,U as Hu,V as yl,X as Fu,Y as M1,_ as T1,aa as kx,ba as Kp,c as Ex,ca as Lx,j as Px,k as I1,l as Cl,r as Ax,v as Du,w as S1}from"./27G4S2R3.js";import{B as Ru,C as bl,D as Ux,F as Wx,H as $e,I as P1,P as Jx,Q as e2,U as dt,a as Nu,d as Hx,e as Dr,k as Vu,l as Fx,m as Nx,r as Vx,v as oi,w as Rx,y as zx,z as Ro}from"./JDSHOLU5.js";import{b as y1,e as fl,g as b1,h as U0,i as W0,j as Ci,k as hl}from"./HFEXSQX6.js";import{A as cl,K as V0,L as R0,f as v0,ja as dl,q as M0,w as pl,z as _1}from"./3M3IYJ36.js";import{b as du,f as Zi}from"./DKMNSB2V.js";import{$ as O0,A as xi,E as bt,F as En,G as Qt,I as Rp,J as zp,M as v,O as Ta,P as C1,Q as T0,R as w0,S as E0,T as P0,V as A0,W as k0,_ as L0,a as pn,aa as B0,ba as D0,d as u0,ea as Up,fa as ul,g as mu,ga as fu,h as lt,ha as hu,i as h0,ia as gu,j as g0,k as Eo,l as _0,la as De,m as C0,n as Qr,na as Wp,o as y0,pa as H0,q as b0,qa as F0,sa as N0,ta as xu,x as I0,y as S0,ya as ml,za as _u}from"./WINLMBYH.js";import{n as Qi,r as _i,u as z0,x as He}from"./HKBWT4XT.js";import{E as Fp,Ea as f0,F as Yi,J as Np,M as uu,N as Ma,Pa as x0,c as Zr,d as g1,i as Hp,ka as m0,m as cu,n as ao,o as wn,p as l0,pa as d0,s as p0,v as x1,wb as Vp,zb as Qo}from"./NO5PF2KS.js";import{a as M}from"./4B6UFNBQ.js";import{a as c0}from"./PJ57C2TE.js";import{c as re,f as S,h as s0}from"./GAV6HCJA.js";var Xy=re(Xm=>{"use strict";"use client";var _M=go();Object.defineProperty(Xm,"__esModule",{value:!0});Xm.default=void 0;var CM=_M(_o()),yM=xo(),KN=Xm.default=(0,CM.default)((0,yM.jsx)("path",{d:"m19 15-1.41-1.41L13 18.17V2h-2v16.17l-4.59-4.59L5 15l7 7z"}),"South")});var i6=re(Ym=>{"use strict";"use client";var DM=go();Object.defineProperty(Ym,"__esModule",{value:!0});Ym.default=void 0;var HM=DM(_o()),n6=xo(),XV=Ym.default=(0,HM.default)([(0,n6.jsx)("path",{d:"m21.67 18.17-5.3-5.3h-.99l-2.54 2.54v.99l5.3 5.3c.39.39 1.02.39 1.41 0l2.12-2.12c.39-.38.39-1.02 0-1.41"},"0"),(0,n6.jsx)("path",{d:"m17.34 10.19 1.41-1.41 2.12 2.12c1.17-1.17 1.17-3.07 0-4.24l-3.54-3.54-1.41 1.41V1.71l-.7-.71-3.54 3.54.71.71h2.83l-1.41 1.41 1.06 1.06-2.89 2.89-4.13-4.13V5.06L4.83 2.04 2 4.87 5.03 7.9h1.41l4.13 4.13-.85.85H7.6l-5.3 5.3c-.39.39-.39 1.02 0 1.41l2.12 2.12c.39.39 1.02.39 1.41 0l5.3-5.3v-2.12l5.15-5.15z"},"1")],"Handyman")});var a6=re(Zm=>{"use strict";"use client";var FM=go();Object.defineProperty(Zm,"__esModule",{value:!0});Zm.default=void 0;var NM=FM(_o()),VM=xo(),ZV=Zm.default=(0,NM.default)((0,VM.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error")});var s6=re(Qm=>{"use strict";"use client";var RM=go();Object.defineProperty(Qm,"__esModule",{value:!0});Qm.default=void 0;var zM=RM(_o()),UM=xo(),JV=Qm.default=(0,zM.default)((0,UM.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info")});var M6=re((hz,v6)=>{"use strict";function b6(o){return(b6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(o)}function uc(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function C6(o,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function mc(o,e,t){return e&&C6(o.prototype,e),t&&C6(o,t),o}function eT(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e&&I6(o,e)}function ch(o){return(ch=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(o)}function I6(o,e){return(I6=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(o,e)}function tT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function oT(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function rT(o,e){return!e||typeof e!="object"&&typeof e!="function"?oT(o):e}function nT(o){var e=tT();return function(){var t,r=ch(o);if(e){var n=ch(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return rT(this,t)}}function y6(o){return iT(o)||aT(o)||sT(o)||lT()}function iT(o){if(Array.isArray(o))return uh(o)}function aT(o){if(typeof Symbol<"u"&&Symbol.iterator in Object(o))return Array.from(o)}function sT(o,e){if(o){if(typeof o=="string")return uh(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);return t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set"?Array.from(o):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?uh(o,e):void 0}}function uh(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function lT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var mh=function(){function o(e){uc(this,o),this._listeners=[],this._mute=!1,this._accumulate=!1,this._accumulatedEvents=[],this._name=e||"",this._onListenerAdded=null,this._onFirstListenerAdded=null,this._onListenerRemoved=null,this._onLastListenerRemoved=null}return mc(o,[{key:"addListener",value:function(e,t){this._pushListener(e,t,!1)}},{key:"addOnceListener",value:function(e,t){this._pushListener(e,t,!0)}},{key:"removeListener",value:function(e,t){this._ensureListener(e);var r=this._indexOfListener(e,t);0<=r&&this._spliceListener(r)}},{key:"removeAllListeners",value:function(){for(;this.hasListeners();)this._spliceListener(0)}},{key:"hasListener",value:function(e,t){return this._ensureListener(e),0<=this._indexOfListener(e,t)}},{key:"hasListeners",value:function(){return 0<this._listeners.length}},{key:"dispatch",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invokeListeners({args:t,async:!1})}},{key:"dispatchAsync",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invokeListeners({args:t,async:!0})}},{key:"mute",value:function(e){var t=0<arguments.length&&e!==void 0?e:{};this._mute=!0,t.accumulate?this._accumulate=!0:(this._accumulate=!1,this._accumulatedEvents=[])}},{key:"unmute",value:function(){this._mute=!1,this._accumulate&&(this._dispatchAccumulated(),this._accumulate=!1)}},{key:"_invokeListeners",value:function(e){var t=this,r=0<arguments.length&&e!==void 0?e:{args:[],async:!1};this._mute?this._accumulate&&this._accumulatedEvents.push(r):this._listeners.slice().forEach(function(n){t._invokeListener(n,r),n.once&&t.removeListener(n.callback,n.context)})}},{key:"_invokeListener",value:function(e,t){var r,n,i=e.callback instanceof o;t.async?i?(r=e.callback).dispatchAsync.apply(r,y6(t.args)):setTimeout(function(){return e.callback.apply(e.context,t.args)},0):i?(n=e.callback).dispatch.apply(n,y6(t.args)):e.callback.apply(e.context,t.args)}},{key:"_ensureListener",value:function(e){if(!o.isValidListener(e))throw new Error("Channel "+this._name+": listener is not a function and not a Channel")}},{key:"_dispatchInnerAddEvents",value:function(){var e,t;this._onListenerAdded&&(e=this._onListenerAdded).dispatch.apply(e,arguments),this._onFirstListenerAdded&&this._listeners.length===1&&(t=this._onFirstListenerAdded).dispatch.apply(t,arguments)}},{key:"_dispatchInnerRemoveEvents",value:function(){var e,t;this._onListenerRemoved&&(e=this._onListenerRemoved).dispatch.apply(e,arguments),this._onLastListenerRemoved&&this._listeners.length===0&&(t=this._onLastListenerRemoved).dispatch.apply(t,arguments)}},{key:"_indexOfListener",value:function(e,t){for(var r=0;r<this._listeners.length;r++){var n=this._listeners[r],i=n.callback===e,a=e instanceof o,s=t===void 0&&n.context===void 0,l=t===n.context;if(i&&(a||s||l))return r}}},{key:"_dispatchAccumulated",value:function(){var e=this;this._accumulatedEvents.forEach(function(t){return e._invokeListeners(t)}),this._accumulatedEvents=[]}},{key:"_pushListener",value:function(e,t,r){this._ensureListener(e),this._checkForDuplicates(e,t),this._listeners.push({callback:e,context:t,once:r}),this._dispatchInnerAddEvents(e,t,r)}},{key:"_checkForDuplicates",value:function(e,t){if(this.hasListener(e,t))throw new Error("Channel "+this._name+": duplicating listeners")}},{key:"_spliceListener",value:function(e){var t=this._listeners[e],r=t.callback,n=t.context,i=t.once;this._listeners.splice(e,1),this._dispatchInnerRemoveEvents(r,n,i)}},{key:"onListenerAdded",get:function(){return this._onListenerAdded||(this._onListenerAdded=new o("".concat(this._name,":onListenerAdded"))),this._onListenerAdded}},{key:"onFirstListenerAdded",get:function(){return this._onFirstListenerAdded||(this._onFirstListenerAdded=new o("".concat(this._name,":onFirstListenerAdded"))),this._onFirstListenerAdded}},{key:"onListenerRemoved",get:function(){return this._onListenerRemoved||(this._onListenerRemoved=new o("".concat(this._name,":onListenerRemoved"))),this._onListenerRemoved}},{key:"onLastListenerRemoved",get:function(){return this._onLastListenerRemoved||(this._onLastListenerRemoved=new o("".concat(this._name,":onLastListenerRemoved"))),this._onLastListenerRemoved}}],[{key:"isValidListener",value:function(e){return typeof e=="function"||e instanceof o}}]),o}(),pT=function(){function o(){uc(this,o),this._channels=new Map}return mc(o,[{key:"addListener",value:function(e,t,r){this._getChannel(e).addListener(t,r)}},{key:"on",value:function(e,t,r){this.addListener(e,t,r)}},{key:"addOnceListener",value:function(e,t,r){this._getChannel(e).addOnceListener(t,r)}},{key:"once",value:function(e,t,r){this.addOnceListener(e,t,r)}},{key:"removeListener",value:function(e,t,r){this._getChannel(e).removeListener(t,r)}},{key:"off",value:function(e,t,r){this.removeListener(e,t,r)}},{key:"hasListener",value:function(e,t,r){return this._getChannel(e).hasListener(t,r)}},{key:"has",value:function(e,t,r){return this.hasListener(e,t,r)}},{key:"hasListeners",value:function(e){return this._getChannel(e).hasListeners()}},{key:"dispatch",value:function(e){for(var t,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this._getChannel(e)).dispatch.apply(t,n)}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.dispatch.apply(this,[e].concat(r))}},{key:"_getChannel",value:function(e){return this._channels.has(e)||this._channels.set(e,new mh(e)),this._channels.get(e)}}]),o}(),cT=function(){function o(e){uc(this,o),this._params=e,this._isOn=!1,this._assertParams()}return mc(o,[{key:"on",value:function(){if(!this._isOn){var e=this._params.channel,t=e.addListener||e.addEventListener||e.on;this._applyMethod(t),this._isOn=!0}}},{key:"off",value:function(){if(this._isOn){var e=this._params.channel,t=e.removeListener||e.removeEventListener||e.off;this._applyMethod(t),this._isOn=!1}}},{key:"_applyMethod",value:function(e){var t=this._params,r=t.channel,n=t.event,i=t.listener,a=n?[n,i]:[i];e.apply(r,a)}},{key:"_assertParams",value:function(){var e=this._params,t=e.channel,r=e.event,n=e.listener;if(!t||b6(t)!=="object")throw new Error("Channel should be object");if(r&&typeof r!="string")throw new Error("Event should be string");if(!n||!mh.isValidListener(n))throw new Error("Listener should be function or Channel")}}]),o}(),S6=function(){function o(e){uc(this,o),this._items=e.map(function(t){return new cT(t)})}return mc(o,[{key:"on",value:function(){return this._items.forEach(function(e){return e.on()}),this}},{key:"off",value:function(){return this._items.forEach(function(e){return e.off()}),this}}]),o}(),uT=function(){eT(e,S6);var o=nT(e);function e(t,r){var n;return uc(this,e),(n=o.call(this,r))._overrideComponentCallback(t,"componentDidMount","on"),n._overrideComponentCallback(t,"componentWillUnmount","off"),n}return mc(e,[{key:"_overrideComponentCallback",value:function(t,r,n){var i=this,a=t[r];t[r]=function(){if(i[n](),typeof a=="function"){for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return a.apply(t,l)}}}}]),e}(),td=mh;td.EventEmitter=pT,td.Subscription=S6,td.ReactSubscription=uT,v6.exports=td});var w6=re((gz,T6)=>{T6.exports={timeout:0,timeoutReason:"Promise rejected by PromiseController timeout {timeout} ms.",resetReason:"Promise rejected by PromiseController reset."}});var E6=re(od=>{od.isPromise=function(o){return o&&typeof o.then=="function"};od.tryCall=function(o){return typeof o=="function"?o():o};od.createErrorType=function(o){function e(t){Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t}return e.prototype=new Error,e.prototype.name=o,e.prototype.constructor=e,e}});var dh=re((_z,L6)=>{var mT=w6(),{isPromise:P6,createErrorType:k6,tryCall:A6}=E6(),dc=class o{constructor(e){this._options=Object.assign({},mT,e),this._resolve=null,this._reject=null,this._isPending=!1,this._isFulfilled=!1,this._isRejected=!1,this._value=void 0,this._promise=null,this._timer=null}get promise(){return this._promise}get value(){return this._value}get isPending(){return this._isPending}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isSettled(){return this._isFulfilled||this._isRejected}call(e){return this._isPending||(this.reset(),this._createPromise(),this._createTimer(),this._callFn(e)),this._promise}resolve(e){this._isPending&&(P6(e)?this._tryAttachToPromise(e):(this._settle(e),this._isFulfilled=!0,this._resolve(e)))}reject(e){this._isPending&&(this._settle(e),this._isRejected=!0,this._reject(e))}reset(){if(this._isPending){let e=A6(this._options.resetReason),t=new o.ResetError(e);this.reject(t)}this._promise=null,this._isPending=!1,this._isFulfilled=!1,this._isRejected=!1,this._value=void 0,this._clearTimer()}configure(e){Object.assign(this._options,e)}_createPromise(){this._promise=new Promise((e,t)=>{this._isPending=!0,this._resolve=e,this._reject=t})}_handleTimeout(){let e=A6(this._options.timeoutReason),t=typeof e=="string"?e.replace("{timeout}",this._options.timeout):"",r=new o.TimeoutError(t);this.reject(r)}_createTimer(){this._options.timeout&&(this._timer=setTimeout(()=>this._handleTimeout(),this._options.timeout))}_clearTimer(){this._timer&&(clearTimeout(this._timer),this._timer=null)}_settle(e){this._isPending=!1,this._value=e,this._clearTimer()}_callFn(e){if(typeof e=="function")try{let t=e();this._tryAttachToPromise(t)}catch(t){this.reject(t)}}_tryAttachToPromise(e){P6(e)&&e.then(t=>this.resolve(t),t=>this.reject(t))}};dc.TimeoutError=k6("TimeoutError");dc.ResetError=k6("ResetError");L6.exports=dc});var O6=re(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});rd.PromisedMap=void 0;var dT=function(){function o(){this.map=new Map}return Object.defineProperty(o.prototype,"size",{get:function(){return this.map.size},enumerable:!1,configurable:!0}),o.prototype.set=function(e,t){var r=this.createMapItem(t);return this.map.set(e,r),r.promise},o.prototype.get=function(e){var t=this.map.get(e);return t&&t.data},o.prototype.has=function(e){return this.map.has(e)},o.prototype.delete=function(e){return this.map.delete(e)},o.prototype.resolve=function(e,t){var r=this.map.get(e);r&&(this.delete(e),r.resolve(t))},o.prototype.reject=function(e,t){var r=this.map.get(e);r&&(this.delete(e),r.reject(t))},o.prototype.resolveAll=function(e){this.map.forEach(function(t){return t.resolve(e)}),this.map.clear()},o.prototype.rejectAll=function(e){this.map.forEach(function(t){return t.reject(e)}),this.map.clear()},o.prototype.forEach=function(e){this.map.forEach(function(t,r,n){return e(t.data,r,n)})},o.prototype.clear=function(){return this.map.clear()},o.prototype.createMapItem=function(e){var t={data:e};return t.promise=new Promise(function(r,n){t.resolve=r,t.reject=n}),t},o}();rd.PromisedMap=dT});var H6=re((yz,D6)=>{"use strict";var fT="Function.prototype.bind called on incompatible ",hT=Object.prototype.toString,gT=Math.max,xT="[object Function]",B6=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r},_T=function(e,t){for(var r=[],n=t||0,i=0;n<e.length;n+=1,i+=1)r[i]=e[n];return r},CT=function(o,e){for(var t="",r=0;r<o.length;r+=1)t+=o[r],r+1<o.length&&(t+=e);return t};D6.exports=function(e){var t=this;if(typeof t!="function"||hT.apply(t)!==xT)throw new TypeError(fT+t);for(var r=_T(arguments,1),n,i=function(){if(this instanceof n){var u=t.apply(this,B6(r,arguments));return Object(u)===u?u:this}return t.apply(e,B6(r,arguments))},a=gT(0,t.length-r.length),s=[],l=0;l<a;l++)s[l]="$"+l;if(n=Function("binder","return function ("+CT(s,",")+"){ return binder.apply(this,arguments); }")(i),t.prototype){var c=function(){};c.prototype=t.prototype,n.prototype=new c,c.prototype=null}return n}});var nd=re((bz,F6)=>{"use strict";var yT=H6();F6.exports=Function.prototype.bind||yT});var V6=re((Iz,N6)=>{"use strict";N6.exports=Error});var z6=re((Sz,R6)=>{"use strict";R6.exports=EvalError});var W6=re((vz,U6)=>{"use strict";U6.exports=RangeError});var K6=re((Mz,G6)=>{"use strict";G6.exports=ReferenceError});var id=re((Tz,j6)=>{"use strict";j6.exports=SyntaxError});var fn=re((wz,$6)=>{"use strict";$6.exports=TypeError});var X6=re((Ez,q6)=>{"use strict";q6.exports=URIError});var Z6=re((Pz,Y6)=>{"use strict";Y6.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==n||a.enumerable!==!0)return!1}return!0}});var e5=re((Az,J6)=>{"use strict";var Q6=typeof Symbol<"u"&&Symbol,bT=Z6();J6.exports=function(){return typeof Q6!="function"||typeof Symbol!="function"||typeof Q6("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:bT()}});var o5=re((kz,t5)=>{"use strict";var fh={__proto__:null,foo:{}},IT=Object;t5.exports=function(){return{__proto__:fh}.foo===fh.foo&&!(fh instanceof IT)}});var fc=re((Lz,r5)=>{"use strict";var ST=Function.prototype.call,vT=Object.prototype.hasOwnProperty,MT=nd();r5.exports=MT.call(ST,vT)});var Ni=re((Oz,l5)=>{"use strict";var Ye,TT=V6(),wT=z6(),ET=W6(),PT=K6(),rp=id(),op=fn(),AT=X6(),s5=Function,hh=function(o){try{return s5('"use strict"; return ('+o+").constructor;")()}catch{}},Rs=Object.getOwnPropertyDescriptor;if(Rs)try{Rs({},"")}catch{Rs=null}var gh=function(){throw new op},kT=Rs?function(){try{return arguments.callee,gh}catch{try{return Rs(arguments,"callee").get}catch{return gh}}}():gh,ep=e5()(),LT=o5()(),tr=Object.getPrototypeOf||(LT?function(o){return o.__proto__}:null),tp={},OT=typeof Uint8Array>"u"||!tr?Ye:tr(Uint8Array),zs={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Ye:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ye:ArrayBuffer,"%ArrayIteratorPrototype%":ep&&tr?tr([][Symbol.iterator]()):Ye,"%AsyncFromSyncIteratorPrototype%":Ye,"%AsyncFunction%":tp,"%AsyncGenerator%":tp,"%AsyncGeneratorFunction%":tp,"%AsyncIteratorPrototype%":tp,"%Atomics%":typeof Atomics>"u"?Ye:Atomics,"%BigInt%":typeof BigInt>"u"?Ye:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Ye:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Ye:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ye:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":TT,"%eval%":eval,"%EvalError%":wT,"%Float32Array%":typeof Float32Array>"u"?Ye:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ye:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ye:FinalizationRegistry,"%Function%":s5,"%GeneratorFunction%":tp,"%Int8Array%":typeof Int8Array>"u"?Ye:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ye:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ye:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ep&&tr?tr(tr([][Symbol.iterator]())):Ye,"%JSON%":typeof JSON=="object"?JSON:Ye,"%Map%":typeof Map>"u"?Ye:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ep||!tr?Ye:tr(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ye:Promise,"%Proxy%":typeof Proxy>"u"?Ye:Proxy,"%RangeError%":ET,"%ReferenceError%":PT,"%Reflect%":typeof Reflect>"u"?Ye:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ye:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ep||!tr?Ye:tr(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ye:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ep&&tr?tr(""[Symbol.iterator]()):Ye,"%Symbol%":ep?Symbol:Ye,"%SyntaxError%":rp,"%ThrowTypeError%":kT,"%TypedArray%":OT,"%TypeError%":op,"%Uint8Array%":typeof Uint8Array>"u"?Ye:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ye:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ye:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ye:Uint32Array,"%URIError%":AT,"%WeakMap%":typeof WeakMap>"u"?Ye:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ye:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ye:WeakSet};if(tr)try{null.error}catch(o){n5=tr(tr(o)),zs["%Error.prototype%"]=n5}var n5,BT=function o(e){var t;if(e==="%AsyncFunction%")t=hh("async function () {}");else if(e==="%GeneratorFunction%")t=hh("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=hh("async function* () {}");else if(e==="%AsyncGenerator%"){var r=o("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=o("%AsyncGenerator%");n&&tr&&(t=tr(n.prototype))}return zs[e]=t,t},i5={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},hc=nd(),ad=fc(),DT=hc.call(Function.call,Array.prototype.concat),HT=hc.call(Function.apply,Array.prototype.splice),a5=hc.call(Function.call,String.prototype.replace),sd=hc.call(Function.call,String.prototype.slice),FT=hc.call(Function.call,RegExp.prototype.exec),NT=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,VT=/\\(\\)?/g,RT=function(e){var t=sd(e,0,1),r=sd(e,-1);if(t==="%"&&r!=="%")throw new rp("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new rp("invalid intrinsic syntax, expected opening `%`");var n=[];return a5(e,NT,function(i,a,s,l){n[n.length]=s?a5(l,VT,"$1"):a||i}),n},zT=function(e,t){var r=e,n;if(ad(i5,r)&&(n=i5[r],r="%"+n[0]+"%"),ad(zs,r)){var i=zs[r];if(i===tp&&(i=BT(r)),typeof i>"u"&&!t)throw new op("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new rp("intrinsic "+e+" does not exist!")};l5.exports=function(e,t){if(typeof e!="string"||e.length===0)throw new op("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new op('"allowMissing" argument must be a boolean');if(FT(/^%?[^%]*%?$/,e)===null)throw new rp("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=RT(e),n=r.length>0?r[0]:"",i=zT("%"+n+"%",t),a=i.name,s=i.value,l=!1,c=i.alias;c&&(n=c[0],HT(r,DT([0,1],c)));for(var u=1,p=!0;u<r.length;u+=1){var m=r[u],d=sd(m,0,1),h=sd(m,-1);if((d==='"'||d==="'"||d==="`"||h==='"'||h==="'"||h==="`")&&d!==h)throw new rp("property names with quotes must have matching quotes");if((m==="constructor"||!p)&&(l=!0),n+="."+m,a="%"+n+"%",ad(zs,a))s=zs[a];else if(s!=null){if(!(m in s)){if(!t)throw new op("base intrinsic for "+e+" exists, but the property is not available.");return}if(Rs&&u+1>=r.length){var f=Rs(s,m);p=!!f,p&&"get"in f&&!("originalValue"in f.get)?s=f.get:s=s[m]}else p=ad(s,m),s=s[m];p&&!l&&(zs[a]=s)}}return s}});var gc=re((Bz,p5)=>{"use strict";var UT=Ni(),ld=UT("%Object.defineProperty%",!0)||!1;if(ld)try{ld({},"a",{value:1})}catch{ld=!1}p5.exports=ld});var xh=re((Dz,c5)=>{"use strict";var WT=Ni(),pd=WT("%Object.getOwnPropertyDescriptor%",!0);if(pd)try{pd([],"length")}catch{pd=null}c5.exports=pd});var cd=re((Hz,d5)=>{"use strict";var u5=gc(),GT=id(),np=fn(),m5=xh();d5.exports=function(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")throw new np("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new np("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new np("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new np("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new np("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new np("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,l=!!m5&&m5(e,t);if(u5)u5(e,t,{configurable:a===null&&l?l.configurable:!a,enumerable:n===null&&l?l.enumerable:!n,value:r,writable:i===null&&l?l.writable:!i});else if(s||!n&&!i&&!a)e[t]=r;else throw new GT("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var xc=re((Fz,h5)=>{"use strict";var _h=gc(),f5=function(){return!!_h};f5.hasArrayLengthDefineBug=function(){if(!_h)return null;try{return _h([],"length",{value:1}).length!==1}catch{return!0}};h5.exports=f5});var y5=re((Nz,C5)=>{"use strict";var KT=Ni(),g5=cd(),jT=xc()(),x5=xh(),_5=fn(),$T=KT("%Math.floor%");C5.exports=function(e,t){if(typeof e!="function")throw new _5("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||$T(t)!==t)throw new _5("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,i=!0;if("length"in e&&x5){var a=x5(e,"length");a&&!a.configurable&&(n=!1),a&&!a.writable&&(i=!1)}return(n||i||!r)&&(jT?g5(e,"length",t,!0,!0):g5(e,"length",t)),e}});var dd=re((Vz,ud)=>{"use strict";var Ch=nd(),md=Ni(),qT=y5(),XT=fn(),S5=md("%Function.prototype.apply%"),v5=md("%Function.prototype.call%"),M5=md("%Reflect.apply%",!0)||Ch.call(v5,S5),b5=gc(),YT=md("%Math.max%");ud.exports=function(e){if(typeof e!="function")throw new XT("a function is required");var t=M5(Ch,v5,arguments);return qT(t,1+YT(0,e.length-(arguments.length-1)),!0)};var I5=function(){return M5(Ch,S5,arguments)};b5?b5(ud.exports,"apply",{value:I5}):ud.exports.apply=I5});var yh=re((Rz,w5)=>{"use strict";var T5=Object.prototype.toString;w5.exports=function(e){var t=T5.call(e),r=t==="[object Arguments]";return r||(r=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&T5.call(e.callee)==="[object Function]"),r}});var H5=re((zz,D5)=>{"use strict";var B5;Object.keys||(_c=Object.prototype.hasOwnProperty,bh=Object.prototype.toString,E5=yh(),Ih=Object.prototype.propertyIsEnumerable,P5=!Ih.call({toString:null},"toString"),A5=Ih.call(function(){},"prototype"),Cc=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],fd=function(o){var e=o.constructor;return e&&e.prototype===o},k5={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},L5=function(){if(typeof window>"u")return!1;for(var o in window)try{if(!k5["$"+o]&&_c.call(window,o)&&window[o]!==null&&typeof window[o]=="object")try{fd(window[o])}catch{return!0}}catch{return!0}return!1}(),O5=function(o){if(typeof window>"u"||!L5)return fd(o);try{return fd(o)}catch{return!1}},B5=function(e){var t=e!==null&&typeof e=="object",r=bh.call(e)==="[object Function]",n=E5(e),i=t&&bh.call(e)==="[object String]",a=[];if(!t&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var s=A5&&r;if(i&&e.length>0&&!_c.call(e,0))for(var l=0;l<e.length;++l)a.push(String(l));if(n&&e.length>0)for(var c=0;c<e.length;++c)a.push(String(c));else for(var u in e)!(s&&u==="prototype")&&_c.call(e,u)&&a.push(String(u));if(P5)for(var p=O5(e),m=0;m<Cc.length;++m)!(p&&Cc[m]==="constructor")&&_c.call(e,Cc[m])&&a.push(Cc[m]);return a});var _c,bh,E5,Ih,P5,A5,Cc,fd,k5,L5,O5;D5.exports=B5});var R5=re((Uz,V5)=>{"use strict";var ZT=Array.prototype.slice,QT=yh(),F5=Object.keys,hd=F5?function(e){return F5(e)}:H5(),N5=Object.keys;hd.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(r){return QT(r)?N5(ZT.call(r)):N5(r)})}else Object.keys=hd;return Object.keys||hd};V5.exports=hd});var Sh=re((Wz,G5)=>{"use strict";var JT=R5(),ew=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",tw=Object.prototype.toString,ow=Array.prototype.concat,z5=cd(),rw=function(o){return typeof o=="function"&&tw.call(o)==="[object Function]"},U5=xc()(),nw=function(o,e,t,r){if(e in o){if(r===!0){if(o[e]===t)return}else if(!rw(r)||!r())return}U5?z5(o,e,t,!0):z5(o,e,t)},W5=function(o,e){var t=arguments.length>2?arguments[2]:{},r=JT(e);ew&&(r=ow.call(r,Object.getOwnPropertySymbols(e)));for(var n=0;n<r.length;n+=1)nw(o,r[n],e[r[n]],t[r[n]])};W5.supportsDescriptors=!!U5;G5.exports=W5});var gd=re((Gz,K5)=>{"use strict";K5.exports=function(){if(typeof Promise!="function")throw new TypeError("`Promise.prototype.finally` requires a global `Promise` be available.")}});var X5=re((Kz,q5)=>{"use strict";var iw=Ni(),aw=dd(),sw=id(),j5=iw("%Promise.resolve%",!0),$5=j5&&aw(j5);q5.exports=function(e,t){if(!$5)throw new sw("This environment does not support Promises.");return $5(e,t)}});var J5=re((jz,Q5)=>{"use strict";var Z5=Function.prototype.toString,ip=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Mh,xd;if(typeof ip=="function"&&typeof Object.defineProperty=="function")try{Mh=Object.defineProperty({},"length",{get:function(){throw xd}}),xd={},ip(function(){throw 42},null,Mh)}catch(o){o!==xd&&(ip=null)}else ip=null;var lw=/^\s*class\b/,Th=function(e){try{var t=Z5.call(e);return lw.test(t)}catch{return!1}},vh=function(e){try{return Th(e)?!1:(Z5.call(e),!0)}catch{return!1}},_d=Object.prototype.toString,pw="[object Object]",cw="[object Function]",uw="[object GeneratorFunction]",mw="[object HTMLAllCollection]",dw="[object HTML document.all class]",fw="[object HTMLCollection]",hw=typeof Symbol=="function"&&!!Symbol.toStringTag,gw=!(0 in[,]),wh=function(){return!1};typeof document=="object"&&(Y5=document.all,_d.call(Y5)===_d.call(document.all)&&(wh=function(e){if((gw||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=_d.call(e);return(t===mw||t===dw||t===fw||t===pw)&&e("")==null}catch{}return!1}));var Y5;Q5.exports=ip?function(e){if(wh(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{ip(e,null,Mh)}catch(t){if(t!==xd)return!1}return!Th(e)&&vh(e)}:function(e){if(wh(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(hw)return vh(e);if(Th(e))return!1;var t=_d.call(e);return t!==cw&&t!==uw&&!/^\[object HTML/.test(t)?!1:vh(e)}});var Eh=re(($z,eb)=>{"use strict";eb.exports=J5()});var ob=re((qz,tb)=>{"use strict";tb.exports=Ni()});var Cd=re((Xz,rb)=>{"use strict";var xw=fn(),yc=fc(),_w={__proto__:null,"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};rb.exports=function(e){if(!e||typeof e!="object")return!1;for(var t in e)if(yc(e,t)&&!_w[t])return!1;var r=yc(e,"[[Value]]")||yc(e,"[[Writable]]"),n=yc(e,"[[Get]]")||yc(e,"[[Set]]");if(r&&n)throw new xw("Property Descriptors may not be both accessor and data descriptors");return!0}});var Ph=re((Yz,ab)=>{"use strict";var nb=Ni(),ib=dd(),Cw=ib(nb("String.prototype.indexOf"));ab.exports=function(e,t){var r=nb(e,!!t);return typeof r=="function"&&Cw(e,".prototype.")>-1?ib(r):r}});var pb=re((Zz,lb)=>{"use strict";var yw=Ni(),sb=yw("%Array%"),bw=!sb.isArray&&Ph()("Object.prototype.toString");lb.exports=sb.isArray||function(e){return bw(e)==="[object Array]"}});var db=re((Qz,mb)=>{"use strict";var Iw=xc(),cb=gc(),ub=Iw.hasArrayLengthDefineBug(),Sw=ub&&pb(),vw=Ph(),Mw=vw("Object.prototype.propertyIsEnumerable");mb.exports=function(e,t,r,n,i,a){if(!cb){if(!e(a)||!a["[[Configurable]]"]||!a["[[Writable]]"]||i in n&&Mw(n,i)!==!!a["[[Enumerable]]"])return!1;var s=a["[[Value]]"];return n[i]=s,t(n[i],s)}return ub&&i==="length"&&"[[Value]]"in a&&Sw(n)&&n.length!==a["[[Value]]"]?(n.length=a["[[Value]]"],n.length===a["[[Value]]"]):(cb(n,i,r(a)),!0)}});var hb=re((Jz,fb)=>{"use strict";fb.exports=function(e){if(typeof e>"u")return e;var t={};return"[[Value]]"in e&&(t.value=e["[[Value]]"]),"[[Writable]]"in e&&(t.writable=!!e["[[Writable]]"]),"[[Get]]"in e&&(t.get=e["[[Get]]"]),"[[Set]]"in e&&(t.set=e["[[Set]]"]),"[[Enumerable]]"in e&&(t.enumerable=!!e["[[Enumerable]]"]),"[[Configurable]]"in e&&(t.configurable=!!e["[[Configurable]]"]),t}});var xb=re((eU,gb)=>{"use strict";var Tw=fn(),ww=Cd(),Ew=hb();gb.exports=function(e){if(typeof e<"u"&&!ww(e))throw new Tw("Assertion failed: `Desc` must be a Property Descriptor");return Ew(e)}});var yb=re((tU,Cb)=>{"use strict";var Pw=fn(),_b=fc(),Aw=Cd();Cb.exports=function(e){if(typeof e>"u")return!1;if(!Aw(e))throw new Pw("Assertion failed: `Desc` must be a Property Descriptor");return!(!_b(e,"[[Value]]")&&!_b(e,"[[Writable]]"))}});var Ib=re((oU,bb)=>{"use strict";bb.exports=function(e){return typeof e=="string"||typeof e=="symbol"}});var vb=re((rU,Sb)=>{"use strict";Sb.exports=Number.isNaN||function(e){return e!==e}});var wb=re((nU,Tb)=>{"use strict";var Mb=vb();Tb.exports=function(e,t){return e===t?e===0?1/e===1/t:!0:Mb(e)&&Mb(t)}});var Pb=re((iU,Eb)=>{"use strict";Eb.exports=function(e){if(e===null)return"Null";if(typeof e>"u")return"Undefined";if(typeof e=="function"||typeof e=="object")return"Object";if(typeof e=="number")return"Number";if(typeof e=="boolean")return"Boolean";if(typeof e=="string")return"String"}});var bc=re((aU,Ab)=>{"use strict";var kw=Pb();Ab.exports=function(e){return typeof e=="symbol"?"Symbol":typeof e=="bigint"?"BigInt":kw(e)}});var Lb=re((sU,kb)=>{"use strict";kb.exports=function(e){return!!e}});var Db=re((lU,Bb)=>{"use strict";var Vi=fc(),yd=fn(),Lw=bc(),Ah=Lb(),Ob=Eh();Bb.exports=function(e){if(Lw(e)!=="Object")throw new yd("ToPropertyDescriptor requires an object");var t={};if(Vi(e,"enumerable")&&(t["[[Enumerable]]"]=Ah(e.enumerable)),Vi(e,"configurable")&&(t["[[Configurable]]"]=Ah(e.configurable)),Vi(e,"value")&&(t["[[Value]]"]=e.value),Vi(e,"writable")&&(t["[[Writable]]"]=Ah(e.writable)),Vi(e,"get")){var r=e.get;if(typeof r<"u"&&!Ob(r))throw new yd("getter must be a function");t["[[Get]]"]=r}if(Vi(e,"set")){var n=e.set;if(typeof n<"u"&&!Ob(n))throw new yd("setter must be a function");t["[[Set]]"]=n}if((Vi(t,"[[Get]]")||Vi(t,"[[Set]]"))&&(Vi(t,"[[Value]]")||Vi(t,"[[Writable]]")))throw new yd("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}});var Nb=re((pU,Fb)=>{"use strict";var kh=fn(),Hb=Cd(),Ow=db(),Bw=xb(),Dw=yb(),Hw=Ib(),Fw=wb(),Nw=Db(),Vw=bc();Fb.exports=function(e,t,r){if(Vw(e)!=="Object")throw new kh("Assertion failed: Type(O) is not Object");if(!Hw(t))throw new kh("Assertion failed: IsPropertyKey(P) is not true");var n=Hb(r)?r:Nw(r);if(!Hb(n))throw new kh("Assertion failed: Desc is not a valid Property Descriptor");return Ow(Dw,Fw,Bw,e,t,n)}});var Rb=re((cU,Bh)=>{"use strict";var Rw=ob(),Vb=Rw("%Reflect.construct%",!0),bd=Nb();try{bd({},"",{"[[Get]]":function(){}})}catch{bd=null}bd&&Vb?(Lh={},Oh={},bd(Oh,"length",{"[[Get]]":function(){throw Lh},"[[Enumerable]]":!0}),Bh.exports=function(e){try{Vb(e,Oh)}catch(t){return t===Lh}}):Bh.exports=function(e){return typeof e=="function"&&!!e.prototype};var Lh,Oh});var Gb=re((uU,Wb)=>{"use strict";var zw=Ni(),zb=zw("%Symbol.species%",!0),Dh=fn(),Uw=Rb(),Ub=bc();Wb.exports=function(e,t){if(Ub(e)!=="Object")throw new Dh("Assertion failed: Type(O) is not Object");var r=e.constructor;if(typeof r>"u")return t;if(Ub(r)!=="Object")throw new Dh("O.constructor is not an Object");var n=zb?r[zb]:void 0;if(n==null)return t;if(Uw(n))return n;throw new Dh("no constructor found")}});var jb=re((mU,Kb)=>{"use strict";var Sc=function(){return typeof function(){}.name=="string"},Ic=Object.getOwnPropertyDescriptor;if(Ic)try{Ic([],"length")}catch{Ic=null}Sc.functionsHaveConfigurableNames=function(){if(!Sc()||!Ic)return!1;var e=Ic(function(){},"name");return!!e&&!!e.configurable};var Ww=Function.prototype.bind;Sc.boundFunctionsHaveNames=function(){return Sc()&&typeof Ww=="function"&&function(){}.bind().name!==""};Kb.exports=Sc});var Xb=re((dU,qb)=>{"use strict";var $b=cd(),Gw=xc()(),Kw=jb().functionsHaveConfigurableNames(),jw=fn();qb.exports=function(e,t){if(typeof e!="function")throw new jw("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||Kw)&&(Gw?$b(e,"name",t,!0,!0):$b(e,"name",t)),e}});var Hh=re((fU,Zb)=>{"use strict";var $w=gd();$w();var qw=fn(),Yb=X5(),Xw=Eh(),Yw=Gb(),Zw=bc(),Qw=Xb(),Jw=Promise,eE=function(e,t){return function(r){var n=t(),i=Yb(e,n),a=function(){return r};return i.then(a)}},tE=function(e,t){return function(r){var n=t(),i=Yb(e,n),a=function(){throw r};return i.then(a)}};Zb.exports=Qw(function(e){var t=this;if(Zw(t)!=="Object")throw new qw("receiver is not an Object");var r=Yw(t,Jw),n=e,i=e;return Xw(e)&&(n=eE(r,e),i=tE(r,e)),t.then(n,i)},"finally",!0)});var Fh=re((hU,Qb)=>{"use strict";var oE=gd(),rE=Hh();Qb.exports=function(){return oE(),typeof Promise.prototype.finally=="function"?Promise.prototype.finally:rE}});var eI=re((gU,Jb)=>{"use strict";var nE=gd(),iE=Fh(),aE=Sh();Jb.exports=function(){nE();var e=iE();return aE(Promise.prototype,{finally:e},{finally:function(){return Promise.prototype.finally!==e}}),e}});var nI=re((xU,rI)=>{"use strict";var sE=dd(),lE=Sh(),pE=Hh(),tI=Fh(),cE=eI(),oI=sE(tI());lE(oI,{getPolyfill:tI,implementation:pE,shim:cE});rI.exports=oI});var aI=re((CU,iI)=>{var uE=dh(),mE=nI();iI.exports=class{constructor(){this._items=new Map}create(e,t,r){return this._rejectExistingRequest(e),this._createNewRequest(e,t,r)}resolve(e,t){e&&this._items.has(e)&&this._items.get(e).resolve(t)}rejectAll(e){this._items.forEach(t=>t.isPending?t.reject(e):null)}_rejectExistingRequest(e){let t=this._items.get(e);t&&t.isPending&&t.reject(new Error(`WebSocket request is replaced, id: ${e}`))}_createNewRequest(e,t,r){let n=new uE({timeout:r,timeoutReason:`WebSocket request was rejected by timeout (${r} ms). RequestId: ${e}`});return this._items.set(e,n),mE(n.call(t),()=>this._deleteRequest(e,n))}_deleteRequest(e,t){this._items.get(e)===t&&this._items.delete(e)}}});var lI=re((yU,sI)=>{sI.exports={createWebSocket:o=>new WebSocket(o),packMessage:null,unpackMessage:null,attachRequestId:null,extractRequestId:null,extractMessageData:o=>o.data,timeout:0,connectionTimeout:0}});var pI=re(Nh=>{Nh.throwIf=(o,e)=>{if(o)throw new Error(e)};Nh.isPromise=o=>o&&typeof o.then=="function"});var dI=re((IU,mI)=>{var ss=M6(),cI=dh(),{PromisedMap:dE}=O6(),fE=aI(),uI=lI(),{throwIf:Id,isPromise:hE}=pI(),Sd={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},Vh=class{constructor(e,t){this._assertOptions(t),this._url=e,this._options=Object.assign({},uI,t),this._requests=new fE,this._promisedMap=new dE,this._ws=null,this._wsSubscription=null,this._createOpeningController(),this._createClosingController(),this._createChannels()}get ws(){return this._ws}get url(){return this._url}get isOpening(){return!!(this._ws&&this._ws.readyState===Sd.CONNECTING)}get isOpened(){return!!(this._ws&&this._ws.readyState===Sd.OPEN)}get isClosing(){return!!(this._ws&&this._ws.readyState===Sd.CLOSING)}get isClosed(){return!this._ws||this._ws.readyState===Sd.CLOSED}get onOpen(){return this._onOpen}get onSend(){return this._onSend}get onMessage(){return this._onMessage}get onUnpackedMessage(){return this._onUnpackedMessage}get onResponse(){return this._onResponse}get onClose(){return this._onClose}get onError(){return this._onError}open(){return this.isClosing?Promise.reject(new Error("Can't open WebSocket while closing.")):this.isOpened?this._opening.promise:this._opening.call(()=>{this._opening.promise.catch(e=>this._cleanup(e)),this._createWS()})}sendRequest(e,t={}){let r=t.requestId||`${Math.random()}`,n=t.timeout!==void 0?t.timeout:this._options.timeout;return this._requests.create(r,()=>{this._assertRequestIdHandlers();let i=this._options.attachRequestId(e,r);this.sendPacked(i)},n)}sendPacked(e){this._assertPackingHandlers();let t=this._options.packMessage(e);this.send(t)}send(e){Id(!this.isOpened,"Can't send data because WebSocket is not opened."),this._ws.send(e),this._onSend.dispatchAsync(e)}waitUnpackedMessage(e,t={}){return Id(typeof e!="function",`Predicate must be a function, got ${typeof e}`),t.timeout&&setTimeout(()=>{if(this._promisedMap.has(e)){let r=t.timeoutError||new Error("Timeout");this._promisedMap.reject(e,r)}},t.timeout),this._promisedMap.set(e)}close(e,t){return this.isClosed?Promise.resolve(this._closing.value):this._closing.call(()=>this._ws.close(e,t))}removeAllListeners(){this._onOpen.removeAllListeners(),this._onMessage.removeAllListeners(),this._onUnpackedMessage.removeAllListeners(),this._onResponse.removeAllListeners(),this._onSend.removeAllListeners(),this._onClose.removeAllListeners(),this._onError.removeAllListeners()}_createOpeningController(){let e=this._options.connectionTimeout||this._options.timeout;this._opening=new cI({timeout:e,timeoutReason:`Can't open WebSocket within allowed timeout: ${e} ms.`})}_createClosingController(){let e=this._options.timeout;this._closing=new cI({timeout:e,timeoutReason:`Can't close WebSocket within allowed timeout: ${e} ms.`})}_createChannels(){this._onOpen=new ss,this._onMessage=new ss,this._onUnpackedMessage=new ss,this._onResponse=new ss,this._onSend=new ss,this._onClose=new ss,this._onError=new ss}_createWS(){this._ws=this._options.createWebSocket(this._url),this._wsSubscription=new ss.Subscription([{channel:this._ws,event:"open",listener:e=>this._handleOpen(e)},{channel:this._ws,event:"message",listener:e=>this._handleMessage(e)},{channel:this._ws,event:"error",listener:e=>this._handleError(e)},{channel:this._ws,event:"close",listener:e=>this._handleClose(e)}]).on()}_handleOpen(e){this._onOpen.dispatchAsync(e),this._opening.resolve(e)}_handleMessage(e){let t=this._options.extractMessageData(e);this._onMessage.dispatchAsync(t),this._tryUnpack(t)}_tryUnpack(e){this._options.unpackMessage&&(e=this._options.unpackMessage(e),hE(e)?e.then(t=>this._handleUnpackedData(t)):this._handleUnpackedData(e))}_handleUnpackedData(e){e!==void 0&&(this._onUnpackedMessage.dispatchAsync(e),this._tryHandleResponse(e)),this._tryHandleWaitingMessage(e)}_tryHandleResponse(e){if(this._options.extractRequestId){let t=this._options.extractRequestId(e);t&&(this._onResponse.dispatchAsync(e,t),this._requests.resolve(t,e))}}_tryHandleWaitingMessage(e){this._promisedMap.forEach((t,r)=>{let n=!1;try{n=r(e)}catch(i){this._promisedMap.reject(r,i);return}n&&this._promisedMap.resolve(r,e)})}_handleError(e){this._onError.dispatchAsync(e)}_handleClose(e){this._onClose.dispatchAsync(e),this._closing.resolve(e);let t=new Error(`WebSocket closed with reason: ${e.reason||e.message} (${e.code}).`);this._opening.isPending&&this._opening.reject(t),this._cleanup(t)}_cleanupWS(){this._wsSubscription&&(this._wsSubscription.off(),this._wsSubscription=null),this._ws=null}_cleanup(e){this._cleanupWS(),this._requests.rejectAll(e)}_assertOptions(e){Object.keys(e||{}).forEach(t=>{if(!uI.hasOwnProperty(t))throw new Error(`Unknown option: ${t}`)})}_assertPackingHandlers(){let{packMessage:e,unpackMessage:t}=this._options;Id(!e||!t,"Please define 'options.packMessage / options.unpackMessage' for sending packed messages.")}_assertRequestIdHandlers(){let{attachRequestId:e,extractRequestId:t}=this._options;Id(!e||!t,"Please define 'options.attachRequestId / options.extractRequestId' for sending requests.")}};mI.exports=Vh});var MI=re(wd=>{"use strict";"use client";var IE=go();Object.defineProperty(wd,"__esModule",{value:!0});wd.default=void 0;var SE=IE(_o()),vE=xo(),nW=wd.default=(0,SE.default)((0,vE.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92z"}),"MicNoneOutlined")});var vc=re(Ed=>{"use strict";"use client";var PE=go();Object.defineProperty(Ed,"__esModule",{value:!0});Ed.default=void 0;var AE=PE(_o()),kE=xo(),MW=Ed.default=(0,AE.default)((0,kE.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")});var Wh=re(Pd=>{"use strict";"use client";var LE=go();Object.defineProperty(Pd,"__esModule",{value:!0});Pd.default=void 0;var OE=LE(_o()),BE=xo(),wW=Pd.default=(0,OE.default)((0,BE.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop")});var BI=re(kd=>{"use strict";"use client";var RE=go();Object.defineProperty(kd,"__esModule",{value:!0});kd.default=void 0;var zE=RE(_o()),UE=xo(),YW=kd.default=(0,zE.default)((0,UE.jsx)("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"InfoOutlined")});var S3=re(ff=>{"use strict";"use client";var bA=go();Object.defineProperty(ff,"__esModule",{value:!0});ff.default=void 0;var IA=bA(_o()),SA=xo(),Gre=ff.default=(0,IA.default)((0,SA.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp")});var F3=re(gf=>{"use strict";"use client";var VA=go();Object.defineProperty(gf,"__esModule",{value:!0});gf.default=void 0;var RA=VA(_o()),zA=xo(),wie=gf.default=(0,RA.default)((0,zA.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess")});var j3=re((_g,Cg)=>{(function(o,e){typeof define=="function"&&define.amd?define([],e):typeof _g<"u"?e():(e(),o.FileSaver={})})(_g,function(){"use strict";function o(s,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function e(s,l,c){var u=new XMLHttpRequest;u.open("GET",s),u.responseType="blob",u.onload=function(){a(u.response,l,c)},u.onerror=function(){},u.send()}function t(s){var l=new XMLHttpRequest;l.open("HEAD",s,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function r(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(l)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,i=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(s,l,c){var u=n.URL||n.webkitURL,p=document.createElement("a");l=l||s.name||"download",p.download=l,p.rel="noopener",typeof s=="string"?(p.href=s,p.origin===location.origin?r(p):t(p.href)?e(s,l,c):r(p,p.target="_blank")):(p.href=u.createObjectURL(s),setTimeout(function(){u.revokeObjectURL(p.href)},4e4),setTimeout(function(){r(p)},0))}:"msSaveOrOpenBlob"in navigator?function(s,l,c){if(l=l||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(o(s,c),l);else if(t(s))e(s,l,c);else{var u=document.createElement("a");u.href=s,u.target="_blank",setTimeout(function(){r(u)})}}:function(s,l,c,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof s=="string")return e(s,l,c);var p=s.type==="application/octet-stream",m=/constructor/i.test(n.HTMLElement)||n.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||p&&m||i)&&typeof FileReader<"u"){var h=new FileReader;h.onloadend=function(){var x=h.result;x=d?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=x:location=x,u=null},h.readAsDataURL(s)}else{var f=n.URL||n.webkitURL,_=f.createObjectURL(s);u?u.location=_:location.href=_,u=null,setTimeout(function(){f.revokeObjectURL(_)},4e4)}});n.saveAs=a.saveAs=a,typeof Cg<"u"&&(Cg.exports=a)})});var Ig=re(yf=>{"use strict";"use client";var Ik=go();Object.defineProperty(yf,"__esModule",{value:!0});yf.default=void 0;var Sk=Ik(_o()),vk=xo(),rce=yf.default=(0,Sk.default)((0,vk.jsx)("path",{d:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9z"}),"SubdirectoryArrowRight")});var _S=re(Sf=>{"use strict";"use client";var Vk=go();Object.defineProperty(Sf,"__esModule",{value:!0});Sf.default=void 0;var Rk=Vk(_o()),zk=xo(),aue=Sf.default=(0,Rk.default)((0,zk.jsx)("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code")});var Vv=re(Hf=>{"use strict";"use client";var GL=go();Object.defineProperty(Hf,"__esModule",{value:!0});Hf.default=void 0;var KL=GL(_o()),jL=xo(),Ixe=Hf.default=(0,KL.default)((0,jL.jsx)("path",{d:"M19 6H5c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 10H5V8h14z"}),"Crop32Outlined")});var Rv=re(Ff=>{"use strict";"use client";var $L=go();Object.defineProperty(Ff,"__esModule",{value:!0});Ff.default=void 0;var qL=$L(_o()),XL=xo(),vxe=Ff.default=(0,qL.default)((0,XL.jsx)("path",{d:"M19 4H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H5V6h14z"}),"Crop54Outlined")});var zv=re(Nf=>{"use strict";"use client";var YL=go();Object.defineProperty(Nf,"__esModule",{value:!0});Nf.default=void 0;var ZL=YL(_o()),QL=xo(),Txe=Nf.default=(0,ZL.default)((0,QL.jsx)("path",{d:"M19 5H5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 12H5V7h14z"}),"Crop75Outlined")});var Uv=re(Vf=>{"use strict";"use client";var JL=go();Object.defineProperty(Vf,"__esModule",{value:!0});Vf.default=void 0;var eO=JL(_o()),tO=xo(),Exe=Vf.default=(0,eO.default)((0,tO.jsx)("path",{d:"M19 7H5c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2m0 8H5V9h14z"}),"Crop169Outlined")});var Wv=re(Rf=>{"use strict";"use client";var oO=go();Object.defineProperty(Rf,"__esModule",{value:!0});Rf.default=void 0;var rO=oO(_o()),nO=xo(),Axe=Rf.default=(0,rO.default)((0,nO.jsx)("path",{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H6V6h12z"}),"CropSquareOutlined")});var s9=re(t1=>{"use strict";"use client";var vB=go();Object.defineProperty(t1,"__esModule",{value:!0});t1.default=void 0;var MB=vB(_o()),TB=xo(),$ve=t1.default=(0,MB.default)((0,TB.jsx)("path",{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3"}),"PushPin")});var l9=re(o1=>{"use strict";"use client";var wB=go();Object.defineProperty(o1,"__esModule",{value:!0});o1.default=void 0;var EB=wB(_o()),PB=xo(),Xve=o1.default=(0,EB.default)((0,PB.jsx)("path",{d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4zm3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1"}),"PushPinOutlined")});var m9=re(n1=>{"use strict";"use client";var kB=go();Object.defineProperty(n1,"__esModule",{value:!0});n1.default=void 0;var LB=kB(_o()),OB=xo(),r8e=n1.default=(0,LB.default)((0,OB.jsx)("path",{d:"M15.61 7.41 14.2 6l-6 6 6 6 1.41-1.41L11.03 12z"}),"NavigateBeforeOutlined")});var d9=re(i1=>{"use strict";"use client";var BB=go();Object.defineProperty(i1,"__esModule",{value:!0});i1.default=void 0;var DB=BB(_o()),HB=xo(),i8e=i1.default=(0,DB.default)((0,HB.jsx)("path",{d:"M10.02 6 8.61 7.41 13.19 12l-4.58 4.59L10.02 18l6-6z"}),"NavigateNextOutlined")});var a7=re((su,d1)=>{(function(o,e){"use strict";var t="1.0.38",r="",n="?",i="function",a="undefined",s="object",l="string",c="major",u="model",p="name",m="type",d="vendor",h="version",f="architecture",_="console",x="mobile",C="tablet",y="smarttv",b="wearable",w="embedded",I=500,E="Amazon",P="Apple",O="ASUS",N="BlackBerry",V="Browser",A="Chrome",D="Edge",W="Firefox",k="Google",U="Huawei",K="LG",H="Microsoft",R="Motorola",F="Opera",Y="Samsung",$="Sharp",ie="Sony",G="Xiaomi",B="Zebra",ae="Facebook",X="Chromium OS",oe="Mac OS",ue=function(q,de){var se={};for(var Se in q)de[Se]&&de[Se].length%2===0?se[Se]=de[Se].concat(q[Se]):se[Se]=q[Se];return se},Z=function(q){for(var de={},se=0;se<q.length;se++)de[q[se].toUpperCase()]=q[se];return de},J=function(q,de){return typeof q===l?j(de).indexOf(j(q))!==-1:!1},j=function(q){return q.toLowerCase()},ce=function(q){return typeof q===l?q.replace(/[^\d\.]/g,r).split(".")[0]:e},ke=function(q,de){if(typeof q===l)return q=q.replace(/^\s\s*/,r),typeof de===a?q:q.substring(0,I)},at=function(q,de){for(var se=0,Se,To,ar,ot,_e,Yr;se<de.length&&!_e;){var fe=de[se],Q=de[se+1];for(Se=To=0;Se<fe.length&&!_e&&fe[Se];)if(_e=fe[Se++].exec(q),_e)for(ar=0;ar<Q.length;ar++)Yr=_e[++To],ot=Q[ar],typeof ot===s&&ot.length>0?ot.length===2?typeof ot[1]==i?this[ot[0]]=ot[1].call(this,Yr):this[ot[0]]=ot[1]:ot.length===3?typeof ot[1]===i&&!(ot[1].exec&&ot[1].test)?this[ot[0]]=Yr?ot[1].call(this,Yr,ot[2]):e:this[ot[0]]=Yr?Yr.replace(ot[1],ot[2]):e:ot.length===4&&(this[ot[0]]=Yr?ot[3].call(this,Yr.replace(ot[1],ot[2])):e):this[ot]=Yr||e;se+=2}},we=function(q,de){for(var se in de)if(typeof de[se]===s&&de[se].length>0){for(var Se=0;Se<de[se].length;Se++)if(J(de[se][Se],q))return se===n?e:se}else if(J(de[se],q))return se===n?e:se;return q},tt={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},At={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Zt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,h],[/opios[\/ ]+([\w\.]+)/i],[h,[p,F+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[h,[p,F+" GX"]],[/\bopr\/([\w\.]+)/i],[h,[p,F]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[h,[p,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,h],[/\bddg\/([\w\.]+)/i],[h,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[p,"UC"+V]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[h,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[h,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[h,[p,"Smart Lenovo "+V]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+V],h],[/\bfocus\/([\w\.]+)/i],[h,[p,W+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[p,F+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[p,F+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[p,"MIUI "+V]],[/fxios\/([-\w\.]+)/i],[h,[p,W]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+V]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+V],h],[/samsungbrowser\/([\w\.]+)/i],[h,[p,Y+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],h],[/metasr[\/ ]?([\d\.]+)/i],[h,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[p,h],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,ae],h],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[h,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[p,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,A+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[p,"Android "+V]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[h,we,tt]],[/(webkit|khtml)\/([\w\.]+)/i],[p,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[p,W+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,h],[/(cobalt)\/([\w\.]+)/i],[p,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,j]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,r,j]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,j]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[d,Y],[m,C]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[d,Y],[m,x]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[d,P],[m,x]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[d,P],[m,C]],[/(macintosh);/i],[u,[d,P]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[d,$],[m,x]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[d,U],[m,C]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[d,U],[m,x]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[d,G],[m,x]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[d,G],[m,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[d,"OPPO"],[m,x]],[/\b(opd2\d{3}a?) bui/i],[u,[d,"OPPO"],[m,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[d,"Vivo"],[m,x]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[d,"Realme"],[m,x]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[d,R],[m,x]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[d,R],[m,C]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[d,K],[m,C]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[d,K],[m,x]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[d,"Lenovo"],[m,C]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[d,"Nokia"],[m,x]],[/(pixel c)\b/i],[u,[d,k],[m,C]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[d,k],[m,x]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[d,ie],[m,x]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[d,ie],[m,C]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[d,"OnePlus"],[m,x]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[d,E],[m,C]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[d,E],[m,x]],[/(playbook);[-\w\),; ]+(rim)/i],[u,d,[m,C]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[d,N],[m,x]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[d,O],[m,C]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[d,O],[m,x]],[/(nexus 9)/i],[u,[d,"HTC"],[m,C]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[u,/_/g," "],[m,x]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[d,"Acer"],[m,C]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[d,"Meizu"],[m,x]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[d,"Ulefone"],[m,x]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,u,[m,x]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,u,[m,C]],[/(surface duo)/i],[u,[d,H],[m,C]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[d,"Fairphone"],[m,x]],[/(u304aa)/i],[u,[d,"AT&T"],[m,x]],[/\bsie-(\w*)/i],[u,[d,"Siemens"],[m,x]],[/\b(rct\w+) b/i],[u,[d,"RCA"],[m,C]],[/\b(venue[\d ]{2,7}) b/i],[u,[d,"Dell"],[m,C]],[/\b(q(?:mv|ta)\w+) b/i],[u,[d,"Verizon"],[m,C]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[d,"Barnes & Noble"],[m,C]],[/\b(tm\d{3}\w+) b/i],[u,[d,"NuVision"],[m,C]],[/\b(k88) b/i],[u,[d,"ZTE"],[m,C]],[/\b(nx\d{3}j) b/i],[u,[d,"ZTE"],[m,x]],[/\b(gen\d{3}) b.+49h/i],[u,[d,"Swiss"],[m,x]],[/\b(zur\d{3}) b/i],[u,[d,"Swiss"],[m,C]],[/\b((zeki)?tb.*\b) b/i],[u,[d,"Zeki"],[m,C]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],u,[m,C]],[/\b(ns-?\w{0,9}) b/i],[u,[d,"Insignia"],[m,C]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[d,"NextBook"],[m,C]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],u,[m,x]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],u,[m,x]],[/\b(ph-1) /i],[u,[d,"Essential"],[m,x]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[d,"Envizen"],[m,C]],[/\b(trio[-\w\. ]+) b/i],[u,[d,"MachSpeed"],[m,C]],[/\btu_(1491) b/i],[u,[d,"Rotor"],[m,C]],[/(shield[\w ]+) b/i],[u,[d,"Nvidia"],[m,C]],[/(sprint) (\w+)/i],[d,u,[m,x]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[d,H],[m,x]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[d,B],[m,C]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[d,B],[m,x]],[/smart-tv.+(samsung)/i],[d,[m,y]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[d,Y],[m,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,K],[m,y]],[/(apple) ?tv/i],[d,[u,P+" TV"],[m,y]],[/crkey/i],[[u,A+"cast"],[d,k],[m,y]],[/droid.+aft(\w+)( bui|\))/i],[u,[d,E],[m,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[d,$],[m,y]],[/(bravia[\w ]+)( bui|\))/i],[u,[d,ie],[m,y]],[/(mitv-\w{5}) bui/i],[u,[d,G],[m,y]],[/Hbbtv.*(technisat) (.*);/i],[d,u,[m,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,ke],[u,ke],[m,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,u,[m,_]],[/droid.+; (shield) bui/i],[u,[d,"Nvidia"],[m,_]],[/(playstation [345portablevi]+)/i],[u,[d,ie],[m,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[d,H],[m,_]],[/((pebble))app/i],[d,u,[m,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[d,P],[m,b]],[/droid.+; (glass) \d/i],[u,[d,k],[m,b]],[/droid.+; (wt63?0{2,3})\)/i],[u,[d,B],[m,b]],[/(quest( \d| pro)?)/i],[u,[d,ae],[m,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[m,w]],[/(aeobc)\b/i],[u,[d,E],[m,w]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[m,x]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[m,C]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,C]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,x]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[p,D+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,h],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[h,we,At]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,we,At],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,oe],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,h],[/\(bb(10);/i],[h,[p,N]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[p,W+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[p,A+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,X],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,h],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,h]]},yt=function(q,de){if(typeof q===s&&(de=q,q=e),!(this instanceof yt))return new yt(q,de).getResult();var se=typeof o!==a&&o.navigator?o.navigator:e,Se=q||(se&&se.userAgent?se.userAgent:r),To=se&&se.userAgentData?se.userAgentData:e,ar=de?ue(Zt,de):Zt,ot=se&&se.userAgent==Se;return this.getBrowser=function(){var _e={};return _e[p]=e,_e[h]=e,at.call(_e,Se,ar.browser),_e[c]=ce(_e[h]),ot&&se&&se.brave&&typeof se.brave.isBrave==i&&(_e[p]="Brave"),_e},this.getCPU=function(){var _e={};return _e[f]=e,at.call(_e,Se,ar.cpu),_e},this.getDevice=function(){var _e={};return _e[d]=e,_e[u]=e,_e[m]=e,at.call(_e,Se,ar.device),ot&&!_e[m]&&To&&To.mobile&&(_e[m]=x),ot&&_e[u]=="Macintosh"&&se&&typeof se.standalone!==a&&se.maxTouchPoints&&se.maxTouchPoints>2&&(_e[u]="iPad",_e[m]=C),_e},this.getEngine=function(){var _e={};return _e[p]=e,_e[h]=e,at.call(_e,Se,ar.engine),_e},this.getOS=function(){var _e={};return _e[p]=e,_e[h]=e,at.call(_e,Se,ar.os),ot&&!_e[p]&&To&&To.platform&&To.platform!="Unknown"&&(_e[p]=To.platform.replace(/chrome os/i,X).replace(/macos/i,oe)),_e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Se},this.setUA=function(_e){return Se=typeof _e===l&&_e.length>I?ke(_e,I):_e,this},this.setUA(Se),this};yt.VERSION=t,yt.BROWSER=Z([p,h,c]),yt.CPU=Z([f]),yt.DEVICE=Z([u,d,m,_,x,y,C,b,w]),yt.ENGINE=yt.OS=Z([p,h]),typeof su!==a?(typeof d1!==a&&d1.exports&&(su=d1.exports=yt),su.UAParser=yt):typeof define===i&&define.amd?define(function(){return yt}):typeof o!==a&&(o.UAParser=yt);var Zo=typeof o!==a&&(o.jQuery||o.Zepto);if(Zo&&!Zo.ua){var zt=new yt;Zo.ua=zt.getResult(),Zo.ua.get=function(){return zt.getUA()},Zo.ua.set=function(q){zt.setUA(q);var de=zt.getResult();for(var se in de)Zo.ua[se]=de[se]}}})(typeof window=="object"?window:su)});var Um=S(M()),_y=()=>{let o=(0,Um.useRef)(null);return(0,Um.useEffect)(()=>{let e=async t=>{o.current?.onMouseUp(t)};return window.addEventListener("contextmenu",e),()=>{window.removeEventListener("contextmenu",e)}},[]),o};var Mr=S(M()),Cy=(0,Mr.forwardRef)((o,e)=>{let{title:t,showConfirmButton:r=!0,showCancelButton:n=!0,confirmButtonText:i,cancelButtonText:a,onConfirm:s,onCancel:l,onClose:c,confirmButtonDisabled:u,cancelButtonDisabled:p,PaperProps:m,children:d,ConfirmButtonProps:h,CancelButtonProps:f,hideCloseButton:_=!1,loading:x,actionRef:C,...y}=o,[b,w]=(0,Mr.useState)(!1),{t:I}=v(),E=async()=>{if(s){w(!0);try{if(!await s())return}catch{}finally{w(!1)}}c?.({},"confirm")},P=async()=>{if(l){w(!0);try{if(!await l())return}catch{}finally{w(!1)}}c?.({},"backdropClick")};return(0,Mr.useImperativeHandle)(C,()=>({submit:E,cancel:P})),Mr.default.createElement(yi,{onClose:c,...y,disableScrollLock:!0,disableRestoreFocus:!0},Mr.default.createElement(L,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",outline:"none"}},Mr.default.createElement(_r,{...m,sx:{overflowY:"auto",maxHeight:"calc(100vh - 32px)",position:"relative",borderRadius:"16px",maxWidth:"768px!important",width:"calc(100vw - 32px)",margin:"0 auto",p:"24px",display:"flex",flexDirection:"column",gap:"24px",boxSizing:"border-box",bgcolor:O=>O.palette.mode==="dark"?"#2C2C2C":"#FFFFFF",...m?.sx}},!_&&Mr.default.createElement(ee,{sx:{padding:"8px",width:"36px",height:"36px",position:"absolute",top:"18px",right:"18px"},onClick:()=>{l?.(),c?.({},"backdropClick")}},Mr.default.createElement(z,{sx:{fontSize:"20px!important"},icon:"Close"})),t&&Mr.default.createElement(T,{sx:{fontSize:"20px",lineHeight:"1.2",textAlign:"left",fontWeight:500}},t),d,r||n?Mr.default.createElement(g,{sx:{flexDirection:"row",justifyContent:"flex-end",gap:"8px",width:"100%"}},n&&Mr.default.createElement(cn,{variant:"outlined",onClick:P,disabled:p||b||x,...f,sx:{borderRadius:"9999px",height:"44px",borderColor:O=>O.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",...f?.sx}},a||I("package__features:context_menu__lite_editor__modal__common__cancel")),r&&Mr.default.createElement(cn,{loading:b||x,variant:"contained",onClick:E,disabled:u,...h,sx:{borderRadius:"9999px",height:"44px",...h?.sx}},i||I("package__features:context_menu__lite_editor__modal__common__confirm"))):null)))});Cy.displayName="LiteModal";var os=Cy;var yy=S(M()),K7=({open:o,title:e,description:t,confirmButtonText:r,onClose:n,onConfirm:i})=>{let{openConfirm:a}=Ra();return(0,yy.useEffect)(()=>{o&&a({title:e,content:t,confirmButtonText:r,confirmDangerColor:!0,contentSx:{lineHeight:"1.4",fontSize:"14px",textAlign:"left",fontWeight:400,color:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},onConfirm:async s=>(s&&await i(),!0),onClose:n})},[r,t,n,i,o,a,e]),null},rs=K7;var by=S(M()),j7=()=>{let{t:o}=v(),{groupData:e,isOpenDeleteGroupConfirm:t,closeDeleteGroupConfirm:r}=Nr(),{refetch:n}=Lo();return by.default.createElement(rs,{open:t,onClose:()=>{r()},title:o("package__features:context_menu__lite_editor__modal__delete_group__title"),description:o("package__features:context_menu__lite_editor__modal__delete_group__description"),confirmButtonText:o("package__features:context_menu__lite_editor__modal__delete_group__button__delete"),onConfirm:async()=>{if(e?.prompt_id){let i=await Ao.deleteContextMenuNode(e.prompt_id,e.parent_prompt_id);if(i.success&&i.data?.data){try{await Ei.getService("CONTEXT_MENU_SUGGEST").removeUsageRecord(e.prompt_id)}catch{}dt.error(o("package__features:chat__inputbox__my_own_tools__modal__group__delete_success"))}else dt.error(o("package__features:chat__inputbox__my_own_tools__modal__delete_error"));await n("LiteContextMenuGroupDeleteConfirm")}return!0}})},Iy=j7;var lr=S(M()),$7=()=>{let{t:o}=v(),e=so(),t=(0,lr.createRef)(),{groupData:r,updateGroup:n,isOpen:i,closeEditor:a,onSuccessCallback:s}=Nr(),{contextMenuPath:l,changeMode:c}=lo(),[u,p]=(0,lr.useState)(!1),[m,d]=(0,lr.useState)(!1),[h,f]=(0,lr.useState)(null),[_,x]=(0,lr.useState)("");(0,lr.useEffect)(()=>{r?.prompt_title&&r?.prompt_title.trim().length>150?f(o("package__features:project__error_msg__folder_name_max_length")):f(null)},[r?.prompt_title,o]);let{refetch:C}=Lo(),y=!r?.prompt_id,b=o(y?"package__features:context_menu__lite_editor__modal__edit_group__title__add":"package__features:context_menu__lite_editor__modal__edit_group__title__edit"),w=async()=>{try{if(p(!0),r){let I=He(r);I.prompt_title&&(I.prompt_title=I.prompt_title.trim());let E=await Ao.addOrUpdateContextMenuGroup(I);return E.data&&E.success?(x(""),await C("LiteContextMenuGroupEditor"),l!=="/my_own_tools"&&c("edit"),s&&y&&s(E.data)):x(E.error),d(!E.success),E.success}return!0}catch{return!1}finally{p(!1)}};return(0,lr.useEffect)(()=>{i?setTimeout(()=>{t.current&&t.current.focus(),y&&t.current?.select()},100):(d(!1),x(""))},[i]),lr.default.createElement(lr.default.Fragment,null,lr.default.createElement(os,{container:e,loading:u,title:b,PaperProps:{sx:{maxWidth:"448px"}},open:i,onConfirm:async()=>await w(),confirmButtonDisabled:!r?.prompt_title||r?.prompt_title.trim()===""||!!h,onClose:()=>{a()},confirmButtonText:o(y?"package__common:create":"package__common:done")},r&&lr.default.createElement(g,{gap:"8px"},lr.default.createElement(Lt,{error:!!h||m,helperText:h||_,inputProps:{style:{fontSize:"16px",textAlign:"left"}},FormHelperTextProps:{sx:{fontSize:"12px"}},inputRef:t,onCopy:I=>{I.stopPropagation()},onCut:I=>{I.stopPropagation()},onPaste:I=>{I.stopPropagation()},onKeyUpCapture:I=>{I.stopPropagation()},onKeyDownCapture:async I=>{I.stopPropagation(),!I.nativeEvent.isComposing&&(I.key==="Enter"&&!I.shiftKey?r&&await w()&&a():I.key==="Escape"&&a())},value:r.prompt_title,onChange:I=>{n({prompt_title:I.target.value})},size:"small",placeholder:o("package__features:context_menu__lite_editor__modal__edit_group__variable_name__label")}))),lr.default.createElement(Iy,null))},Sy=$7;var Fs=S(M()),q7=o=>{let{sx:e,groupData:t,icon:r,onChange:n}=o,{t:i}=v(),{createNewGroup:a,editGroup:s}=Nr(),{isOpen:l}=Nr(),c=(0,Fs.useRef)(!1),u=t?.prompt_id?i("package__features:context_menu__lite_editor__modal__edit_group__title__edit"):i("package__features:context_menu__lite_editor__modal__edit_group__title__add"),p=async()=>{await Fe({emitEvent:!0})&&(c.current=!0,t?.prompt_id?s(t):await a())};return(0,Fs.useEffect)(()=>{!l&&c.current&&(c.current=!1,n?.())},[l,n]),Fs.default.createElement(ee,{disabledClickEvent:!0,placement:"left-end",onClick:p,tooltipProps:{PopperProps:{disablePortal:!0},disableInteractive:!0},title:u,sx:e},typeof r=="string"?Fs.default.createElement(z,{icon:r||"PromptEdit"}):r)},vy=q7;var Di=S(M()),rh=async o=>{let t=(await Ao.getContextMenuChildren(o)).filter(r=>r.type==="group");if(o==="/my_own_tools"){let r=await Ao.getContextMenuByPath(o);r&&(r.prompt_title="",t.unshift(r))}return E_(t,{labelKey:"prompt_title",valueKey:"prompt_id"})},X7=o=>{let{defaultValue:e,onChange:t,contextMenuPath:r,...n}=o,[i,a]=(0,Di.useState)(e||""),s=Di.default.useRef(null),{data:l,isLoading:c,refetch:u}=L2({queryKey:[i2.GET_LITE_CONTEXT_MENU_GROUP,r],queryFn:async()=>{let p=await rh(r);if(p.length>0)return p;let m=await Ao.getContextMenuByPath(r);if(!m)throw new Error("Parent prompt not found");return r!=="/my_own_tools"&&await Ao.addOrUpdateContextMenuGroup({parent_prompt_id:m.prompt_id,prompt_title:"My prompts",prompt_icon:void 0,visibility_settings:{blocked_domains:[],allowed_domains:[],use_allow_list:!1},prompt_id:Eo()}),await rh(r)},enabled:!!r,initialData:[]});return(0,Di.useEffect)(()=>{if(l&&l.length>0){if(s.current){a(s.current.prompt_id),t?.(s.current.prompt_id,s.current),s.current=null;return}l.some(m=>m.value===i)||r!=="/my_own_tools"&&(a(l[0].value),t?.(l[0].value,l[0].origin))}},[l,i]),Di.default.createElement(EC,{value:i,onChange:(p,m)=>{a(p),t?.(p,m.origin)},sx:{padding:0},MenuProps:{slotProps:{paper:{sx:{maxWidth:"720px",textAlign:"left",marginTop:"8px","& > ul":{padding:"8px 0 0 0"}}}}},renderFooter:Di.default.createElement(g,{direction:"row",sx:{justifyContent:"flex-end",alignItems:"center",gap:"8px",padding:"4px",borderTop:"1px solid",borderColor:"border.main"}},Di.default.createElement(vy,{icon:Di.default.createElement(xx,null),onChange:async()=>{let m=(await rh(r)).find(d=>!l.some(h=>h.value===d.value));m?.origin&&(s.current=m.origin,u())},sx:{minWidth:"26px",width:"26px",height:"26px",padding:"4px"}})),loading:c,options:l,...n})},My=X7;var Ty=S(M()),Y7=()=>{let{t:o}=v(),{promptData:e,isOpenDeletePromptConfirm:t,closeDeletePromptConfirm:r}=Oo(),{refetch:n}=Lo();return Ty.default.createElement(rs,{open:t,onClose:()=>{r()},title:o("package__features:context_menu__lite_editor__modal__delete_tool__title"),description:o("package__features:context_menu__lite_editor__modal__delete_tool__description"),confirmButtonText:o("package__features:context_menu__lite_editor__modal__delete_tool__button__delete"),onConfirm:async()=>{if(e?.prompt_id){let i=await Ao.deleteContextMenuNode(e.prompt_id,e.parent_prompt_id);if(i.success&&i.data?.data){try{await Ei.getService("CONTEXT_MENU_SUGGEST").removeUsageRecord(e.prompt_id)}catch{}dt.error(o("package__features:chat__inputbox__my_own_tools__modal__prompt__delete_success"))}else dt.error(o("package__features:chat__inputbox__my_own_tools__modal__delete_error"));await n("LiteContextMenuPromptDeleteConfirm")}return!0}})},wy=Y7;var Hi=S(M()),Z7=o=>{let{onCreateVariable:e,onUpdateVariable:t}=o,{t:r}=v(),{isOpenEditVariableModal:n,closeEditVariableModal:i,editVariable:a,updateVariable:s,saveEditVariable:l,variables:c}=Oi(),[u,p]=(0,Hi.useState)(""),m=Hi.default.createRef(),d=!a.hint?.trim(),h=()=>{let f=He(a);if(f.hint=f.hint.trim(),c.find(x=>x.hint===f.hint&&x.name!==f.name))return p(r("package__features:context_menu__lite_editor__modal__edit_variable__variable_name__error__name_repeated")),!1;if(f.name)l(f),t?.(f);else{let x=p2(f.hint),C={...f,name:x};l(C),e?.(C)}return!0};return(0,Hi.useEffect)(()=>{n&&(p(""),setTimeout(()=>{m.current&&m.current.focus()},100))},[n]),Hi.default.createElement(os,{disableRestoreFocus:!0,title:a.name?r("package__features:context_menu__lite_editor__modal__edit_variable__title__edit"):r("package__features:context_menu__lite_editor__modal__edit_variable__title__add"),open:n,confirmButtonDisabled:d,onClose:()=>{i()},onConfirm:async()=>h(),sx:{zIndex:2147483623}},Hi.default.createElement(g,{gap:"8px"},Hi.default.createElement(T,{fontSize:"16px",fontWeight:500,textAlign:"left",color:"text.primary"},r("package__features:context_menu__lite_editor__modal__edit_variable__variable_name__title")),Hi.default.createElement(Lt,{inputRef:m,error:u!=="",helperText:u,inputProps:{style:{fontSize:"16px",textAlign:"left"}},FormHelperTextProps:{sx:{fontSize:"12px"}},value:a.hint,onChange:f=>{s({...a,hint:f.target.value})},onKeyUpCapture:f=>{f.stopPropagation()},onKeyDown:f=>{f.stopPropagation()},onKeyUp:f=>{f.stopPropagation()},onKeyPress:f=>{f.stopPropagation()},onKeyPressCapture:f=>{f.stopPropagation()},onKeyDownCapture:f=>{if(f.stopPropagation(),!f.nativeEvent.isComposing)if(f.key==="Enter"&&!f.shiftKey){if(f.preventDefault(),d)return;a&&h()&&i()}else f.key==="Escape"&&(f.preventDefault(),i())},size:"small",placeholder:r("package__features:context_menu__lite_editor__modal__edit_variable__variable_name__label")})))},Ey=Z7;var Rr=S(M()),Q7=Jr(({className:o,...e})=>Rr.default.createElement(kn,{...e,classes:{popper:o}}))(({theme:o})=>({[`& > .${Br.tooltip}`]:{backgroundColor:"#fff",color:"rgba(0, 0, 0, 0.87)",maxWidth:"unset",border:"1px solid #E0E0E0",boxShadow:o.shadows[5]},"& button > svg":{color:"rgba(0, 0, 0, 0.87)!important"},'&[data-popper-placement="bottom"] > div':{marginTop:"8px !important"},'&[data-popper-placement="top"] > div':{marginBottom:"8px !important"},[`& > .${Br.arrow}`]:{color:"#fff"}})),J7=o=>{let{variable:e,onClick:t,onDelete:r,onEdit:n}=o,{t:i}=v(),{theme:a}=tn(),[s,l]=(0,Rr.useState)(!1),c=a.palette.mode==="dark",u=PC(e.name,c),p=AC(u,c?.3:.8,c?.1:.3);return Rr.default.createElement("div",null,Rr.default.createElement(Q7,{title:Rr.default.createElement(g,{direction:"row",gap:"4px"},Rr.default.createElement(ee,{placement:"top",tooltipProps:{disableInteractive:!0,PopperProps:{disablePortal:!0}},sx:{width:"20px",height:"20px",minWidth:"20px",borderRadius:"2px"},title:i("package__features:context_menu__lite_editor__modal__edit_variable__title__edit"),onClick:()=>{n&&n()}},Rr.default.createElement(z,{sx:{fontSize:"16px!important"},icon:"PromptEdit"})),Rr.default.createElement(ee,{placement:"top",tooltipProps:{disableInteractive:!0,PopperProps:{disablePortal:!0}},sx:{width:"20px",height:"20px",minWidth:"20px",borderRadius:"2px"},title:i("package__features:context_menu__lite_editor__modal__delete_variable__title__delete"),onClick:()=>{l(!0)}},Rr.default.createElement(z,{sx:{fontSize:"16px!important"},icon:"Delete"}))),placement:"top",PopperProps:{disablePortal:!0}},Rr.default.createElement(le,{key:e.name,sx:{minWidth:"unset",padding:"2px 6px",color:u,bgcolor:p,"&:hover":{color:u,bgcolor:p}},onClick:()=>{t&&t()}},Rr.default.createElement(T,{lineHeight:"20px",fontSize:"14px",fontWeight:400,textAlign:"left",color:"inherit",noWrap:!0,maxWidth:"240px"},`{{${e.hint}}}`))),Rr.default.createElement(os,{PaperProps:{sx:{maxWidth:"448px"}},open:s,onClose:()=>{l(!1)},title:i("package__features:context_menu__lite_editor__modal__delete_variable__title__delete"),confirmButtonText:i("package__features:context_menu__lite_editor__modal__delete_variable__button__delete"),ConfirmButtonProps:{sx:{bgcolor:"#ED5050",color:"white","&:hover":{bgcolor:"rgba(255, 14, 39, 1)",color:"white"}}},onConfirm:async()=>(r&&r(),l(!1),!0)},Rr.default.createElement(T,{lineHeight:"24px",fontSize:"16px",textAlign:"left",color:"text.primary",fontWeight:400},i("package__features:context_menu__lite_editor__modal__delete_variable__description"))))},Py=J7;var Ay=S(k7());var ns=S(M()),eM=o=>{let{sx:e,onInsertVariable:t,children:r}=o,{t:n}=v(),{variables:i,openEditVariableModal:a,deleteVariable:s}=Oi(),{secondaryElementMouseLeave:l,secondaryElementMouseEnter:c,secondaryElementSx:u}=Oo(),p=m=>{a(m)};return ns.default.createElement(g,{onMouseLeave:l,onMouseEnter:c,direction:"row",sx:{flexWrap:"wrap",gap:"8px",alignItems:"center",bgcolor:m=>m.palette.mode==="dark"?"#363839":"#f9f9f9",...u,...e}},i.map(m=>m.hidden||m.type==="select"?null:ns.default.createElement(Py,{variable:m,onClick:()=>t(m),onEdit:()=>p(m),onDelete:()=>{s(m)},key:m.name+m.hint})),ns.default.createElement(le,{sx:{padding:"2px 6px",gap:"4px",display:"flex",alignItems:"center",bgcolor:m=>m.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.06)","&:hover":{bgcolor:m=>m.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.06)"}},onClick:()=>{a({name:"",hint:"",type:"text"})}},ns.default.createElement(T,{lineHeight:"20px",fontSize:"14px",fontWeight:400,textAlign:"left",color:"inherit",noWrap:!0},n("package__features:context_menu__lite_editor__modal__edit_variable__button__new_variable")),ns.default.createElement(me,{title:n("package__features:context_menu__lite_editor__modal__edit_variable__button__new_variable__tooltip"),PopperProps:{disablePortal:!0},disableInteractive:!0},ns.default.createElement(Ay.default,{sx:{fontSize:"12px"}}))),ns.default.createElement(Ey,{onCreateVariable:m=>{t(m)}}),r)},ky=eM;var Yl=S(M()),tM=typeof Element<"u",oM=typeof Map=="function",rM=typeof Set=="function",nM=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView,Wm=(o,e)=>{if(o===e)return!0;if(o&&e&&typeof o=="object"&&typeof e=="object"){if(o.constructor!==e.constructor)return!1;let t,r,n;if(Array.isArray(o)){if(t=o.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!Wm(o[r],e[r]))return!1;return!0}let i;if(oM&&o instanceof Map&&e instanceof Map){if(o.size!==e.size)return!1;for(i=o.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;for(i=o.entries();!(r=i.next()).done;)if(!Wm(r.value[1],e.get(r.value[0])))return!1;return!0}if(rM&&o instanceof Set&&e instanceof Set){if(o.size!==e.size)return!1;for(i=o.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(nM&&ArrayBuffer.isView(o)&&ArrayBuffer.isView(e)){if(t=o.length,t!=e.length)return!1;for(r=t;r--!==0;)if(o[r]!==e[r])return!1;return!0}if(o.constructor===RegExp)return o.source===e.source&&o.flags===e.flags;if(o.valueOf!==Object.prototype.valueOf&&typeof o.valueOf=="function"&&typeof e.valueOf=="function")return o.valueOf()===e.valueOf();if(o.toString!==Object.prototype.toString&&typeof o.toString=="function"&&typeof e.toString=="function")return o.toString()===e.toString();if(n=Object.keys(o),t=n.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,n[r]))return!1;if(tM&&o instanceof Element)return!1;for(r=t;r--!==0;)if(!((n[r]==="_owner"||n[r]==="__v"||n[r]==="__o")&&o.$$typeof)&&!Wm(o[n[r]],e[n[r]]))return!1;return!0}return o!==o&&e!==e};function Ly(o){return o&&o.replace(/&nbsp;|\u202F|\u00A0/g," ").replace(/<br\s*\/>/g,"<br>")}function Oy(o){return o.replace(/(<br\s*\/?>)+$/i,"")}function nh(o){if(!o)return"";let e=o.replace(/<br\s*\/>/gi,"<br>");return/<br>$/i.test(e)?e:e+"<br>"}function By(o){let e=document.createTextNode("");o.appendChild(e);let t=document.activeElement===o;if(e.nodeValue!==null&&t){let r=window.getSelection();if(r!==null){let n=document.createRange();n.setStart(e,e.nodeValue.length),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}o.focus()}}var ac=class extends Yl.Component{constructor(){super(...arguments);this.lastHtml=this.props.html;this.el=typeof this.props.innerRef=="function"?{current:null}:Yl.createRef();this.getEl=()=>(this.props.innerRef&&typeof this.props.innerRef!="function"?this.props.innerRef:this.el).current;this.emitChange=t=>{let r=this.getEl();if(!r)return;let n=Oy(r.innerHTML);if(this.props.onChange&&n!==this.lastHtml){let i=Object.assign({},t,{target:{value:n}});this.props.onChange(i)}this.lastHtml=n};this._recordCompositionPrevElement=null;this._recordCompositionPrevElementParentNode=null}_focusRecordCompositionPrevElement(){if(!this._recordCompositionPrevElement)return;let t=document.createRange(),r=window.getSelection();r&&(this._recordCompositionPrevElement===this.getEl()?t.setStart(this.getEl(),0):this._recordCompositionPrevElement.nextSibling?this._recordCompositionPrevElement.nextSibling.contentEditable==="false"&&this._recordCompositionPrevElementParentNode?t.setStart(this._recordCompositionPrevElementParentNode,Array.from(this._recordCompositionPrevElementParentNode.childNodes).indexOf(this._recordCompositionPrevElement.nextSibling)):t.setStart(this._recordCompositionPrevElement.nextSibling,0):this._recordCompositionPrevElementParentNode&&t.setStart(this._recordCompositionPrevElementParentNode,this._recordCompositionPrevElementParentNode.childNodes.length),t.collapse(!0),r.removeAllRanges(),r.addRange(t),this.getEl()?.focus())}getPreviousElementFromCaret(){let r=(this.getEl()?.getRootNode()||window).getSelection();if(!r?.rangeCount)return null;let n=this.getEl();if(!n)return null;let i=r.getRangeAt(0);if(!n.contains(i.commonAncestorContainer))return null;let a=i.startContainer,s=i.startOffset;if(a===n){if(s===0)return n;if(s<=n.childNodes.length)return n.childNodes[s-1]}return a.nodeType===Node.TEXT_NODE&&s===0?a.previousSibling:null}shouldComponentUpdate(t){let r=this.getEl();if(!r)return!0;let n=Oy(r.innerHTML);return Ly(t.html)!==Ly(n)?!0:this.props.disabled!==t.disabled||this.props.tagName!==t.tagName||this.props.className!==t.className||this.props.innerRef!==t.innerRef||this.props.placeholder!==t.placeholder||!Wm(this.props.style,t.style)}componentDidUpdate(){let t=this.getEl();if(!t)return;let r=nh(this.props.html);r!==t.innerHTML&&(t.innerHTML=r),this.lastHtml=this.props.html,By(t)}componentDidMount(){let t=this.getEl();if(!t)return;let r=nh(this.props.html);r!==t.innerHTML&&(t.innerHTML=r),this.lastHtml=this.props.html,By(t)}render(){let{tagName:t,html:r,innerRef:n,children:i,...a}=this.props,s=nh(r);return Yl.createElement(t||"div",{...a,ref:typeof n=="function"?l=>{n(l),this.el.current=l}:n||this.el,onInput:this.emitChange,onBlur:this.props.onBlur||this.emitChange,onKeyUp:this.props.onKeyUp||this.emitChange,onKeyDown:this.props.onKeyDown||this.emitChange,onCompositionStart:l=>{this._recordCompositionPrevElement=this.getPreviousElementFromCaret(),this._recordCompositionPrevElementParentNode=this._recordCompositionPrevElement?.parentNode||null,this.props.onCompositionStart?.(l)},onCompositionEnd:l=>{l.data||this._focusRecordCompositionPrevElement(),this.props.onCompositionEnd?.(l)},contentEditable:!this.props.disabled,dangerouslySetInnerHTML:{__html:s}},i)}};var Ut=S(M()),iM=o=>{let{promptId:e,error:t,disabled:r,placeholder:n,minHeight:i=80,maxHeight:a=80,sx:s,onData:l,onClose:c,...u}=o,[p,m]=(0,Ut.useState)(!1),{t:d}=v(),{theme:h}=tn(),f=_2(),{template:_,setTemplate:x,variables:C,html:y,setIsDarkMode:b,htmlToTemplate:w}=Oi(),I=(0,Ut.useRef)(null),E=(0,Ut.useRef)(""),P=(0,Ut.useRef)(!1),O=!!e,N=(0,Ut.useMemo)(()=>Qo([{pointerEvents:r?"none":"auto",borderRadius:"8px",display:"flex",flexDirection:"column",width:"100%",border:"1px solid",outline:"0px solid",height:"100%",outlineColor:k=>k.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.12)",borderColor:k=>k.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.12)",boxSizing:"border-box","& > div":{"&:first-of-type":{borderRadius:"8px 8px 0 0"},"&:last-of-type":{borderRadius:"0 0 8px 8px"},padding:"8px",fontFamily:"Roboto, Helvetica, Arial, sans-serif!important"},"&:hover":{outlineColor:k=>k.palette.mode==="dark"?"#fff":"rgba(0, 0, 0,.87)",borderColor:k=>k.palette.mode==="dark"?"#fff":"rgba(0, 0, 0,.87)"},"&:has( > div:active),&:has( > div:focus)":{outlineColor:k=>k.palette.mode==="dark"?"#fff":"rgba(0, 0, 0,.87)",borderColor:k=>k.palette.mode==="dark"?"#fff":"rgba(0, 0, 0,.87)",outlineWidth:1},".prompt-template-input[contenteditable=true]:empty:before":{content:"attr(data-placeholder)",display:"block",color:"#aaa",fontFamily:"Roboto, Helvetica, Arial, sans-serif!important"},".prompt-template-input":{display:"block",outline:"none!important",boxSizing:"border-box",width:"calc(100% - 4px)",minHeight:p?"unset":`${i}px`,height:p?"unset":`calc(95vh - ${O?"364":"447"}px)`,flex:p?1:"unset",overflow:"auto",fontSize:16,lineHeight:1.4,letterSpacing:"0.4px",WebkitUserModify:"read-write-plaintext-only"}},s,t?{"&:":{"--borderColor":k=>`${k.palette.error.main}!important`}}:{}]),[r,i,a,s,t,p,O]);(0,Ut.useEffect)(()=>{b(h.palette.mode==="dark")},[h.palette.mode]);let V=()=>{I.current&&setTimeout(()=>{Y1(I.current,E.current,f)},0)},A=async k=>{if(I.current){let U=I.current.innerText.replace(/\n$/,""),K=E.current;U.startsWith(K)?(E.current=K+`{{${k.hint}}}`,U=E.current+U.slice(K.length)):(E.current=U+`{{${k.hint}}}`,U+=`{{${k.hint}}}`);let H=new Map;C.forEach($=>{H.set($.hint,$.name)}),H.set(k.hint,k.name);let R=/\{\{([^{}]+?)\}\}/g,F=document.createElement("textarea");F.textContent=U;let Y=F.innerHTML;F.remove(),U=Y.replace(R,($,ie)=>{let G=H.get(ie);return G?`{{${G}}}`:$}),x(U),V()}},D=k=>{if(I.current)if(f()?.rangeCount){let K=f()?.getRangeAt(0),H=K?.cloneRange();K&&H&&(K.collapsed&&K.startContainer.parentElement?.tagName==="SPAN"&&K.setStartAfter(K.startContainer.parentElement),H.selectNodeContents(I.current),H.setEnd(K.startContainer,K.startOffset),E.current=H.toString())}else I.current.focus()};(0,Ut.useEffect)(()=>{l?.({template:_,variables:C})},[_,C]),(0,Ut.useEffect)(()=>{setTimeout(()=>{I.current&&(E.current=I.current.innerText,I.current.focus(),Y1(I.current,E.current,f))},100)},[e,p]);let W=()=>Ut.default.createElement(L,{sx:N},Ut.default.createElement(ac,{style:{textAlign:"left"},innerRef:I,html:y,className:"prompt-template-input",id:"prompt-template-input","data-testid":"prompt-template-input","data-placeholder":n,onCopy:k=>{k.stopPropagation()},onCut:k=>{k.stopPropagation()},onPaste:k=>{k.stopPropagation()},onChange:k=>{if(P.current)return;let U=k.target.value;D("onChange"),w(U)},onCompositionStart:k=>{P.current=!0},onCompositionEnd:k=>{if(P.current=!1,!k.data)return;let U=k.target.innerHTML;D("onCompositionEnd"),w(U)},onKeyDownCapture:k=>{k.stopPropagation(),k.key==="Escape"&&(p?m(!1):c?.())},onKeyUpCapture:k=>{k.stopPropagation(),!P.current&&D("onKeyUp")},onKeyDown:k=>{k.stopPropagation()},onKeyUp:k=>{k.stopPropagation()},onMouseUp:()=>{D("onMouseUp")},...u}),Ut.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"end",sx:{padding:"4px!important","&:empty":{display:"none"}}},!p&&Ut.default.createElement(ee,{placement:"top",tooltipProps:{disableInteractive:!0,PopperProps:{disablePortal:!0}},sx:{alignItems:"flex-end",marginLeft:"auto"},title:d("package__features:context_menu__lite_editor__modal__edit_tool__prompt_template__expand"),onClick:()=>{m(!0)},"data-testid":"maxai-prompt-template-input--expand"},Ut.default.createElement(z,{icon:"ExpandContent"}))),Ut.default.createElement(ky,{onInsertVariable:A}));return p?Ut.default.createElement(yi,{open:!0,sx:{position:"fixed",zIndex:2147483622},onClose:()=>{m(!1)}},Ut.default.createElement(_r,{component:"div",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",my:0,boxShadow:"none",overflow:"hidden",height:"95vh",width:"80vw",padding:"24px",alignItems:"center",justifyContent:"center",boxSizing:"border-box"}},Ut.default.createElement(g,{width:"100%",gap:"24px",height:"100%"},Ut.default.createElement(g,{width:"100%",height:0,flex:1},W()),Ut.default.createElement(g,{direction:"row",sx:{flexShrink:0,alignItems:"center",justifyContent:"end",height:"40px"}},Ut.default.createElement(le,{sx:{borderRadius:"9999px"},variant:"contained",onClick:()=>{m(!1)}},d("package__features:context_menu__lite_editor__modal__edit_tool__prompt_template__close")))))):Ut.default.createElement(Ut.default.Fragment,null,W())},Dy=iM;var Dt=S(M()),Hy=He(Qp).filter(o=>o!=="Empty"&&o!=="CopyTextOnly"&&o!=="Loading").map(o=>({label:o,value:o})),aM=({defaultValue:o="",placement:e="bottom-start",tooltipProps:t,onChange:r,disabled:n})=>{let i=so(),{t:a}=v(),s=(0,Dt.useRef)(null),l=(0,Dt.useRef)(null),[c,u]=(0,Dt.useState)(!1),[p,m]=(0,Dt.useState)(""),d=(0,Dt.useMemo)(()=>Hy.filter(_=>_.label.toLowerCase().includes(p.toLowerCase())||_.value.toLowerCase().includes(p.toLowerCase())),[p]),[h,f]=(0,Dt.useState)(()=>Hy.find(_=>_.value===o)||void 0);return(0,Dt.useEffect)(()=>{c?setTimeout(()=>{l.current?.focus()},100):m("")},[c]),Dt.default.createElement(me,{title:a("package__ui:contextmenu_icon_selector__title"),PopperProps:{container:i},...t,disabled:n},Dt.default.createElement("div",{style:{flexShrink:0}},Dt.default.createElement(le,{ref:s,variant:"outlined",sx:{height:"40px",padding:"8px",display:"flex",alignItems:"center",gap:"8px",width:"fit-content",boxSizing:"border-box",borderColor:_=>_.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.12)"},onClick:()=>{n||u(!c)}},h?Dt.default.createElement(z,{sx:{fontSize:"24px"},icon:h.value}):Dt.default.createElement(L,{sx:{bgcolor:_=>_.palette.mode==="dark"?"rgba(255, 255, 255, 0.06)":"rgba(0, 0, 0, 0.06)",width:"24px",height:"24px"}}),Dt.default.createElement(z,{sx:{fontSize:"18px",color:"text.secondary"},icon:c?"ArrowDropUp":"ArrowDropDown"})),Dt.default.createElement(El,{anchorEl:s.current,open:c,placement:e,container:i,onClose:()=>{u(!1)}},Dt.default.createElement(g,{sx:{padding:"8px",gap:"24px"}},Dt.default.createElement(Lt,{onKeyUpCapture:_=>{_.stopPropagation()},onKeyDown:_=>{_.stopPropagation()},onKeyUp:_=>{_.stopPropagation()},onKeyPress:_=>{_.stopPropagation()},onKeyPressCapture:_=>{_.stopPropagation()},inputRef:l,placeholder:a("package__ui:contextmenu_icon_selector__filter_label"),inputProps:{style:{fontSize:"16px",textAlign:"left"}},size:"small",InputProps:{startAdornment:Dt.default.createElement(Ii,{position:"start"},Dt.default.createElement(z,{icon:"Search"}))},value:p,onChange:_=>{m(_.target.value)}}),Dt.default.createElement(g,{direction:"row",sx:{gap:"16px",flexWrap:"wrap",width:"288px",maxHeight:"224px",overflowY:"auto"}},d.map((_,x)=>Dt.default.createElement("div",{key:x},Dt.default.createElement(ee,{title:_.label,tooltipProps:{PopperProps:{disablePortal:!0},disableInteractive:!0},sx:{backgroundColor:_.value===h?.value?"rgba(0, 0, 0, 0.04)":"transparent"},onClick:()=>{f(_),u(!1),r?.(_.value)}},Dt.default.createElement(z,{icon:_.value})))),d.length===0&&Dt.default.createElement(T,{sx:{color:"text.secondary"},textAlign:"center",fontSize:"14px",fontWeight:400,width:"100%"},a("package__ui:contextmenu_icon_selector__no_result")))))))},Fy=aM;var nt=S(M());var Ny=S(M());var sM=()=>{let{t:o}=v(),{isOpenDiscardConfirmModal:e,closeDiscardConfirmModal:t,closeEditor:r}=Oo();return Ny.default.createElement(rs,{open:e,title:o("package__features:context_menu__lite_editor__modal__discard_edits__title"),description:o("package__features:context_menu__lite_editor__modal__discard_edits__description"),confirmButtonText:o("package__common:discard"),onClose:()=>{t()},onConfirm:async()=>(r(),!0)})},Vy=sM;var lM=o=>{let{sx:e}=o,t=so(),{t:r}=v(),{contextMenuPath:n,changeMode:i}=lo(),[a,s]=nt.default.useState(!1),[l,c]=nt.default.useState(""),u=(0,nt.useRef)(null),{updatePrompt:p,closeEditor:m,isOpen:d,createSuccessCallback:h,promptData:f,secondaryElementSx:_,secondaryElementMouseLeave:x,secondaryElementMouseEnter:C,openDiscardConfirmModal:y,originalPromptData:b}=Oo(),{refetch:w}=Lo();(0,nt.useEffect)(()=>{d||(s(!1),c(""))},[d]);let I=$e(f),E=$e(b),[P,O]=(0,nt.useState)(null);(0,nt.useEffect)(()=>{f?.prompt_title&&f?.prompt_title.trim().length>150?O(r("package__features:project__error_msg__folder_name_max_length")):O(null)},[f?.prompt_title,r]);let N=A=>({template:A?.prompt_template?.default?.trim()||"",title:A?.prompt_title?.trim()||"",icon:A?.prompt_icon,variables:A?.variables||[]}),V=()=>{let A=I.current,D=E.current;if(!A||!D)return!1;let W=N(A),k=N(D);return W.template!==k.template||W.title!==k.title||W.icon!==k.icon||!P_(W.variables,k.variables)?(y(),!0):!1};return nt.default.createElement(nt.default.Fragment,null,nt.default.createElement(os,{actionRef:u,container:t,open:d,PaperProps:{sx:{height:"95vh"}},title:f?.prompt_id?r("package__features:context_menu__lite_editor__modal__edit_tool__title__edit"):r("package__features:context_menu__lite_editor__modal__edit_tool__title__add"),confirmButtonDisabled:f?.prompt_template?.default===""||f?.prompt_title?.trim()===""||!!P,onConfirm:async()=>{if(f){let A=He(f);if(A.prompt_title&&(A.prompt_title=A.prompt_title.trim()),A.variables=A.variables.filter(W=>!!(W.hidden||A.prompt_template?.default?.includes(W.name))),!A.parent_prompt_id&&n){let W=await Ao.getContextMenuByPath(n);W&&(A.parent_prompt_id=W.prompt_id)}let D=await Ao.addOrUpdateContextMenu(A);return D.data&&D.success?(h?.(D.data||A),c(""),await w("LiteContextMenuPromptEditor"),n!=="/my_own_tools"&&i("edit")):c(D.error),s(!D.success),D.success}return!0},onClose:(A,D)=>{D!=="confirm"&&V()||m()}},nt.default.createElement(g,{width:"100%",sx:{...e}},nt.default.createElement(g,{gap:"16px"},f&&nt.default.createElement(g,{gap:"4px"},nt.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"space-between"},nt.default.createElement(g,{direction:"row",gap:"4px",alignItems:"center"},nt.default.createElement(T,{fontSize:"16px",fontWeight:500,color:"text.primary"},r("package__features:context_menu__lite_editor__modal__edit_tool__variable_prompt__label"))),nt.default.createElement(g,{direction:"row",gap:"4px",alignItems:"center"},nt.default.createElement(T,{fontSize:"14px",fontWeight:400,color:"text.secondary"},r("package__features:context_menu__lite_editor__modal__edit_tool__variable_prompt__help_1")),nt.default.createElement(T,{href:"https://www.maxai.me/docs/help/my-own-prompts/ai-prompt-writing-guide/",target:"_blank",component:"a",fontSize:"14px",fontWeight:400,color:"text.primary",sx:{textDecoration:"underline",cursor:"pointer"}},r("package__features:context_menu__lite_editor__modal__edit_tool__variable_prompt__help_2")))),nt.default.createElement(Dy,{promptId:f?.prompt_id,onClose:()=>{V()||m()},onData:A=>{p({prompt_template:{default:A.template},variables:A.variables})},placeholder:r("package__features:context_menu__lite_editor__modal__edit_tool__prompt_template__placeholder")}))),nt.default.createElement(g,{onMouseEnter:C,onMouseLeave:x,sx:{gap:"16px",flexWrap:"wrap",width:"100%",pt:"16px",..._}},nt.default.createElement(g,{gap:"4px"},nt.default.createElement(T,{fontWeight:500,fontSize:"16px",color:"text.primary",textAlign:"left"},r("package__features:context_menu__lite_editor__modal__edit_tool__variable_name__label")),nt.default.createElement(g,{direction:"row",gap:"4px"},nt.default.createElement(Fy,{defaultValue:um(f?.prompt_icon),onChange:A=>{p({prompt_icon:A})}}),nt.default.createElement(Lt,{error:!!P||a,helperText:P||l,inputProps:{style:{fontSize:"16px",textAlign:"left"}},FormHelperTextProps:{sx:{fontSize:"12px"}},size:"small",fullWidth:!0,placeholder:r("package__features:context_menu__lite_editor__modal__edit_tool__variable_name__placeholder"),defaultValue:f?.prompt_title||"",onCopy:A=>{A.stopPropagation()},onCut:A=>{A.stopPropagation()},onPaste:A=>{A.stopPropagation()},onKeyDownCapture:A=>{if(!A.nativeEvent.isComposing){if(A.stopPropagation(),A.key==="Escape"){if(V())return;m()}A.key==="Enter"&&f?.prompt_title&&f.prompt_template?.default&&(A.preventDefault(),u.current?.submit())}},onKeyUpCapture:A=>{A.stopPropagation()},onKeyDown:A=>{A.stopPropagation()},onKeyUp:A=>{A.stopPropagation()},onChange:A=>{p({prompt_title:A.target.value})}}))),!f?.prompt_id&&nt.default.createElement(g,{gap:"4px"},nt.default.createElement(T,{fontWeight:500,fontSize:"16px",color:"text.primary",textAlign:"left"},r("package__features:context_menu__lite_editor__modal__edit_tool__variable_parent_group__label")),nt.default.createElement(My,{contextMenuPath:n||"",sx:{width:"100%",height:"40px"},defaultValue:f?.parent_prompt_id||"",onChange:A=>{p({parent_prompt_id:A})}}))))),nt.default.createElement(wy,null),nt.default.createElement(Vy,null))},Ry=lM;var ai=S(M()),pM=o=>{let{defaultContextMenuPath:e,defaultMode:t,children:r,panelId:n}=o,[i,a]=(0,ai.useState)(t||"list"),[s,l]=(0,ai.useState)(e!==void 0?e:null),u={panelId:(0,ai.useRef)(n||Eo()).current,contextMenuPath:s,mode:i,changeMode:a,changeContextMenuPath:l};return ai.default.createElement($_.Provider,{value:u},ai.default.createElement(ai.default.Fragment,null,r,ai.default.createElement(Ry,null),ai.default.createElement(Sy,null)))},is=pM;var Ns=S(M()),$y=S(Vp());var Km=S(M()),cM=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},o(e,t)};return function(e,t){o(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Bo=function(){return Bo=Object.assign||function(o){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n])}return o},Bo.apply(this,arguments)},zy={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},Uy={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},Gm={width:"20px",height:"20px",position:"absolute"},uM={top:Bo(Bo({},zy),{top:"-5px"}),right:Bo(Bo({},Uy),{left:void 0,right:"-5px"}),bottom:Bo(Bo({},zy),{top:void 0,bottom:"-5px"}),left:Bo(Bo({},Uy),{left:"-5px"}),topRight:Bo(Bo({},Gm),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:Bo(Bo({},Gm),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:Bo(Bo({},Gm),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:Bo(Bo({},Gm),{left:"-10px",top:"-10px",cursor:"nw-resize"})},Wy=function(o){cM(e,o);function e(){var t=o!==null&&o.apply(this,arguments)||this;return t.onMouseDown=function(r){t.props.onResizeStart(r,t.props.direction)},t.onTouchStart=function(r){t.props.onResizeStart(r,t.props.direction)},t}return e.prototype.render=function(){return Km.createElement("div",{className:this.props.className||"",style:Bo(Bo({position:"absolute",userSelect:"none"},uM[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},e}(Km.PureComponent);var mM=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},o(e,t)};return function(e,t){o(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Fi=function(){return Fi=Object.assign||function(o){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n])}return o},Fi.apply(this,arguments)},dM={width:"auto",height:"auto"},jm=function(o,e,t){return Math.max(Math.min(o,t),e)},Gy=function(o,e,t){var r=Math.round(o/e);return r*e+t*(r-1)},Zl=function(o,e){return new RegExp(o,"i").test(e)},$m=function(o){return!!(o.touches&&o.touches.length)},fM=function(o){return!!((o.clientX||o.clientX===0)&&(o.clientY||o.clientY===0))},Ky=function(o,e,t){t===void 0&&(t=0);var r=e.reduce(function(i,a,s){return Math.abs(a-o)<Math.abs(e[i]-o)?s:i},0),n=Math.abs(e[r]-o);return t===0||n<t?e[r]:o},ih=function(o){return o=o.toString(),o==="auto"||o.endsWith("px")||o.endsWith("%")||o.endsWith("vh")||o.endsWith("vw")||o.endsWith("vmax")||o.endsWith("vmin")?o:o+"px"},qm=function(o,e,t,r){if(o&&typeof o=="string"){if(o.endsWith("px"))return Number(o.replace("px",""));if(o.endsWith("%")){var n=Number(o.replace("%",""))/100;return e*n}if(o.endsWith("vw")){var n=Number(o.replace("vw",""))/100;return t*n}if(o.endsWith("vh")){var n=Number(o.replace("vh",""))/100;return r*n}}return o},hM=function(o,e,t,r,n,i,a){return r=qm(r,o.width,e,t),n=qm(n,o.height,e,t),i=qm(i,o.width,e,t),a=qm(a,o.height,e,t),{maxWidth:typeof r>"u"?void 0:Number(r),maxHeight:typeof n>"u"?void 0:Number(n),minWidth:typeof i>"u"?void 0:Number(i),minHeight:typeof a>"u"?void 0:Number(a)}},gM=function(o){return Array.isArray(o)?o:[o,o]},xM=["as","ref","style","className","grid","gridGap","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],jy="__resizable_base__",qy=function(o){mM(e,o);function e(t){var r,n,i,a,s=o.call(this,t)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var l=s.parentNode;if(!l)return null;var c=s.window.document.createElement("div");return c.style.width="100%",c.style.height="100%",c.style.position="absolute",c.style.transform="scale(0, 0)",c.style.left="0",c.style.flex="0 0 100%",c.classList?c.classList.add(jy):c.className+=jy,l.appendChild(c),c},s.removeBase=function(l){var c=s.parentNode;c&&c.removeChild(l)},s.state={isResizing:!1,width:(n=(r=s.propsSize)===null||r===void 0?void 0:r.width)!==null&&n!==void 0?n:"auto",height:(a=(i=s.propsSize)===null||i===void 0?void 0:i.height)!==null&&a!==void 0?a:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||dM},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var t=0,r=0;if(this.resizable&&this.window){var n=this.resizable.offsetWidth,i=this.resizable.offsetHeight,a=this.resizable.style.position;a!=="relative"&&(this.resizable.style.position="relative"),t=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:n,r=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:i,this.resizable.style.position=a}return{width:t,height:r}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizeStyle",{get:function(){var t=this,r=this.props.size,n=function(s){var l;if(typeof t.state[s]>"u"||t.state[s]==="auto")return"auto";if(t.propsSize&&t.propsSize[s]&&(!((l=t.propsSize[s])===null||l===void 0)&&l.toString().endsWith("%"))){if(t.state[s].toString().endsWith("%"))return t.state[s].toString();var c=t.getParentSize(),u=Number(t.state[s].toString().replace("px","")),p=u/c[s]*100;return p+"%"}return ih(t.state[s])},i=r&&typeof r.width<"u"&&!this.state.isResizing?ih(r.width):n("width"),a=r&&typeof r.height<"u"&&!this.state.isResizing?ih(r.height):n("height");return{width:i,height:a}},enumerable:!1,configurable:!0}),e.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var t=this.appendBase();if(!t)return{width:0,height:0};var r=!1,n=this.parentNode.style.flexWrap;n!=="wrap"&&(r=!0,this.parentNode.style.flexWrap="wrap"),t.style.position="relative",t.style.minWidth="100%",t.style.minHeight="100%";var i={width:t.offsetWidth,height:t.offsetHeight};return r&&(this.parentNode.style.flexWrap=n),this.removeBase(t),i},e.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},e.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},e.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var t=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:t.flexBasis!=="auto"?t.flexBasis:void 0})}},e.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},e.prototype.createSizeForCssProperty=function(t,r){var n=this.propsSize&&this.propsSize[r];return this.state[r]==="auto"&&this.state.original[r]===t&&(typeof n>"u"||n==="auto")?"auto":t},e.prototype.calculateNewMaxFromBoundary=function(t,r){var n=this.props.boundsByDirection,i=this.state.direction,a=n&&Zl("left",i),s=n&&Zl("top",i),l,c;if(this.props.bounds==="parent"){var u=this.parentNode;u&&(l=a?this.resizableRight-this.parentLeft:u.offsetWidth+(this.parentLeft-this.resizableLeft),c=s?this.resizableBottom-this.parentTop:u.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(l=a?this.resizableRight:this.window.innerWidth-this.resizableLeft,c=s?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(l=a?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),c=s?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return l&&Number.isFinite(l)&&(t=t&&t<l?t:l),c&&Number.isFinite(c)&&(r=r&&r<c?r:c),{maxWidth:t,maxHeight:r}},e.prototype.calculateNewSizeFromDirection=function(t,r){var n=this.props.scale||1,i=gM(this.props.resizeRatio||1),a=i[0],s=i[1],l=this.state,c=l.direction,u=l.original,p=this.props,m=p.lockAspectRatio,d=p.lockAspectRatioExtraHeight,h=p.lockAspectRatioExtraWidth,f=u.width,_=u.height,x=d||0,C=h||0;return Zl("right",c)&&(f=u.width+(t-u.x)*a/n,m&&(_=(f-C)/this.ratio+x)),Zl("left",c)&&(f=u.width-(t-u.x)*a/n,m&&(_=(f-C)/this.ratio+x)),Zl("bottom",c)&&(_=u.height+(r-u.y)*s/n,m&&(f=(_-x)*this.ratio+C)),Zl("top",c)&&(_=u.height-(r-u.y)*s/n,m&&(f=(_-x)*this.ratio+C)),{newWidth:f,newHeight:_}},e.prototype.calculateNewSizeFromAspectRatio=function(t,r,n,i){var a=this.props,s=a.lockAspectRatio,l=a.lockAspectRatioExtraHeight,c=a.lockAspectRatioExtraWidth,u=typeof i.width>"u"?10:i.width,p=typeof n.width>"u"||n.width<0?t:n.width,m=typeof i.height>"u"?10:i.height,d=typeof n.height>"u"||n.height<0?r:n.height,h=l||0,f=c||0;if(s){var _=(m-h)*this.ratio+f,x=(d-h)*this.ratio+f,C=(u-f)/this.ratio+h,y=(p-f)/this.ratio+h,b=Math.max(u,_),w=Math.min(p,x),I=Math.max(m,C),E=Math.min(d,y);t=jm(t,b,w),r=jm(r,I,E)}else t=jm(t,u,p),r=jm(r,m,d);return{newWidth:t,newHeight:r}},e.prototype.setBoundingClientRect=function(){var t=1/(this.props.scale||1);if(this.props.bounds==="parent"){var r=this.parentNode;if(r){var n=r.getBoundingClientRect();this.parentLeft=n.left*t,this.parentTop=n.top*t}}if(this.props.bounds&&typeof this.props.bounds!="string"){var i=this.props.bounds.getBoundingClientRect();this.targetLeft=i.left*t,this.targetTop=i.top*t}if(this.resizable){var a=this.resizable.getBoundingClientRect(),s=a.left,l=a.top,c=a.right,u=a.bottom;this.resizableLeft=s*t,this.resizableRight=c*t,this.resizableTop=l*t,this.resizableBottom=u*t}},e.prototype.onResizeStart=function(t,r){if(!(!this.resizable||!this.window)){var n=0,i=0;if(t.nativeEvent&&fM(t.nativeEvent)?(n=t.nativeEvent.clientX,i=t.nativeEvent.clientY):t.nativeEvent&&$m(t.nativeEvent)&&(n=t.nativeEvent.touches[0].clientX,i=t.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var a=this.props.onResizeStart(t,r,this.resizable);if(a===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var s,l=this.window.getComputedStyle(this.resizable);if(l.flexBasis!=="auto"){var c=this.parentNode;if(c){var u=this.window.getComputedStyle(c).flexDirection;this.flexDir=u.startsWith("row")?"row":"column",s=l.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var p={original:{x:n,y:i,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:Fi(Fi({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(t.target).cursor||"auto"}),direction:r,flexBasis:s};this.setState(p)}},e.prototype.onMouseMove=function(t){var r=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&$m(t))try{t.preventDefault(),t.stopPropagation()}catch{}var n=this.props,i=n.maxWidth,a=n.maxHeight,s=n.minWidth,l=n.minHeight,c=$m(t)?t.touches[0].clientX:t.clientX,u=$m(t)?t.touches[0].clientY:t.clientY,p=this.state,m=p.direction,d=p.original,h=p.width,f=p.height,_=this.getParentSize(),x=hM(_,this.window.innerWidth,this.window.innerHeight,i,a,s,l);i=x.maxWidth,a=x.maxHeight,s=x.minWidth,l=x.minHeight;var C=this.calculateNewSizeFromDirection(c,u),y=C.newHeight,b=C.newWidth,w=this.calculateNewMaxFromBoundary(i,a);this.props.snap&&this.props.snap.x&&(b=Ky(b,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(y=Ky(y,this.props.snap.y,this.props.snapGap));var I=this.calculateNewSizeFromAspectRatio(b,y,{width:w.maxWidth,height:w.maxHeight},{width:s,height:l});if(b=I.newWidth,y=I.newHeight,this.props.grid){var E=Gy(b,this.props.grid[0],this.props.gridGap?this.props.gridGap[0]:0),P=Gy(y,this.props.grid[1],this.props.gridGap?this.props.gridGap[1]:0),O=this.props.snapGap||0,N=O===0||Math.abs(E-b)<=O?E:b,V=O===0||Math.abs(P-y)<=O?P:y;b=N,y=V}var A={width:b-d.width,height:y-d.height};if(h&&typeof h=="string"){if(h.endsWith("%")){var D=b/_.width*100;b=D+"%"}else if(h.endsWith("vw")){var W=b/this.window.innerWidth*100;b=W+"vw"}else if(h.endsWith("vh")){var k=b/this.window.innerHeight*100;b=k+"vh"}}if(f&&typeof f=="string"){if(f.endsWith("%")){var D=y/_.height*100;y=D+"%"}else if(f.endsWith("vw")){var W=y/this.window.innerWidth*100;y=W+"vw"}else if(f.endsWith("vh")){var k=y/this.window.innerHeight*100;y=k+"vh"}}var U={width:this.createSizeForCssProperty(b,"width"),height:this.createSizeForCssProperty(y,"height")};this.flexDir==="row"?U.flexBasis=U.width:this.flexDir==="column"&&(U.flexBasis=U.height);var K=this.state.width!==U.width,H=this.state.height!==U.height,R=this.state.flexBasis!==U.flexBasis,F=K||H||R;F&&(0,$y.flushSync)(function(){r.setState(U)}),this.props.onResize&&F&&this.props.onResize(t,m,this.resizable,A)}},e.prototype.onMouseUp=function(t){var r,n,i=this.state,a=i.isResizing,s=i.direction,l=i.original;if(!(!a||!this.resizable)){var c={width:this.size.width-l.width,height:this.size.height-l.height};this.props.onResizeStop&&this.props.onResizeStop(t,s,this.resizable,c),this.props.size&&this.setState({width:(r=this.props.size.width)!==null&&r!==void 0?r:"auto",height:(n=this.props.size.height)!==null&&n!==void 0?n:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:Fi(Fi({},this.state.backgroundStyle),{cursor:"auto"})})}},e.prototype.updateSize=function(t){var r,n;this.setState({width:(r=t.width)!==null&&r!==void 0?r:"auto",height:(n=t.height)!==null&&n!==void 0?n:"auto"})},e.prototype.renderResizer=function(t){var r=this,n=this.props,i=n.enable,a=n.handleStyles,s=n.handleClasses,l=n.handleWrapperStyle,c=n.handleWrapperClass,u=n.handleComponent;if(!i)return null;var p=t.filter(function(m){return i[m]!==!1}).map(function(m){return i[m]!==!1?Ns.createElement(Wy,{key:m,direction:m,onResizeStart:r.onResizeStart,replaceStyles:a&&a[m],className:s&&s[m]},u&&u[m]?u[m]:null):null});return Ns.createElement("div",{className:c,style:l},p)},e.prototype.render=function(){var t=this,r=Object.keys(this.props).reduce(function(a,s){return xM.indexOf(s)!==-1||(a[s]=t.props[s]),a},{}),n=Fi(Fi(Fi({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(n.flexBasis=this.state.flexBasis);var i=this.props.as||"div";return Ns.createElement(i,Fi({style:n,className:this.props.className},r,{ref:function(a){a&&(t.resizable=a)}}),this.state.isResizing&&Ns.createElement("div",{style:this.state.backgroundStyle}),this.renderResizer(["topLeft","top","topRight","left"]),this.props.children,this.renderResizer(["right","bottomLeft","bottom","bottomRight"]))},e.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],gridGap:[0,0],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},e}(Ns.PureComponent);var Ql=S(Xy());var ve=S(M()),Yy=o=>{let{conversationId:e}=o,t=(0,ve.useRef)(null),[r,n]=(0,ve.useState)([]),i=Dr(()=>{if(t.current){let s=t.current?.querySelector(".max-ai__action_status__loading");s?t.current?.scrollTo({top:s.offsetTop-s.offsetHeight/2-t.current.offsetHeight/2,behavior:"smooth"}):t.current?.scrollTo({top:t.current?.scrollHeight,behavior:"smooth"})}},200);(0,ve.useEffect)(()=>{let{shortcutsEngine:s}=vm(e);if(!s)return;let l=(c,u)=>{let p=He(u.shortcutsEngine.actions);n(p)};return s.addListener(l),()=>{s.removeListener(l)}},[e]),(0,ve.useEffect)(()=>{i()},[r]);let a=(s,l=0)=>s.map((c,u)=>{let p="#ebebeb",m="text.primary";c.status==="running"?(p="primary.main",m="primary.main"):c.status==="error"?(p="error.main",m="error.main"):c.status==="complete"&&(p="success.main",m="success.main");let d=c.type==="ASK_CHATGPT",h=d?c.question:"",f=c.status==="complete",_=f?c.output:c.error;typeof h=="object"&&(h=JSON.stringify(h,null,2)),c.type==="SET_VARIABLES_MODAL"?_=JSON.stringify(c.parameters.SetVariablesModalConfig,null,2):c.type==="SET_VARIABLE_MAP"?_=JSON.stringify(c.parameters.VariableMap,null,2):typeof _=="object"&&(_=JSON.stringify(_,null,2));let x=JSON.stringify(c.parameters,null,2);return ve.default.createElement(g,{key:c.type+u+l,sx:{px:1,alignItems:"center"}},ve.default.createElement(kn,{PopperProps:{disablePortal:!0,sx:{zIndex:2147483647}},placement:"right",title:ve.default.createElement(g,{sx:{maxHeight:500,overflowY:"auto",gap:1}},`[${c.type}]`,d&&ve.default.createElement(g,null,ve.default.createElement(T,{fontSize:"12px",display:"flex",alignItems:"center",gap:1},"[Question]",ve.default.createElement(Fr,{copyText:h,sx:{color:"text.primary",height:"12px"}})),ve.default.createElement(T,{sx:{whiteSpace:"pre-wrap"},fontSize:"12px"},h)),ve.default.createElement(T,{fontSize:"12px",display:"flex",alignItems:"center",gap:1},"[parameters]",ve.default.createElement(Fr,{copyText:x,sx:{color:"text.primary",height:"12px"}})),ve.default.createElement(T,{sx:{whiteSpace:"pre-wrap"},fontSize:"12px"},x),ve.default.createElement(T,{fontSize:"12px",display:"flex",alignItems:"center",gap:1},f?"[Answer]":"[Error]",ve.default.createElement(Fr,{copyText:_,sx:{color:"text.primary",height:"12px"}})),ve.default.createElement(T,{sx:{whiteSpace:"pre-wrap"},fontSize:"12px"},_))},ve.default.createElement(g,{className:c.status==="running"?"max-ai__action_status__loading":"",sx:{width:"100%",border:"1px solid",alignItems:"center",justifyContent:"center",borderColor:p,color:m,fontSize:"12px",borderRadius:"4px",position:"relative",padding:"8px 4px"}},c.status==="running"&&ve.default.createElement(g,{sx:{position:"absolute",right:1,top:1}},ve.default.createElement(Jt,{size:16,thickness:4,color:"inherit",variant:"indeterminate",sx:{color:m}})),ve.default.createElement(g,{direction:"row",alignItems:"center",gap:1,height:16,width:"100%"},c.status!=="idle"&&c.status!=="running"&&ve.default.createElement(Fr,{sx:{flexShrink:0},size:"small",copyText:JSON.stringify(c)}),ve.default.createElement(T,{noWrap:!0,fontSize:"12px"},c.type)))),c.type==="SCRIPTS_CONDITIONAL"&&c.status==="complete"&&ve.default.createElement(g,{direction:"row",gap:1,mt:1},ve.default.createElement(g,null,c.output==="true"?ve.default.createElement(Ql.default,{sx:{fontSize:"11px",mt:.5,transform:"rotate(45deg)",marginLeft:"auto"}}):ve.default.createElement(g,{height:16}),ve.default.createElement(g,{sx:{p:.5,borderRadius:"4px",border:"1px solid",borderColor:c.output==="true"?"success.main":"error.main"}},a(c.parameters.WFConditionalIfTrueActions||[],l+1)),c.output==="true"?ve.default.createElement(Ql.default,{sx:{fontSize:"11px",mt:.5,transform:"rotate(-45deg)",marginLeft:"auto"}}):ve.default.createElement(g,{height:16})),ve.default.createElement(g,null,c.output==="false"?ve.default.createElement(Ql.default,{sx:{fontSize:"11px",mt:.5,transform:"rotate(-45deg)"}}):ve.default.createElement(g,{height:16}),ve.default.createElement(g,{sx:{p:.5,borderRadius:"4px",border:"1px solid",borderColor:c.output==="false"?"success.main":"error.main"}},a(c.parameters.WFConditionalIfFalseActions||[],l+1)),c.output==="false"?ve.default.createElement(Ql.default,{sx:{fontSize:"11px",mt:.5,transform:"rotate(45deg)"}}):ve.default.createElement(g,{height:16}))),c.type!=="SCRIPTS_CONDITIONAL"&&u+1!==s.length&&ve.default.createElement(Ql.default,{sx:{fontSize:"11px",mt:.5}}))});return ve.default.createElement(Au,null,ve.default.createElement(g,{width:"100%",sx:{flexShrink:0,gap:1,overflowY:"auto",maxHeight:500},ref:t},ve.default.createElement(g,null,"ConversationId: ",e),ve.default.createElement(g,{sx:{position:"sticky",top:0,p:1,bgcolor:"background.paper",zIndex:1}},"Actions(count: ",r.length,")"),a(r)))};var Do=S(M());var bM=()=>{let[o,e]=Do.default.useState(!1),{conversationIds:t,chatDocuments:r}=te(n=>({conversationIds:n.conversationIds,chatDocuments:n.chatDocuments}));return Do.default.createElement(g,null,Do.default.createElement(le,{onClick:()=>e(!o)},o?"Collapse":"Expand"),Do.default.createElement(g,{gap:"8px",direction:"row"},Do.default.createElement(g,{width:"66%",gap:"8px",direction:"row",flexWrap:"wrap"},t.map((n,i)=>Do.default.createElement(SM,{expanded:o,key:n,conversationId:n,order:i}))),Do.default.createElement(g,{width:"33%",gap:"8px"},Do.default.createElement(T,{color:"text.primary"},"Chat Documents"),r.map(n=>Do.default.createElement(IM,{expanded:o,key:n.id,chatDocument:n})))))},IM=o=>{let{chatDocument:e,expanded:t}=o,{document:r}=w_(e.maxAIDocumentId);return Do.default.createElement(g,{sx:{width:"100%",border:"1px solid",borderColor:"border.main",padding:"8px",fontSize:"12px",color:"text.primary",gap:"8px",whiteSpace:"pre-wrap",overflow:"auto",wordBreak:"break-all",maxHeight:t?"unset":"auto"}},JSON.stringify(e,null,2),Do.default.createElement("br",null),t&&JSON.stringify(r||{},null,2))},SM=o=>{let{conversationId:e,order:t,expanded:r}=o,n=Ol(e),i=bt(L_(e)),a=bt(gm(e));return Do.default.createElement(g,{sx:{width:"calc(50% - 4px)",border:"1px solid",borderColor:"border.main",padding:"8px",fontSize:"12px",color:"text.primary",gap:"8px",maxHeight:r?"unset":"auto"}},Do.default.createElement("div",null,"conversationId:",Do.default.createElement("br",null),e),Do.default.createElement("div",null,"order: ",t),Do.default.createElement("div",null,"chatBoxLoading: ",i?"\u{1F4AB}":"\u2705"),Do.default.createElement("div",null,"chatBoxShortcutsStatus: ",a),Do.default.createElement(Yy,{conversationId:e}),r&&Do.default.createElement("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-all"}},JSON.stringify(n,null,2)))},Zy=bM;var Yt=S(M()),vM=Qp.reduce((o,e)=>{let t=e[0].toUpperCase();return o[t]||(o[t]=[]),o[t].push(e),o},{}),MM=Qi(Object.entries(vM).map(([o,e])=>({key:o,value:e})),"key","asc"),TM=Object.keys(Mx),wM=TM.reduce((o,e)=>{let t=e[0].toUpperCase();return o[t]||(o[t]=[]),o[t].push(e),o},{}),EM=Qi(Object.entries(wM).map(([o,e])=>({key:o,value:e})),"key","asc"),PM=()=>Yt.default.createElement(g,{gap:"16px"},Yt.default.createElement(g,null,Yt.default.createElement(T,{color:"text.primary",fontSize:20,fontWeight:500},"Contextmenu icons")),Yt.default.createElement(g,null,Yt.default.createElement(Si,{href:"https://mui.com/material-ui/material-icons/?theme=Outlined",target:"_blank"},"MUI icons")),Yt.default.createElement(T,{color:"text.primary"},"Total"),Yt.default.createElement(g,{direction:"row",flexWrap:"wrap",gap:"8px"},Qp.map(o=>Yt.default.createElement(ee,{key:o,onClick:()=>{navigator.clipboard.writeText(o)},title:o,sx:{border:"1px solid",borderColor:"border.main",padding:"0"}},Yt.default.createElement(z,{icon:o,sx:{fontSize:"24px"}})))),MM.map(o=>Yt.default.createElement(g,{key:o.key,gap:"4px"},Yt.default.createElement(T,{color:"text.primary"},o.key),Yt.default.createElement(g,{direction:"row",flexWrap:"wrap",gap:"8px"},o.value.map(e=>Yt.default.createElement(ee,{key:e,onClick:()=>{navigator.clipboard.writeText(`
                        <ContextMenuIcon icon={'${e}'} />
                        `)},sx:{width:"unset",border:"1px solid",borderColor:"border.main",padding:"0 8px",gap:"4px"}},Yt.default.createElement(z,{icon:e,sx:{fontSize:"24px"}}),Yt.default.createElement(T,{color:"text.primary"},e)))))),Yt.default.createElement(It,null),Yt.default.createElement(g,null,Yt.default.createElement(T,{color:"text.primary",fontSize:20,fontWeight:500},"MaxAIIcon icons")),EM.map(o=>Yt.default.createElement(g,{key:o.key,gap:"4px"},Yt.default.createElement(T,{color:"text.primary"},o.key),Yt.default.createElement(g,{direction:"row",flexWrap:"wrap",gap:"8px"},o.value.map(e=>Yt.default.createElement(ee,{key:e,onClick:()=>{navigator.clipboard.writeText(`
                        <${e} />
                      `)},sx:{width:"unset",border:"1px solid",borderColor:"border.main",padding:"0 8px",gap:"4px"}},Yt.default.createElement(Ls,{icon:e.replace("Icon",""),sx:{fontSize:"24px"}}),Yt.default.createElement(T,{color:"text.primary"},e))))))),Qy=PM;var as=S(M()),AM=()=>{let{devShowAuxiliaryLine:o,devAlwaysShowTooltip:e,devAlwaysExpandAllButtons:t,updateQuickAccessDevContent:r}=kC();return as.default.createElement(g,null,as.default.createElement("label",null,as.default.createElement("input",{type:"checkbox",checked:o,onChange:()=>r({showAuxiliaryLine:!o})}),"\u663E\u793A\u8F85\u52A9\u7EBF"),as.default.createElement("label",null,as.default.createElement("input",{type:"checkbox",checked:e,onChange:()=>r({alwaysShowTooltip:!e})}),"\u603B\u662F\u663E\u793Atooltip"),as.default.createElement("label",null,as.default.createElement("input",{type:"checkbox",checked:t,onChange:()=>r({alwaysExpandAllButtons:!t})}),"\u603B\u662F\u5C55\u5F00\u6240\u6709\u6309\u94AE"))},Jy=AM;var aa=S(M()),kM=()=>aa.default.createElement(g,null,aa.default.createElement(g,null,aa.default.createElement(T,null,"Indexed DB")),aa.default.createElement(g,null,aa.default.createElement(le,{onClick:async()=>{await E2(I_,"documents").clear().then(),window.location.reload()}},"Clear Document"),aa.default.createElement(le,{onClick:async()=>{await pn.set({CHROME_EXTENSION_USE_CHAT_GPT_AI_ON_BOARDING_SAVE_KEY:""}),await pn.set({[IC]:""})}},"Clear Onboarding"),aa.default.createElement(le,{onClick:async()=>{await qe.resetOnboardingData()}},"Clear maxai-client Onboarding settings"),aa.default.createElement(le,{onClick:async()=>{await Ei.getService("CONTEXT_MENU_SUGGEST").clearUsageHistory()}},"Clear [CONTEXT_MENU] suggestion"))),e6=kM;var Tr=S(M());var ut=S(M()),ah={thread:1,bufferTokens:0,startSliceRate:1,endSliceRate:1,partOfTextLength:1e3,startSlicePosition:"end"},LM=[{text:"1234567890\u{1F600}1234567890",tokenLimit:5,options:{...ah,partOfTextLength:11}},{text:"a234567890\u{1F600}b234567890\u{1F600}c234567890\u{1F600}d234567890\u{1F600}e234567890\u{1F600}f234567890\u{1F600}g234567890\u{1F600}h234567890\u{1F600}i234567890\u{1F600}j234567890\u{1F600}k234567890\u{1F600}l234567890\u{1F600}m234567890\u{1F600}n234567890\u{1F600}o234567890\u{1F600}p234567890\u{1F600}q234567890\u{1F600}r234567890",tokenLimit:15,options:{...ah,partOfTextLength:11}}],OM=()=>{let[o,e]=(0,ut.useState)(""),[t,r]=(0,ut.useState)(""),[n,i]=(0,ut.useState)(10),[a,s]=(0,ut.useState)("1234567890\u{1F600}1234567890"),[l,c]=(0,ut.useState)({...ah}),[u,p]=(0,ut.useState)(null),m=(0,ut.useCallback)(async()=>{let h=await I0(a,n,l);p(h);let f="";try{encodeURIComponent(h.text),f+=`text \u6821\u9A8C\u6210\u529F\u2705
`}catch{f+=`text \u6821\u9A8C\u5931\u8D25\u274C
`}try{encodeURIComponent(h.origin),f+="origin \u6821\u9A8C\u6210\u529F\u2705"}catch{f+="origin \u6821\u9A8C\u5931\u8D25\u274C"}r(f)},[a,n,l]),d=(0,ut.useMemo)(()=>Dr(m,300),[m]);return(0,ut.useEffect)(()=>{d()},[a,n,l,d]),ut.default.createElement("div",null,ut.default.createElement("div",null,ut.default.createElement("div",null,"demoList:"),ut.default.createElement("div",null,LM.map((h,f)=>ut.default.createElement("button",{key:f,onClick:()=>{s(h.text),i(h.tokenLimit),c(h.options)}},h.description||`demo ${f+1}`)))),ut.default.createElement("div",{style:{display:"flex",gap:10}},ut.default.createElement("div",null,ut.default.createElement("div",null,"originalText:"),ut.default.createElement("textarea",{cols:30,rows:10,value:a,onChange:h=>s(h.target.value)})),ut.default.createElement("div",null,ut.default.createElement("div",null,"tokenLimit:"),ut.default.createElement("input",{type:"number",value:n,onChange:h=>i(Number(h.target.value))})),ut.default.createElement("div",null,ut.default.createElement("div",null,"options:"),ut.default.createElement("textarea",{cols:30,rows:10,value:JSON.stringify(l,null,2),onChange:h=>{try{c(JSON.parse(h.target.value)),e("")}catch(f){e(f instanceof Error?f.message:"unknown error")}}}))),ut.default.createElement("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-all"}},o?ut.default.createElement("span",{style:{color:"red"}},o):JSON.stringify(u,null,2)),ut.default.createElement("div",null,"\u6821\u9A8C\u7ED3\u679C: ",t))},t6=OM;var o6=[{label:"ChatHub",value:"ChatHub"},{label:"ReactComponent",value:"ReactComponent"},{label:"QuickAccess",value:"QuickAccess"},{label:"Storage",value:"Storage"},{label:"Icons",value:"Icons"}],BM=()=>{let[o,e]=Tr.default.useState(o6[0].value);return Tr.default.createElement(g,{sx:{width:"100%",height:"100%",flex:1}},Tr.default.createElement(cx,{value:o,onChange:(r,n)=>{e(n)},variant:"scrollable",scrollButtons:"auto"},o6.map(r=>Tr.default.createElement(px,{key:r.value,value:r.value,label:r.label}))),Tr.default.createElement(sc,{active:o==="ChatHub",keepAlive:!0},Tr.default.createElement(Zy,null)),Tr.default.createElement(sc,{active:o==="ReactComponent"},Tr.default.createElement(t6,null)),Tr.default.createElement(sc,{active:o==="QuickAccess"},Tr.default.createElement(Jy,null)),Tr.default.createElement(sc,{active:o==="Storage"},Tr.default.createElement(e6,null)),Tr.default.createElement(sc,{active:o==="Icons"},Tr.default.createElement(Qy,null)))},sc=o=>{let{active:e,keepAlive:t=!1}=o;return Tr.default.createElement(g,{sx:{width:"100%",height:0,flex:1,display:e?"block":"none",padding:2,textAlign:"left"}},t||e?o.children:null)},r6=BM;var d6=S(i6());var Kt=S(M());var l6=S(rm()),p6=S(a6()),c6=S(s6());var sa=S(M());var Jm=vl(o=>({message:"",type:"info",show:!1,setToast:(e,t)=>o({message:e,type:t,show:!0}),hideToast:()=>o({show:!1})})),sh={info:o=>Jm.getState().setToast(o,"info"),success:o=>Jm.getState().setToast(o,"success"),error:o=>Jm.getState().setToast(o,"error")},WM=()=>{let{message:o,type:e,show:t,hideToast:r}=Jm(),[n,i]=(0,sa.useState)(!1);if((0,sa.useEffect)(()=>{if(t){let l=setTimeout(()=>{i(!0),setTimeout(()=>{r(),i(!1)},200)},1e3);return()=>clearTimeout(l)}},[t,r]),!t)return null;let a=()=>{switch(e){case"success":return"#4caf50";case"error":return"#f44336";default:return"#2196f3"}};return sa.default.createElement(g,{direction:"row",alignItems:"center",gap:1.5,sx:{position:"fixed",bottom:"24px",right:"24px",backgroundColor:"rgba(33, 33, 33, 0.95)",color:"#fff",padding:"10px 16px",borderRadius:"6px",zIndex:2147483701,transition:"all 0.2s ease",opacity:n?0:1,transform:n?"translateY(10px)":"translateY(0)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",fontSize:"14px",fontWeight:500,minWidth:"200px",maxWidth:"400px",backdropFilter:"blur(8px)","&::before":{content:'""',position:"absolute",inset:0,borderRadius:"6px",padding:"1px",background:"linear-gradient(to bottom right, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05))",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude"}}},(()=>{let l={sx:{color:a(),fontSize:20}};switch(e){case"success":return sa.default.createElement(l6.default,{...l});case"error":return sa.default.createElement(p6.default,{...l});default:return sa.default.createElement(c6.default,{...l})}})(),o)},u6=WM;var Gt=S(M());var GM={position:"fixed",border:"2px solid #1976d2",background:"rgba(25, 118, 210, 0.1)",pointerEvents:"none",zIndex:2147483700,boxSizing:"border-box",borderRadius:"4px"},KM={position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"#fff",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",pointerEvents:"none",zIndex:2147483701,left:"16px",bottom:"16px",whiteSpace:"nowrap"},m6=(o,e)=>{let{sourcePathAttribute:t,tooltipConfig:r}=e,[n,i]=(0,Gt.useState)(!1),[a,s]=(0,Gt.useState)(null),l=(0,Gt.useRef)(null),c=(0,Gt.useRef)(null),u=(0,Gt.useRef)(null),p=(0,Gt.useCallback)(P=>o.querySelector('[data-testid="dev-tools-button"]')?.contains(P),[o]),m=(0,Gt.useCallback)(()=>{if(!o||l.current)return;let P=document.createElement("div");return P.id="component-highlight",Object.assign(P.style,GM),o.appendChild(P),l.current=P,P},[o]),d=(0,Gt.useCallback)(()=>{if(!o||c.current)return;let P=document.createElement("div");return P.id="component-tooltip",Object.assign(P.style,KM),o.appendChild(P),c.current=P,P},[o]),h=(0,Gt.useCallback)(P=>{let O=P.getAttribute(t);if(!O||r?.show===!1)return null;let N=O,V="\u6587\u4EF6\u8DEF\u5F84";if(!r?.attribute)return{title:V,content:N};let A=P.getAttribute(r.attribute);return A?(V=r.attribute,N=A,{title:V,content:N}):r.showDefaultInfo?{title:V,content:N}:null},[t,r]),f=(0,Gt.useCallback)(P=>{if(!o)return;let O=l.current||m(),N=c.current||d();if(!O||!N)return;let V=P.getBoundingClientRect();Object.assign(O.style,{left:`${V.left}px`,top:`${V.top}px`,width:`${V.width}px`,height:`${V.height}px`,display:"block"});let A=h(P);if(A){let{title:D,content:W}=A;N.textContent=`${D}: ${W}\uFF08\u6309 C \u590D\u5236\uFF09`,N.style.display="block",u.current=W}else u.current=null,N.style.display="none"},[o,m,d,h]),_=(0,Gt.useCallback)(P=>{if(!n||p(P.target))return;let O=P.target;s(O),f(O)},[n,f,p]),x=(0,Gt.useCallback)(()=>{l.current&&(l.current.style.display="none"),c.current&&(c.current.style.display="none")},[]),C=(0,Gt.useCallback)(()=>{i(!1),s(null),x()},[x]),y=(0,Gt.useCallback)(P=>{C(),requestAnimationFrame(()=>{window.open(P,"_blank")})},[C]),b=(0,Gt.useCallback)(P=>{!n||p(P.target)||(x(),s(null))},[n,x,p]),w=(0,Gt.useCallback)(P=>{if(!n||p(P.target))return;let N=P.target.getAttribute(t);N&&(P.stopPropagation(),P.preventDefault(),y(N))},[n,y,p,t]),I=(0,Gt.useCallback)(P=>{n&&(P.preventDefault(),P.stopPropagation(),i(!1),s(null),x())},[n,x]),E=(0,Gt.useRef)(null);return(0,Gt.useEffect)(()=>{n?sh.success("\u5DF2\u5F00\u542F\u7EC4\u4EF6\u6620\u5C04\u5DE5\u5177"):E.current&&sh.info("\u5DF2\u5173\u95ED\u7EC4\u4EF6\u6620\u5C04\u5DE5\u5177"),E.current=n},[n]),(0,Gt.useEffect)(()=>{let P=O=>{if(O.code==="KeyX"&&O.metaKey&&O.altKey){if(O.preventDefault(),O.stopPropagation(),O.shiftKey){i(!1),s(null),x(),l.current&&(l.current.remove(),l.current=null);return}n?(i(!1),s(null),x()):i(!0)}O.code==="KeyC"&&n&&u.current&&(O.preventDefault(),navigator.clipboard.writeText(u.current).then(()=>{let N=c.current.textContent;c.current.textContent="\u5DF2\u590D\u5236\uFF01",setTimeout(()=>{c.current&&(c.current.textContent=N)},1e3)}).catch(console.error)),O.key==="Escape"&&n&&(i(!1),s(null),x())};return window.addEventListener("keydown",P,!0),()=>{window.removeEventListener("keydown",P,!0)}},[n,x]),(0,Gt.useEffect)(()=>{if(o)return n&&(o.addEventListener("mouseover",_,!0),o.addEventListener("mouseout",b,!0),o.addEventListener("click",w,!0),o.addEventListener("contextmenu",I,!0)),()=>{o.removeEventListener("mouseover",_,!0),o.removeEventListener("mouseout",b,!0),o.removeEventListener("click",w,!0),o.removeEventListener("contextmenu",I,!0)}},[n,_,b,w,I,o]),(0,Gt.useEffect)(()=>()=>{l.current&&(l.current.remove(),l.current=null),c.current&&(c.current.remove(),c.current=null)},[]),{needOpenIDE:n,setNeedOpenIDE:i,currentHoverElement:a}};var ed="maxa-devtools-cache",Jl=vl(o=>({open:!1,setOpen:e=>o({open:e}),position:{x:0,y:0},size:{width:300,height:200},setPosition:e=>o({position:e}),setSize:e=>o({size:e})})),jM=o=>{let t=Math.max(Math.min(o.position.x,window.innerWidth-o.size.width),10),r=Math.max(Math.min(o.position.y,window.innerHeight-o.size.height),10),n=Math.min(o.size.width,window.innerWidth-10),i=Math.min(o.size.height,window.innerHeight-10);return{position:{x:t,y:r},size:{width:n,height:i}}},lh=()=>{let o=Jl(c=>c.open),e=Jl(c=>c.position),t=Jl(c=>c.size),r=Jl(c=>c.setPosition),n=Jl(c=>c.setSize),i=Jl(c=>c.setOpen);return(0,Kt.useEffect)(()=>{pn.getItem(ed).then(c=>{if(c){let{position:u,size:p}=jM(c);r(u),n(p),i(c.open)}})},[]),{position:e,size:t,setPosition:c=>{r(c),pn.setItem(ed,{open:o,position:c,size:t})},setSize:c=>{n(c),pn.setItem(ed,{open:o,position:e,size:c})},setOpen:c=>{i(c),pn.setItem(ed,{open:c,position:e,size:t})},open:o}},$M=o=>{let{sx:e,...t}=o.fabProps||{},{position:r,setPosition:n}=lh(),i=(0,Kt.useRef)(null),a=(0,Kt.useRef)(!1),s=(0,Kt.useRef)(!1),l=(0,Kt.useRef)({x:0,y:0}),c=h=>{if(i.current){a.current=!0;let f=i.current.getBoundingClientRect();l.current={x:h.clientX-f.left,y:h.clientY-f.top}}},u=()=>{s.current||o.onToolsClick()},p=(0,Kt.useCallback)(h=>{if(a.current){s.current=!0;let f=h.clientX-l.current.x,_=h.clientY-l.current.y,x=window.innerWidth-44,C=window.innerHeight-44;n({x:Math.min(Math.max(0,f),x),y:Math.min(Math.max(0,_),C)})}},[a,l,n]),m=()=>{s.current&&(s.current=!1),a.current=!1};(0,Kt.useEffect)(()=>(window.addEventListener("mousemove",p),window.addEventListener("mouseup",m),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m)}),[p]);let d=o.onComponentToIDEClick&&o.needOpenIDE!==void 0;return Kt.default.createElement(rx,{"data-testid":"dev-tools-button",ref:i,size:"small","aria-label":"add",onMouseDown:c,sx:{color:"text.primary",backgroundColor:"background.paper","&:hover":{backgroundColor:"background.paper"},position:"fixed",left:`${r.x}px`,top:`${r.y}px`,width:"44px",height:"44px",cursor:"move",px:1,touchAction:"none",userSelect:"none",zIndex:2047483647,...e},...t},Kt.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"center",gap:1},Kt.default.createElement(d6.default,{onMouseUp:u}),d&&Kt.default.createElement(LC,{onMouseUp:()=>{s.current||o.onComponentToIDEClick&&o.onComponentToIDEClick()},sx:{color:o.needOpenIDE?"text.primary":"text.secondary"}})))},qM=o=>{let{open:e}=o,{position:t,size:r,setSize:n}=lh(),i=_y(),a=(s,l,c,u)=>{let p={width:Math.min(c.offsetWidth,window.innerWidth),height:Math.min(c.offsetHeight,window.innerHeight)};n(p)};return Kt.default.createElement(g,{sx:{position:"fixed",left:`${t.x}px`,top:`${t.y}px`,zIndex:2047483646,display:e?"block":"none"}},Kt.default.createElement(qy,{ref:i,size:r,onResize:a,minWidth:100,minHeight:100,style:{position:"fixed",zIndex:2047483646,display:e?"block":"none"}},Kt.default.createElement(_r,{elevation:3,style:{width:"100%",height:"100%",overflow:"auto",boxSizing:"border-box"},sx:{padding:"36px"}},Kt.default.createElement(r6,null))))},XM={sourcePathAttribute:"debug-open-path",tooltipConfig:{attribute:"data-testid",showDefaultInfo:!1}},YM=()=>{let o=so(),{setOpen:e,open:t}=lh(),{needOpenIDE:r,setNeedOpenIDE:n}=m6(o,XM);return Kt.default.createElement(Kt.default.Fragment,null,Kt.default.createElement(u6,null),Kt.default.createElement($M,{needOpenIDE:r,onToolsClick:()=>e(!t),onComponentToIDEClick:()=>n(!r),fabProps:{variant:"extended",sx:{width:"auto"}}}),Kt.default.createElement(qM,{open:t}))},ZM=()=>Kt.default.createElement(Au,null,Kt.default.createElement(YM,null)),f6=ZM;var ph=xi({key:"ExtensionTourOnBoardingOpened",default:!ao});var on=()=>({extensionTourOnBoardingOpened:bt(ph)}),kR=()=>({setExtensionTourOnBoardingOpened:Qt(ph)});var h6=o=>{let{sigOutMaxAIAccount:e}=Yx();Ro(()=>{Qr.request.use(_0(async()=>{await Ha.checkAccessToken();let t=await Ha.getAccessToken();return wn&&Ha.isTokenExpired(t)&&(t=await Ha.getRefreshToken()),{userId:await zu.getUserId()||"",token:t||""}},["/app/send_mixpanel_log","/app/metrics_mp","/app/uplog",...Object.values(qx),...o??[]])),Qr.response.use(C0(()=>{e()}))})};var lc=class{constructor(){this.cacheStorage=new A1({saveKey:"MAXAI_CLIENT__FEATURES__MARKETING__REWARDS_STATUS",cacheTime:A1.DAILY*2})}async fetchRewardDashboard(){let e=await Qr.fetch("/user/get_referral_dashboard",{method:"GET"});return e.success&&e.data?.data?e.data.data:null}async getRewardDashboard(e=!1){let t=await this.cacheStorage.get();if(e||t.expired){let r=await this.fetchRewardDashboard();r&&(t.data=r,await this.cacheStorage.sync(r))}return t.data}async uploadRewardScreenshot(e){let t=Date.now(),r=new FormData;r.append("file",e);let{success:n,message:i}=await Qr.fetch("/app/upload_review_screenshot",{method:"POST",body:r}),a=Date.now()-t;a<x1.SECOND*2&&await new Promise(l=>setTimeout(l,x1.SECOND*2-a)),n&&await qp.refreshModelUsage();let s=await this.getRewardDashboard(n);return{success:n,data:s,message:i}}async clearRewardDashboard(){await this.cacheStorage.clear()}};s0([$x({cacheArgs:!0})],lc.prototype,"getRewardDashboard",1);var pc=new lc;var cc=S(M());var Vs=vl(o=>({loading:!1,dashboard:null,setLoading:e=>o({loading:e}),setDashboard:e=>o({dashboard:e})})),QM=()=>Vs(),JM=()=>{let{loadModelUsage:o}=Wu(),e=(0,cc.useCallback)(async()=>{Vs.setState({loading:!0});let i=await pc.getRewardDashboard();Vs.setState({loading:!1,dashboard:i})},[]),t=(0,cc.useCallback)(async()=>{Vs.setState({loading:!0});let i=await pc.getRewardDashboard(!0);Vs.setState({loading:!1,dashboard:i})},[]),r=(0,cc.useCallback)(async()=>{await pc.clearRewardDashboard(),Vs.setState({loading:!1,dashboard:null})},[]),n=(0,cc.useCallback)(async i=>{let{success:a,data:s,message:l}=await pc.uploadRewardScreenshot(i);return a?o():dt.error(l),Vs.setState({dashboard:s}),{success:a,data:s,message:l}},[]);return{loadRewardDashboard:e,refreshRewardDashboard:t,clearRewardDashboard:r,uploadRewardScreenshot:n}},g6=()=>{let o=QM(),e=JM();return{...o,...e}};var x6=S(M()),_6=()=>{let{loading:o,dashboard:e,loadRewardDashboard:t,refreshRewardDashboard:r,clearRewardDashboard:n}=g6(),i=$e({loading:o,dashboard:e});(0,x6.useEffect)(()=>{t();let a=(s,l)=>{l.proChatReward&&!i.current.loading&&!i.current.dashboard?.is_webstore_commented&&r()};return qp.addListener("onUsageChange",a),()=>{qp.removeListener("onUsageChange",a)}},[]),V_(()=>{r()}),_m(()=>{n()})};var xr=S(M());var fI=S(dI());var gE=()=>{let o=new Map,e=new qu,t=async(r,n,i)=>{await e.postMessage({event:"Client_ListenProxyWebsocketResponse",data:{data:n,taskId:r,listenerType:i}})};Am(async(r,n)=>{switch(r){case"Client_ListenProxyWebsocket":{let{taskId:i,data:a,type:s}=n;switch(s){case"Open":{let l=new fI.default(a.url,{});return l.onUnpackedMessage.addListener(c=>{t(i,c,"onUnpackedMessage")}),l.onMessage.addListener(async c=>{t(i,c,"onMessage")}),l.onClose.addListener(()=>{t(i,{},"onClose")}),await l.open(),o.set(i,l),{success:!0,data:"success",message:"ok"}}break;case"Close":{let l=o.get(i);return l?(l.removeAllListeners(),await l.close(),o.delete(i),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;case"SendPacked":{let l=o.get(i);return l?(l.sendPacked(a),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;default:return{success:!0,data:"success",message:"ok"}}}break}})},hI=gE;var ap=S(M());var gI=(o,e)=>{for(let t=o.length-1;t>=0;t--){let r=o[t];if(e(r))return r}};var xI=()=>{let o=(0,ap.useRef)(!1),{conversationMessages:e,conversationIdRef:t}=ki(),{createMessage:r}=Li(),n=(0,ap.useRef)(!1),i=(0,ap.useRef)("");return m2(a=>{a.name!=="free"&&(n.current=!0,a.name==="elite"?i.current="You have successfully upgraded to MaxAI Elite.":a.name==="pro"?i.current="You have successfully upgraded to MaxAI Pro.":a.name==="basic"&&(i.current="You have successfully upgraded to MaxAI Basic."))}),(0,ap.useEffect)(()=>{!n.current||!i.current||o.current||t.current&&!gI(e,a=>a.text==="You have successfully upgraded to MaxAI Elite."||a.text==="You have successfully upgraded to MaxAI Pro."||a.text==="You have successfully upgraded to MaxAI Basic.")&&r(t.current,{messageId:Eo(),type:"system",parentMessageId:void 0,text:i.current,meta:{status:"success"}}).then().catch().finally(()=>{o.current=!0})},[e]),null};var vd=S(M()),_I={},Rh=vd.default.createContext({}),CI=()=>(0,vd.useContext)(Rh);var bI=S(bi());var si=S(M()),xE=o=>{let{children:e,onClick:t,link:r,dataTestId:n,tooltip:i,tooltipProps:a,...s}=o,[l,c]=(0,si.useState)(!1),u=Gu("maxai-animation-hover-left-bottom-slide-in",{duration:200});return si.default.createElement(me,{title:i,...a},si.default.createElement(L,null,si.default.createElement(le,{"data-testid":n,component:r?"a":"button",...r?{href:r,target:"_blank"}:{},sx:{minWidth:"unset",textAlign:"center",color:"text.primary",opacity:.55,"&:hover":{opacity:1},[`& .${Y0.root}`]:{borderRadius:"7px"}},onClick:t,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),...s},si.default.createElement(T,{component:"h2",sx:{fontSize:"12px",fontWeight:400,lineHeight:"150%"}},e),l?si.default.createElement(bI.default,{sx:{ml:"4px",fontSize:"16px",color:"inherit",...u}},si.default.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},si.default.createElement("path",{d:"M4.03076 11.9679L11.9687 4.02991M11.9687 4.02991H5.51913M11.9687 4.02991V10.2039",stroke:"currentColor",strokeWidth:"1.24031",strokeLinecap:"round",strokeLinejoin:"round"}))):si.default.createElement(L,{sx:{width:"20px",height:"16px"}}))))},zh=xE;var Md=S(M()),_E=o=>{let{sx:e}=o,{t}=v();return Md.default.createElement(g,{direction:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"center",sx:{position:"absolute",bottom:"16px",left:"50%",transform:"translateX(-50%)",zIndex:1502,...e}},Md.default.createElement(zh,{dataTestId:"maxai--chat-home-view--chat-with-any-content--write",link:`${Zr}/ai-writing-tools/`},t("package__features:home_view__chat_with_any_content__tab__write__title")),Md.default.createElement(zh,{dataTestId:"maxai--chat-home-view--chat-with-any-content--create-image",link:`${Zr}/ai-tools/ai-art/`},t("package__features:home_view__chat_with_any_content__tab__create_image__title")))},Td=_E;var jt=S(M());var CE=30*1e3,II=async(o,e)=>{let{signal:t}=e||{};try{let r=new FormData;r.append("audio_file",o),r.append("feature_name",wn?"immersive_chat":"sidebar"),r.append("prompt_name","Use microphone"),r.append("event_source",t2);let n=new AbortController,i=n.signal;return new Promise(a=>{let s=setTimeout(()=>{n.abort()},CE);Qr.fetch("/gpt/speech_to_text",{signal:t?AbortSignal.any([i,t]):i,method:"POST",body:r}).then(async l=>{clearTimeout(s);let c=await l.data;c.status!=="OK"&&a({status:"error",data:{speechText:""},error:c.detail||""}),a({status:"success",data:{speechText:c?.data?.speech_text||""}})}).catch(l=>{if(l.name==="AbortError"){a({status:"timeout",data:{speechText:""}});return}clearTimeout(s),a({status:"error",data:{speechText:""}})})})}catch{return{status:"error",data:{speechText:""}}}};var hn=S(M()),yE=(o,e,t)=>{let[r,n]=(0,hn.useState)(!1),[i,a]=(0,hn.useState)(!1),[s,l]=(0,hn.useState)(0),[c,u]=(0,hn.useState)(),[p,m]=(0,hn.useState)(),[d,h]=(0,hn.useState)(),f=(0,hn.useCallback)(()=>{let b=setInterval(()=>{l(w=>w+1)},1e3);m(b)},[l,m]),_=(0,hn.useCallback)(()=>{p!=null&&clearInterval(p),m(void 0)},[p,m]),x=(0,hn.useCallback)(()=>{p==null&&navigator.mediaDevices.getUserMedia({audio:o??!0}).then(b=>{n(!0);let w=new MediaRecorder(b,t);u(w),w.start(),f(),w.addEventListener("dataavailable",I=>{h(I.data),w.stream.getTracks().forEach(E=>E.stop()),u(void 0)})}).catch(b=>{e?.(b)})},[p,n,u,f,h,e,t]),C=(0,hn.useCallback)(()=>{c?.stop(),_(),l(0),n(!1),a(!1)},[c,l,n,a,_]),y=(0,hn.useCallback)(()=>{i?(a(!1),c?.resume(),f()):(a(!0),_(),c?.pause())},[c,a,f,_]);return{startRecording:x,stopRecording:C,togglePauseResume:y,recordingBlob:d,isRecording:r,isPaused:i,recordingTime:s,mediaRecorder:c}},SI=yE;var Ho=S(M()),bE=({stream:o,boxStyle:e,barStyle:t,leftMaskStyle:r,rightMaskStyle:n,barWidth:i=2,barGap:a=2})=>{let s=(0,Ho.useRef)(null),[l,c]=(0,Ho.useState)([]),u=(0,Ho.useRef)([]),p=(0,Ho.useRef)(0),{isDarkMode:m,theme:{palette:d}}=tn();(0,Ho.useEffect)(()=>{if(!s.current)return;let x=()=>{if(s.current){let b=s.current.clientWidth,w=i+a,I=Math.floor(b/w);if(p.current===0){let E=Array(I).fill({type:"idle",volume:8});c(E),u.current=[...E],p.current=I}else if(I!==p.current){let E=[...u.current];if(I>p.current){let P={type:"idle",volume:8},V=[...Array(I-p.current).fill(P),...E].slice(-I);c(V),u.current=V}else{let P=E.slice(-I);c(P),u.current=P}p.current=I}}};x();let C=new ResizeObserver(x),y=s.current;return C.observe(y),()=>{y&&C.unobserve(y),C.disconnect()}},[i,a]);let h=(0,Ho.useRef)(new Uint8Array(0));(0,Ho.useEffect)(()=>{if(!o)return;let x=window.AudioContext||window.webkitAudioContext,C=new x,y=C.createMediaStreamSource(o),b=C.createAnalyser();b.fftSize=2048,b.smoothingTimeConstant=.5,h.current=new Uint8Array(b.frequencyBinCount),y.connect(b);let w,I=()=>{b.getByteFrequencyData(h.current);let E={type:"idle",volume:3},P=14,O=Math.min(140,h.current.length-1),N=0,V=0;for(let Y=P;Y<=O;Y++)N+=h.current[Y],V++;let A=V>0?N/V:0,D=8,W=24,k=W-D,U=A/255,H=Math.pow(U,.8),R=Math.max(D,Math.min(W,D+Math.round(k*H)));E.type="recording",E.volume=R;let F=u.current;F.length!==0&&(F.shift(),F.push(E),c([...F]),w=requestAnimationFrame(I))};return w=requestAnimationFrame(I),()=>{cancelAnimationFrame(w),b.disconnect(),y.disconnect(),C.close().catch(console.error)}},[o]);let f=(0,Ho.useMemo)(()=>W1(d.background.paper,0),[d.background.paper]),_=(0,Ho.useMemo)(()=>W1(d.background.paper,1),[d.background.paper]);return Ho.default.createElement("div",{ref:s,style:{flex:1,height:"32px",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",gap:`${a}px`,...e}},l.map((x,C)=>{let y=m?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",b=x.type==="recording";return Ho.default.createElement("div",{key:C,style:{width:`${i}px`,height:`${x.volume}px`,backgroundColor:b?d.primary.main:y,borderRadius:"1px",flexShrink:0,...t}})}),Ho.default.createElement("div",{style:{position:"absolute",left:0,top:0,width:"12px",height:"100%",background:`linear-gradient(to left, ${f}, ${_})`,pointerEvents:"none",...r}}),Ho.default.createElement("div",{style:{position:"absolute",right:0,top:0,width:"12px",height:"100%",background:`linear-gradient(to right, ${f}, ${_})`,pointerEvents:"none",...n}}))},vI=(0,Ho.memo)(bE);var EI=S(Cr()),PI=S(MI());var Ge=S(M()),AI=S(Vp());var sp=S(M()),TI=(0,sp.createContext)({isVoiceInput:!1,setIsVoiceInput:()=>{},isUseInternalState:!0}),wI=()=>(0,sp.useContext)(TI),ls=({children:o,value:e})=>sp.default.createElement(TI.Provider,{value:e},o);var ME=6*60,Uh=o=>o===3||o===4||o===5||o===6,TE=async(o,e,t={canceled:!1})=>{let n=new Set,i=window.AudioContext||window.webkitAudioContext,a=new i,s=a.createMediaStreamSource(o),l=a.createAnalyser();l.fftSize=2048,s.connect(l);let c=new Uint8Array(l.frequencyBinCount),u=!1,p=()=>{l.getByteTimeDomainData(c);for(let h of Array.from(c))if(n.add(h),h>138||h<118){u=!0;break}},m=a.currentTime,d=e;return new Promise(h=>{let f=()=>{if(p(),u||a.currentTime-m>=d||t.canceled){a.close(),h(u);return}setTimeout(f,100)};f()})},wE="max-ai__actions__button--voice-input",EE=o=>{let{sx:e,onStartRecording:t,onStopRecording:r,onVoiceInputStatusChange:n,onSpeechToTextSuccess:i,onSpeechToTextFinally:a,disabled:s,...l}=o,{t:c}=v(),{conversationId:u,inputMediator:p}=Ce(),m=ge(u),[d,h]=(0,Ge.useState)(""),[f,_]=(0,Ge.useState)(!1),[x,C]=(0,Ge.useState)(0),{startRecording:y,stopRecording:b,recordingBlob:w,isRecording:I,mediaRecorder:E,recordingTime:P}=SI(void 0,()=>{C(3)}),O=(0,Ge.useRef)(0);P&&(O.current=P);let N=$e(n),V=(0,Ge.useRef)(new AbortController),A=(0,Ge.useMemo)(()=>({0:c("package__features:chat__inputbox__button__voice_input__idle__tooltip"),1:c("package__features:chat__inputbox__button__voice_input__done__tooltip"),2:c("package__features:chat__inputbox__button__voice_input__transcribing__tooltip"),3:c("package__features:chat__inputbox__button__voice_input__permission_denied__tooltip"),4:c("package__features:chat__inputbox__button__voice_input__no_speech__tooltip"),5:c("package__features:chat__inputbox__button__voice_input__timeout__tooltip"),6:d})[x],[x,d,c]),D=(0,Ge.useMemo)(()=>Uh(x)||f,[x,f]),W=(0,Ge.useRef)(!1),k=(0,Ge.useRef)(x),U=(0,Ge.useRef)(!1),K=(0,Ge.useRef)(null),H=(0,Ge.useCallback)(()=>{K.current&&(K.current.getTracks().forEach(we=>we.stop()),K.current=null)},[]),R=$e(t),F=(0,Ge.useCallback)(async()=>{try{if(U.current)return;U.current=!0,K.current=await navigator.mediaDevices.getUserMedia({audio:!0}),U.current=!1,O.current=0,V.current=new AbortController,y(),C(1),R.current?.()}catch{C(3),U.current=!1}},[R,y]),Y=$e(r),$=(0,Ge.useCallback)(we=>{b(),H(),C(2),Y.current?.(we)},[Y,b,H]),ie=async()=>{I?$("done"):await F()},G=async we=>{we.key==="Enter"?I?$("done"):await F():we.key==="Escape"&&I&&(b(),H(),C(0),Y.current?.("cancel"),we.stopPropagation())},B=()=>{_(!0)},ae=()=>{_(!1)};(0,Ge.useEffect)(()=>{if(k.current=x,Uh(x)){let we=setTimeout(()=>{C(tt=>Uh(tt)?0:tt)},3e3);return()=>{clearTimeout(we)}}},[x]),(0,Ge.useEffect)(()=>{N.current?.(x)},[N,x]),(0,Ge.useEffect)(()=>{if(I&&E){let we=ME,tt=setInterval(()=>{we--,we<=0&&I&&$("timeout")},1e3),At={canceled:!1};return TE(E.stream,5,At).then(Zt=>{Zt||(C(yt=>yt===1?4:yt),b(),H(),k.current!==2&&Y.current?.("timeout"))}).catch(Zt=>{}),()=>{At.canceled=!0,clearTimeout(tt)}}},[$,I,E,b,H,Y]);let X=$e(i),oe=$e(a);(0,Ge.useEffect)(()=>{if(w&&x===2&&!W.current){W.current=!0;let we=new File([w],"audio.webm",{type:"audio/webm"});II(we,{signal:V.current.signal}).then(tt=>{if(tt.status==="success"){let At=tt.data.speechText;X.current?X.current(At):p.updateInputValue(p.getInputValue()+At),(0,AI.flushSync)(()=>{C(0)})}else tt.status==="timeout"?C(5):tt.error?(h(tt.error),C(6)):C(0)}).catch().finally(()=>{W.current=!1,oe.current?.()})}},[p,X,oe,w,x]);let ue=(0,Ge.useMemo)(()=>({height:"30px"}),[]),Z=x!==0&&x!==3&&x!==4,J=x===2,{isVoiceInput:j,setIsVoiceInput:ce,isUseInternalState:ke}=wI();(0,Ge.useEffect)(()=>{ce(Z)},[Z,ce]);let at=ke?Z:j;return m?null:Ge.default.createElement(g,{direction:"row",spacing:1,flex:at?1:void 0,justifyContent:"flex-end",overflow:"hidden"},at&&Ge.default.createElement(Ge.default.Fragment,null,Ge.default.createElement(ee,{title:c("package__common:cancel"),placement:"top",variant:"secondary",onClick:()=>{V.current.abort(),b(),H(),C(0),Y.current?.("cancel")}},Ge.default.createElement(EI.default,null)),Ge.default.createElement(g,{direction:"row",gap:1,sx:{flex:1,alignItems:"center",justifyContent:"center",height:"32px",overflow:"hidden"}},Ge.default.createElement(vI,{stream:E?.stream,boxStyle:ue}),Ge.default.createElement(T,{sx:{fontSize:"14px",color:"text.primary"}},e_(O.current)))),Ge.default.createElement(me,{key:x,title:A,open:D,onOpen:B,onClose:ae,disableInteractive:!0},Ge.default.createElement("span",null,Ge.default.createElement(cn,{onKeyDownCapture:G,tabIndex:-1,loading:J,onClick:ie,id:"MaxAISidebarVoiceInputButton",variant:"contained","data-testid":wE,disabled:J||s,sx:{width:32,height:32,minWidth:"unset",borderRadius:1,boxSizing:"border-box",boxShadow:"none",[`&.${Xp.loading}`]:{backgroundColor:"transparent"},[`& .${Xp.loadingIndicator}`]:{color:"text.secondary"},...e},...l},at?Ge.default.createElement(z,{icon:"Done",sx:{color:"inherit!important",fontSize:"20px"}}):Ge.default.createElement(PI.default,{sx:{color:"inherit!important",fontSize:"20px"}})))))},lp=EE;var kI=S(vc()),LI=S(Wh()),la=S(M()),DE=o=>{let{onSpeechToTextSuccess:e,voiceButtonProps:t,loading:r,inputMediator:n,onSend:i,...a}=o,{t:s}=v(),{conversationId:l}=Ce(),c=ge(l),u=Hl(n),{askAIQuestionV2:p,stopGenerate:m}=Re(),d=u.getInputValue(),{localSettings:h}=_t(),{loading:f}=ja(),{loading:_}=rC(),x=r||c;(0,la.useEffect)(()=>{x||y.current?.closeTooltip()},[x]);let C=async()=>{if(!await Fe({emitEvent:!0})){u.focus();return}f||_||(x?m?.():d&&(await p({type:"user",text:d,meta:{includeHistory:!0}}),i?.()))},y=(0,la.useRef)(null);return h.chatMode==="pro_chat"&&d===""&&!x?la.default.createElement(lp,{onSpeechToTextSuccess:e,...t}):la.default.createElement(ee,{title:f||_?"":s(x?"package__features:chat__inputbox__button__stop_generating__tooltip":"package__features:chat__inputbox__button__send_to_ai__tooltip"),description:x?void 0:"\u23CE",tooltipProps:{controlsRef:y,sx:{minWidth:"unset",p:1},disableInteractive:!0},onBlur:()=>{y.current?.closeTooltip()},variant:"contained","data-testid":"sidebar_actions__send_btn",sx:{width:32,height:32,minWidth:"unset",borderRadius:1,boxSizing:"border-box","&[disabled]":{color:"background.paper"},"&:hover":{color:b=>b.palette.mode==="dark"?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 1)"}},disabled:f||_||!d&&!x,onClick:C,styleType:"default",...a},x?la.default.createElement(LI.default,{sx:{fontSize:"16px",color:"inherit !important"}}):la.default.createElement(kI.default,{sx:{fontSize:"16px",color:"inherit !important"}}))},pp=DE;var or=S(M()),ps=24,Gh=0,HE=o=>{let e=o||window.innerHeight*.4;return Math.max(Math.floor(e/ps),5)},Mc=(o,e)=>{let t=o?.parentElement;if(o&&t){let r=window.getComputedStyle(o),n=Number(o.getAttribute("data-min-line"))||1,i=parseInt(r.paddingTop??Gh,10)+parseInt(r.paddingBottom??Gh,10);o.style.cssText="height:0px";let a=o.value?o.scrollHeight:ps*n+i,s=o?.previousElementSibling?.offsetHeight||0,l=Math.min(ps*HE(e),a),c=Math.max(ps*n+i,s),u=Math.max(c,l);o.style.cssText=`height: ${u}px`,t.style.cssText=`height: ${u}px`}},FE=(o,e)=>{Mc(o,e),setTimeout(()=>{if(Mc(o,e),!o)return;let t=o.value;o.focus(),o.setSelectionRange(t.length,t.length)},100)},NE=(o,e)=>{if(!o)return;let t=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(t?.nextElementSibling&&t.nextElementSibling.getAttribute("tabindex")==="-1"&&t.nextElementSibling.removeAttribute("tabindex"),window.location.host==="www.linkedin.com"){let n=document.querySelector('div[tabindex="-1"][role="dialog"]');n&&(n.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{n.setAttribute("tabindex","-1")},100))}let r=document.activeElement;r?.shadowRoot&&(r=r.shadowRoot.activeElement),(!r||!o.isSameNode(r))&&FE(o,e)},OI=(0,or.forwardRef)((o,e)=>{let{t}=v(),{loading:r,value:n,placeholder:i=t("package__features:chat__input__chat__placeholder"),onChange:a,onChangeText:s,onPasteFiles:l,onPaste:c,onEnter:u,sx:p,stopPropagation:m=!0,minLine:d=1,maxHeight:h,...f}=o,_=(0,or.useRef)(null),x=Wx(_,e),C=(0,or.useRef)(!1),y=(0,or.useMemo)(()=>oi(Mc,200),[]),b=(0,or.useCallback)(I=>{let E=I.target.value;a?.(I),s?.(E)},[a,s]);(0,or.useEffect)(()=>{y(_.current,h);let I=setTimeout(()=>{Mc(_.current,h)},0);return()=>clearTimeout(I)},[n,h,y]),(0,or.useEffect)(()=>{let I=()=>{Mc(_.current,h)};return window.addEventListener("resize",I),()=>{window.removeEventListener("resize",I)}},[h]);let w=(0,or.useCallback)((I,E)=>{if(!C.current&&!(I.key==="Enter"&&I.shiftKey)){if(I.key==="Enter"){I.preventDefault(),u?.(E);return}if(I.code==="Space"){I.stopPropagation();return}}},[u,C]);return or.default.createElement(L,{component:"div",className:r?"chat-box__input--loading":"",borderRadius:1,width:"100%",minHeight:ps*d+Gh*2,sx:{overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...p}},or.default.createElement(L,{component:"div",className:"chat-box__input-skeleton"},or.default.createElement(vt,{height:ps})),or.default.createElement(L,{component:"textarea",sx:{boxSizing:"border-box",display:"block",maxHeight:r?ps*d+16:"unset",color:I=>I.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",fontSize:"16px",lineHeight:ps+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::placeholder":{fontWeight:"400",color:I=>I.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)"},"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}},placeholder:i,disabled:r,ref:x,value:n,rows:1,"data-min-line":d,onCopy:I=>{I.stopPropagation()},onCut:I=>{I.stopPropagation()},onPaste:I=>{if(I.stopPropagation(),c&&c(I),l){let E=I.clipboardData,P=Array.from(E?.items||[]).map(O=>O.getAsFile?.()).filter(O=>O!==null);P&&P.length>0&&(I.preventDefault(),l(P,I))}},onKeyUp:I=>{m&&I.stopPropagation()},onKeyPress:I=>{m&&I.stopPropagation()},onKeyDown:I=>{m&&I.stopPropagation(),w(I,I.currentTarget.value)},onClick:I=>{NE(I.currentTarget,h)},onCompositionUpdate:I=>{m&&I.stopPropagation()},onCompositionStart:I=>{m&&I.stopPropagation(),C.current=!0},onCompositionEnd:I=>{m&&I.stopPropagation(),C.current=!1,b(I)},onInput:I=>{m&&I.stopPropagation(),C.current?s?.(I.currentTarget.value):b(I)},onBlur:I=>{y(I.currentTarget,h)},...f}))});OI.displayName="AutoHeightTextarea";var cp=OI;var Ad=class{async sendUserAction(e,t){let r=await Qr.fetch("/user/send_user_action",{method:"POST",body:JSON.stringify({action:e,...t})});return r.data?.paywall&&(r.data.info&&(r.data.paywall.info=r.data.info),Object.keys(r.data.paywall).forEach(n=>{let i=n,a=r.data?.paywall?.[i]||{};Object.keys(a).length===0&&delete r.data?.paywall?.[i]})),r.data}};var VE=new Ad,Us=VE;var DI=S(BI());var Ie=S(M()),WE=(o,e)=>o.left<=e.right&&o.right>=e.left&&o.top<=e.bottom&&o.bottom>=e.top,GE=(o,e)=>!(o.left>=e.left&&o.right<=e.right&&o.top>=e.top&&o.bottom<=e.bottom),KE=o=>{let{total:e,remaining:t}=o;return Ie.default.createElement(g,{direction:"row",sx:{width:"100%",gap:"2px"}},Array.from({length:e},(r,n)=>Ie.default.createElement(L,{key:n,sx:{flex:1,height:"4px",bgcolor:i=>i.palette.mode==="light"?n<t?"primary.main":"#d9d9d9":n<t?"primary.main":"#4f4f4f",borderRadius:"2px"}})))},jE=o=>{let{total:e,remaining:t}=o;return Ie.default.createElement(L,{position:"relative"},Ie.default.createElement(L,{sx:{flex:1,height:"4px",bgcolor:r=>r.palette.mode==="light"?"#d9d9d9":"#4f4f4f",borderRadius:"2px"}}),Ie.default.createElement(L,{sx:{position:"absolute",top:0,width:`${t/e*100}%`,height:"4px",bgcolor:"primary.main",borderRadius:"2px"}}))},Kh=()=>{let{t:o}=v(),{modelUsage:e}=Mi(),{showPricingHooksPopup:t}=Ml(),r=te(n=>n.conversationIds[0]);return Ie.default.createElement(g,{sx:{gap:"8px",width:"100%"}},Ie.default.createElement(T,{sx:{fontSize:"18px",fontWeight:500,color:"text.primary",textAlign:"left",lineHeight:1.5}},"Pro chat"),Ie.default.createElement(T,{sx:{fontSize:"14px",fontWeight:400,color:"text.secondary",textAlign:"left",lineHeight:1.4}},o("package__features:chat__pro_chat_switch__usage_card__description")),Ie.default.createElement(g,{sx:{padding:"8px 0 16px 0",gap:"8px",width:"100%"}},e.proChatReward?Ie.default.createElement(Ie.default.Fragment,null,Ie.default.createElement(jE,{total:Fu+M1,remaining:e.proChat+e.proChatReward}),Ie.default.createElement(g,{direction:"row",alignItems:"center",gap:1},Ie.default.createElement(T,{sx:{fontSize:"14px",fontWeight:400,color:e.proChat+e.proChatReward<=0?"#f44336":"text.secondary",textAlign:"left",lineHeight:1.4}},o("package__features:chat__pro_chat_switch__usage_card__daily_left_single__title",{LEFT_COUNT:e.proChat+e.proChatReward,NAME:e.proChat+e.proChatReward<=1?"Pro chat":"Pro chats"})),Ie.default.createElement(wx,{title:Ie.default.createElement(g,{minWidth:250},Ie.default.createElement(T,{fontSize:"14px",fontWeight:600,mb:1},o("package__features:chat__pro_chat_switch__usage_card__daily_left_single__title",{LEFT_COUNT:"",NAME:"Pro chats"})),Ie.default.createElement(g,{direction:"row",justifyContent:"space-between",gap:1,mb:.5},Ie.default.createElement(T,{fontSize:"14px",color:"rgba(255, 255, 255, 0.7)"},o("package__features:chat__pro_chat_switch__usage_card__daily_free__title")),Ie.default.createElement(T,{fontSize:"14px",color:"rgba(255, 255, 255, 0.7)"},e.proChat," / ",Fu)),Ie.default.createElement(g,{direction:"row",justifyContent:"space-between",gap:1},Ie.default.createElement(T,{fontSize:"14px",color:"rgba(255, 255, 255, 0.7)"},o("package__features:chat__pro_chat_switch__usage_card__rewarded__title")),Ie.default.createElement(T,{fontSize:"14px",color:"rgba(255, 255, 255, 0.7)"},e.proChatReward," /"," ",M1))),arrow:!0},Ie.default.createElement(DI.default,{sx:{fontSize:18,color:"text.secondary"}})))):Ie.default.createElement(Ie.default.Fragment,null,Ie.default.createElement(KE,{total:Fu,remaining:e.proChat}),Ie.default.createElement(T,{sx:{fontSize:"14px",fontWeight:400,color:e.proChat<=0?"#f44336":"text.secondary",textAlign:"left",lineHeight:1.4}},o("package__features:chat__pro_chat_switch__usage_card__daily_left_single__title",{LEFT_COUNT:e.proChat,NAME:e.proChat<=1?"Pro chat":"Pro chats"})))),Ie.default.createElement(le,{variant:"contained",sx:{width:"100%",minHeight:"44px",gap:1},onClick:async n=>{Bs("click",{paywallType:"pro_chat_card",paywallReason:"ProChat",buttonType:"upgrade",targetElement:n?.currentTarget});let i=await Us.sendUserAction("click_upgrade_cta_pro_chat");i?.paywall&&t(r,i.paywall,"pro_chat_modal")}},Ie.default.createElement(Bu,{sx:{fontSize:"20px",color:"inherit"}}),Ie.default.createElement(T,{sx:{fontSize:"16x",fontWeight:500,textAlign:"left",color:"inherit"}},o("package__features:chat__pro_chat_switch__usage_card__button__upgrade",{NAME:"Pro chat"}))))},$E=o=>{let{children:e}=o,[t,r]=(0,Ie.useState)("bottom-start"),n=(0,Ie.useMemo)(()=>ux(t,8),[t]),i=Ie.default.useRef(null),a=Ie.default.useRef(null),[s,l]=Ie.default.useState(!1),c=Ie.default.useRef({width:320,height:240}),{paywallShowDebounce:u}=za(),p=()=>{let d=c.current;if(i.current){let h=i.current.getBoundingClientRect(),f={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight},x=[{placement:"bottom-start",top:h.bottom+8,bottom:h.bottom+d.height+8,left:h.left,right:d.width+h.left},{placement:"top-start",top:h.top-d.height-8,bottom:h.top-8,left:h.left,right:d.width+h.left},{placement:"left",left:h.left-d.width-8,right:h.left-8,top:h.top-d.height/2-20,bottom:h.top+d.height/2},{placement:"right",...d,left:h.right+8,right:h.right+d.width+8,top:h.top-d.height/2,bottom:h.top+d.height/2},{placement:"left",left:h.left-d.width-8,right:h.left-8,top:0,bottom:d.height},{placement:"right",...d,left:h.right+8,right:h.right+d.width+8,top:0,bottom:d.height}].find(C=>!GE(C,f)&&!WE(C,h));r(x?.placement||"top")}};(0,Ie.useEffect)(()=>{s&&u({paywallType:"pro_chat_card",paywallReason:"ProChat"})},[s,u]);let m=mx(200);return Ie.default.createElement(hx,{popupId:"maxai_client__features__chat__pro_chat_switch",variant:"popover",disableAutoFocus:!0},d=>{let h=fx(d),f=dx(d);return l(h.open),h.open&&p(),Ie.default.createElement("div",null,Ie.default.createElement("div",{ref:i,...f,onMouseLeave:_=>{m.add(()=>f.onMouseLeave(_))},onMouseEnter:()=>{p()}},e),Ie.default.createElement(gx,{onMouseEnter:_=>m.clear(),...h,anchorOrigin:n.anchorOrigin,transformOrigin:n.transformOrigin,disableScrollLock:!0,transitionDuration:0,slotProps:{paper:{elevation:0,sx:{background:"transparent",overflow:"unset"}}}},Ie.default.createElement(_r,{ref:a,elevation:0,sx:{width:"280px",padding:"16px",marginBottom:"6px",border:"1px solid",borderColor:"border.main",boxShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.20), 0px 0px 16px 0px rgba(0, 0, 0, 0.10), 0px 16px 24px 0px rgba(0, 0, 0, 0.08);"}},Ie.default.createElement(Kh,null))))})},HI=$E;var FI=()=>new Promise(o=>{setTimeout(o,0)}),_G=(()=>{let o=new MessageChannel,e=[];return o.port2.onmessage=()=>{let t=e.shift();t&&t()},()=>new Promise(t=>{e.push(t),o.port1.postMessage(null)})})();var jh=S(M()),qE=()=>{let o=te(m=>m.conversationIds[0]),{localSettings:e,setLocalSettings:t}=_t(),{isFreeUser:r}=Mt(),{modelUsage:n,refreshModelUsage:i}=Mi(),{showPricingHooksPopup:a}=Ml(),s=(0,jh.useRef)(null),l=(0,jh.useRef)(!1),{paywallShow:c}=za(),u=async m=>(l.current=!1,new Promise(d=>{s.current=setTimeout(()=>{Us.sendUserAction("turn_on_pro_chat_mode").then(h=>{l.current||(h?.paywall?(a(o,h.paywall),c({paywallType:"modal",paywallReason:"ProChat"}),t({chatMode:"free_chat"}),d(!1)):(i(),d(!0)))})},m)})),p=async(m,d)=>{let{asyncConfirm:h=!0,asyncConfirmDelay:f=100}=d||{};return await Fe({emitEvent:!0})?(l.current=!0,s.current&&clearTimeout(s.current),await FI(),m==="pro_chat"?(await t({chatMode:"pro_chat"}),r&&h&&n.proChat===0&&n.proChatReward===0?await u(f):!0):(await t({chatMode:m}),!0)):!1};return{chatMode:e.chatMode,updateChatMode:p}},cs=qE;var pa=S(M());var XE=o=>{let{anchorElementSelectors:e='[data-testid="maxai--chat-pro-chat-switch"]',placement:t="top-start",onTryIt:r,...n}=o,{t:i}=v(),{modelUsage:a}=Mi(),{isPayingUser:s}=Mt(),{localSettings:l}=_t(),[c,u]=(0,pa.useState)(!1),[p,m]=pa.default.useState(!0),{extensionTourOnBoardingOpened:d}=on();return(0,pa.useEffect)(()=>{d&&qe.getOnboardingDataByKey("ON_BOARDING__RECORD_FIRST_AUTO_CLOSE_PRO_CHAT_SWITCH_TOOLTIP").then(h=>m(!!h))},[d]),(0,pa.useEffect)(()=>{let h=!1;return!s&&a.proChat===0&&a.proChatReward===0&&l.chatMode==="free_chat"&&qe.getOnboardingData().then(f=>{h||f.ON_BOARDING__RECORD_FIRST_AUTO_CLOSE_PRO_CHAT_SWITCH_TOOLTIP||f.ON_BOARDING__RECORD_FIRST_AUTO_CLOSE_PRO_CHAT_SWITCH&&u(!0)}),()=>{h=!0}},[s,a.proChat,l.chatMode]),p?null:pa.default.createElement(Bt,{trigger:c,arrow:!1,hideCTAButton:!0,placement:t,anchorElementSelectors:e,onShow:()=>{qe.setOnboardingData("ON_BOARDING__RECORD_FIRST_AUTO_CLOSE_PRO_CHAT_SWITCH_TOOLTIP",!0)},ctaButtonText:i("package__features:onboarding__onboarding_popover__cta_button__try_it"),onCTAButtonClick:async()=>{r&&r()},PaperProps:{sx:{...t.includes("top")?{transform:"translate(-4px, -12px)"}:{}}},...n},pa.default.createElement(Kh,null))},NI=XE;var Tc="ON_BOARDING_POPOVER__PRO_CHAT__OPENED",Ld="ON_BOARDING_POPOVER__PRO_CHAT__CLOSED",wc="ON_BOARDING_POPOVER__NEW_CHAT",zG="ON_BOARDING_POPOVER__CHAT_IN_FULL_PAGE",$h="ON_BOARDING_POPOVER__CHAT_HISTORY",qh="ON_BOARDING_POPOVER__CHAT_HUB_SELECTOR",Ec="ON_BOARDING_POPOVER__AI_MODEL_SELECTOR";var gn=S(M());var YE=o=>{let{anchorElementSelectors:e='[data-testid="maxai--chat-pro-chat-switch"]',placement:t="top-start",onTryIt:r,...n}=o,{t:i}=v(),[a,s]=gn.default.useState(!1),[l,c]=gn.default.useState(!0),u=te(C=>C.conversationIds),p=er(u[0]),m=ge(u[0]),d=(0,gn.useRef)(!1),{localSettings:h}=_t(),{isFreeUser:f}=Mt(),_=ko.use.setChatAIModelAndProvider(),{extensionTourOnBoardingOpened:x}=on();return(0,gn.useEffect)(()=>{x&&qe.getOnboardingDataByKey(Tc).then(C=>c(!!C))},[x]),(0,gn.useEffect)(()=>{if(l)return;let C=p.find(y=>y.type==="ai");C&&C.originalMessage?.metadata?.chatMode==="free_chat"&&h.chatMode==="free_chat"&&!m&&d.current&&s(!0)},[p,h.chatMode,l,m]),(0,gn.useEffect)(()=>{m&&(d.current=!0)},[m]),l?null:gn.default.createElement(Bt,{trigger:a,placement:t,anchorElementSelectors:e,onShow:()=>{qe.setOnboardingData(Tc,!0),f&&_({AIModel:Gp.value,AIProvider:Gp.AIProvider})},onClose:()=>{qe.setOnboardingData(Ld,!0)},ctaButtonText:i("package__features:onboarding__onboarding_popover__cta_button__try_it"),onCTAButtonClick:async()=>{r&&r()},CtaButtonProps:{"data-button-clicked-name":"Onboarding > Pro chat > Try it"},...n},gn.default.createElement(g,{spacing:.5},gn.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},"Pro chat"),gn.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},i("package__features:onboarding__onboarding_popover__pro_chat__description"))))},VI=YE;var li=S(M());var ZE=o=>{let{anchorElementSelectors:e='[data-testid="maxai--chat-pro-chat-switch"]',placement:t="top-start",onTryIt:r,...n}=o,{t:i}=v(),{modelUsage:a}=Mi(),{isPayingUser:s}=Mt(),{localSettings:l}=_t(),[c,u]=(0,li.useState)(!1),[p,m]=li.default.useState(!0),{extensionTourOnBoardingOpened:d}=on();return(0,li.useEffect)(()=>{d&&qe.getOnboardingData().then(h=>{h.ON_BOARDING__RECORD_FIRST_AUTO_CLOSE_PRO_CHAT_SWITCH_TOOLTIP&&m(h.ON_BOARDING__RECORD_FIRST_RESET_DAILY_USAGE_PRO_CHAT_SWITCH_TOOLTIP===!0)})},[d]),(0,li.useEffect)(()=>{!s&&a.proChat>0&&l.chatMode==="free_chat"&&u(!0)},[s,a.proChat,l.chatMode]),p?null:li.default.createElement(Bt,{trigger:c,placement:t,anchorElementSelectors:e,onShow:()=>{qe.setOnboardingData("ON_BOARDING__RECORD_FIRST_RESET_DAILY_USAGE_PRO_CHAT_SWITCH_TOOLTIP",!0)},ctaButtonText:i("package__features:onboarding__onboarding_popover__cta_button__try_it"),onCTAButtonClick:async h=>{r&&r(h)},CtaButtonProps:{"data-button-clicked-name":"Onboarding > Pro chat > Got it"},...n},li.default.createElement(g,{spacing:.5},li.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},"Pro chat"),li.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},i("package__features:onboarding__onboarding_popover__pro_chat__first_reset_daily_usage__description",{NAME:"Pro chats"}))))},RI=ZE;var yo=S(M()),zI=o=>{let{sx:e,children:t,...r}=o;return yo.default.createElement(g,{direction:"row",alignItems:"center",sx:{padding:"6px 4px",gap:"4px",cursor:"pointer",transform:"translateY(0)",lineHeight:"1!important",...e},...r},t,yo.default.createElement(T,{sx:{fontSize:"14px",fontWeight:500,color:"text.primary",textAlign:"left"}},"Pro"))},UI=o=>{let{children:e,title:t}=o;return yo.default.createElement(me,{disableInteractive:!0,testId:"maxai--chat-pro-chat-switch--tooltip",placement:"top",title:t},yo.default.createElement("div",null,e))},QE=()=>{let{t:o}=v();return yo.default.createElement(UI,{title:o("package__features:chat__pro_chat_switch__pay_user_tooltip")},yo.default.createElement(zI,{sx:{cursor:"default"}},yo.default.createElement(Da,{sx:{color:"text.primary"},"data-testid":"maxai--chat-pro-chat-switch"})))},JE=o=>{let{hideOnboarding:e=!1}=o,{chatMode:t,updateChatMode:r}=cs(),{isLogin:n}=Po(),{t:i}=v(),a=async l=>{qe.setOnboardingData("ON_BOARDING__RECORD_FIRST_CLICK_PRO_CHAT_SWITCH",!0),await r(t==="free_chat"?"pro_chat":"free_chat")===!1&&Bs("click",{paywallType:"pro_chat_card",paywallReason:"ProChat",buttonType:"pro_switch",targetElement:l?.target})},s=yo.default.createElement(zI,{onClick:a},yo.default.createElement("div",{"data-testid":"maxai--chat-pro-chat-switch"},yo.default.createElement(hm,{...o,checked:t==="pro_chat"})));return n?yo.default.createElement("div",null,yo.default.createElement(HI,null,s),yo.default.createElement(NI,null),yo.default.createElement(RI,{onTryIt:a}),!e&&yo.default.createElement(VI,{onTryIt:a})):yo.default.createElement(UI,{title:i("package__features:chat__pro_chat_switch__not_login_user_tooltip",{NAME:"Pro chat"})},s)},eP=o=>{let{isPayingUser:e}=Mt(),{isLogin:t}=Po(),{setLocalSettings:r,localSettings:n}=_t();return(0,yo.useEffect)(()=>{t&&e&&n.chatMode!=="pro_chat"&&r({chatMode:"pro_chat"})},[t,e,n.chatMode]),t&&e?yo.default.createElement(QE,null):yo.default.createElement(JE,{...o})},us=eP;var WI=S(M()),tP=o=>{let{onChanged:e,...t}=o,{userSettings:r,setUserSettings:n}=en(),i=Gx(),a=wn&&typeof i.query.locale=="string"?i.query.locale:"",s=async c=>{e?.(c),setTimeout(()=>{n({language:c})},0)},l=Qx(r?.language||"",a||r?.preferredLanguage||"");return WI.default.createElement(GC,{options:p0,value:l,onChange:s,...t})},GI=tP;var KI=S(M()),oP=o=>{let{onChanged:e,tooltipProps:t,popoverProps:r,...n}=o,{t:i}=v(),{conversationId:a,inputMediator:s}=Ai(),l=ge(a);return KI.default.createElement(GI,{onChanged:c=>{s.focus(),e?.(c)},disabled:l,tooltipProps:{title:i("package__features:chat__ai_language_selector__button__tooltip"),...t},popoverProps:{offset:5,...r},...n})},ms=oP;var rP=o=>{let{enableChatMode:e,disableChatMode:t,children:r}=o,{localSettings:n}=b2(),i=n.chatMode||"free_chat";return typeof r=="function"?r(i):e&&i!==e||t&&i===t?null:r},Od=rP;var Pc=S(M()),jI=S(M()),nP=o=>{let{type:e="floating",sx:t}=o,{t:r}=v(),n=(0,jI.useMemo)(()=>[{value:"clear_suggested",label:r("package__features:context_menu__more_button__clear_suggested_tools"),ButtonProps:{tooltipProps:{placement:"right",disabled:!1}},labelSx:{color:"rgba(255, 14, 39, 1) !important"},icon:Pc.default.createElement(z,{icon:"Delete",sx:{color:"rgba(255, 14, 39, 1) !important"}})}],[r]),i=async p=>{if(p==="clear_suggested"){if(!await Fe({emitEvent:!0}))return;await l()}},{contextMenuPath:a}=lo(),{contextMenuSuggestions:s,resetContextMenuSuggestions:l}=Qa(a||""),{contextMenuSuggestions:c}=Qa("/rewrite"),{contextMenuSuggestions:u}=Qa("/my_own_tools");return a&&s.length===0||c.length===u.length&&c.length===0?null:Pc.default.createElement(L,{sx:{padding:0,...t}},Pc.default.createElement(ee,{options:n,placement:"bottom-end",onSelectOption:p=>{i(p)},OptionsCardProps:{sx:{width:"auto",marginRight:"-13px"}},sx:{width:"26px",height:"26px",padding:"8px"}},Pc.default.createElement(z,{size:e==="floating"?18:16,icon:"More"})))},up=nP;var Ac=class{constructor(){this.menuList=[];this.path=[];this.onUpdate=()=>{}}setOnUpdate(e){this.onUpdate=e}updatePath(e){this.path=e,this.onUpdate()}setMenuList(e){if(e!==this.menuList)if(this.menuList=e,this.menuList.length===0)this.updatePath([]);else{let t=null,r=[];for(let n of this.menuList){if(n.type==="chat_complete"){t=n,r=this.menuList;break}if(n.type==="group"){let i=!1;for(let a of n.children)if(a.type==="chat_complete"){t=a,r=n.children,i=!0;break}if(i)break}}this.updatePath(t?[{item:t,siblingList:r,triggerByHover:!1}]:[])}}onHover(e){let t=[];function r(n){let i=n;for(let a of n){if(a.prompt_id===e.prompt_id)return t.unshift({item:a,siblingList:i,triggerByHover:!0}),!0;a.type==="group"&&r(a.children??[])&&t.unshift({item:a,siblingList:i,triggerByHover:!0})}return!1}r(this.menuList),this.updatePath(t)}proxyKeyboardEvent(e){return e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"?this.onNavigate(e.key.slice(5)):!1}onNavigate(e){if(this.path.length===0)return!1;let t=this.path[this.path.length-1];switch(e){case"Up":{let r=t.siblingList.indexOf(t.item);if(r===-1)throw Error("onNavigate up index = -1");return r===0?!1:(t.item=t.siblingList[r-1],this.updatePath(this.path.map(n=>({...n,triggerByHover:!1}))),!0)}case"Down":{let r=t.siblingList.indexOf(t.item);if(r===-1)throw Error("onNavigate down index = -1");return r===t.siblingList.length-1?!1:(t.item=t.siblingList[r+1],this.updatePath(this.path.map(n=>({...n,triggerByHover:!1}))),!0)}case"Left":return this.path.length===1?!1:(this.updatePath(this.path.slice(0,this.path.length-1).map(r=>({...r,triggerByHover:!1}))),!0);case"Right":{if(t.item.type!=="group")return!1;let r=t.item;return!r.children||r.children.length===0?!1:(this.path.push({item:r.children[0],siblingList:r.children,triggerByHover:!1}),this.updatePath(this.path.map(n=>({...n,triggerByHover:!1}))),!0)}}}getSelectedItem(){let e=_i(this.path);if(e&&e.item.type==="chat_complete")return e.item}match(e){return!!this.path.find(r=>r.item===e)}matchOpenGroup(e){let t=this.path.findIndex(r=>r.item===e);return t===-1?!1:t!==this.path.length-1||this.path[t].triggerByHover}onLeave(){this.updatePath(this.path.slice(0,1).map(e=>({...e,triggerByHover:!1})))}};var qI=S(qC()),XI=S(z7());var ft=S(M()),Xh=S(M()),Yh=(0,ft.forwardRef)(function({disabled:e,data:t,onHover:r,isActive:n,label:i,iconKey:a,includeChildren:s,onClick:l,stopClickEventPropagation:c,...u},p){let m=(0,ft.useRef)();(0,ft.useEffect)(()=>{if(n&&m.current&&m.current.parentElement){let h=m.current,f=m.current.parentElement,_={top:f.scrollTop,bottom:f.clientHeight+f.scrollTop};if(h.offsetTop+h.clientHeight>_.bottom)f.scrollTo({behavior:"instant",top:h.offsetTop+h.clientHeight-f.clientHeight,left:f.scrollLeft});else if(h.offsetTop<_.top){let x=h;h.previousElementSibling instanceof HTMLElement&&h.previousElementSibling.classList.contains("maxai-context-menu-group-label")&&(x=h.previousElementSibling),f.scrollTo({behavior:"instant",top:x.offsetTop,left:f.scrollLeft})}}},[n]);let d=(0,Xh.useMemo)(()=>{try{return`dropdown-menu--item--${t.text.replace(/\s+/g,"-").toLowerCase()}`}catch{return""}},[t.text]);return ft.default.createElement(L,{"data-testid":d,...u,"aria-disabled":e,className:`floating-context-menu-item ${n?"floating-context-menu-item--active":""}`,tabIndex:n?0:-1,sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:1,boxSizing:"border-box",px:1,borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:h=>{h&&(p&&(typeof p=="function"?p(h):p.current=h),m.current=h)},component:"div",role:"menuitem",onMouseEnter:()=>{r?.(t)},onClick:h=>{l?.(t),c&&h.stopPropagation()}},a&&ft.default.createElement(z,{size:16,icon:a,sx:{color:"primary.main",flexShrink:0}}),ft.default.createElement(T,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},i),ft.default.createElement("span",{className:"floating-context-menu-item__footer-icon "+(s?"floating-context-menu-item__footer-icon--active":"")},s?ft.default.createElement(qI.default,{sx:{color:h=>h.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}):ft.default.createElement(XI.default,{className:"floating-context-menu-item__footer-hover-icon",sx:{color:h=>h.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}})))}),iP=(o,e,t)=>_l(o,e,t,{animationFrame:!0}),$I=(0,ft.forwardRef)(function({referenceElement:e,referenceElementRef:t,zIndex:r=1,children:n,root:i=document.body,open:a,needAutoUpdate:s=!0,sx:l,defaultPlacement:c,defaultFallbackPlacements:u,data:p,menuMaxHeight:m,menuWidth:d,onHover:h,onLeave:f,stopClickEventPropagation:_,...x},C){let y=N2(),b=V1(),w=!b,I=!!b,[E,P]=(0,ft.useState)(a??!1),O=(0,Xh.useMemo)(()=>E||a,[a,E]),N=c||(w?"bottom-start":"right-start"),V=u||(w?["bottom-start","left","left-end","top-start","right"]:["right","right-start","right-end","left","left-start","left-end"]),{x:A,y:D,strategy:W,placement:k,refs:U,context:K}=Ua({nodeId:y,open:O,onOpenChange:(B,ae,X)=>{P(B),X==="hover"&&(B?h?.(p):f?.(p))},placement:N,middleware:[Iu({mainAxis:w?4:0,alignmentAxis:w?0:-4}),vu({fallbackPlacements:V}),Su()],whileElementsMounted:s?iP:void 0}),H=om(K,{role:"menu"}),R=tm(K),F=z2(K,{delay:{open:70,close:200},handleClose:W2({blockPointerEvents:!0})}),{getReferenceProps:Y,getFloatingProps:$,getItemProps:ie}=wl([H,R,F]),G=F2([U.setReference,C,t]);return ft.default.createElement(V2,{id:y},e&&ft.default.isValidElement(e)&&ft.default.cloneElement(e,{...Y({...x,className:`${I?"MenuItem":"RootMenu"}`,...I&&{role:"menuitem"},ref:G})}),ft.default.createElement(Ju,{root:i},O&&ft.default.Children.count(n)!==0&&ft.default.createElement(U2,{context:K,modal:!1,initialFocus:-1,visuallyHiddenDismiss:!0},ft.default.createElement(g,{sx:{zIndex:r+1,display:"flex",flexDirection:"column",p:ft.default.Children.count(n)===0?0:.5,outline:"none!important",maxHeight:m||340,boxSizing:"border-box",overflowY:"auto",border:"1px solid",borderColor:B=>B.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.12)",bgcolor:"background.paper",borderRadius:1,boxShadow:k.includes("top")?"rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px -3px 6px, rgba(15, 15, 15, 0.05) 0px -9px 24px":"rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px","& *":{outline:"none!important"},"&:has(.max-ai--popper-wrapper)":{overflowY:"unset"},width:d,...l},component:"div",ref:U.setFloating,className:"Menu dropdown-menu",onClick:B=>{_&&B.stopPropagation()},style:{position:W,top:D??0,left:A??0},...$()},ft.default.Children.map(n,B=>ft.default.isValidElement(B)&&ft.default.cloneElement(B,{...ie({})}))))))}),aP=(0,ft.forwardRef)(function(e,t){return V1()?ft.default.createElement($I,{...e,ref:t}):ft.default.createElement(R2,null,ft.default.createElement($I,{...e,ref:t}))}),Zh=aP;var Ht=S(M()),Bd=(0,Ht.forwardRef)((o,e)=>{let{menuItem:t,onClick:r,root:n,zIndex:i,menuWidth:a,contextMenuNavigator:s,onClickGroup:l,platformFeatureCover:c,...u}=o,{t:p}=v(),m=(0,Ht.useMemo)(()=>{let d=`context_menu__prompt__${t.prompt_id.replace(sr,"")}`,h=`package__features:${d}`,f=p(h);return f!==h&&f!==d?f:t.prompt_title},[t.prompt_title,p]);if(t.type==="group"){let d="";try{d=`maxai--rewrite--menu-item--${t.prompt_title.replace(/\s+/g,"-").toLowerCase()}`}catch{d=`maxai--rewrite--menu-item--${t.prompt_id}`}return Ht.default.createElement(Zh,{zIndex:i,ref:e,root:n,label:m,data:t,menuWidth:a,open:s.matchOpenGroup(t),onHover:()=>{s.onHover(t)},stopClickEventPropagation:!0,referenceElement:Ht.default.createElement(Yh,{label:m,data:t,"data-testid":d,includeChildren:!0,onClick:l,iconKey:t.prompt_icon,isActive:s.match(t)})},(t.children??[]).map(h=>Ht.default.createElement(Bd,{...u,platformFeatureCover:c,zIndex:i+1,onClick:r,root:n,contextMenuNavigator:s,key:h.prompt_id,menuItem:h,menuWidth:a})))}return Ht.default.createElement(Yh,{data:t,"data-platform-feature":c,"data-testid":`maxai--rewrite--menu-item--${t.prompt_id}`,"data-promptid":t.prompt_id,ref:e,label:m,iconKey:t.prompt_icon,onClick:r,isActive:s.match(t),onHover:()=>{s.onHover(t)}})});Bd.displayName="DropdownItemWrapper";var YI=()=>Ht.default.createElement(L,{"data-testid":"max-ai-context-menu-divider","aria-disabled":!0,onClick:o=>{o.stopPropagation(),o.preventDefault()},component:"div",sx:{pointerEvents:"none",borderTop:"1px solid",borderColor:o=>o.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0,0,0,0.12)",my:.5}}),sP=(0,Ht.forwardRef)(function(e,t){let{root:r,referenceElement:n,referenceElementRef:i,menuList:a=[],open:s,needAutoUpdate:l,defaultPlacement:c,defaultFallbackPlacements:u,onClickItem:p,menuWidth:m=450,zIndex:d=uu()?0:2147483601,menuMaxHeight:h,noOptionFallback:f,onClickGroup:_,sx:x,platformFeatureCover:C}=e,y=Ux(),b=(0,Ht.useMemo)(()=>{let w=new Ac;return w.setOnUpdate(y),w},[]);return(0,Ht.useImperativeHandle)(t,()=>({proxyKeyboardEvent:w=>b.proxyKeyboardEvent(w),getSelectedItem:()=>b.getSelectedItem()})),(0,Ht.useEffect)(()=>{b.setMenuList(a.filter(w=>typeof w=="object"))},[a]),Ht.default.createElement(Zh,{zIndex:d,root:r,open:s,needAutoUpdate:l,referenceElement:n,referenceElementRef:i,defaultPlacement:c,defaultFallbackPlacements:u,onClick:p,menuMaxHeight:h,menuWidth:m,stopClickEventPropagation:!0,onLeave:()=>{b.onLeave()},sx:x},a.length===0&&f,a.map((w,I)=>{if(typeof w=="string"){let E=w.split("__CONTEXT_MENU_LABEL_SLOT_PLACEHOLDER__")[0],P=w.split("__CONTEXT_MENU_LABEL_SLOT_PLACEHOLDER__")[1];return Ht.default.createElement(Ht.Fragment,{key:P+"_group_name"},I!==0&&YI(),Ht.default.createElement(L,{"aria-disabled":!0,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",boxSizing:"border-box",direction:"row",pl:"8px"},className:"maxai-context-menu-group-label",onClick:O=>{O.stopPropagation(),O.preventDefault()}},Ht.default.createElement(L,{sx:{p:"3px 0 6px 0",pointerEvents:"none"}},Ht.default.createElement(T,{textAlign:"left",fontSize:12,color:"text.secondary"},E)),P===sr&&Ht.default.createElement(up,{sx:{ml:"auto"}})))}return w.type==="group"?Ht.default.createElement(Ht.Fragment,{key:w.prompt_id+"_group_name"},KC.includes(w.prompt_id)&&YI(),Ht.default.createElement(Bd,{platformFeatureCover:C,menuItem:w,root:r,zIndex:d+1,menuWidth:m,contextMenuNavigator:b,onClick:p,onClickGroup:_})):Ht.default.createElement(Bd,{platformFeatureCover:C,key:w.prompt_id,zIndex:d+1,root:r,menuItem:w,menuWidth:m,contextMenuNavigator:b,onClick:p})}))}),Dd=sP;var Vd=S(M());var ZI=S(bi());var kc=S(M()),Qh=[{language_code:"uk",value:"Ukrainian",label:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430"},{language_code:"so",value:"Somali",label:"Af Soomaali"},{language_code:"af",value:"Afrikaans",label:"Afrikaans"},{language_code:"az",value:"Azerbaijani",label:"Az\u0259rbaycan dili"},{language_code:"id",value:"Indonesian",label:"Bahasa Indonesia"},{language_code:"ms-MY",value:"Malaysian Malay",label:"Bahasa Malaysia"},{language_code:"ms",value:"Malay",label:"Bahasa Melayu"},{language_code:"jv",value:"Javanese",label:"Basa Jawa"},{language_code:"su",value:"Sundanese",label:"Basa Sunda"},{language_code:"bs",value:"Bosnian",label:"Bosanski jezik"},{language_code:"ca",value:"Catalan",label:"Catal\xE0"},{language_code:"cs",value:"Czech",label:"\u010Ce\u0161tina"},{language_code:"ny",value:"Chichewa",label:"Chichewa"},{language_code:"cy",value:"Welsh",label:"Cymraeg"},{language_code:"da",value:"Danish",label:"Dansk"},{language_code:"de",value:"German",label:"Deutsch"},{language_code:"et",value:"Estonian",label:"Eesti keel"},{language_code:"en",value:"English",label:"English"},{language_code:"en-GB",value:"English (UK)",label:"English (UK)"},{language_code:"en-US",value:"English (US)",label:"English (US)"},{language_code:"es",value:"Spanish",label:"Espa\xF1ol"},{language_code:"eo",value:"Esperanto",label:"Esperanto"},{language_code:"eu",value:"Basque",label:"Euskara"},{language_code:"fr",value:"French",label:"Fran\xE7ais"},{language_code:"ga",value:"Irish",label:"Gaeilge"},{language_code:"gl",value:"Galician",label:"Galego"},{language_code:"hr",value:"Croatian",label:"Hrvatski jezik"},{language_code:"xh",value:"Xhosa",label:"isiXhosa"},{language_code:"zu",value:"Zulu",label:"isiZulu"},{language_code:"is",value:"Icelandic",label:"\xCDslenska"},{language_code:"it",value:"Italian",label:"Italiano"},{language_code:"sw",value:"Swahili",label:"Kiswahili"},{language_code:"ht",value:"Haitian Creole",label:"Krey\xF2l Ayisyen"},{language_code:"ku",value:"Kurdish",label:"Kurd\xEE"},{language_code:"la",value:"Latin",label:"Lat\u012Bna"},{language_code:"lv",value:"Latvian",label:"Latvie\u0161u valoda"},{language_code:"lb",value:"Luxembourgish",label:"L\xEBtzebuergesch"},{language_code:"lt",value:"Lithuanian",label:"Lietuvi\u0173 kalba"},{language_code:"hu",value:"Hungarian",label:"Magyar"},{language_code:"mg",value:"Malagasy",label:"Malagasy"},{language_code:"mt",value:"Maltese",label:"Malti"},{language_code:"mi",value:"Maori",label:"M\u0101ori"},{language_code:"nl",value:"Dutch",label:"Nederlands"},{language_code:"no",value:"Norwegian",label:"Norsk"},{language_code:"uz",value:"Uzbek",label:"O'zbek tili"},{language_code:"pl",value:"Polish",label:"Polski"},{language_code:"pt",value:"Portuguese",label:"Portugu\xEAs"},{language_code:"ro",value:"Romanian",label:"Rom\xE2n\u0103"},{language_code:"st",value:"Sesotho",label:"Sesotho"},{language_code:"sq",value:"Albanian",label:"Shqip"},{language_code:"sk",value:"Slovak",label:"Sloven\u010Dina"},{language_code:"sl",value:"Slovenian",label:"Sloven\u0161\u010Dina"},{language_code:"fi",value:"Finnish",label:"Suomi"},{language_code:"sv",value:"Swedish",label:"Svenska"},{language_code:"tl",value:"Tagalog",label:"Tagalog"},{language_code:"tt",value:"Tatar",label:"Tatar\xE7a"},{language_code:"tr",value:"Turkish",label:"T\xFCrk\xE7e"},{language_code:"vi",value:"Vietnamese",label:"Vi\u1EC7t ng\u1EEF"},{language_code:"yo",value:"Yoruba",label:"Yor\xF9b\xE1"},{language_code:"el",value:"Greek",label:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC"},{language_code:"be",value:"Belarusian",label:"\u0411\u0435\u043B\u0430\u0440\u0443\u0441\u043A\u0430\u044F \u043C\u043E\u0432\u0430"},{language_code:"bg",value:"Bulgarian",label:"\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438 \u0435\u0437\u0438\u043A"},{language_code:"ky",value:"Kyrgyz",label:"\u041A\u044B\u0440"},{language_code:"kk",value:"Kazakh",label:"\u049A\u0430\u0437\u0430\u049B \u0442\u0456\u043B\u0456"},{language_code:"mk",value:"Macedonian",label:"\u041C\u0430\u043A\u0435\u0434\u043E\u043D\u0441\u043A\u0438 \u0458\u0430\u0437\u0438\u043A"},{language_code:"mn",value:"Mongolian",label:"\u041C\u043E\u043D\u0433\u043E\u043B \u0445\u044D\u043B"},{language_code:"ru",value:"Russian",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"},{language_code:"sr",value:"Serbian",label:"\u0421\u0440\u043F\u0441\u043A\u0438 \u0458\u0435\u0437\u0438\u043A"},{language_code:"tg",value:"Tajik",label:"\u0422\u043E\u04B7\u0438\u043A\u04E3"},{language_code:"ka",value:"Georgian",label:"\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"},{language_code:"hy",value:"Armenian",label:"\u0540\u0561\u0575\u0565\u0580\u0565\u0576"},{language_code:"yi",value:"Yiddish",label:"\u05D9\u05D9\u05B4\u05D3\u05D9\u05E9"},{language_code:"he",value:"Hebrew",label:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{language_code:"ug",value:"Uyghur",label:"\u0626\u06C7\u064A\u063A\u06C7\u0631\u0686\u06D5"},{language_code:"ur",value:"Urdu",label:"\u0627\u0631\u062F\u0648"},{language_code:"ar",value:"Arabic",label:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"},{language_code:"ps",value:"Pashto",label:"\u067E\u069A\u062A\u0648"},{language_code:"fa",value:"Persian",label:"\u0641\u0627\u0631\u0633\u06CC"},{language_code:"ne",value:"Nepali",label:"\u0928\u0947\u092A\u093E\u0932\u0940"},{language_code:"mr",value:"Marathi",label:"\u092E\u0930\u093E\u0920\u0940"},{language_code:"hi",value:"Hindi",label:"\u0939\u093F\u0928\u094D\u0926\u0940"},{language_code:"bn",value:"Bengali",label:"\u09AC\u09BE\u0982\u09B2\u09BE"},{language_code:"pa",value:"Punjabi",label:"\u0A2A\u0A70\u0A1C\u0A3E\u0A2C\u0A40"},{language_code:"gu",value:"Gujarati",label:"\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0"},{language_code:"or",value:"Oriya",label:"\u0B13\u0B21\u0B3C\u0B3F\u0B06"},{language_code:"ta",value:"Tamil",label:"\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD"},{language_code:"te",value:"Telugu",label:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{language_code:"kn",value:"Kannada",label:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1"},{language_code:"ml",value:"Malayalam",label:"\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02"},{language_code:"si",value:"Sinhala",label:"\u0DC3\u0DD2\u0D82\u0DC4\u0DBD"},{language_code:"th",value:"Thai",label:"\u0E44\u0E17\u0E22"},{language_code:"lo",value:"Lao",label:"\u0E9E\u0EB2\u0EAA\u0EB2\u0EA5\u0EB2\u0EA7"},{language_code:"my",value:"Burmese",label:"\u1017\u1019\u102C\u1005\u102C"},{language_code:"km",value:"Khmer",label:"\u1797\u17B6\u179F\u17B6\u1781\u17D2\u1798\u17C2\u179A"},{language_code:"ko",value:"Korean",label:"\uD55C\uAD6D\uC5B4"},{language_code:"zh",value:"Chinese",label:"\u4E2D\u6587"},{language_code:"zh-TW",value:"Traditional Chinese",label:"\u7E41\u9AD4\u4E2D\u6587"},{language_code:"ja",value:"Japanese",label:"\u65E5\u672C\u8A9E"}];function lP(o,{inputValue:e}){return o.filter(t=>{let r=t.label.toLowerCase(),n=t.value.toLowerCase(),i=e.toLowerCase();return r.includes(i)||n.includes(i)})}var pP=o=>{let{label:e="Output language",defaultValue:t="",onChange:r=l=>{},placeholder:n,sx:i}=o,[a,s]=(0,kc.useState)(()=>Qh.find(l=>l.value===t)||Qh[0]);return kc.default.createElement(Mu,{"data-testid":"system-variable--language-select",disablePortal:!0,disableClearable:!0,value:a,size:"small",sx:{[`.${ax.root}`]:{fontSize:16},[`.${Ji.root}`]:{fontSize:16,paddingRight:"28px!important"},[`.${Ji.root} fieldset > legend`]:{fontSize:14},[`.${tx.popupIndicator} .${ZI.svgIconClasses.root}`]:{fontSize:24},...i},slotProps:{paper:{sx:{fontSize:16}}},ListboxProps:{style:{maxHeight:"144px"}},autoHighlight:!0,getOptionLabel:l=>l.label,options:Qh,onChange:(l,c)=>{l.stopPropagation(),s(c),r(c.value)},onKeyDown:l=>{l.stopPropagation()},onPaste:l=>{l.stopPropagation()},filterOptions:lP,renderInput:l=>kc.default.createElement(Lt,{...l,label:e,placeholder:n,InputLabelProps:{sx:{fontSize:"16px"},...l.InputLabelProps},inputProps:{sx:{fontSize:"16px"},...l.inputProps}})})},QI=pP;var JI=S(rm()),Jh=S(im());var Ft=S(M()),cP=({onSelectOption:o,options:e,selectedOption:t,menuListBoxSx:r,sx:n})=>{let{t:i}=v(),a=(0,Ft.useRef)(null),s=(0,Ft.useRef)(null),[l,c]=(0,Ft.useState)(""),[u,p]=(0,Ft.useState)(null),m=(0,Ft.useMemo)(()=>l===""?e:e.filter(x=>{let C=x.label.toLowerCase(),y=String(x.value).toLowerCase(),b=l.toLowerCase();return C.includes(b)||y.includes(b)}),[l,e]),d=(0,Ft.useRef)(!1),h=m.length-1,f=x=>{p(C=>{if(C!==null){let y=x==="increase"?C+1:C-1;return y>=h?h:y<=0?0:y}return C})};(0,Ft.useEffect)(()=>{s.current&&(s.current.focus(),setTimeout(()=>{s.current?.focus()},200))},[]),(0,Ft.useEffect)(()=>{l!==""&&p(0)},[l]),(0,Ft.useEffect)(()=>{if(a.current&&u!==null){let x=m[u];if(x){let C=a.current,y=C.querySelector(`[data-testid="maxai-client--ui--select-option--${x.value}"]`);if(y){let b=y.offsetTop-C.offsetTop;C.scrollTo({top:b,behavior:"smooth"})}}}},[u,m]);let _=()=>{if(!m.length)return Ft.default.createElement(g,{width:"100%",justifyContent:"center",alignItems:"center",spacing:1},Ft.default.createElement(Jh.default,{sx:{fontSize:32,color:"text.secondary"}}),Ft.default.createElement(T,{fontSize:12,color:"text.secondary"},i("package__ui:select__no_options__title")));let x=(C,y)=>{let b=t===C.value;return Ft.default.createElement(Eu,{"data-testid":`maxai-client--ui--select-option--${C.value}`,selected:u===y,key:`${y}-${C.value}`,sx:[{py:"6px",px:"10px",borderRadius:1,mt:.5,"&.Mui-selected":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}],onClick:w=>{w.stopPropagation(),o&&o(C)}},Ft.default.createElement(lx,{sx:{my:0},primary:Ft.default.createElement(g,{direction:"row",alignItems:"center",sx:{color:"text.primary",fontSize:14}},Ft.default.createElement(T,{fontSize:"inherit",noWrap:!0,sx:{color:"inherit"}},C.label),b?Ft.default.createElement(JI.default,{sx:{fontSize:"inherit",color:"text.primary",ml:"auto"}}):null)}))};return Ft.default.createElement(wu,{sx:{p:0,width:"100%"},onKeyDown:C=>{C.key==="ArrowDown"&&(C.preventDefault(),f("increase")),C.key==="ArrowUp"&&(C.preventDefault(),f("decrease"))}},m.map((C,y)=>x(C,y)))};return Ft.default.createElement(g,{sx:n},Ft.default.createElement(Lt,{inputRef:s,size:"small",value:l,onChange:x=>c(x.target.value),onCompositionStart:()=>d.current=!0,onCompositionEnd:()=>d.current=!1,placeholder:i("package__common:search"),InputProps:{startAdornment:Ft.default.createElement(Ii,{position:"start"},Ft.default.createElement(Jh.default,null)),sx:{fontSize:16}},inputProps:{autoComplete:"off"},sx:{pt:1,px:1,pb:.5},onKeyUp:x=>{x.stopPropagation()},onKeyDown:x=>{x.stopPropagation();let C=x.key;if((C==="ArrowDown"||C==="ArrowUp")&&(x.preventDefault(),u===null?p(0):f(C==="ArrowDown"?"increase":"decrease")),C==="Enter"&&u!==null&&!d.current){let y=m[u];x.preventDefault(),y&&o&&o(y)}}}),Ft.default.createElement(L,{sx:{overflow:"auto",maxHeight:310,minHeight:310,px:1,pb:0,mb:1,overscrollBehavior:"contain",scrollbarColor:x=>x.palette.scrollbarColor,boxSizing:"border-box",display:"flex",...r},ref:a},_()))},e4=cP;var po=S(M()),uP=o=>{let{title:e,dataTestId:t,options:r,defaultValue:n,value:i="",onChange:a,disabled:s,sx:l,startIcon:c,endIcon:u="ExpandMore",labelMaxWidth:p=64,tooltipProps:m,popoverProps:d,...h}=o,[f,_]=(0,po.useState)(!1),[x,C]=(0,po.useState)(()=>r.find(E=>E.value===i)||r.find(E=>E.value===n)||r[0]);(0,po.useEffect)(()=>{C(E=>r.find(O=>O.value===E.value)||E)},[r]);let[y,b]=(0,po.useState)(!1),w=(0,po.useRef)(null),I=s?!1:f;return(0,po.useLayoutEffect)(()=>{let E=r.find(P=>P.value===i);E&&E.value!==x.value&&C(E)},[i]),Nu(()=>{_(!1)}),po.default.createElement(po.default.Fragment,null,po.default.createElement(me,{title:e,open:y&&!I,disabled:s,...m},po.default.createElement(le,{ref:w,disableRipple:!0,onMouseEnter:()=>{b(!0)},onMouseLeave:()=>{b(!1)},onClick:()=>{s||_(E=>!E)},className:f?"MAXAI_CLIENT__UI__SELECT":"","data-testid":t,startIcon:c?po.default.createElement(Ii,{position:"start",sx:{marginRight:0}},typeof c=="string"?po.default.createElement(z,{icon:c,sx:{fontSize:"18px",mx:"4px",color:"text.secondary"}}):c):void 0,endIcon:u?po.default.createElement(Ii,{position:"end",sx:{marginLeft:0,position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",zIndex:1,p:"6px"}},typeof u=="string"?po.default.createElement(z,{icon:u,sx:{color:"text.secondary",fontSize:"16px",transform:f?"rotate(180deg)":"rotate(0)"}}):u):void 0,sx:{minWidth:"unset",maxWidth:"120px",borderRadius:1,cursor:s?"default":"pointer","&:focus":{cursor:"default"},color:"text.secondary",transition:"background-color 250ms cubic-bezier(0.4, 0, 0.2, 1)",[`& .${ea.startIcon}`]:{mr:0},[`& .${ea.endIcon}`]:{ml:0,p:0},[`& .${ea.endIcon} .${ix.root}`]:{position:"static",transform:"none"},height:"32px",display:"flex",flexWrap:"nowrap",p:"4px 6px",alignItems:"center",justifyContent:"flex-start",fontSize:14,...l},...h},po.default.createElement(T,{noWrap:!0,fontSize:"inherit",maxWidth:p,textAlign:"left"},x.label))),po.default.createElement(El,{transitionDuration:0,disableScrollLock:!0,...d,placement:"bottom-start",fallbackPlacements:["top-start"],open:f,onClose:()=>{_(!1)},anchorEl:w.current},po.default.createElement(e4,{selectedOption:i,options:r,onSelectOption:E=>{C(E),a?.(E.value),_(!1)}})))},Hd=uP;var Fd=S(M()),mP=[{label:"Default tone",value:"Default"},{label:"Authoritative",value:"Authoritative"},{label:"Casual",value:"Casual"},{label:"Clinical",value:"Clinical"},{label:"Cold",value:"Cold"},{label:"Confident",value:"Confident"},{label:"Cynical",value:"Cynical"},{label:"Emotional",value:"Emotional"},{label:"Empathetic",value:"Empathetic"},{label:"Formal",value:"Formal"},{label:"Friendly",value:"Friendly"},{label:"Humorous",value:"Humorous"},{label:"Informal",value:"Informal"},{label:"Ironic",value:"Ironic"},{label:"Optimistic",value:"Optimistic"},{label:"Pessimistic",value:"Pessimistic"},{label:"Playful",value:"Playful"},{label:"Professional",value:"Professional"},{label:"Sarcastic",value:"Sarcastic"},{label:"Serious",value:"Serious"},{label:"Straightforward",value:"Straightforward"},{label:"Sympathetic",value:"Sympathetic"},{label:"Tentative",value:"Tentative"},{label:"Warm",value:"Warm"}],dP=o=>{let{t:e}=v(),t=(0,Fd.useMemo)(()=>mP.map(r=>({label:e(`package__features:shortcuts__tone_options__${r.value.toLowerCase()}`),value:r.value})),[e]);return Fd.default.createElement(Hd,{title:e("package__features:shortcuts__set_variables_modal__system_selector__tone"),labelMaxWidth:"unset",startIcon:"GraphicEqualizer",sx:{maxWidth:"unset"},...o,options:t})},t4=dP;var Nd=S(M()),fP=[{label:"Default writing style",value:"Default"},{value:"Academic",label:"Academic"},{value:"Analytical",label:"Analytical"},{value:"Argumentative",label:"Argumentative"},{value:"Conversational",label:"Conversational"},{value:"Creative",label:"Creative"},{value:"Critical",label:"Critical"},{value:"Descriptive",label:"Descriptive"},{value:"Epigrammatic",label:"Epigrammatic"},{value:"Epistolary",label:"Epistolary"},{value:"Expository",label:"Expository"},{value:"Informative",label:"Informative"},{value:"Instructive",label:"Instructive"},{value:"Journalistic",label:"Journalistic"},{value:"Metaphorical",label:"Metaphorical"},{value:"Narrative",label:"Narrative"},{value:"Persuasive",label:"Persuasive"},{value:"Poetic",label:"Poetic"},{value:"Satirical",label:"Satirical"},{value:"Technical",label:"Technical"}],hP=o=>{let{t:e}=v(),t=(0,Nd.useMemo)(()=>fP.map(r=>({label:e(`package__features:shortcuts__writing_style_options__${r.value.toLowerCase()}`),value:r.value})),[e]);return Nd.default.createElement(Hd,{title:e("package__features:shortcuts__set_variables_modal__system_selector__writing_style"),labelMaxWidth:"unset",startIcon:"Feather",sx:{maxWidth:"unset"},...o,options:t})},o4=hP;var gP=o=>{let{systemVariableSelectKey:e,...t}=o;switch(e){case"AI_RESPONSE_WRITING_STYLE":return Vd.default.createElement(o4,{...t});case"AI_RESPONSE_LANGUAGE":return Vd.default.createElement(QI,{...t});case"AI_RESPONSE_TONE":return Vd.default.createElement(t4,{...t});default:return null}},Rd=gP;var Lc=class{constructor(){this.SET_VARIABLES_MODAL_SELECT_KEY="MAXAI_CLIENT__FEATURES__SET_VARIABLES_MODAL_SELECT_KEY"}async getSetVariablesModalSelectCache(){return await pn.getItem(this.SET_VARIABLES_MODAL_SELECT_KEY)||{}}async setVariablesModalSelectCache(e,t){try{let r=await this.getSetVariablesModalSelectCache();return r[e]=t,await pn.setItem(this.SET_VARIABLES_MODAL_SELECT_KEY,r),!0}catch{return!1}}};var mp=new Lc;var n4=S(Cr()),i4=S(vc()),a4=S(Wh());var Ne=S(M()),s4=S(Vp());var r4=!0,l4=(0,Ne.forwardRef)((o,e)=>{let{title:t,variables:r,modelKey:n,onShow:i,onClose:a,onBeforeRunShortcuts:s,onChange:l,onBeforeClose:c,onInputCustomVariable:u,actions:p,answerInsertMessageId:m,askChatGPTActionParameters:d,showCloseButton:h=!0,isSaveLastRunShortcuts:f,disabled:_,sx:x,notBuiltInVariables:C,includeHistory:y,autoFocusAfterBlur:b=!1,disableCachingSystemVariableValue:w=!1,disabledResetFormOnConfirmModal:I=!1,MaxAIPromptActionConfig:E}=o,{betaSettings:P}=Sr(),{askAIWithShortcutsV2:O,askAIWithShortcuts:N,shortCutsEngine:V,stopGenerate:A}=Re(),D=so(),{conversationId:W,conversationType:k}=Ai(),U=ge(W),{localSettings:K}=_t(),{t:H}=v(),[R,F]=(0,Ne.useState)(!1),Y=(0,Ne.useMemo)(()=>k!=="Chat"&&!R,[k,R]),$=Na(),[ie,G]=(0,Ne.useState)(null),B=(0,Ne.useRef)(null),[ae,X]=(0,Ne.useState)([]),{control:oe,getValues:ue,setValue:Z,register:J,trigger:j,reset:ce,clearErrors:ke,formState:{errors:at,isValid:we}}=Sl(),[tt,At]=(0,Ne.useState)({}),Zt=async fe=>{c&&!c()||(ae.forEach(Q=>{Q.resolve({data:ue(),type:fe?"cancel":"close",success:!1})}),n!=="PromptPreview"&&(ce(),At({}),F(!1),a?.("close")))},yt=async()=>{let fe=await j();return!fe&&!R&&F(!0),fe},Zo=async fe=>{if(!(U||_)){if(Vu(fe)){let Q=B.current?.querySelectorAll("textarea[id]")?.[fe+1];if(Q){Q.focus();return}}if(ie?.waitForUserAction){if(!await yt())return;ae.forEach(Q=>{Q.resolve({data:ue(),type:"confirm",success:!0})})}else await zt(!1)}},zt=(0,Ne.useCallback)(async(fe,Q={})=>{let{ignoreChatHubLoading:Te=!1}=Q,Be=Object.values(ue()).filter(Qn=>String(Qn||"").trim()==="").length>0;if(!await yt()){fe&&Be&&ke();return}if(fe&&Be){F(!0);return}let Le=He(ue());n!=="PromptPreview"&&!I&&(At({}),ce(),F(!1)),l?.({data:Le,type:"change",success:!0},"runPromptStart");let Ee=[];if(ie?.template||ie?.MaxAIPromptActionConfig||E){let Qn=String(Le?.TEMPLATE||ie?.template||ie?.title||""),Jn={...ie?.variables?.reduce((Pe,io)=>({...Pe,[io.name]:io}),{})},kt={};if(Object.keys(Le).forEach(Pe=>{let io=Jn[Pe];if(io?.hidden){if(r4)return;io.hint="(Dev show) "+io.hint}io?(kt[Pe]={key:Pe,value:Le[Pe],overwrite:!0,label:io.hint},(C||ie?.notBuiltInVariables)?.includes(Pe)&&(kt[Pe].isBuiltIn=!1)):kt[Pe]={key:Pe,value:Le[Pe],overwrite:!0}}),!kt.SELECTED_TEXT){let Pe=ie?.variables?.find(io=>io.name==="SELECTED_TEXT");Pe&&(kt.SELECTED_TEXT={key:"SELECTED_TEXT",value:Pe.default_value,isBuiltIn:!0,overwrite:!0,label:"patch selected text not found"})}if(!kt.SELECTED_TEXT&&kt.MAXAI_CONTINUE_WRITING_TEXT_DRAFT&&(kt.MAXAI_CONTINUE_WRITING_TEXT_DRAFT.isBuiltIn=!0,kt.SELECTED_TEXT={...kt.MAXAI_CONTINUE_WRITING_TEXT_DRAFT,key:"SELECTED_TEXT"}),K.chatMode!=="pro_chat"){let Pe=kt.AI_RESPONSE_TONE;Pe&&(Pe.value="Default");let io=kt.AI_RESPONSE_WRITING_STYLE;io&&(io.value="Default")}Ee.push({type:"SET_VARIABLE_MAP",parameters:{VariableMap:kt}});let wo=He(p||ie?.actions||[]);Ee.push(...wo),Ee.push({type:"RENDER_TEMPLATE",parameters:{template:Qn}});let st=m||ie?.answerInsertMessageId||"",ei=d||ie?.askChatGPTActionParameters||{},gi=y??ie?.includeHistory??void 0,lu={type:"ASK_CHATGPT",parameters:{template:"{{LAST_ACTION_OUTPUT}}",AskChatGPTActionType:st?"ASK_CHAT_GPT_HIDDEN":"ASK_CHAT_GPT_WITH_PREFIX",AskChatGPTActionQuestion:{text:"{{LAST_ACTION_OUTPUT}}",meta:Qo([{includeHistory:!0,...st?{outputMessageId:st}:{}},ie?.questionMeta||{}])},MaxAIPromptActionConfig:He(ie?.MaxAIPromptActionConfig||E),...ei}};gi!==void 0&&(lu.parameters.AskChatGPTActionQuestion.meta.includeHistory=gi),Ee.push(lu);let pu=await s?.();await(P?.appearance_v2_enabled?O:N)(Ee,{isSaveLastRunShortcuts:f,conversationId:pu?pu.id:void 0}).then(()=>{let Pe=V?.getNextAction()?.error||""}).catch(Pe=>{}).finally(()=>{n!=="PromptPreview"&&!I&&(ce(),At({}),F(!1),a?.("runPrompt")),l?.({data:ue(),type:"change",success:!0},"runPromptEnd")})}},[K.chatMode,O,P?.appearance_v2_enabled,N,ke,ue,f,l,a,ce,V,yt,ie,p,m,d,n,C,y,I]),q=(0,Ne.useMemo)(()=>{let fe={},Q=r||ie?.variables||[],Te=t||ie?.title||"";if(ie?.MaxAIPromptActionConfig?.prompt_id){let Pe=ie.MaxAIPromptActionConfig.prompt_id,io=`package__features:context_menu__prompt__${Pe}`;zp().t(io).includes(Pe)||(Te=zp().t(io))}let Be=[],Le=[],Ee=ue();n==="PromptPreview"&&ce(),Q.forEach(Pe=>{let io=n==="PromptPreview"&&Ee[Pe.name]!==void 0?Ee[Pe.name]:Pe.default_value?.trim();if(Pe.hidden){if(r4)return;Pe.hint?.startsWith("(Dev show) ")||(Pe.hint="(Dev show) "+Pe.hint)}Pe.type==="select"&&Be.push(Pe),Pe.type==="text"&&(Le.push(Pe),Object.prototype.hasOwnProperty.call(Ee,Pe.name)&&Z(Pe.name,io));let ll=Pe.optional?[]:[{required:!0,message:""}];fe[Pe.name]=J(Pe.name,{value:io,validate:T7=>{for(let a0 of ll)if(a0.required&&!T7)return a0.message||`${Pe.hint} is required`;return!0}})});let Qn=Be.length,Jn=typeof window>"u"?580:window.innerHeight*.6,kt=Be.length+Le.length>0?36:30,wo=Math.ceil(Qn/3),st=wo*48+(wo-1)*16,ei=Le.length,gi=(ei-1)*16,lu=16*3,pu=Jn-kt-st-gi-lu,i0=Math.max(Math.floor(pu/24/ei)-3,2);return mp.getSetVariablesModalSelectCache().then(Pe=>{let io=Object.keys(fe);io.length!==0&&(io.forEach(ll=>{Pe[ll]!==void 0&&Z(ll,Pe[ll])}),At(fe))}),{titleHeight:kt,currentTitle:Te,currentSelectTotalCount:Qn,selectTypeVariables:Be,textTypeVariables:Le,maxTextareaMaxRows:i0,minTextareaMaxRows:2}},[r,t,n,ie]);(0,Ne.useEffect)(()=>{let fe=Zi.receive(`SetVariablesModal_${W}`,Q=>new Promise((Te,Be)=>{Q.task==="open"&&(At({}),ce(),G(Q.config),F(!1),setTimeout(()=>{Q.config.waitForUserAction?X([{resolve:Te,reject:Be}]):Te({data:He(tt),type:"confirm",success:!0})},200))}));return()=>{fe()}},[W]);let de=(0,Ne.useRef)(zt);de.current=zt,(0,Ne.useEffect)(()=>{if(!V)return;let fe=(Q,{currentAction:Te})=>{Q==="afterRunAction"&&Te&&Te.type==="SET_VARIABLES_MODAL"&&de.current(!0,{ignoreChatHubLoading:!0}).then().catch(Be=>{})};return V.addListener(fe),()=>{V.removeListener(fe)}},[V]);let se=()=>{let fe=Array.from(B.current?.querySelectorAll("textarea")||[]);if(fe.length===0)return;let Q=fe.find(Te=>!Te.hasAttribute("aria-hidden")&&Te.value==="")||fe[0];return Q&&(Q.focus(),Q.setSelectionRange(0,0)),Q};(0,Ne.useEffect)(()=>{if(R){if(Y)a?.("reset");else if(setTimeout(()=>{se()},500),i?.(),b){let fe=()=>{se()};return setTimeout(()=>{B.current?.removeEventListener("focusout",fe)},500),B.current?.addEventListener("focusout",fe),()=>{B.current?.removeEventListener("focusout",fe)}}}},[R,Y]);let Se=(0,Ne.useRef)(null),To=fe=>{Se.current=fe},ar=()=>{Se.current?Se.current.focus():se()};(0,Ne.useImperativeHandle)(e,()=>({discard:()=>Zt(!0),focusLastFocusInput:ar}));let ot=ge(W),_e=(0,Ne.useRef)(!1);return!o.show&&(!R||Y||Object.keys(tt).length===0)||ot?null:Ne.default.createElement(g,{className:"max-ai__action__set_variables_modal",sx:{width:"100%",overflow:"hidden",pb:1,gap:1,boxSizing:"border-box",...x},maxHeight:"60vh",onKeyPressCapture:fe=>{fe.stopPropagation()},onKeyPress:fe=>{fe.stopPropagation()}},Ne.default.createElement(g,{flexShrink:0,height:q.titleHeight,direction:"row",alignItems:"start",justifyContent:"space-between",width:"100%"},Ne.default.createElement(L,{width:0,flex:1,component:"div",display:"flex",alignItems:"center"},Ne.default.createElement(T,{fontSize:"14px",color:"#fff",fontWeight:600,height:30,lineHeight:"30px",sx:{textAlign:"left",borderRadius:"8px",p:"0 8px",bgcolor:"rgba(0, 0, 0, 0.87)",width:n!=="PromptPreview"?"100%":"auto"},noWrap:!0},q.currentTitle)),h&&Ne.default.createElement(je,{"data-testid":"close-modal-button",onClick:async()=>await Zt(!0),sx:{flexShrink:0,position:"relative",top:"-8px",right:"-8px"}},Ne.default.createElement(n4.default,{sx:{fontSize:"24px"}}))),Ne.default.createElement(g,{flexShrink:0,flexWrap:"wrap",direction:"row",display:q.selectTypeVariables.length?void 0:"none",sx:{gap:"16px"}},q.selectTypeVariables.map((fe,Q)=>{if(fe.type==="select"){let Te=D?.querySelector('div[data-testid="maxai--chat-box--tools--left-container--portal-root"]');return Te?s4.default.createPortal(Ne.default.createElement(Fa,{key:fe.name,control:oe,name:fe.name,defaultValue:fe.default_value,render:({field:Be})=>Ne.default.createElement(Rd,{systemVariableSelectKey:fe.name,key:fe.name,defaultValue:Be.value,onChange:Le=>{w||mp.setVariablesModalSelectCache(fe.name,Le),Be.onChange(Le)}})}),Te):void 0}return null})),Ne.default.createElement(g,{component:"div",direction:"row",flexWrap:"wrap",gap:2,paddingTop:1,ref:B,flex:1,height:0,display:q.textTypeVariables.length?void 0:"none",sx:{overflowY:"auto"}},q.textTypeVariables.map((fe,Q)=>{let Te=($==="lg"||$==="xl")&&q.textTypeVariables.length>1?"calc(50% - 8px)":"100%",Be=q.minTextareaMaxRows*23+17;return Ne.default.createElement(Lt,{"data-testid":`custom-variable--${fe.name}`,sx:{width:Te},size:"small",key:fe.name,label:fe.label||fe.hint||"Label",...tt[fe.name],onKeyUp:Le=>{u?.({data:ue(),type:"input",success:!0,variables:q.textTypeVariables}),Le.stopPropagation()},onKeyDown:async Le=>{Le.key==="Enter"&&!Le.shiftKey&&!_e.current?(Le.stopPropagation(),Le.preventDefault(),await Zo(Q)):Le.stopPropagation()},onCompositionStart:()=>{_e.current=!0},onCompositionEnd:()=>{_e.current=!1},onPaste:Le=>{Le.stopPropagation()},InputProps:{sx:{fontSize:"16px",minHeight:Be}},inputProps:{style:{fontSize:"16px",textAlign:"left"}},FormHelperTextProps:{sx:{ml:0,fontSize:"12px"}},error:!!at[fe.name],helperText:at[fe.name]?.message||"",InputLabelProps:{shrink:!0,sx:{fontSize:"16px"}},multiline:!0,placeholder:fe.hint,minRows:q.minTextareaMaxRows,maxRows:q.maxTextareaMaxRows,onFocus:Le=>To(Le.target)})})),Ne.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"end",gap:1,flexShrink:0},Ne.default.createElement(me,{title:H(U?"package__features:chat__inputbox__button__stop_generating__tooltip":"package__features:chat__inputbox__button__send_to_ai__tooltip"),description:U?void 0:"\u23CE",placement:"bottom",disabled:_||!we},Ne.default.createElement(le,{"data-testid":"sidebar-variables-modal--send-btn",disabled:U?_:_||!we,onClick:()=>{U?A():Zo()},variant:"contained",sx:{width:"32px",height:"32px",minWidth:"unset",borderRadius:"8px"}},U?Ne.default.createElement(a4.default,{sx:{fontSize:"16px",color:"white !important"}}):Ne.default.createElement(i4.default,{sx:{fontSize:"16px"}})))))});l4.displayName="ActionSetVariablesModal";var zd=Ne.default.memo(l4);var S4=S(Cr());var be=S(M());var hp=S(M());var qd=S(M());var Nn=S(M());var xP=o=>{let{anchorElementSelectors:e='[data-testid="max-ai__ai-provider-floating-button"]',placement:t="top",...r}=o,{t:n}=v(),[i,a]=Nn.default.useState(!0),{localSettings:s}=_t(),[l,c]=Nn.default.useState(!1),u=(0,Nn.useCallback)(async()=>{await qe.getOnboardingDataByKey("ON_BOARDING__RECORD_FIRST_CLICK_PRO_CHAT_SWITCH")&&s.chatMode==="pro_chat"&&c(!0)},[s.chatMode]),{extensionTourOnBoardingOpened:p}=on();return(0,Nn.useEffect)(()=>{p&&qe.getOnboardingDataByKey(Ec).then(m=>a(!!m))},[p]),(0,Nn.useEffect)(()=>{i||u()},[i,u]),i?null:Nn.default.createElement(Bt,{placement:t,trigger:l,anchorElementSelectors:e,onShow:()=>{qe.setOnboardingData(Ec,!0)},CtaButtonProps:{"data-button-clicked-name":"Onboarding > Choose a smarter AI > Got it"},...r},Nn.default.createElement(g,{spacing:.5},Nn.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},n("package__features:onboarding__onboarding_popover__ai_model_selector__title")),Nn.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},n("package__features:onboarding__onboarding_popover__ai_model_selector__description"))))},Ud=xP;var Wd=class{constructor(e=!1){this.defaultCaptureEvent=e;this.executionIndex=new Map;this.eventMap=new Map}add(e,t,r,n=0,i=this.defaultCaptureEvent){this.eventMap.has(e)||this.eventMap.set(e,new Map);let a=this.eventMap.get(e);if(!a.has(t)){a.set(t,[]);let l=c=>{let u=!0,p=a.get(t).sort((m,d)=>d.priority-m.priority);for(let m of p){let d=new Proxy(c,{get(h,f){if(f==="stopSpread")return()=>{u=!1};let _=h[f];return typeof _=="function"?_.bind(h):_}});if(m.handler(d),!u)break}};e.addEventListener(t,l,i),a.set(`${t}_proxy`,[{handler:l,priority:0}])}a.get(t).push({handler:r,priority:n})}remove(e,t,r,n=this.defaultCaptureEvent){let i=this.eventMap.get(e);if(!i)return;let a=i.get(t);if(!a)return;let s=a.findIndex(l=>l.handler===r);if(s>-1&&a.splice(s,1),a.length===0){let l=i.get(`${t}_proxy`);l&&l[0]&&e.removeEventListener(t,l[0].handler,n),i.delete(t),i.delete(`${t}_proxy`)}i.size===0&&this.eventMap.delete(e)}removeAll(e){let t=this.eventMap.get(e);if(t){for(let r of t.keys()){if(r.endsWith("_proxy"))continue;let n=t.get(`${r}_proxy`);n&&n[0]&&e.removeEventListener(r,n[0].handler)}this.eventMap.delete(e)}}executeOnPriority(e,t,r){let n=this.eventMap.get(e);if(!n)return!0;let i=n.get(t);if(!i||i.length===0)return!0;if(t==="keydown"&&r?.event instanceof KeyboardEvent){let m=r.event;if(r.keys&&!r.keys.includes(m.key))return!0}let a=`${e.toString()}_${String(t)}`,s=this.executionIndex.get(a)??0,l=[...i].sort((m,d)=>d.priority-m.priority);if(s>=l.length)return this.executionIndex.delete(a),!0;let c=l[s],u=r?.event||new Event(t),p=new Proxy(u,{get:(m,d)=>{if(d==="stopSpread")return()=>{this.executionIndex.delete(a)};let h=m[d];return typeof h=="function"?h.bind(m):h}});return c.handler(p),this.executionIndex.set(a,s+1),!1}};var Gd=class{static{this.managers=new Map}static getManager(e,t=!1){return this.managers.has(e)||this.managers.set(e,new Wd(t)),this.managers.get(e)}static removeManager(e){this.managers.has(e)&&this.managers.delete(e)}static clear(){this.managers.clear()}};var ca=S(M()),p4=(0,ca.createContext)(null);function Kd({children:o,managerId:e="default",defaultCaptureEvent:t=!1}){let r=(0,ca.useRef)(Gd.getManager(e,t)),n=(0,ca.useRef)((a,s)=>{a.stopPropagation(),a.preventDefault(),s&&a.stopSpread()}),i={domEventManager:r.current,stopPropagation:n.current};return ca.default.createElement(p4.Provider,{value:i},o)}function dp(){let o=(0,ca.useContext)(p4);if(!o)throw new Error("useDomEventManager must be used within DomEventManagerProvider");return o}var Ct=S(M());var bo=S(M());var eg=class o extends du{constructor(){super()}static getInstance(){return this.instance||(this.instance=new o),this.instance}},fp=()=>eg.getInstance();var fs=S(M());var Ws=S(M()),_P=({model:o,selectedModel:e,onSelect:t,listItemIndex:r,focusKey:n,onFocusKey:i,zIndex:a,eventPriority:s,parentOpen:l,MainComponent:c})=>{let{t:u}=v(),{label:p,children:m}=o,d=Ta(p||"",u);return Ws.default.createElement(Ws.default.Fragment,null,d&&Ws.default.createElement(St,{sx:{fontSize:"12px",lineHeight:"18px",fontWeight:500,p:"2px 8px",color:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)",opacity:"1!important",mt:r===0?void 0:"4px",minHeight:"unset"},disabled:!0},d+" AI"),m?.map(h=>Ws.default.createElement(c,{key:h.key,model:h,selectedModel:e,onSelect:t,focusKey:n,onFocusKey:i,zIndex:a,eventPriority:s,parentOpen:l})))},c4=(0,Ws.memo)(_P);var u4=S(M()),CP=({sx:o,children:e,...t})=>u4.default.createElement(T,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"text.primary",...o},...t},e),ds=CP;var pr=S(M());var jd=S(M()),tg=o=>{let{tag:e,...t}=o,{t:r}=v(),n=Ta(e,r);return n==="New"?jd.default.createElement(T,{component:"span",bgcolor:"rgba(52, 168, 83, 1)",color:"#fff",fontSize:"9px",fontWeight:500,px:"4px",py:"1px",borderRadius:"4px",lineHeight:1.5,whiteSpace:"nowrap",...t},n):n==="Beta"?jd.default.createElement(T,{component:"span",color:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.38)",border:"1px solid",borderColor:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)",fontSize:"9px",fontWeight:500,px:"4px",py:"1px",borderRadius:"4px",lineHeight:1.5,whiteSpace:"nowrap",...t},n):jd.default.createElement(T,{component:"span",bgcolor:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.06)",color:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.6)",fontSize:"9px",fontWeight:500,px:"4px",py:"1px",borderRadius:"4px",lineHeight:1.5,whiteSpace:"nowrap",...t},n)},m4=tg;var yP=({model:o,selectedModel:e,onSelect:t,isKeyOrChildrenFocused:r,onFocusKey:n,zIndex:i,parentOpen:a})=>{let{t:s}=v(),{key:l,label:c,value:u}=o,p=Ta(c||"",s),m=u,{open:d,handleOpen:h,handleClose:f}=dm({delay:{open:100}});(0,pr.useEffect)(()=>{a===!1&&f()},[a,f]),(0,pr.useEffect)(()=>{r===!1&&f()},[r,f]);let _=(0,pr.useCallback)(()=>{h(),n?.(l)},[l,n,h]),x=(0,pr.useRef)(null);return Ku(x,C=>{C||requestAnimationFrame(()=>{f()})}),m?pr.default.createElement(me,{open:d,placement:"right",sx:{maxWidth:"200px"},disableInteractive:!0,TransitionProps:{timeout:{enter:300,exit:0}},PopperProps:{modifiers:[{name:"flip",enabled:!0,options:{fallbackPlacements:["right","left"]}}]},zIndex:i,title:Mm(m,s)},pr.default.createElement(St,{component:"div",key:l,ref:x,"data-testid":`maxai--ai-model-selector--menu-item--${m.value}`,"data-menu-item-key":l,disabled:m.disabled,selected:m.value===e,onClick:()=>{t(m),f()},onMouseEnter:_,onMouseLeave:f,sx:{...Hu,...r&&{backgroundColor:C=>C.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.04)"}}},pr.default.createElement(g,{alignItems:"center",direction:"row",spacing:1,sx:yl},pr.default.createElement(Jo,{model:m.value}),pr.default.createElement(ds,{fontSize:"14px",lineHeight:"21px",sx:{pr:"8px"}},p),pr.default.createElement(g,{direction:"row",alignItems:"center",sx:{ml:"auto !important"}},m.tag&&pr.default.createElement(m4,{tag:m.tag}))))):null},d4=(0,pr.memo)(yP);var f4=S(qC());var wt=S(M());var bP=({model:o,selectedModel:e,onSelect:t,onFocusKey:r,zIndex:n,eventPriority:i,parentOpen:a,isKeyOrChildrenFocused:s,MainComponent:l})=>{let{t:c}=v(),{key:u,label:p,children:m}=o,d=Ta(p||"",c),{open:h,handleOpen:f,handleClose:_}=dm({delay:{open:100}}),[x,C]=(0,wt.useState)(!1),y=(0,wt.useRef)(0),[b,w]=(0,wt.useState)(""),I=(0,wt.useCallback)(()=>{_(),y.current=0,w(""),C(!1)},[_]),E=(0,wt.useCallback)((R=!0)=>{f(),R&&C(!0)},[f]);(0,wt.useEffect)(()=>{(!s||a===!1)&&I()},[I,a,s]);let P=(0,wt.useCallback)(R=>{t(R),I()},[t,I]),O=(0,wt.useRef)(null),N=(0,wt.useCallback)(()=>{O.current=setTimeout(()=>{I()},300)},[I]),V=(0,wt.useCallback)(()=>{r?.(u),O.current&&clearTimeout(O.current),E(!1)},[u,r,E]),A=(0,wt.useCallback)(R=>{C(!0),w(R),m&&(y.current=m?.findIndex(F=>F?.key===R))},[m]),{domEventManager:D,stopPropagation:W}=dp(),[k,U]=(0,wt.useState)(!1),K=fp();(0,wt.useEffect)(()=>{let R=Y=>{if(!m?.length)return;let $=()=>W(Y,!0);switch(["ArrowDown","ArrowUp"].includes(Y.key)&&m?.length>1&&(U(!0),requestAnimationFrame(()=>{K.emit("scrollToItem",m[y.current].key)})),Y.key){case"ArrowRight":if(!s)return;$(),m?.[0]&&w(m[0].key),E();break;case"ArrowUp":if(!h||!x||!s)return;$(),y.current=(y.current-1+m.length)%m.length,w(m[y.current].key);break;case"ArrowDown":if(!h||!x||!s)return;$(),y.current=(y.current+1)%m.length,w(m[y.current].key);break;case"Enter":{if(!h||!x||!s)return;$();let ie=m[y.current];ie?.value&&P(ie.value);break}case"Tab":$();break}},F=()=>{U(!1)};return D.add(document,"keydown",R,i),D.add(document,"mousemove",F),()=>{D.remove(document,"keydown",R),D.remove(document,"mousemove",F)}},[K,m,D,i,E,P,x,s,u,h,W]),(0,wt.useEffect)(()=>{let R=F=>{if(!m?.length)return;let Y=()=>W(F,!0);switch(F.key){case"Escape":case"ArrowLeft":if(!h)return;Y(),I();break}};return s&&D.add(document,"keydown",R,i,!0),()=>{D.remove(document,"keydown",R,!0)}},[m?.length,D,i,I,h,W,s]);let H=(0,wt.useRef)(null);return Ku(H,R=>{R||requestAnimationFrame(()=>{I()})}),wt.default.createElement(Ga,{open:h,placement:"right-start",sx:{zIndex:n},contentSx:{display:s?"block":"none",width:"auto",minWidth:"200px"},onMouseEnter:V,onMouseLeave:N,modifiers:[{name:"flip",options:{fallbackPlacements:["left-start"]}}],customTransitionProps:{timeout:{enter:300,exit:0}},referenceElementBoxProps:{component:"li","data-menu-item-key":u,"data-testid":`maxai--ai-model-selector--menu-more-item--${u}`,sx:{display:"flex",alignItems:"center",cursor:"pointer",...Hu,...s&&{backgroundColor:R=>R.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.04)"}}},referenceElement:wt.default.createElement(g,{ref:H,alignItems:"center",direction:"row",spacing:1,sx:yl},wt.default.createElement(z,{icon:"More",size:20,sx:{color:R=>R.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)"}}),wt.default.createElement(ds,{fontSize:"14px",lineHeight:"21px"},d),wt.default.createElement(f4.default,{sx:{ml:"auto !important",color:R=>R.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}))},wt.default.createElement(Pn,{sx:{scrollPaddingBlock:"6px",cursor:k?"none":"default","& *":{cursor:k?"none !important":"",pointerEvents:k?"none":"auto"}}},m?.map(R=>wt.default.createElement(l,{key:R.key,model:R,selectedModel:e,onSelect:P,focusKey:b,onFocusKey:A,zIndex:n&&n+1,eventPriority:i&&i+1,parentOpen:h}))))},h4=(0,wt.memo)(bP);var og=({model:o,selectedModel:e,onSelect:t,listItemIndex:r,focusKey:n,onFocusKey:i,zIndex:a,eventPriority:s,parentOpen:l})=>{let{type:c="item"}=o,u=(0,fs.useMemo)(()=>{let p=m=>m.key===n?!0:m.children?m.children.some(d=>p(d)):!1;return p(o)},[o,n]);switch(c){case"item":return fs.default.createElement(d4,{model:o,selectedModel:e,onSelect:t,onFocusKey:i,zIndex:a,parentOpen:l,isKeyOrChildrenFocused:u});case"group":return fs.default.createElement(c4,{model:o,selectedModel:e,onSelect:t,listItemIndex:r,focusKey:n,onFocusKey:i,zIndex:a,eventPriority:s,parentOpen:l,MainComponent:og});case"more":return fs.default.createElement(h4,{model:o,selectedModel:e,onSelect:t,onFocusKey:i,zIndex:a,eventPriority:s,parentOpen:l,MainComponent:og,isKeyOrChildrenFocused:u});default:return null}},g4=(0,fs.memo)(og);var IP=o=>{let{conversationType:e,AIModel:t,onSelect:r,onClose:n,buttonRef:i,sx:a,parentOpen:s}=o,l=(0,bo.useMemo)(()=>H2(e),[e]),c=i?.current?.getBoundingClientRect()??{y:0,height:0},u=c.y-10,p=window.innerHeight-c.y-c.height-10,m=Math.max(u,p),d=Math.min(m,370),h=(0,bo.useCallback)(async N=>{r?.(e,N.AIProvider,N.value)},[e,r]),f=(0,bo.useMemo)(()=>l.flatMap(N=>N.children),[l]),_=(0,bo.useRef)(-1),[x,C]=(0,bo.useState)(""),y=(0,bo.useCallback)(N=>{C(N),_.current=f.findIndex(V=>V?.key===N)},[f]),{domEventManager:b,stopPropagation:w}=dp(),[I,E]=(0,bo.useState)(!1),P=fp();(0,bo.useEffect)(()=>{let N=A=>{if(!f?.length)return;let D=()=>w(A);switch(["ArrowDown","ArrowUp"].includes(A.key)&&(E(!0),requestAnimationFrame(()=>{P.emit("scrollToItem",f[_.current]?.key??"")})),A.key){case"ArrowDown":D(),_.current=(_.current+1)%f.length,C(f[_.current]?.key??"");break;case"ArrowUp":D(),_.current=_.current<0?f.length-1:(_.current-1+f.length)%f.length,C(f[_.current]?.key??"");break;case"Escape":D(),n?.();break;case"Enter":{D();let W=f?.[_.current];W?.value&&h(W.value);break}case"Tab":D();break}},V=()=>{E(!1)};return b.add(document,"keydown",N,1),b.add(document,"mousemove",V),()=>{b.remove(document,"keydown",N),b.remove(document,"mousemove",V)}},[f,h,w,n,b,P]),(0,bo.useEffect)(()=>{let N=V=>{if(!f?.length)return;let A=()=>w(V);switch(V.key){case"Escape":A(),n?.();break}};return b.add(document,"keydown",N,1),()=>{b.remove(document,"keydown",N)}},[b,f?.length,x,n,w]);let O=(0,bo.useRef)(null);return(0,bo.useEffect)(()=>{let N=V=>{let A=_.current===0,D=_.current===f.length-1,W=O.current?.querySelector(`[data-menu-item-key="${V}"]`);W&&(W.scrollIntoView({block:"nearest"}),A?O.current?.scrollTo({top:0,behavior:"smooth"}):D&&O.current?.scrollTo({top:O.current.scrollHeight,behavior:"smooth"}))};return P.on("scrollToItem",N),()=>{P.off("scrollToItem",N)}},[f,P]),bo.default.createElement(Pn,{component:"div",ref:O,id:"maxai-ai-model-selector-menu","data-testid":"maxai--ai-model-selector-card","aria-labelledby":"maxai-ai-model-selector-menu",disableListWrap:!0,sx:{scrollPaddingBlock:"6px",cursor:I?"none":"default","& *":{cursor:I?"none !important":"",pointerEvents:I?"none":"auto"},overflowY:"auto",overflowX:"hidden",flexShrink:0,maxHeight:d,py:"6px",boxSizing:"border-box",bgcolor:N=>N.palette.mode==="dark"?"rgba(61, 61, 61, 1)":"#fff",...a}},l.map((N,V)=>bo.default.createElement(g4,{key:N.key,listItemIndex:V,model:N,selectedModel:t,onSelect:h,focusKey:x,onFocusKey:y,zIndex:2147483622,eventPriority:2,parentOpen:s})))},x4=(0,bo.memo)(IP);var vP=[...Ti.FREE,...Ti.FAST,...Ti.SMART,...Ti.REASONING,...Ti.LEGACY],rg=(o,e)=>({currentModelDetail:(0,Ct.useMemo)(()=>{let r=vP.find(a=>a.value===o);if(r&&r.AIProvider===e)return{label:r.title,value:r.value,AIProvider:r.AIProvider};let n=kx[e],i=n.find(a=>a.value===o)||n?.[0];return i?{label:i?.title||"",value:i?.value||"",AIProvider:e}:{label:v1.title,value:v1.value,AIProvider:"USE_CHAT_GPT_PLUS"}},[e,o])}),MP=o=>{let{mode:e,conversationType:t="Chat",AIProvider:r=T1[t].AIProvider,AIModel:n=T1[t].AIModel,onChange:i,sx:a,disabled:s,labelProps:l,tooltipProps:c,popperProps:u,domEventManagerId:p,defaultCaptureEvent:m=!0,...d}=o,{t:h}=v(),[f,_]=(0,Ct.useState)(!1),{currentModelDetail:x}=rg(n,r),[C,y]=(0,Ct.useState)(!1),b=(0,Ct.useCallback)(()=>{y(!1)},[y]),w=(0,Ct.useCallback)(()=>{y(!C)},[C,y]),I=(0,Ct.useRef)(null),E=(0,Ct.useCallback)(async(K,H,R)=>{b(),_(!1),await qe.setOnboardingData("ON_BOARDING__RECORD_FIRST_SELECTOR_AI_MODEL",!0),i?.(K,H,R)},[i,b]),P=[{name:"RTLSupport",enabled:typeof document<"u"&&document.querySelector("body")?.getAttribute("dir")==="rtl",phase:"main",fn({state:K}){if(K.modifiersData.popperOffsets){let R=K.rects.reference.x+K.rects.reference.width-K.rects.popper.width;R>0&&(K.modifiersData.popperOffsets.x=R)}}},{name:"offset",options:{offset:[0,5]}},{name:"flip",options:{fallbackPlacements:["top-start"]}}],O=(0,Ct.useRef)(C);(0,Ct.useEffect)(()=>{O.current===!0&&C===!1&&I.current.focus(),O.current=C},[C]);let N=(0,Ct.useCallback)(()=>{w()},[w]),V=(0,Ct.useCallback)(K=>{y(K),K||_(!1)},[y]),A=(0,Ct.useCallback)(()=>{V(!1),I.current?.matches(":hover")&&_(!0)},[V]),D=$e(t),W=$e(r),k=$e(n),U=fp();return(0,Ct.useEffect)(()=>{let K=H=>{let R=H({conversationType:D.current,AIProvider:W.current,AIModel:k.current});R&&E(R.conversationType??D.current,R.AIProvider,R.AIModel)};return U.on("closePopper",A),U.on("selectModel",K),()=>{U.off("closePopper",A),U.off("selectModel",K)}},[U,E,A,D,W,k]),Ct.default.createElement(Kd,{managerId:p,defaultCaptureEvent:m},Ct.default.createElement(Ga,{width:220,sx:{zIndex:2147483621},open:C,onOpenChange:V,placement:"bottom-start",isMirror:!0,modifiers:P,referenceElement:Ct.default.createElement(me,{title:h("package__features:chat__ai_model_selector__button__tooltip"),testId:"maxai--ai-model-selector--tooltip",open:f&&!C,...c},Ct.default.createElement(le,{disableRipple:!0,disabled:s,id:"max-ai__ai-provider-floating-button","data-testid":"max-ai__ai-provider-floating-button",ref:I,sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",p:.5,pl:"6px",height:32,minWidth:e==="mini"?"auto":void 0,...a},"aria-controls":C?"composition-menu":void 0,"aria-expanded":C?"true":void 0,"aria-haspopup":"true",onClick:N,onMouseEnter:()=>{C||_(!0)},onMouseLeave:()=>{C||_(!1)},...d},Ct.default.createElement(g,{direction:"row",alignItems:"center"},Tl(r)?Ct.default.createElement(ku,{sx:{fontSize:"20px"}}):Ct.default.createElement(Jo,{model:n}),e!=="mini"&&x?.label&&Ct.default.createElement(T,{mx:.5,fontSize:14,lineHeight:1.4,color:"text.secondary",...l,sx:{userSelect:"none",...l?.sx}},x.label),Ct.default.createElement(z,{icon:"ExpandMore",sx:{color:"text.secondary",fontSize:"18px",transform:C?"rotate(180deg)":"rotate(0)"}})))),...u},Ct.default.createElement(x4,{buttonRef:I,conversationType:t,AIProvider:r,AIModel:n,onSelect:E,onClose:A,parentOpen:C})),Ct.default.createElement(Ud,null))},_4=MP;var TP=o=>{let{disabled:e,onChanged:t,domEventManagerId:r,defaultCaptureEvent:n,AIModel:i,AIProvider:a,setAIModelAndProvider:s,...l}=o,{conversationId:c,conversationType:u,inputMediator:p}=Ai(),m=ge(c),d=$e(t),h=(0,qd.useCallback)(async(f,_,x)=>{let C=async()=>{s({AIProvider:_,AIModel:x}),p.focus(),d.current?.(a,i)};if(ao)C();else{if(!await Fe({emitEvent:!0}))return;C()}},[i,a,p,d,s]);return qd.default.createElement(_4,{conversationType:u,AIProvider:a,AIModel:i,onChange:h,disabled:e||m,domEventManagerId:r,defaultCaptureEvent:n,...l})},C4=TP;var y4=S(rm());var ye=S(M());var wP=o=>{let{t:e}=v(),{mode:t,AIProvider:r,AIModel:n,sx:i,disabled:a,labelProps:s,menuIsOpen:l,controlRef:c,...u}=o,{currentModelDetail:p}=rg(n,r);return ye.default.createElement(le,{ref:c,disableRipple:!0,disabled:a,id:"max-ai__ai-provider-floating-button","data-testid":"max-ai__ai-provider-floating-button",sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",p:.5,pl:"6px",height:32,minWidth:t==="mini"?"auto":void 0,...i},...u},ye.default.createElement(g,{direction:"row",alignItems:"center"},Tl(r)?ye.default.createElement(ku,{sx:{fontSize:"20px"}}):ye.default.createElement(Jo,{model:n}),t!=="mini"&&p?.label&&ye.default.createElement(T,{ml:"4px",mr:"2px",fontSize:14,lineHeight:1.4,color:"text.secondary",...s,sx:{userSelect:"none",...s?.sx}},e(Zp[N1[p.value]]?.label)),ye.default.createElement(z,{icon:"ExpandMore",sx:{color:"text.secondary",fontSize:"18px",transform:l?"rotate(180deg)":"rotate(0)"}})))},EP=o=>{let{model:e,selectedModel:t,currentKeyboardArrowSelectModel:r,zIndex:n,sx:i,...a}=o,{t:s}=v(),l=(0,ye.useMemo)(()=>e.value===r,[e,r]);return ye.default.createElement(me,{autoCalculatePlacementWithFallback:["right","left","top","bottom"],sx:{maxWidth:"200px"},disableInteractive:!0,TransitionProps:{timeout:{enter:300,exit:0}},zIndex:n,title:Mm(e,s)},ye.default.createElement(St,{component:"div",key:e.value,"data-testid":`maxai--ai-model-selector--menu-item--${e.value}`,"data-menu-item-key":e.value,sx:{borderRadius:"6px",minHeight:"unset",p:"6px 10px 6px 10px",height:"40px","&:hover":{backgroundColor:c=>c.palette.mode==="dark"?"rgba(255, 255, 255, .1)":"rgba(0, 0, 0, 0.04)"},...l&&{backgroundColor:c=>c.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.04)"},...i},...a},ye.default.createElement(g,{alignItems:"center",direction:"row",spacing:1,sx:yl},ye.default.createElement(Jo,{model:e.value}),ye.default.createElement(ds,{fontSize:"14px",lineHeight:"21px"},e.title),ye.default.createElement(g,{direction:"row",alignItems:"center",sx:{}},e.tag&&ye.default.createElement(tg,{tag:e.tag})),e.value===t&&ye.default.createElement(y4.default,{sx:{color:"text.primary",ml:"auto !important",fontSize:"18px"}}))))},ua=[Zp.FAST,Zp.SMART,Zp.REASONING],PP=o=>{let{AIModel:e,AIProvider:t,chatHubOrder:r,conversationType:n,onChange:i,onClose:a,open:s,anchorEl:l}=o,{t:c}=v(),{domEventManager:u,stopPropagation:p}=dp(),m=N1[e]||ua[0].key,[d,h]=(0,ye.useState)(!1),[f,_]=(0,ye.useState)(null),x=(0,ye.useRef)(ua.findIndex(A=>A.key===m)||0),[C,y]=(0,ye.useState)(m);(0,ye.useEffect)(()=>{s?(h(!1),y(m),x.current=ua.findIndex(A=>A.key===m)||0,B2().then(A=>{let D=null;r!==void 0?D=A.chatHub[r]:D=A.chat;let W=O2[D];W&&!Object.values(W).some(k=>k.value===e)&&F1(H1(e),r)})):_(null)},[s,m,r,e]);let b=(0,ye.useMemo)(()=>Ti[C],[C]),w=(0,ye.useMemo)(()=>{let A=b.findIndex(D=>D.value===e);return{nextModel:b[(A+1)%b.length]??b[0],prevModel:b[(A-1+b.length)%b.length]??b[0]}},[e,b]),I=(0,ye.useCallback)(A=>{let D=H1(A.value);D&&F1(D,r)},[r]),E=(0,ye.useCallback)((A,D,W)=>{W?.isUpdateTemporaryProvider&&I(A),W?.isCloseMenu&&a?.(),i(n,A.AIProvider,A.value,D),_(D==="keyboardArrow"?A.value??null:null)},[i,n,I,a]),P=(0,ye.useCallback)((A,D)=>{E(A,D,{isUpdateTemporaryProvider:!0,isCloseMenu:!0})},[E]),O=(0,ye.useCallback)(async(A,D)=>{y(A);let W=await D2(e,A,r);if(W)E(W,D);else{let k=Ti[A][0];E(k,D)}},[e,r,E]);(0,ye.useEffect)(()=>{let A=W=>{if(!b?.length||!s)return;let k=()=>p(W);switch(["ArrowDown","ArrowUp"].includes(W.key)&&h(!0),W.key){case"ArrowDown":k(),E(w.nextModel,"keyboardArrow",{isUpdateTemporaryProvider:!0});break;case"ArrowUp":k(),E(w.prevModel,"keyboardArrow",{isUpdateTemporaryProvider:!0});break;case"ArrowLeft":k(),x.current=(x.current-1+ua.length)%ua.length,O(ua[x.current].key,"keyboardArrow");break;case"ArrowRight":k(),x.current=(x.current+1)%ua.length,O(ua[x.current].key,"keyboardArrow");break;case"Escape":k(),a?.();break;case"Enter":{k(),a?.();break}case"Tab":k();break}},D=()=>{h(!1)};return u.add(document,"keydown",A,1),u.add(document,"mousemove",D),()=>{u.remove(document,"keydown",A),u.remove(document,"mousemove",D)}},[b,p,a,u,O,P,C,E,w,s]);let N=[{name:"RTLSupport",enabled:typeof document<"u"&&document.querySelector("body")?.getAttribute("dir")==="rtl",phase:"main",fn({state:A}){if(A.modifiersData.popperOffsets){let W=A.rects.reference.x+A.rects.reference.width-A.rects.popper.width;W>0&&(A.modifiersData.popperOffsets.x=W)}}},{name:"offset",options:{offset:[0,5]}},{name:"flip",options:{fallbackPlacements:["top-start"],padding:{top:0,bottom:C==="REASONING"?140:0,left:0,right:0}}}],V=(0,ye.useRef)(null);return(0,ye.useEffect)(()=>{let A=D=>{let W=D.composedPath();V.current&&W.includes(V.current)||setTimeout(()=>{s&&a?.()},0)};return document.addEventListener("mouseup",A),()=>{document.removeEventListener("mouseup",A)}},[a,s]),ye.default.createElement(ex,{placement:"bottom-start",modifiers:N,open:s,anchorEl:l},ye.default.createElement("div",null,ye.default.createElement(g,{ref:V,sx:{gap:"6px",borderRadius:"8px",border:"1px solid",borderColor:A=>A.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.08)",scrollPaddingBlock:"6px",cursor:d?"none":"default","& *":{cursor:d?"none !important":"",pointerEvents:d?"none":"auto"},overflowY:"auto",overflowX:"hidden",flexShrink:0,boxSizing:"border-box",minWidth:"270px",padding:"6px",bgcolor:A=>A.palette.mode==="dark"?"rgba(54, 56, 57, 1)":"#fff",boxShadow:A=>(A.palette.mode==="dark","0px 4px 6px -2px rgba(16, 24, 40, 0.03), 0px 12px 16px -4px rgba(16, 24, 40, 0.08)")}},ye.default.createElement(g,{sx:{flexDirection:"row",gap:"2px"}},ua.map(A=>ye.default.createElement(le,{key:A.key,onClick:()=>O(A.key,"clickTab"),disableRipple:!0,sx:{flex:1,minWidth:"82px",height:"32px",borderRadius:"8px",fontWeight:"400",fontSize:"12px",color:"text.secondary",transition:"none",...C===A.key&&{fontWeight:"500",color:"text.primary",backgroundColor:D=>D.palette.mode==="dark"?"rgba(59, 61, 62, 1)":"#fff",borderWidth:"0.5px",borderStyle:"solid",borderColor:D=>D.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.12)",boxShadow:D=>D.palette.mode==="dark"?"0px 1px 4px 0px rgba(0, 0, 0, 0.16)":"0px 1px 4px 0px rgba(0, 0, 0, 0.08)"}}},c(A.label)))),ye.default.createElement(Pn,{component:"div",id:"maxai-ai-model-selector-menu","data-testid":"maxai--ai-model-selector-card","aria-labelledby":"maxai-ai-model-selector-menu",disableListWrap:!0,sx:{p:0,display:"flex",flexDirection:"column",gap:"4px"}},Ti[C]?.map(A=>ye.default.createElement(EP,{zIndex:2147483621,key:A.value,model:A,selectedModel:o.AIModel,onClick:()=>P(A,"clickModelItem"),currentKeyboardArrowSelectModel:f}))))))},AP=o=>{let{mode:e,chatHubOrder:t,AIProvider:r,AIModel:n,setAIModelAndProvider:i,onChanged:a,sx:s,disabled:l,labelProps:c,tooltipProps:u,popperProps:p,domEventManagerId:m,defaultCaptureEvent:d=!0,...h}=o,{t:f}=v(),{conversationId:_,conversationType:x,inputMediator:C}=Ai(),y=ge(_),b=(0,ye.useRef)(null),[w,I]=(0,ye.useState)(!1),[E,P]=(0,ye.useState)(!1),O=(0,ye.useCallback)(()=>{P(!1),C.focus()},[P,C]),N=w&&!E,V=(A,D,W,k)=>{let U=()=>{i({AIProvider:D,AIModel:W}),a?.(D,W,k)};ao?U():Fe({emitEvent:!0}).then(K=>{K&&U()}),qe.setOnboardingData("ON_BOARDING__RECORD_FIRST_SELECTOR_AI_MODEL",!0)};return ye.default.createElement(Kd,{managerId:m,defaultCaptureEvent:d},ye.default.createElement(me,{open:N,title:f("package__features:chat__ai_model_selector__button__tooltip")},ye.default.createElement("div",null,ye.default.createElement(wP,{controlRef:b,mode:e,conversationType:x,AIProvider:r,AIModel:n,sx:s,disabled:l||y,labelProps:c,menuIsOpen:E,onMouseEnter:()=>{I(!0)},onMouseLeave:()=>{I(!1)},onClick:()=>{P(A=>!A)},...h}))),ye.default.createElement(PP,{open:E,anchorEl:b.current,chatHubOrder:t,conversationType:x,AIProvider:r,AIModel:n,onChange:V,onClose:()=>{O()}}),ye.default.createElement(Ud,null))},ng=AP;var hs=o=>{let{AIModel:e,AIProvider:t}=ko.use.chat(),r=ko.use.setChatAIModelAndProvider();return hp.default.createElement(hp.default.Fragment,null,hp.default.createElement(ng,{AIModel:e,AIProvider:t,chatHubOrder:void 0,setAIModelAndProvider:r,...o}))},b4=o=>{let{AIModel:e,AIProvider:t}=ko.use.art(),r=ko.use.setArtAIModelAndProvider();return hp.default.createElement(C4,{AIModel:e,AIProvider:t,setAIModelAndProvider:r,...o})},I4=({order:o,...e})=>{let{isPayingUser:t}=Mt(),r=t?aC:iC,n=ko.use.chat(),i=ko.use.chatHub(),a=ko.use.setChatAIModelAndProvider(),s=ko.use.setChatHubAIModelAndProvider(),l=o===0?a:m=>{s(o,m)},c=o===0?n:i[o],{AIModel:u,AIProvider:p}=c||r;return hp.default.createElement(ng,{chatHubOrder:o,AIModel:u,AIProvider:p,setAIModelAndProvider:l,...e})};var kP=200,LP=({contentHeight:o})=>{let{t:e}=v(),{palette:t}=gl(),r=(0,be.useMemo)(()=>typeof window>"u"?"immersive_rewrite":Ma()?"sidebar_rewrite":"immersive_rewrite",[]),[n,i]=(0,be.useState)(""),a=$e(n),[s,l]=(0,be.useState)(!1),[c,u]=(0,be.useState)(!1),{askAIQuestion:p,askAIWithShortcuts:m,stopGenerate:d}=Re(),h=Hl(),{conversationId:f}=Ce(),_=ge(f),x=h.getInputValue(),{liteContextMenuActionsItems:C}=Bi(x),y=(0,be.useRef)(null),b=(0,be.useMemo)(()=>c?[]:C,[c,C,e]),w=(0,be.useMemo)(()=>b.flatMap(B=>{if(B.type==="group"){let ae=`context_menu__prompt__${B.prompt_id}`,X=`package__features:${ae}`,oe=e(X),ue=wn?oe==="package__features:"+ae:oe===ae;return(!oe||oe===B.prompt_id||ue||ae===X)&&(oe=B.prompt_title),[oe+"__CONTEXT_MENU_LABEL_SLOT_PLACEHOLDER__"+B.prompt_id,...B.children??[]]}return[B]}),[b,e]),I=async()=>{if(!await Fe({emitEvent:!0})){h.focus();return}if(_){d();return}let B=a.current;if(!B){l(!0);return}let ae=y.current?.getSelectedItem();if(ae)A(ae);else if(x.trim()){let X=`${x}:
"""
{{SELECTED_TEXT}}
"""`;await p({type:"user",text:X,meta:{includeHistory:!0}},{beforeActions:[{type:"RENDER_TEMPLATE",parameters:{template:"{{POPUP_DRAFT}}"}},{type:"SET_VARIABLE",parameters:{Variable:{key:"SELECTED_TEXT",overwrite:!0,value:B,isBuiltIn:!0}}},{type:"SET_VARIABLE",parameters:{Variable:{key:"ANALYTICS_FEATURE_NAME",value:r,overwrite:!0,isBuiltIn:!0}}}]})}},E=(0,be.useRef)(null),P=(0,be.useRef)(null),O=(0,be.useRef)(null),N=()=>{O.current?.querySelector("textarea")?.focus()},V=()=>{N()},A=async B=>{if(N(),!a.current){l(!0);return}if(!B||!B.prompt_id||B.type==="group")return;let X=He(B.actions||[]);X.unshift({type:"SET_VARIABLE",parameters:{Variable:{key:"SELECTED_TEXT",value:a.current.trim(),overwrite:!0,isBuiltIn:!0,label:"Selected text overwrite"}}},{type:"SET_VARIABLE",parameters:{Variable:{key:"VARIABLE_MODAL_KEY",value:"SidebarRewrite",overwrite:!0,isBuiltIn:!0}}},{type:"SET_VARIABLE",parameters:{Variable:{key:"ANALYTICS_FEATURE_NAME",value:r,overwrite:!0,isBuiltIn:!0}}}),X.length>0&&m(X,{overwriteParameters:[{key:"SELECTED_TEXT",value:a.current,label:"Selected text",isBuiltIn:!0,overwrite:!0}]})},D=so(),[W,k]=(0,be.useState)(10);(0,be.useEffect)(()=>{let B=Math.floor((o-kP-140)/24);B<=0||k(Math.min(B,10))},[o]);let U=(0,be.useMemo)(()=>Math.min(o-140-W*24,300),[o,W]),K=(0,be.useRef)(null),H=(0,be.useCallback)(()=>{Y.current?.()},[]),R=()=>{P.current?.focus()},F=()=>{h.focus()},Y=(0,be.useRef)(R),$=B=>{Y.current=B},[ie,G]=h2([["maxai-animation-slide-in",{duration:200}],["maxai-animation-slide-in",{fillMode:"forwards",delay:-100,duration:200}]]);return be.default.createElement(be.default.Fragment,null,be.default.createElement(g,{gap:1,sx:{boxSizing:"border-box",border:"1px solid",borderColor:"border.main",bgcolor:t.background.paper,borderRadius:1,boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",overflow:"hidden",isolation:"isolate",width:"100%",py:1,px:1.5,maxWidth:"768px",...ie},onKeyUp:B=>{B.stopPropagation()},onKeyDown:B=>{B.stopPropagation()}},be.default.createElement(g,{direction:"row",justifyContent:"space-between",sx:{wordBreak:"break-word",color:B=>B.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)"},component:"div"},be.default.createElement(g,{direction:"row",gap:.5},be.default.createElement(us,null),be.default.createElement(Od,{enableChatMode:"pro_chat"},be.default.createElement(hs,{conversationType:"ContextMenu",tooltipProps:{placement:"bottom"},sx:{height:"32px"},onChanged:H}),be.default.createElement(ms,{onChanged:H}))),be.default.createElement(g,{direction:"row",gap:1,alignItems:"center"},c&&be.default.createElement(me,{title:e("package__common:discard")},be.default.createElement(je,{onClick:()=>{K.current?.discard()},sx:{width:"auto",color:"inherit",padding:"3px",marginLeft:"-4px",marginRight:"-3px"}},be.default.createElement(S4.default,{sx:{fontSize:17,color:"text.secondary"}}))))),!c&&be.default.createElement(L,{sx:{width:"100%",p:1,bgcolor:B=>B.palette.mode==="dark"?"#3B3D3E":"#F4F4F4",boxShadow:"0px 1px 2px rgba(16, 24, 40, 0.05)",borderRadius:1,boxSizing:"border-box",border:"1px solid",borderColor:s?j0[800]:"transparent","& > textarea":{border:"none",outline:"none",background:"transparent",width:"100%",height:"100%",resize:"none",color:"text.primary",lineHeight:"24px",fontFamily:"inherit",fontSize:"16px"}}},be.default.createElement("textarea",{onFocus:()=>$(R),ref:P,rows:W,onClick:B=>{B.stopPropagation()},value:n,onChange:B=>{l(!1),i(B.target.value)},placeholder:e("package__features:chat__home_view__rewrite__textarea__placeholder"),autoFocus:!0})),be.default.createElement(zd,{ref:K,showCloseButton:!1,onClose:()=>{u(!1)},onShow:()=>{u(!0)},modelKey:"SidebarRewrite"}),!c&&be.default.createElement(g,{direction:"row",alignItems:"end",gap:1},be.default.createElement(g,{direction:"row",width:0,flex:1,alignItems:"center",spacing:1,justifyContent:"left",ref:O},be.default.createElement(cp,{ref:B=>h.bindRef(B),minLine:1,stopPropagation:!0,autoFocus:!0,onKeyDownCapture:B=>{y.current?.proxyKeyboardEvent(B.nativeEvent)?(B.preventDefault(),B.stopPropagation()):B.shiftKey&&B.key.toLowerCase()==="tab"&&(P.current?.focus(),B.preventDefault(),B.stopPropagation())},onFocusCapture:B=>{P.current&&P.current.value===""&&!P.current.getAttribute("data-autofocused")?(P.current.setAttribute("data-autofocused","true"),P.current.focus(),B.preventDefault(),$(R)):$(F)},value:x,onChangeText:B=>h.updateInputValue(B),placeholder:e("package__features:chat__home_view__rewrite__input__placeholder"),sx:{border:"none","& > div":{"& > div":{p:0},"& > textarea":{p:0},"& > .max-ai-user-input__expand":{"&:has(> div)":{pr:1}}},borderRadius:0,minHeight:"24px"},onEnter:I})),be.default.createElement(pp,{placement:"bottom-end",disabled:(!x||!n)&&!_,onClick:I}))),be.default.createElement(L,{sx:{maxWidth:"768px",width:"100%",display:w.length<=0?"none":void 0}},be.default.createElement(Dd,{sx:{opacity:0,...G},ref:y,open:!0,defaultPlacement:"bottom-start",needAutoUpdate:!0,root:D,menuList:w,referenceElementRef:E,menuWidth:415,referenceElement:be.default.createElement(L,{"data-test-id":"ContextMenuList-referenceElementRef"}),onClickItem:A,onClickGroup:V,menuMaxHeight:`${U}px`})))},OP=()=>{let o=(0,be.useRef)(),[e,t]=(0,be.useState)(0);return(0,be.useEffect)(()=>{o.current&&t(o.current.clientHeight)},[]),(0,be.useEffect)(()=>{if(!o.current)return;let r=()=>{o.current&&t(o.current.clientHeight)},n=new ResizeObserver(r);return n.observe(o.current),()=>{n.disconnect()}},[]),be.default.createElement(L,{ref:o,component:"div",width:"100%",padding:"10px",paddingBottom:0,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",sx:{boxSizing:"border-box"}},e!==0?be.default.createElement(is,{defaultContextMenuPath:"/rewrite"},be.default.createElement(LP,{contentHeight:e})):null)},v4=OP;var Hc=S(M());var M4={MAXAI_FLUX:Wp({prompt_id:E0,prompt_title:"Prompt Optimization FLUX/SD",type:"chat_complete",variables:[{hint:"User input",name:"USER_INPUT",type:"text"},De.PRESET_VARIABLE__AI_RESPONSE_TONE,De.PRESET_VARIABLE__AI_RESPONSE_WRITING_STYLE],output:[De.OUTPUT_PRESET_VARIABLE__CHAT_COMPLETE]}),MAXAI_STABLE_DIFFUSION:Wp({prompt_id:P0,prompt_title:"Prompt Optimization FLUX/SD",type:"chat_complete",variables:[{hint:"User input",name:"USER_INPUT",type:"text"},{hint:"The previous user inputs",name:"PREVIOUS_USER_INPUTS",type:"text"},De.PRESET_VARIABLE__AI_RESPONSE_TONE,De.PRESET_VARIABLE__AI_RESPONSE_WRITING_STYLE],output:[De.OUTPUT_PRESET_VARIABLE__CHAT_COMPLETE]}),MAXAI_DALLE:Wp({prompt_id:w0,prompt_title:"Prompt Optimization DALL\xB7E",type:"chat_complete",variables:[{hint:"User input",name:"USER_INPUT",type:"text"},De.PRESET_VARIABLE__AI_RESPONSE_TONE,De.PRESET_VARIABLE__AI_RESPONSE_WRITING_STYLE],output:[De.OUTPUT_PRESET_VARIABLE__CHAT_COMPLETE]}),MAXAI_OPENAI_IMAGE:Wp({prompt_id:T0,prompt_title:"Prompt Optimization OpenAI",type:"chat_complete",variables:[{hint:"User input",name:"USER_INPUT",type:"text"},De.PRESET_VARIABLE__AI_RESPONSE_TONE,De.PRESET_VARIABLE__AI_RESPONSE_WRITING_STYLE],output:[De.OUTPUT_PRESET_VARIABLE__CHAT_COMPLETE]})};var Oc=class{async createTextToArtActions(e,t,r,n){n=n||sC.getState().art.AIModel;let i=await Co.getService(!0).getConversationById(e);if(!i||i.item_type==="group"||t.trim()===""||!i?.meta.AIProvider)return[];let a=await Dn.getService().dangerouslyGetTotalMessages(e),s=Eo(),l=Eo(),c=await h_("MAXAI_DALLE"),u={prompt:t,model:Cl.value,contentType:c?.contentType,resolution:c?.resolution,generateCount:c?.generateCount,aspectRatio:c?.aspectRatio},p=M4[i?.meta.AIProvider||"MAXAI_DALLE"],m=!0,d=[],h={type:"CHAT_MESSAGE",parameters:{ActionChatMessageType:"user",ActionChatMessageOperationType:"add",ActionChatMessageConfig:{conversationId:e,messageId:s,type:"user",meta:{includeHistory:!0,messageChatDocuments:r,messageVisibleText:t,contexts:[],disableEditQuestion:!0},text:t}}};if(m&&p){let f=[];for(let C=a.length-1;C>=0;C--){let y=a[C];if(mn(y)&&y.originalMessage){let b=y.originalMessage.metadata?.title?.title||"",w=y.originalMessage.metadata?.artTextToImagePrompt||"";if(b&&w&&b&&f.unshift(b),y.originalMessage.metadata?.includeHistory===!1)break}}let _=f.map((C,y)=>`${y+1}. ${C}`).join(`
`),x=r?.length?[{type:"SET_VARIABLE",parameters:{Variable:{key:"IMAGE_PROMPT",overwrite:!0,value:t,isBuiltIn:!0}}}]:[{type:"ASK_CHATGPT",parameters:{isEnabledDetectAIResponseLanguage:!1,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",MaxAIPromptActionConfig:p,AskChatGPTActionQuestion:{text:t,meta:{historyMessages:[],outputMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",messageVisibleText:t}}}},{type:"TEXT_HANDLER",parameters:{ActionTextHandleParameters:{trim:!0,noQuotes:!0,noCommand:!0}}},{type:"SET_VARIABLE",parameters:{VariableKey:"IMAGE_PROMPT"}}];d=[h,{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:l,text:"",originalMessage:{metadata:{AIModel:n,shareType:"art",title:{title:t},copilot:{title:{title:"AI art",titleIcon:"Awesome",titleIconSize:24},steps:[{title:"Optimizing art prompt",status:"loading",icon:"CheckCircle"}]},artTextToImageMetadata:u}}}}},{type:"SET_VARIABLE",parameters:{VariableKey:"AI_RESPONSE_MESSAGE_ID"}},{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{PREVIOUS_USER_INPUTS:_,USER_INPUT:t}}},...x,{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{isComplete:!1,copilot:{steps:[{title:"Optimizing art prompt",status:"complete",icon:"CheckCircle",value:"{{IMAGE_PROMPT}}",valueType:"text"}]},artTextToImagePrompt:"{{IMAGE_PROMPT}}"},content:{title:{title:"Image",titleIcon:"Image"},contentType:"image",text:""}}}}},{type:"ASK_CHATGPT",parameters:{AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",isEnabledDetectAIResponseLanguage:!1,AskChatGPTActionQuestion:{text:"{{IMAGE_PROMPT}}",meta:{outputMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",messageVisibleText:"{{IMAGE_PROMPT}}",messageChatDocuments:r,contextMenu:{id:C1,droppable:!1,parent:"",text:"[Art] text to image",data:{editable:!1,type:"shortcuts",actions:[]}}}}}},{type:"SCRIPTS_LIST",parameters:{}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",text:"",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",originalMessage:{content:{text:"",contentType:"image"},metadata:{attachments:"{{LAST_ACTION_OUTPUT}}"}}}}}]}else d=[h,{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:l,text:"",originalMessage:{metadata:{includeHistory:!1,artTextToImagePrompt:t,shareType:"art",title:{title:t},copilot:{title:{title:"Pro art",titleIcon:"Awesome",titleIconSize:24},steps:[{title:"Generating art",status:"complete",icon:"CheckCircle",value:t}]},artTextToImageMetadata:u}}}}},{type:"SET_VARIABLE",parameters:{VariableKey:"AI_RESPONSE_MESSAGE_ID"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{content:{title:{title:"Image",titleIcon:"Image"},contentType:"image",text:""}}}}},{type:"ASK_CHATGPT",parameters:{AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",isEnabledDetectAIResponseLanguage:!1,AskChatGPTActionQuestion:{text:t,meta:{includeHistory:!1,outputMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",messageVisibleText:t,messageChatDocuments:r,contextMenu:{id:C1,droppable:!1,parent:"",text:"[Art] text to image",data:{editable:!1,type:"shortcuts",actions:[]}}}}}},{type:"SCRIPTS_LIST",parameters:{}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",text:"",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",originalMessage:{content:{text:"",contentType:"image"},metadata:{attachments:"{{LAST_ACTION_OUTPUT}}"}}}}}];return d}};var T4=new Oc;var Xd=S(M()),BP=({promptData:o,disabled:e,onClick:t,order:r,showLineClamp:n=1})=>Xd.default.createElement(wa,{in:!0,style:{transitionDelay:r?`${r*150}ms`:"0ms"}},Xd.default.createElement(_r,{component:"button","data-testid":`sample-prompt-item${r}`,sx:{width:"100%",px:2,py:1.5,bgcolor:e?"background.secondary":"background.paper",border:"1px solid",borderColor:"border.main",boxShadow:e?"none":"0px 1px 2px 0px #0000000D",cursor:e?"default":"pointer",transition:"border-color 0.3s",borderRadius:1,flex:1,"&:hover":{borderColor:e?"border.main":"primary.main"}},onClick:()=>{e||t&&t(o)}},Xd.default.createElement(ni,{textAlign:"left",tip:o.title,resizeListener:!0,lineClamp:n,sx:{fontSize:"14px",lineHeight:"21px",whiteSpace:"normal",wordBreak:"break-word",minHeight:n*21,color:e?"text.disabled":"text.primary"}},o.title))),Yd=BP;var w4=[{title:"Product mockups",prompt:"Generate a realistic product mockup for an Elegant Glass Meal Prep Set, which will allow customers to envision the product before making a purchase."},{title:"Social media graphics ",prompt:"Design an attention-grabbing graphic for a social post on healthy eating trends. Focus on food and without human faces or text."},{title:"Email banners",prompt:"Create an email banner for email sharing Christmas holiday greetings. With clear text: Merry Christmas!. Without human faces or other texts."},{title:"Logos",prompt:"Generate one single logo for a business eco-friendly packaging firm. Without human faces or texts."},{title:"Ad campaign visuals",prompt:"Generate an image for a banner ad on the theme of fitness, without text or human face."},{title:"Blog post feature image",prompt:"Generate an image that will complement a blog post on the topic mental health."},{title:"Website hero image",prompt:"Generate a hero image for a website dedicated to online learning. With clear beautiful human faces. Highlight the online learning concept."},{title:"Brochure Design",prompt:"Design a visually appealing brochure showcasing the benefits of a premium skincare line, targeting business owners."},{title:"Event Poster",prompt:"Create a vibrant poster promoting an upcoming event hosted by my company that focuses on community events, featuring captivating visuals. Without text."},{title:"Promotional video thumbnails",prompt:"Generate a compelling thumbnail for a promotional video showcasing success stories from customers, designed to attract clicks and drive engagement on platforms like YouTube or social media. If there are human faces, they need to be clear and beautiful."},{title:"Blog images",prompt:"Create a custom graphic for a blog post on remote working best practices. Make sure to include related images. If featuring human faces, ensure they are clear and radiate a sense of beauty and concentration."},{title:"Web page graphic",prompt:"Generate a graphic of homepage for a pet care services website that illustrates care and attention to pets."},{title:"Google ad",prompt:"Create a Google Ads banner to highlight a limited-time offer. Use images of Tablet products, and make sure the image grabs attention. With the text Limited Time Offer as the only text element."},{title:"Poster graphic",prompt:"Design a realistic graphic for a poster for a concert announcement. Make sure to incorporate detailed drawings of musical instruments."},{title:"Travel blogs/websites",prompt:"Generate a photo illustrating the vibrant and intricate rituals during the festival of Carnival. Without human faces."},{title:"E-commerce/online retail platforms",prompt:"Generate photos of a set of modern cookware in various settings, highlighting their non-stick surfaces and ergonomic handles."},{title:"Business websites/corporate blogs",prompt:"Generate photos of an executive team in a strategic retreat setting, fostering a sense of unity and vision. If featuring human faces, ensure they are clear and radiate a sense of beauty and concentration."},{title:"Lifestyle magazines/websites",prompt:"Generate a photo illustrating a mid-century modern home with eclectic decor and cozy corners."},{title:"Educational platforms/e-Learning websites",prompt:"Generate photos of students actively participating in a coding workshop. If featuring human faces, ensure they are clear and radiate a sense of beauty and concentration."},{title:"Event management websites/promotion platforms",prompt:"Capture the excitement of professionals networking and exchanging ideas at an event in a photograph. If featuring human faces, ensure they are front, clear and radiate a sense of beauty and concentration. When the human figure in the picture is relatively small, the complete face does not appear."},{title:"Wellness blogs/healthcare platforms",prompt:"Showcase farmers harvesting organic produce for a healthy and sustainable lifestyle."},{title:"Food and beverage blogs/websites",prompt:"Generate mouthwatering images of pasta dish being cooked, showcasing the blend of colours and textures."},{title:"Fitness and exercise blogs/websites",prompt:"Generate motivational images of individuals engaged in intense workout routines, highlighting their determination and perseverance to achieve their fitness goals.If featuring human faces, ensure they are front, clear and radiate a sense of beauty and concentration. When the human figure in the picture is relatively small, the complete face does not appear."},{title:"Fashion accessories brands/websites",prompt:"Create visually stunning images of a designer handbag, showcasing their elegance and luxury against contrasting backgrounds."},{title:"Product photography",prompt:"Create studio-quality photos of wireless earphones, showcasing them from multiple angles, highlighting the Noise Blocking and Comfortable Fit feature. Without any text."},{title:"Property listings",prompt:"Generate exterior photos of a suburban home. Include shots of the swimming pool and landscaped front yard."},{title:"Hospitality",prompt:"Generate inviting photos of a deluxe king room. Highlight the modern decor and comfortable seating area, ensuring the room looks welcoming and well-appointed."},{title:"Feature articles",prompt:"Generate a photo for a feature story on urban gardening. Include images of community gardens and green rooftops, highlighting sustainability and community spirit. Without any text or human faces."},{title:"Storyboard",prompt:"Generate a storyboard sequence for a romantic comedy where two rival chefs fall in love while competing on a cooking show. Include key scenes like the emotional revelation that changes everything."},{title:"Art for theatrical productions",prompt:"Create a set design concepts for Hamlet. Include elaborate period costumes and props."},{title:"Editorial Art",prompt:"Create a feature illustration for National Geographic exploring climate change and its effects on global migration. Include juxtaposition of contrasting images."},{title:"Art for awareness campaigns",prompt:"Generate a marketing graphic for an ocean plastic pollution awareness campaign. Include emotive photography of affected individuals or environments."},{title:"Literary classics reimagined",prompt:'Reimagine scenes from the literary classic "Pride and Prejudice", blending traditional and modern elements to add a unique artistic touch for a modern graphic novel adaptation. Need to without any texts.'},{title:"Bedtime stories",prompt:"Create warm visuals with soft lighting, cozy setting, and a touch of magic on the theme of nighttime journey through the cosmos, tailored for a bedtime story."},{title:"Philosophical abstract expressions",prompt:"Generate abstract and thought-provoking visuals that resonate with the philosophical concept of the paradox of infinity."},{title:"Surrealistic depiction",prompt:"Create surreal dreamscapes on the theme of the passage of time blending reality and fantasy, using unconventional perspectives and dreamlike elements to evoke a sense of wonder and curiosity."},{title:"Mandalas",prompt:"Craft mandalas incorporating vibrant colors and unique patterns that will inspire feelings of happiness and well-being."},{title:"Artwork from quote",prompt:'"I think, therefore I am." - Ren\xE9 Descartes. Turn this quote into an image artwork.'},{title:"Portrait",prompt:"Generate a portrait of Leonardo da Vinci in impressionism for a blog exploring the history of the Italian Renaissance"},{title:"Pop culture icons redesigned",prompt:"Reimagine iconic characters from Harry Potter with a contemporary twist, incorporating modern fashion and technology elements to breathe new life into familiar favorites."},{title:"Abstract emotions",prompt:"Generate an abstract artwork exploring the depths of human emotion, using color, form, and texture to convey feelings of serenity and chaos."},{title:"Cartoonized web series or online content",prompt:"Create artwork for characters for an animated web series about space adventures. Include robotic appendages in the character design."},{title:"Cartoons and caricatures for promotional material",prompt:"Design a caricature for a social media campaign promoting a food festival. Include exaggerated, humorous depictions of the character eating, highlighting fun atmosphere."},{title:"Custom caricatures for souvenirs ",prompt:"Design beautiful custom caricature for a mug souvenir, showing it exploring landmarks."},{title:"Public Art",prompt:"Create a mural design for a community center. Include environmental sustainability themes in the mural. Without any text."},{title:"Realistic Cartoon",prompt:"Generate a semi-realistic cartoon character with intricate details, blending elements of realism with a cartoon aesthetic into one piece. Need to Without any text."},{title:"Anime Hero",prompt:"Generate an anime character with large, detailed eyes with distinctive Japanese anime aesthetics."},{title:"Minimalist Line Art",prompt:"Design a simple cartoon character using minimalist line art, focusing on clean lines and basic shapes."},{title:"Pixel Art Character",prompt:"Craft a pixel art character, reminiscent of old-school video games, with limited colors and a blocky, pixelated design."},{title:"Comic Book Superhero",prompt:"Create a powerful superhero character in the style of a comic book, complete with bold outlines and vibrant colors."},{title:"Children's Book Illustration",prompt:"Generate a whimsical cartoon character suitable for children's book illustrations, characterized by soft lines and pastel colors to bring a gentle and enchanting vibe to the illustrations."},{title:"Manga Chibi",prompt:"Design a cute and chibi-style manga character with oversized heads, small bodies, and adorable expressions."},{title:"Surreal Art Deco",prompt:"Craft a surreal character in the style of Art Deco, known for its geometric shapes, bold colors, and elegant, vintage feel."},{title:"Retro Cartoon",prompt:"Create a character reminiscent of the classic, retro cartoon era, featuring exaggerated movements and playful antics."},{title:"Historical figure cartoonized",prompt:"Transform a famous historical figure into a lovable cartoon character, depicting them in humorous situations or reimagining their achievements with a playful twist. ! AI image prompts for video game design"},{title:"Color schemes and themes",prompt:"Design a thematic color palette for a fantasy game. I want the colors to evoke a sense of wonder and enchantment."},{title:"Props and objects",prompt:"Create designs for magical props for a role-playing game. Include detailed illustrations of a weathered tome with arcane symbols."},{title:"NPCs and enemies",prompt:"Design a non-playable character for a cyberpunk role-playing game. Include the distinct visual traits of a ruthless corporate enforcer."},{title:"Visuals for the game's website, social media channels",prompt:"I have created a game that explores a fantastical world of magic and adventure. Create a banner image for the game's  Instagram highlight cover. Include the player character wielding a legendary weapon featuring the main characters, set against a backdrop of towering futuristic skyscrapers."},{title:"Epic Fantasy World",prompt:"Design a picture of a stunning fantasy world, complete with enchanted forests, towering castles, and mythical creatures, setting the stage for a grand adventure."},{title:"Cyberpunk Cityscape",prompt:"Craft a futuristic cyberpunk cityscape, with neon-lit skyscrapers, bustling streets, and intricate details that define the urban dystopia."},{title:"Playable Character Concept ",prompt:"Design a character image of a unique playable character, outlining their appearance for a protagonist in an RPG game."},{title:"Alien Planet Ecosystem",prompt:"Create an illusion of an alien planet's ecosystem, with bizarre flora and fauna, strange geology, and atmospheric anomalies."},{title:"Haunted Mansion Interior",prompt:"Generate a chilling interior layout for a haunted mansion, replete with eerie corridors, ghostly apparitions, and secrets waiting to be discovered."},{title:"Melee Weaponry Collection",prompt:"Craft a collection of melee weapons, each with its own distinct design, perfect for a combat-focused game."},{title:"Sci-Fi Space Station",prompt:"Design a massive, intricate space station, teeming with advanced technology, modular compartments, and areas for various in-game activities."},{title:"Ancient Ruins Exploration",prompt:"Generate the environment of a long-forgotten civilization's ruins."},{title:"Interstellar Starship Bridge",prompt:"Craft the interior of an interstellar starship bridge, featuring advanced control panels, holographic displays, and the latest in spacefaring technology."},{title:"Legendary Artifact",prompt:"Craft an iconic legendary artifact for players to discover in-game, featuring intricate detailing, mystical symbols."}];var Zd=S(M()),DP=(o,e)=>Vx(o).slice(0,e),HP=(o,e=4)=>{let[t,r]=(0,Zd.useState)([]);return(0,Zd.useLayoutEffect)(()=>{r(DP(o,e))},[]),{samplePromptList:t}},Qd=HP;var Bc=S(M()),FP=({promptItemXs:o,showLineClamp:e})=>{let{samplePromptList:t}=Qd(w4),{conversationId:r}=Ce(),{runShortcutsActions:n}=Re();return Bc.default.createElement(g,{width:"100%","data-button-clicked-name":"art-sample-prompt-clicked"},Bc.default.createElement(ti,{container:!0,spacing:1.5},t.map((i,a)=>Bc.default.createElement(ti,{key:i.title,item:!0,xs:o},Bc.default.createElement(Yd,{promptData:i,disabled:!1,onClick:async s=>{if(s&&s.prompt){let l=await T4.createTextToArtActions(r,s.prompt);l&&n(l)}},order:a+1,showLineClamp:e})))))},E4=FP;var P4=async(o,e=0)=>{let t=async()=>{e<=0?await o():setTimeout(async()=>{await o()},e)},r=await jp.isLogin();return new Promise(n=>{if(r)t().then(()=>{n(!0)});else{if(ao){n(!1);return}let i=document.querySelector('[data-testid="maxai--sign-in--button"]');if(i){i.dispatchEvent(new MouseEvent("click",{bubbles:!0}));let a=setInterval(async()=>{await jp.isLogin()?(clearInterval(a),await t(),n(!0)):i.disabled===!1&&(clearInterval(a),n(!1))},250)}}})};var A4=[{title:"Humanity's Last Exam"},{title:"New Blood Group Identified"},{title:"View the Comet of the Century"},{title:"Global Seed Vault Under Threat"},{title:"The Fed\u2019s Big Rate Cut"},{title:"23andMe's Fallout"},{title:"New Insights into the Multiverse"},{title:"Lionsgate's Runway AI Video Deal"},{title:"'Third State' Beyond Life and Death"},{title:"Snap's New Large AR Spectacles"},{title:"Earth's Ancient Ring System"},{title:"Neuralink Gets FDA Breakthrough Device"},{title:"CATL's Million-Mile Bus Battery"},{title:"Bitcoin's 66-bit Puzzle Solved"},{title:"Slack Debuts AI Agents"},{title:"Blue Origin Mars Mission Delayed"},{title:"Lucid's Upcoming Affordable SUV"},{title:"The History of Lehman Brothers Bankruptcy"},{title:"Larry Ellison's Take on AI"}];var Dc=S(M()),VP=({promptItemXs:o,showLineClamp:e})=>{let{conversationId:t}=Tt(),{runShortcutsActions:r}=Re(),{samplePromptList:n}=Qd(A4);return Dc.default.createElement(g,{"data-button-clicked-name":"search-sample-prompt-clicked"},Dc.default.createElement(ti,{container:!0,spacing:1.5},n.map((i,a)=>Dc.default.createElement(ti,{key:i.title,item:!0,xs:o},Dc.default.createElement(Yd,{promptData:i,disabled:!1,onClick:async s=>{if(s.title){let l=await Q_.createShortcutsActions(t,s.title,!0);await P4(()=>{r(l)})}},order:a+1,showLineClamp:e})))))},k4=VP;var RP=()=>{let{conversationType:o}=Tt(),e={promptItemXs:6,showLineClamp:2},t={Art:Hc.default.createElement(E4,{...e}),Search:Hc.default.createElement(k4,{...e})}[o]||null;return Hc.default.createElement(Hc.default.Fragment,null,t)},Jd=RP;var zP=o=>{let{sx:e,chatBoxHeight:t}=o,{t:r}=v();return jt.default.createElement(g,{className:"maxai--chat-home-view",gap:1.5,mb:"12px",sx:{"& *":{boxSizing:"border-box"},overflow:"hidden",...e}},jt.default.createElement(T,{"data-testid":"maxai--chat-home-view--title",sx:{height:"100%",display:"flex",alignItems:"flex-end",color:"text.primary",fontSize:"24px",fontWeight:700,lineHeight:"33.6px",textAlign:"center"}},ao?jt.default.createElement(d2,{sx:{fontSize:32,color:"inherit"}}):r("package__features:chat__home_view__website__title")),jt.default.createElement(Td,{sx:{"@media (max-height: 600px)":{display:"none"}}}))},UP=o=>{let{sx:e,isMessageEmpty:t}=o,{t:r}=v(),n=te(i=>i.conversationType);return jt.default.createElement(g,{className:"maxai--chat-home-view",flexGrow:1,width:"100%",sx:{overflowY:"auto","& *":{boxSizing:"border-box"},...e}},n==="ContextMenu"&&jt.default.createElement(g,{direction:"column",sx:{width:"100%",padding:"32px 10px"},flexGrow:1},jt.default.createElement(g,{direction:"column",alignItems:"center",justifyContent:"center",sx:{height:"175px"}},jt.default.createElement(z,{icon:"Rewrite",sx:{color:"primary.main",fontSize:"40px",marginBottom:"12px"}}),jt.default.createElement(T,{component:"h1",marginBottom:"8px",lineHeight:"140%",fontWeight:700,fontSize:20,textAlign:"center",color:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)"},r("package__features:chat__home_view__rewrite__title")),jt.default.createElement(T,{lineHeight:"150%",fontSize:14,textAlign:"center",color:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.60)"},r("package__features:chat__home_view__rewrite__description"))),t&&jt.default.createElement(v4,null)),n==="Art"&&jt.default.createElement(g,{px:2,width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"relative"},jt.default.createElement(g,{justifyContent:"center",alignItems:"center",maxWidth:680,width:"80%"},jt.default.createElement(z,{icon:"Art",sx:{color:"primary.main",fontSize:"48px"}}),jt.default.createElement(T,{component:"h1",mt:1.5,mb:1,fontSize:"20px",fontWeight:700,textAlign:"center",color:"text.primary"},r("package__features:chat__home_view__art__title")),jt.default.createElement(T,{fontSize:"14px",fontWeight:400,textAlign:"center",color:"text.primary"},r("package__features:chat__home_view__art__description")))),n==="Summary"&&jt.default.createElement(un,{sx:{my:0},loading:!0}),jt.default.createElement(g,{alignItems:"center",maxWidth:768,mx:"auto",width:"100%",p:1.5,gap:1.5},jt.default.createElement(Jd,null)))},L4=({sx:o})=>{let{t:e}=v();return jt.default.createElement(g,{sx:{gap:1.5,m:1.5,overflow:"hidden",...o}},jt.default.createElement(T,{component:"h1",sx:{height:"100%",display:"flex",alignItems:"flex-end",color:"text.primary",fontSize:"24px",fontWeight:700,lineHeight:"33.6px",textAlign:"center"}},e("package__features:chat__home_view__art__title")))},WP=o=>te(t=>t.conversationType)==="Chat"?jt.default.createElement(zP,{...o}):jt.default.createElement(UP,{...o}),O4=WP;var bn=S(M());var Fc=S(M()),GP=o=>class extends Fc.Component{constructor(t){super(t),this.state={hasError:!1}}componentDidCatch(t,r){this.setState({hasError:!0})}render(){return this.state.hasError?Fc.default.createElement(o,{...this.props,liteMode:!0,hasError:!0}):Fc.default.createElement(o,{...this.props})}},gp=GP;var yg=S(M());var Ur=S(M()),ef="chat-message--AI-tools",tf=(0,Ur.createContext)({AIMessage:{},usePromptOpen:!1,setUsePromptOpen:()=>{},onClickPromptItem:()=>{},onRegenerate:()=>{},content:{contentType:"text",text:""},metadata:{},processingStep:"RESPONDED",isLoading:!1,isWritingMessage:!1,isLastMessage:!1,isAutoHideTools:!0}),of=o=>{let{message:e,loading:t,children:r}=o,{conversationId:n,inputMediator:i}=Ce(),a=Ka(n),[s,l]=(0,Ur.useState)(!1),{content:c,metadata:u,processingStep:p}=mC(e,t),m=!!t,d=e?.messageId===a||m,h=!d&&!s,f=!u.isComplete||m,_=Re(),x=$e(_),C=(0,Ur.useRef)(!1),y=(0,Ur.useCallback)(async I=>{if(!C.current)try{if(C.current=!1,I&&I.length>0){let P=(e&&Bn(e,!1)||"").replace(ml,""),O=He(I||[]);O.unshift({type:"SET_VARIABLE",parameters:{Variable:{key:"SELECTED_TEXT",value:P||" ",label:"Selected text",isBuiltIn:!0,overwrite:!0}}},{type:"SET_VARIABLE",parameters:{Variable:{key:"VARIABLE_MODAL_KEY",value:"Sidebar",overwrite:!0,isBuiltIn:!0}}}),i.focus(),await Y_(O,async N=>{let V=N.parameters?.AskChatGPTActionQuestion;return V?.meta&&(V.meta.includeHistory=!0),N}),await x.current.askAIWithShortcutsV2(O,{disabledMaxAIDocumentIds:!0})}}catch{}finally{C.current=!1}},[i,e]),b=(0,Ur.useCallback)(()=>{x.current.regenerate(n)},[n]),w=(0,Ur.useMemo)(()=>({AIMessage:e,usePromptOpen:s,setUsePromptOpen:l,onClickPromptItem:y,onRegenerate:b,content:c,metadata:u,processingStep:p,isLoading:f,isWritingMessage:m,isLastMessage:d,isAutoHideTools:h}),[e,s,l,y,b,c,u,p,f,m,d,h]);return Ur.default.createElement(tf.Provider,{value:w},r)},Ze=()=>(0,Ur.useContext)(tf);var B4=S(D7()),D4=S(F7());var co=S(M()),KP=o=>{let{message:e}=o,{t}=v(),[r,n]=co.default.useState(null),[i,a]=(0,co.useState)(!1),s=!!r,{updateMessage:l}=Li(),{conversationId:c}=Ce(),u=x=>{n(x.currentTarget)},p=()=>{n(null)},m=()=>{a(!0)},d=()=>{a(!1)},h=()=>{a(!1);let x=He(e);mn(e)?(x.originalMessage?.metadata&&(x.originalMessage.metadata.includeHistory=!0),x=Qo([x,{originalMessage:{metadata:{includeHistory:!0}}}])):x=Qo([x,{meta:{includeHistory:!0}}]),l(c,x)},f=(0,co.useMemo)(()=>Ma(),[]);return!0?null:co.default.createElement(It,{sx:{mb:2}},co.default.createElement(g,{direction:"row",alignItems:"center"},co.default.createElement(T,{color:"text.secondary",fontSize:"12px"},t("package__features:chat__context_cleared__title")),co.default.createElement(le,{variant:"text",sx:{width:"30px",height:"30px",color:"inherit",minWidth:"unset",ml:"auto!important"},onClick:u},co.default.createElement(D4.default,{sx:{fontSize:16,color:"text.primary"}}))),co.default.createElement(An,{anchorEl:r,open:s,onClose:p,slotProps:{}},co.default.createElement(St,{onClick:()=>{p(),m()},sx:{color:"error.main"}},co.default.createElement(B4.default,{sx:{fontSize:16,mr:1,color:"inherit"}}),t("package__common:delete"))),co.default.createElement(Tx,{open:i,onClose:x=>{x.stopPropagation(),d()},sx:{position:f?"absolute":"fixed"}},co.default.createElement(Tu,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",borderRadius:"4px",bgcolor:"background.paper",maxWidth:"512px!important",width:f?"448px":"100%",p:2},onClick:x=>{x.stopPropagation()}},co.default.createElement(g,{spacing:2},co.default.createElement(T,{fontSize:"20px",fontWeight:700,lineHeight:"24px",color:"text.primary"},t("package__features:chat__context_cleared__delete__title")),co.default.createElement(T,{fontSize:"16px",color:"text.primary"},t("package__features:chat__context_cleared__delete__description")),co.default.createElement(g,{direction:"row",spacing:1,justifyContent:"end"},co.default.createElement(le,{variant:"outlined",onClick:d},t("package__common:cancel")),co.default.createElement(le,{variant:"contained",color:"error",onClick:h,sx:{bgcolor:"#f44336!important","&:hover":{bgcolor:"#d32f2f!important"}}},t("package__common:confirm")))))))},rf=KP;var Ke=S(M());var xp=S(M()),jP=o=>{let{sx:e,fontSx:t,iconSx:r,showLoading:n}=o,{title:i,titleIcon:a,titleIconSize:s}=o.title,l=`${s||20}px`;return xp.default.createElement(g,{direction:"row",alignItems:"center",spacing:1,sx:e,className:"chat-message--metadata-title"},typeof a=="string"&&a?xp.default.createElement(g,{alignItems:"center",justifyContent:"center",width:l,height:l},xp.default.createElement(z,{sx:{color:"text.primary",fontSize:l,...r},icon:a})):a,xp.default.createElement(T,{sx:{color:"text.primary",fontWeight:400,fontSize:"18px",...t}},i),n&&xp.default.createElement(L,{sx:{display:"inline-block",width:"12px",height:"12px",margin:"0 0 0 4px !important",borderRadius:"50%",backgroundColor:c=>c.palette.mode==="dark"?"#fff":"#000"}}))},Ri=jP;var ma=S(M()),H4=o=>{let{AIProvider:e,AIModel:t,icon:r,title:n,sx:i}=o,a=(0,ma.useMemo)(()=>{let s=Ir(void 0,t),l=r;return!r&&s&&(l=ma.default.createElement(Jo,{size:24,provider:e,model:s.value,sx:{outline:"1px solid rgba(0, 0, 0, 0.08)",borderRadius:"8px"}})),{icon:l,title:n||s?.title||""}},[e,t,r,n]);return!a.icon&&!a.title?null:ma.default.createElement(g,{direction:"row",alignItems:"center",gap:1,height:24,className:"chat-ai-message--ai-model",sx:i},a.icon,ma.default.isValidElement(a.title)?a.title:ma.default.createElement(T,{sx:{fontSize:"16px",lineHeight:"24px",color:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)",fontWeight:500}},a.title))},da=o=>ma.default.createElement(H4,{icon:ma.default.createElement(oa,null),title:"MaxAI",...o}),_p=H4;var yp=S(M());var ig=S(M());var $P=()=>{let{processingStep:o}=Ze();return o==="RESPONDING"||o==="RESPONDED"?ig.default.createElement(g,{direction:"row",alignItems:"center",gap:1},ig.default.createElement(da,{title:"Answer"})):null},F4=$P;var N4=S(M()),qP=()=>{let{processingStep:o}=Ze();return o==="RESPONDING"||o==="RESPONDED"?N4.default.createElement(da,{title:"Answer"}):null},V4=qP;var Cp=S(M()),XP=o=>{let{message:e}=o,{content:t,metadata:r}=Ze(),n=e.conversationId||"",i=r?.shareType==="summary",a=Bl(n),s=bm(n);if(s&&s!==S1.value&&e.originalMessage?.metadata?.AIModel!==S1.value)return Cp.default.createElement(_p,{AIProvider:a,AIModel:e.originalMessage?.metadata?.AIModel||s});let l=Cp.default.createElement(Jt,{size:18}),c="";return r.isComplete?(l=t.title?.titleIcon&&t.title?.titleIcon!=="Loading"?t.title?.titleIcon:Cp.default.createElement(Ls,{icon:"Read",sx:{fontSize:"24px"}}),c=t.title?.title||"Answer"):(t.contentType==="text"?c="Writing":t.contentType==="image"&&(c="Creating image"),t.title?.title&&(c=t.title.title),t.title?.titleIcon&&t.title?.titleIcon!=="Loading"&&(l=t.title?.titleIcon),i&&t?.title?.titleIcon!=="Loading"&&(l=t.title?.titleIcon||Cp.default.createElement(Ls,{icon:"Read",sx:{fontSize:"24px"}}),c=t.title?.title||"Answer")),Cp.default.createElement(Ri,{title:{title:c,titleIcon:l,titleIconSize:24}})},R4=XP;var YP=o=>{let{message:e}=o,{metadata:t}=Ze(),r=e.conversationId||"",n=Bl(r),i=bm(r);if(t.chatMode==="free_chat")return yp.default.createElement(F4,{message:e});if(t.chatMode==="pro_chat"||t.shareType==="art")return yp.default.createElement(V4,{message:e});if(t.shareType==="summary")return yp.default.createElement(R4,{message:e});let a=t.AIModel||i;return a?yp.default.createElement(_p,{AIProvider:n,AIModel:a}):yp.default.createElement(da,null)},ag=YP;var Ks=S(M());var cr=S(M()),ZP=o=>{let{message:e}=o,t=(0,cr.useRef)(null),[r,n]=(0,cr.useState)([0,0]),[i]=(0,cr.useState)(1),[a]=(0,cr.useState)("1:1"),s=(0,cr.useMemo)(()=>{try{let p=e.originalMessage?.metadata?.attachments||[],m=r[0],d=r[1];if(p.length>0&&m&&d){let f=2;p.length>=12?f=4:p.length>=9&&(f=3);let _=Math.ceil(p.length/f),x=p.length>=f,C=x?(f-1)*6*2:0,y=x?(_-1)*6*2:0,b=x?(m-C)/f:m,w=x?(d-y)/_:d,I=Math.min(b,w);return p.map((E,P)=>{let O=a||E?.meta?.aspectRatio||"1:1",[N,V]=O.split(":").map(Number),A=N>=V,D=N/V,W=A?I:I*D,k=A?I/D:I,U=Math.floor(P/f),K=P%f,H=U*(I+6*2),R=K*(I+6*2);return{imageBoxWidth:W,imageBoxHeight:k,imageBoxTop:H,imageBoxLeft:R,image:E}})}else return[]}catch{return[]}},[e.originalMessage?.metadata?.attachments,r,i,a]),l=(0,cr.useMemo)(()=>Dr(()=>{if(t.current){let{width:p,height:m}=t.current.getBoundingClientRect();n([p,m])}},50),[]);(0,cr.useEffect)(()=>{let p=new ResizeObserver(()=>{l()});return t.current&&p.observe(t.current),()=>{p.disconnect()}},[t]);let[c,u]=(0,cr.useState)();return cr.default.createElement(g,{component:"div",ref:t,mt:1,minHeight:"16px",width:"60%",minWidth:Kp-16-16,sx:{position:"relative"}},cr.default.createElement(Pi,{hideMenu:!0,images:s.map(p=>({src:p.image?.uploadedUrl||"",alt:p.image?.fileName||""})),selectedImage:c,setSelectedImage:u}),s.map(p=>{let d=(t.current?.getBoundingClientRect().width||Kp-16-16)/m_(p?.image?.meta?.aspectRatio);return cr.default.createElement(L,{ref:t,key:1,className:"maxai-ai-message__image__content__box",sx:{position:"relative",zIndex:0,display:"inline-flex",alignItems:"center",justifyContent:"center",width:"auto",height:"auto",overflow:"hidden",borderRadius:"4px","& > img":{width:"100%",height:"100%",border:"2px solid rgba(0,0,0,0)",boxSizing:"border-box",borderRadius:"8px",transition:"border .1s cubic-bezier(0.22, 0.61, 0.36, 1)",userSelect:"none",overflow:"hidden"}},onClick:()=>{u(p.image?.uploadedUrl||"")}},cr.default.createElement(On,{SkeletonSx:{width:"100%"},fileId:p.image.uploadedFileId,height:d,src:p.image?.uploadedUrl||"",alt:`Variation 1 of ${s.length}`}))}))},z4=ZP;var Gs=S(M()),QP=o=>{let{message:e,text:t,loading:r}=o,{isDarkMode:n}=tn(),{content:i,isLoading:a}=Ze(),s=r??(i.status===void 0?a:i.status!=="complete"),l=t??i.text;return Gs.default.createElement("div",{"data-testid":"chat-ai-message--markdown","data-disabled-button-clicked":!0,className:`markdown-body ${n?"markdown-body-dark":""}`,translate:s?"no":void 0},Gs.default.createElement(Gs.Suspense,{fallback:Gs.default.createElement(un,{loading:!0})},Gs.default.createElement(Ya,{appendLoadingDot:s,message:e},l)))},U4=QP;var W4=S(M()),Uo=S(M()),JP=o=>{let{transcripts:e,loading:t}=o,{t:r}=v(),[n,i]=(0,W4.useState)({}),a=p=>{let m=document.createElement("textarea");return m.innerHTML=p.trim().replace(/\n/g,""),m.value},s=p=>{let d=p.split("[AI KNOWLEDGE]({})"),h=[];return d.forEach((f,_)=>{let x=f.trim();x&&h.push(x),_<d.length-1&&h.push(Uo.default.createElement(M_,null))}),h},l=p=>{n[p]=!n[p],i({...n})},c=!e||!Array.isArray(e),u=e?.length===0;return c?Uo.default.createElement(T,{fontSize:16,color:"error",sx:{p:0,flex:1}},r("package__features:chat__ai_message__youtube_summary__transcript_timestamped_error")):u?Uo.default.createElement(T,{fontSize:16,color:"text.primary",sx:{p:0,flex:1}},r("package__features:chat__ai_message__youtube_summary__not_have__transcript")):Uo.default.createElement(g,{gap:2},e.map((p,m)=>{if(p.text||p.status==="error"){let d=p?.children&&p?.children.length>0;return Uo.default.createElement(g,{key:p.start},Uo.default.createElement(g,{direction:"row",justifyContent:"flex-start",alignItems:"flex-start",spacing:1,key:m},Uo.default.createElement(U1,{time:p.start,docId:p.docId,url:p.url}),p.status!=="error"&&Uo.default.createElement(g,{sx:{flex:1,cursor:d?"pointer":"default"},onClick:()=>p.id&&l(p.id)},Uo.default.createElement(T,{fontSize:16,color:"text.primary"},s(a(p.text||""))),d&&Uo.default.createElement(g,{direction:"row",alignItems:"center"},Uo.default.createElement(T,{fontSize:15,color:"text.secondary"},n[p.id||""]?r("package__features:chat__ai_message__youtube_summary__collapse"):r("package__features:chat__ai_message__youtube_summary__expand")),n[p.id||""]?Uo.default.createElement(z,{sx:{transform:"rotate(180deg)",color:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},size:25,icon:"KeyboardArrowDown"}):Uo.default.createElement(z,{sx:{color:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},size:25,icon:"KeyboardArrowDown"}))),p.status==="error"&&Uo.default.createElement(T,{fontSize:16,color:"error",sx:{p:0,flex:1}},r("package__features:chat__ai_message__youtube_summary__transcript_timestamped_error"))),p?.children&&n[p.id||""]&&p?.children?.map(h=>Uo.default.createElement(g,{direction:"row",justifyContent:"flex-start",alignItems:"flex-start",spacing:1,key:h.id,sx:{marginTop:"5px",marginLeft:"10px"}},Uo.default.createElement(U1,{mode:"lite",time:h.start,docId:h.docId,url:h.url}),Uo.default.createElement(T,{fontSize:15,color:"text.secondary",onClick:()=>p.id&&l(p.id),sx:{p:0,flex:1,cursor:"pointer"}},s(a(h.text||""))))))}else if(t&&p.status==="loading")return Uo.default.createElement(vt,{key:m,variant:"rounded",width:"100%",height:15});return null}))},sg=JP;var eA=o=>{let{message:e,hasError:t}=o,{content:r,metadata:n,processingStep:i,isLoading:a}=Ze(),s=()=>!i_(e)||i==="RESPONDING"||i==="RESPONDED"?r.contentType==="image"||n.artTextToImageMetadata||n.shareType==="art"?i!=="RESPONDED"?null:Ks.default.createElement(z4,{message:e}):(n.videoTimestamped?.length||n.videoTranscripts?.length)&&!r.text?null:Ks.default.createElement(U4,{message:e}):null;return Ks.default.createElement(Ks.default.Fragment,null,!t&&n.videoTimestamped&&Ks.default.createElement(sg,{transcripts:n.videoTimestamped,loading:a}),!t&&n.videoTranscripts&&Ks.default.createElement(sg,{transcripts:n.videoTranscripts,loading:a}),s())},lg=eA;var Vc=S(M()),tA=()=>{let[o,e]=(0,Vc.useState)(()=>window.location.href),[t,r]=(0,Vc.useState)(document.title),n=(0,Vc.useRef)(null),i=()=>{a(),n.current=setInterval(()=>{r(document.title),e(window.location.href)},1e3)},a=()=>{n.current&&clearInterval(n.current)};return{pageUrl:o,documentTitle:t,startListen:i,stopListen:a}},nf=tA;var G4=[{itemId:A0,count:10.2,timestamp:Date.now(),readonly:!0},{itemId:L0,count:10.3,timestamp:Date.now(),readonly:!0},{itemId:B0,count:10.2,timestamp:Date.now(),readonly:!0},{itemId:O0,count:10.1,timestamp:Date.now(),readonly:!0},{itemId:D0,count:10,timestamp:Date.now(),readonly:!0},{itemId:k0,count:10.2,timestamp:Date.now(),readonly:!0},{itemId:fu,count:10.2,timestamp:Date.now(),readonly:!0},{itemId:hu,count:10.1,timestamp:Date.now(),readonly:!0},{itemId:gu,count:10.2,timestamp:Date.now(),readonly:!0},{itemId:ul,count:10.2,timestamp:Date.now(),readonly:!0}];var K4=[{title:"FAA to cut air traffic 10% in 40 markets amid shutdown"},{title:"Judge orders Trump prosecutors to release evidence in Comey case"},{title:"NOAA issues geomagnetic storm watch after strong solar flares"},{title:"OpenAI seeks federal loan guarantees for $1.4T expansion"},{title:"Putin orders Russia to draft nuclear test proposals"},{title:"US household debt hits record $18.6 trillion"},{title:"Senators demand corporate reports on AI job impacts"},{title:"Trump urges GOP to end filibuster as shutdown hits 36 days"},{title:"Snap shares surge 25% on earnings beat, $400M Perplexity deal"},{title:"Tech stocks rebound after AI valuation concerns spark selloff"},{title:"US tariffs now cover nearly half of all imports"},{title:"Centrist Senate Democrats push to end 36-day shutdown"},{title:"Google AI outperforms US model in hurricane forecasts"},{title:"Philippines declares emergency after typhoon kills 241"},{title:"Satellite images show mass graves in Sudan's El-Fasher"},{title:"DHS ends protected status for South Sudanese who fled civil war"},{title:"California Prop 50 passes, allowing Democrats to redraw districts"},{title:"China bans foreign AI chips in state-funded data centers"},{title:"Trump administration ends IRS free tax filing program"},{title:"China's emissions now expected to peak in 2028"}];var af=S(M()),bp=(o,e)=>{if(!o)return e;let t=o.toLowerCase();return e.filter(r=>r.prompt_title.toLowerCase().includes(t)||Za(r.prompt_id,r.prompt_title).toLowerCase().includes(t))},oA=o=>{let{liteContextMenuActionsItems:e}=Bi(o,{selectionInputAble:!0});return{query:o,selectedContextMenuList:e}},rA=o=>{let{t:e}=v(),{conversationId:t,selectionContent:r}=te(f=>({conversationId:f.conversationIds[0],selectionContent:f.selectionContent})),n=er(t),{selectedDocuments:i}=ja(),a=$C(),{liteContextMenuList:s,refetch:l}=Bi(o,{selectionInputAble:!0,contextMenuPath:"/my_own_tools",enabledFavorite:!1}),{liteContextMenuList:c,refetch:u}=Bi(o,{selectionInputAble:!0,contextMenuPath:"/rewrite",enabledFavorite:!1}),{isInStepTour:p}=te(f=>({isInStepTour:f.isInStepTour})),m=(0,af.useMemo)(()=>K4.map(f=>Ul({promptId:Eo(),parentPromptId:Up,promptTitle:f.title,question:f.title,icon:"Search"})),[e]),d=(0,af.useMemo)(()=>{let f=[],_=!r&&i.length>0&&i.every(I=>I.maxAIDocumentType==="page_content__webpage"&&I.selected)||p,x=!r&&i.length===1&&i[0].maxAIDocumentType==="page_content__youtube"&&i[0].selected,C=!r&&i.length===1&&i[0].maxAIDocumentType==="page_content__email"&&i[0].selected,y=!r&&i.length==1&&i[0].maxAIDocumentType==="search_results"&&i[0].selected,b=!r&&i.length>0&&i.every(I=>I.maxAIDocumentType==="image"&&I.selected),w=!r&&i.length>0&&i.every(I=>I.maxAIDocumentType!=="search_results"&&I.selected);if(!r){if(_){let I=_u.PAGE_SUMMARY;I&&f.push(...bp(o,I(i)))}else if(x){let I=_u.YOUTUBE_VIDEO_SUMMARY;I&&f.push(...bp(o,I(i)))}else if(C){let I=_u.DEFAULT_EMAIL_SUMMARY;I&&f.push(...bp(o,I(i)))}else if(b){let I=[Ul({promptId:fu,parentPromptId:"",icon:"DocumentScanner",promptTitle:e("package__features:chat_box__auto_suggestion__suggested__prompt__extract_text"),question:e("package__features:chat_box__auto_suggestion__suggested__prompt__extract_text")}),Ul({promptId:hu,parentPromptId:"",icon:"Question",question:e("package__features:chat_box__auto_suggestion__suggested__prompt__explain_content"),promptTitle:e("package__features:chat_box__auto_suggestion__suggested__prompt__explain_content")})];f.push(...bp(o,I))}else if(y)f=bp(o,m);else if(w){let I=[Ul({promptId:gu,parentPromptId:"",promptTitle:e("package__features:chat_box__auto_suggestion__suggested__prompt__summarize"),question:e("package__features:chat_box__auto_suggestion__suggested__prompt__summarize")})];f.push(...bp(o,I))}}return f},[o,m,i,r,e,p]),h=(0,af.useMemo)(()=>{let f=[],_={prompt_id:Up,parent_prompt_id:"",prompt_title:e("package__features:chat_box__auto_suggestion__suggested__title"),type:"group",children:[],actions:[]};f.push(_);let x=!r&&i.length==1&&i[0].maxAIDocumentType==="search_results"&&i[0].selected,C=o==="",y=[...d,...s.filter(w=>w.type==="chat_complete").map(Hs),...c.filter(w=>w.type==="chat_complete").map(Hs)],b=Qi(y,(w,I)=>{let E=a.indexOf(w.prompt_id);return E===-1?1e5+I:E},["asc"]).slice(0,5);if(n.length===0)C?x?_.children=d:_.children=b.filter(w=>a.includes(w.prompt_id.replace(sr,""))):_.children=b;else{if(C)return _.children=[],f;_.children=b}if(o.trim()&&_.children?.length){let w=Ul({promptId:ul,parentPromptId:_.prompt_id,promptTitle:e("package__features:chat_box__auto_suggestion__suggested__prompt__ask_query",{QUERY:`"${o}"`}),question:o,disableEditQuestion:!1});_.children=[w,..._.children].slice(0,5)}return _.children=_.children.map(w=>(w.parent_prompt_id=_.prompt_id,w)),f},[e,d,s,c,o,n.length,a,i]);return Ro(()=>{l("useChatGlobalSuggestedQuery"),u("useChatGlobalSuggestedQuery")}),{query:o,selectedContextMenuList:h}},nA=o=>{let e=oA(o),t=rA(o),{selectedType:r}=Hr(),{contextMenuPath:n}=lo();return r==="SUGGESTED"&&n!=="/compose_reply"?t:e},j4=nA;var pg=S(M()),iA=o=>{let{t:e}=v(),{onClick:t}=o;return pg.default.createElement(ee,{onClick:t,title:e("package__common:close"),placement:"bottom",sx:{width:"26px",height:"26px",padding:"8px"}},pg.default.createElement(z,{icon:"Close"}))},$4=iA;var $s=S(M()),aA=o=>{let{sx:e,children:t,LiteContextMenuEditViewProps:r,LiteContextMenuPositionSettingsProps:n,isBottom:i,hideToolbar:a=!1}=o,{mode:s,contextMenuPath:l}=lo(),{refetch:c}=Lo();return(0,$s.useEffect)(()=>{c("SidebarLiteContextMenuLayout")},[l]),$s.default.createElement(g,{sx:{width:"100%",height:"100%",...e}},s==="edit"&&$s.default.createElement(jC,{...n}),s==="list"&&t,s==="edit"&&$s.default.createElement(XC,{...r}),l!==null&&!a&&$s.default.createElement(YC,{sx:{...i?{borderTop:"1px solid",borderColor:"border.main",borderRadius:" 0 0 8px 8px"}:{borderBottom:"1px solid",borderColor:"border.main",borderRadius:"8px 8px 0 0"}}}))},q4=aA;var pt=S(M()),sA=o=>{let{isMessageEmpty:e=!0,sx:t,inputElementRef:r,onBeforeRunSuggestion:n,filterContextMenuList:i}=o,{t:a}=v(),{conversationId:s,inputMediator:l}=Ce(),c=pt.default.useRef(null),{layout:u,conversationType:p}=te(F=>({layout:F.layout,conversationType:F.conversationType})),{selectedType:m,resetMyOwnToolsType:d}=Hr(),h=ge(s),f=er(s),{selectedDocuments:_,loading:x}=ja(),[C,y]=(0,pt.useState)(""),{selectedContextMenuList:b}=j4(C),w=_.length===1&&_[0].maxAIDocumentType==="search_results"&&m==="SUGGESTED",I=(0,pt.useMemo)(()=>m==="SUGGESTED"&&C===""&&!w||m!=="SUGGESTED",[m,C,w]),E=(0,pt.useMemo)(()=>(i?i(b):b).filter(F=>F.type==="group"?F.children.length>0:!0),[b,i]),{askAIWithShortcutsV2:P}=Re(),O=u<=1&&f.length===0&&e,[N,V]=(0,pt.useState)(!1),[A,D]=(0,pt.useState)(null),[W,k]=(0,pt.useState)(!0),U=h||x,K=async F=>{if(!await Fe({emitEvent:!0})){l.focus();return}if(F.actions){if(n&&!n(F))return;await P(F.actions,{isClearInput:!0,isFocusInput:!0})}};(0,pt.useEffect)(()=>{let F=r?.current||Ot(p).ref;if(F){let Y=ae=>{if(["ArrowUp","ArrowDown"].includes(ae.key)){let oe=ae.key==="ArrowUp"?-1:1,ue=c.current?.querySelectorAll("[data-promptid]");if(ue&&ue.length>0){ae.preventDefault(),V(!0);let J=Array.from(ue).findIndex(ce=>ce.getAttribute("data-promptid")===A)+oe,j=null;J<0?j=ue[ue.length-1]:J>=0&&J<ue.length?j=ue[J]:j=ue[0],D(j.getAttribute("data-promptid")),j.scrollIntoView({behavior:"instant",block:"nearest"})}}else if(ae.key==="Enter"&&!ae.shiftKey&&!l.isComposing&&!x){let oe=c.current?.querySelector(`[data-promptid="${A}"]`);oe&&(ae.stopPropagation(),ae.preventDefault(),oe.click())}},$=()=>{y(F.value)},ie=()=>{setTimeout(()=>{y(F.value)},0),setTimeout(()=>{y(F.value)},200)},G=()=>{V(!1)};F.addEventListener("keydown",Y,{capture:!0}),F.addEventListener("input",$,{capture:!0}),F.addEventListener("blur",ie),y(F.value);let B=setInterval(()=>{y(F.value)},1e3);return window.addEventListener("mousemove",G),()=>{clearInterval(B),F.removeEventListener("keydown",Y,{capture:!0}),F.removeEventListener("input",$,{capture:!0}),F.removeEventListener("blur",ie),window.removeEventListener("mousemove",G)}}},[p,A,l,x]),(0,pt.useEffect)(()=>{let F=null;for(let Y of E)if(Y.children.length>0){F=Y.children[0],F.prompt_id===ul&&Y.children[1]&&(F=Y.children[1]);break}D(F?.prompt_id||null)},[E]),Ro(()=>{Ei.getService("CONTEXT_MENU_SUGGEST").setReadonlyItems(G4)});let H=(0,pt.useRef)(!1);(0,pt.useEffect)(()=>{if(H.current){H.current=!1;return}k(!0)},[f,_,m]);let R=E.length===0;return h?null:pt.default.createElement(g,{ref:c,"data-testid":"maxai--chat-auto-suggestion--container",sx:{position:"relative",...O?{borderTop:"1px solid",borderColor:"border.main",order:"2!important"}:{borderBottom:"1px solid",borderColor:"border.main",marginTop:"0px !important",order:"0!important"},...R?{border:"none"}:{},...N?{pointerEvents:"none"}:{},...W?{}:{display:"none"},gap:"10px","&:empty":{display:"none"},...t}},pt.default.createElement(q4,{hideToolbar:C!=="",isBottom:O,LiteContextMenuEditViewProps:{sx:{padding:"4px",maxHeight:"max(200px, 14vh)",overflowY:"auto",p:0}}},pt.default.createElement(Pn,{sx:{display:R?"none":"block",maxHeight:"max(200px, 14vh)",overflowY:"auto",padding:"4px"}},E.map((F,Y)=>{let $=F.prompt_title,ie=`package__features:context_menu__prompt__${F.prompt_id}`;return a(ie).includes(F.prompt_id)||($=a(ie)),pt.default.createElement(g,{key:F.prompt_id},E.length>=1&&pt.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"space-between"},pt.default.createElement(T,{fontSize:"12px",fontWeight:400,height:"32px",px:"8px",textAlign:"left",lineHeight:"32px",color:"text.secondary"},$),pt.default.createElement(g,{direction:"row",gap:"6px",sx:{pr:"8px"}},I&&[sr,Up].includes(F.prompt_id)&&pt.default.createElement(up,null),Y===0&&W&&pt.default.createElement($4,{onClick:()=>{d(),m!=="SUGGESTED"&&(H.current=!0),k(!1)}}))),F.children?.map(G=>{if(G.type==="group")return G.children.map(ae=>{let X=A===ae.prompt_id;return pt.default.createElement(X4,{isSelected:X,key:G.prompt_id+G.prompt_title,contextMenuItem:ae,parent:G,disabled:U,onMouseEnter:()=>{D(ae.prompt_id)},onClick:async()=>{await K(ae)}})});let B=A===G.prompt_id;return pt.default.createElement(X4,{isSelected:B,key:G.prompt_id+G.prompt_title,contextMenuItem:G,disabled:U,onMouseEnter:()=>{D(G.prompt_id)},onClick:async()=>{await K(G)}})}))}))))},X4=o=>{let{contextMenuItem:e,parent:t,disabled:r,onMouseEnter:n,onMouseLeave:i,onClick:a,isSelected:s}=o,{t:l}=v(),{selectedType:c}=Hr(),u=e.prompt_icon||t?.prompt_icon,p=e.origin?.path||"",m=p&&p.startsWith("/rewrite"),d=p&&p.startsWith("/my_own_tools"),h=(0,pt.useMemo)(()=>{let f=e.prompt_title,_=e.prompt_id.startsWith(sr)?e.prompt_id.replace(sr,""):e.prompt_id,x=`package__features:context_menu__prompt__${_}`;if(l(x).includes(_)||(f=l(x)),t?.prompt_title&&t?.prompt_id){let C=t.prompt_title,y=`package__features:context_menu__prompt__${t.prompt_id}`;l(y).includes(t.prompt_id)||(C=l(y),f=`${C} -> ${f}`)}return f},[l]);return pt.default.createElement(St,{disabled:r,onClick:a,onMouseEnter:n,onMouseLeave:i,"data-testid":`maxai--chat-auto-suggestion--menu-item--${e.prompt_id}`,"data-promptid":e.prompt_id,key:e.prompt_id,sx:{padding:"6px 8px",height:"32px",boxSizing:"border-box",gap:"12px",alignItems:"center",borderRadius:"4px",color:"text.primary",minHeight:"unset","&:hover":{color:"text.primary"},...s?{bgcolor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.06)!important":"rgba(0, 0, 0, 0.04)!important"}:{}}},u&&pt.default.createElement(z,{sx:{color:"text.secondary",flexShrink:0},icon:u,size:20}),pt.default.createElement(T,{width:0,flex:1,fontSize:"14px",fontWeight:400,textAlign:"left",color:"text.primary",noWrap:!0},h),m&&s&&c==="SUGGESTED"&&pt.default.createElement(T,{component:"span",sx:{border:"1px solid",borderColor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.1)",padding:"2px 4px",fontSize:"12px",borderRadius:"4px",color:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)"}},l("package__features:chat__inputbox__button__my_own_tools__menu__rewrite")),d&&s&&c==="SUGGESTED"&&pt.default.createElement(T,{component:"span",sx:{border:"1px solid",borderColor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.1)",padding:"1px 4px",fontSize:"12px",borderRadius:"4px",color:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)"}},l("package__features:chat__inputbox__button__my_own_tools__menu__my_own_tools")))},sf=sA;var Y4=S(vc());var Fo=S(M());var lA=o=>{let{value:e,onChange:t,onEnter:r,TextareaProps:n,error:i,sx:a,hideFooter:s=!1,onClickSuggestion:l,liteContextMenuPath:c}=o,{t:u}=v(),{chatMode:p}=cs(),m=bt(q_),d=Fo.default.useRef(null),h=(0,Fo.useCallback)(x=>{if(m==="UNKNOWN"||!c||Yp(c)!=="/compose_reply")return x;let C=y=>{let b=[];return m==="CHAT_APP_WEBSITE"&&b.push(...k1,...O1),m==="EMAIL"&&b.push(...L1,...O1),m==="SOCIAL_MEDIA"&&b.push(...L1,...k1),!b.includes(y.prompt_id.replace(sr,""))};return He(x).filter(y=>C(y)?(y.children&&(y.children=y.children.filter(b=>C(b))),!0):!1)},[m,c]),[f,_]=(0,Fo.useState)(!1);return(0,Fo.useEffect)(()=>(d.current&&Ot("chatBoxSetVariablesModalInputMediator").bindRef(d.current),()=>{Ot("chatBoxSetVariablesModalInputMediator").unbindRef()}),[]),Fo.default.createElement(g,{direction:"column",width:"100%",borderRadius:1,border:"1px solid",borderColor:`${i?"rgb(239, 83, 80)":"border.main"}`,boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.05)",boxSizing:"border-box",sx:{"& > *":{order:1},...a}},Fo.default.createElement(g,{"data-testid":"maxai--chat-box--chat-input--main",spacing:1,sx:{p:"10px"}},Fo.default.createElement(cp,{ref:d,"data-testid":"chat-input-textarea","data-disabled-button-clicked":!0,value:e,onChangeText:x=>{t?.(x)},onEnter:r,stopPropagation:!0,...n}),!s&&Fo.default.createElement(L,{display:"flex",alignItems:"center",justifyContent:"space-between"},Fo.default.createElement(g,{direction:"row",spacing:1,sx:{display:f?"none":"flex"}},o.footerLeftNode),Fo.default.createElement(g,{direction:"row",spacing:1,flex:1,justifyContent:"flex-end"},p==="free_chat"||e!==""?Fo.default.createElement(ee,{title:u("package__features:chat__inputbox__button__send_to_ai__tooltip"),description:"\u23CE",tooltipProps:{sx:{minWidth:"unset",p:1}},variant:"contained","data-testid":"sidebar_actions__send_btn",sx:{width:32,height:32,minWidth:"unset",borderRadius:1,boxSizing:"border-box","&[disabled]":{color:"background.paper"},"&:hover":{color:x=>x.palette.mode==="dark"?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 1)"}},disabled:!e,onClick:r,styleType:"default"},Fo.default.createElement(Y4.default,{sx:{fontSize:"16px",color:"inherit !important"}})):Fo.default.createElement(ls,{value:{isVoiceInput:f,setIsVoiceInput:_}},Fo.default.createElement(lp,{onSpeechToTextSuccess:x=>{t?.(x),r?.()}}))))),c&&Fo.default.createElement(is,{defaultContextMenuPath:Yp(c)},Fo.default.createElement(sf,{onBeforeRunSuggestion:x=>l?(l(x),!1):!0,inputElementRef:d,filterContextMenuList:h})))},Z4=lA;var gs=S(M()),ug=o=>{let{t:e}=v(),{sx:t,...r}=o;return gs.default.createElement(ee,{placement:"top",title:e("package__features:chat__ai_message__tools__regenerate_button"),sx:{p:"6px",...t},...r},gs.default.createElement(z,{sx:{fontSize:"20px"},icon:"Regenerate"}))},pA=o=>{let{message:e}=o,{t}=v(),{isLastMessage:r}=Ze(),n=e.conversationId||"",i=ge(n),{regenerate:a}=Re(),[s,l]=(0,gs.useState)(!1);return(0,gs.useEffect)(()=>{r&&Ds(n).then(({lastRunActions:u})=>{l(u.length>0)})},[r]),r&&s?gs.default.createElement(ug,{disabled:i,onClick:()=>a(n),testid:"sidebar_actions__regenerate",sx:{p:"6px"}}):null},Q4=pA;var e3=S(Cr()),t3=S(vc());var ne=S(M());var cA=({error:o})=>ne.default.createElement(bu,{severity:"error",sx:{width:"100%",p:"12px",[`& .${yu.message}`]:{p:0,width:"100%"},"& > div:first-of-type":{display:"none"},"& .markdown-body":{"& > p:first-of-type":{mt:0}}},icon:ne.default.createElement(ne.default.Fragment,null)},ne.default.createElement(g,{sx:{fontSize:"0.875rem",lineHeight:"143%",letterSpacing:"0.17px"}},o)),lf=()=>{Zi.send("SetVariablesModalClose",{})},uA=o=>{let{onShow:e,onClose:t,sx:r}=o,{t:n}=v(),{setChatHubLoading:i}=rt(),{askAIWithShortcutsV2:a}=Re(),{chatMode:s}=cs(),l=(0,ne.useRef)(null),[c,u]=(0,ne.useState)(!1),{conversationId:p}=Ce(),[m,d]=(0,ne.useState)(!1),[h,f]=(0,ne.useState)(null),[_,x]=(0,ne.useState)(null),[C,y]=(0,ne.useState)(!1),[b,w]=(0,ne.useState)(!1),[I,E]=(0,ne.useState)(null),[P,O]=(0,ne.useState)(null);(0,ne.useEffect)(()=>{},[I]);let[N,V]=(0,ne.useState)(null),A=$e(m),{control:D,trigger:W,reset:k,getValues:U,setValue:K,watch:H}=Sl({defaultValues:{textVariables:[],selectVariables:[]}}),R=Na(),{fields:F}=B1({control:D,name:"textVariables"}),{fields:Y}=B1({control:D,name:"selectVariables"}),$=h!==null?H(`textVariables.${h}.default_value`):null,ie=(0,ne.useRef)(!1),G=F.filter(Q=>!Q.hidden).length,B=U().textVariables.filter(Q=>!Q.hidden&&!Q.default_value).length>0,ae=$e(_),X=(0,ne.useRef)(null),[oe,ue]=(0,ne.useState)(!1),Z=(0,ne.useMemo)(()=>s==="free_chat"?!1:C||b||oe?!0:typeof h=="number"?!$:!1,[s,C,b,oe,h,$]),J=(0,ne.useMemo)(()=>I?.contextMenuId&&["47070ec6-8700-43fd-a519-20fe3841df38","9a65c4c0-c2b8-4fe1-a85e-0e2d84682eb1","b5381aa7-5ba3-4f96-a696-c694da938ef2"].includes(I.contextMenuId),[I?.contextMenuId]),j=(0,ne.useRef)(),ce=(0,ne.useRef)(null),ke=(0,ne.useRef)(!1),at=(0,ne.useCallback)(Q=>{Q!=="done"&&y(!1),ue(!1),ce.current&&(ce.current.getTracks().forEach(Te=>Te.stop()),ce.current=null)},[]),we=()=>{y(!0)},tt=Q=>{at(Q),yt(ae.current)},At=(0,ne.useCallback)(()=>{u(!1),k({textVariables:[],selectVariables:[]}),V(null),m&&(d(!1),x(0),t?.())},[t,k,m]),Zt=$e(At),yt=Q=>{let Te=Array.from(l.current?.querySelectorAll('textarea:not([aria-hidden="true"])')||[]);if(typeof Q=="number"&&Te[Q])return Te[Q].focus(),Te[Q].setSelectionRange(Te[Q].value.length,Te[Q].value.length),!0;let Be=Te.find(Le=>!Le.value);return Be?(Be.focus(),Be.setSelectionRange(Be.value.length,Be.value.length),!1):!0},Zo=async()=>{!yt()||!await W()||I&&await zt([{type:"ASK_CHATGPT",parameters:{AskChatGPTActionQuestion:{text:"",meta:Qo([{MaxAIPromptActionConfig:I.MaxAIPromptActionConfig},I?.questionMeta||{}])}}}])},zt=(0,ne.useCallback)(async(Q,Te)=>{try{i(!0);let Be=He(Q),Le=Te?He(Te):{};if(!Te){let kt=He(U());kt.textVariables.concat(kt.selectVariables).forEach(wo=>{Le[wo.name]={key:wo.name,value:wo.default_value,overwrite:!0,isBuiltIn:wo.hidden,label:wo.hint}})}if(s==="free_chat"){let kt=Le.AI_RESPONSE_TONE;kt&&(kt.value="Default");let wo=Le.AI_RESPONSE_WRITING_STYLE;wo&&(wo.value="Default")}Be.unshift({type:"SET_VARIABLE_MAP",parameters:{VariableMap:Le}});let Ee=Be.some(kt=>{let wo=Z_(kt);if(wo?.path){let st=Yp(wo.path);return["/refine_draft","/rewrite","/compose_new","/compose_reply"].includes(st)}return!1});d(!1),t?.(),x_.setOpenType(N?"instant_reply":"normal"),await a(Be,{conversationId:p,disabledMaxAIDocumentIds:Ee,keepLoadingAfterExecution:!0,isFocusInput:!0});let Qn=ri.getShortcutsEngine(p),Jn=!0;if(Qn.status!=="stop"&&N&&(Jn=!1,Be[Be.length-1].type!=="SET_VARIABLES_MODAL")){let kt=ri.getShortcutsEngine(p),wo=await Dn.getService().getMessageByType(p,"ai","latest");if(wo&&kt.status==="idle"){Jn=!1;let st=He(l2);st.variables=[De.PRESET_VARIABLE__REFINE_DRAFT__FOLLOW_UP_INSTRUCTION,{name:"SELECTED_TEXT",hint:"Text to rewrite",type:"text",hidden:!0,default_value:Bn(wo,!1)}],await Zi.send(`SetVariablesModal_${p}`,{task:"open",config:{title:N,contextMenuId:st.prompt_id,variables:st.variables,MaxAIPromptActionConfig:st}})}}Jn&&i(!1)}catch{i(!1)}},[a,s,p,N,U,t]),q=(0,ne.useCallback)(async(Q,Te)=>{try{return u(!0),await __.usePromptAction(p,Te,{chatMode:"free_chat",jsonMode:!0,taskId:Q})}catch{return{error:l0,data:null}}finally{u(!1)}},[p]),de=(0,ne.useRef)(""),se=(0,ne.useRef)(null),Se=(0,ne.useCallback)(async Q=>{O(null),se.current=Q;let{task:Te,config:Be}=Q||{};de.current&&Qr.abort(de.current);let Le=Eo();if(de.current=Le,Te==="open"&&Be){i(!0);let Ee=Be;Ee?.contextMenuId&&["d833ef67-36fb-4228-8e04-4b6d7583a341","1cc8f601-27ac-474f-a70c-20ed1177711a","47070ec6-8700-43fd-a519-20fe3841df38","9a65c4c0-c2b8-4fe1-a85e-0e2d84682eb1","b5381aa7-5ba3-4f96-a696-c694da938ef2","8c0c38d4-1dfe-498e-8229-05e758b2dc03"].includes(Ee.contextMenuId)&&V(Za(Ee?.MaxAIPromptActionConfig?.prompt_id||"",Ee?.title||""));let Qn=await mp.getSetVariablesModalSelectCache();Ee.variables=Ee.variables?.map(st=>(Object.prototype.hasOwnProperty.call(Qn,st.name)&&(st.default_value=Qn[st.name]),st))||[];let Jn=(Ee.variables||[]).filter(st=>st.type==="text"),kt=(Ee.variables||[]).filter(st=>st.type==="select");if(k({textVariables:Jn,selectVariables:kt}),Ee.description?.label&&Ee.extraDataByPromptAction?.prompt_id&&(Ee.description.label=Za(Ee.extraDataByPromptAction.prompt_id,Ee.description.label)),E(Ee),Ee.extraDataByPromptAction&&q(de.current,Ee.extraDataByPromptAction).then(st=>{!st||Le!==de.current||(st.error?O(st.error):E(ei=>st.data?{...ei,description:{icon:"LightBulb",label:"Intent",...ei?.description,content:st.data.intent}}:ei))}).catch(st=>{}),!(Jn.length>0&&Jn.some(st=>!st.hidden&&!st.default_value))&&!Be.disableAutoExecuteWhenAllVariableHaveValue){let st=Ee.variables||[],ei={};st.forEach(gi=>{ei[gi.name]={key:gi.name,value:gi.default_value,overwrite:!0,isBuiltIn:gi.hidden,label:gi.hint}}),zt([{type:"ASK_CHATGPT",parameters:{AskChatGPTActionQuestion:{text:"",meta:Qo([{MaxAIPromptActionConfig:Ee?.MaxAIPromptActionConfig},Ee?.questionMeta||{}])}}}],ei)}else d(!0),e?.(),setTimeout(()=>{yt()},0),i(!1);return{data:{},type:"confirm",success:!0}}},[zt,q,e,k,i]);(0,ne.useEffect)(()=>{let Q=Zi.receive(`SetVariablesModal_${p}`,Se);return()=>{Q()}},[p,Se]),(0,ne.useEffect)(()=>{p&&Zt.current()},[p]),(0,ne.useEffect)(()=>{let Q=Zi.receive("SetVariablesModalClose",()=>{A.current&&Zt.current()});return()=>{Q()}},[]);let To=(0,ne.useRef)(null);x2("keydown",Q=>{Q.key==="Escape"&&Zt.current()});let[ar,ot]=(0,ne.useState)(!1),_e=(0,ne.useMemo)(()=>ne.default.createElement(ne.default.Fragment,null,ne.default.createElement(us,null),s!=="free_chat"&&ne.default.createElement(hs,null),s!=="free_chat"&&ne.default.createElement(ms,null)),[s]),Yr=so(),fe=(0,ne.useCallback)(()=>{let Q=X.current?.closest('[data-testid="maxai--chat-box--center--container"]');if(Q||(Q=Yr?.querySelector('[data-testid="maxai--chat-box--center--container"]')),Q){let Te=0;m&&X.current?.clientHeight&&(Te=X.current.clientHeight-16),Q.style.setProperty("--chatGptMarginTopExcludeAIReplyDescription",`${Te}px`)}},[Yr,m]);return(0,ne.useEffect)(()=>(fe(),()=>{fe()}),[I?.description,m,fe]),m?ne.default.createElement(g,{className:"max-ai__action__set_variables_modal",sx:{width:"100%",overflow:"hidden",pb:1,boxSizing:"border-box",...r},maxHeight:"100%",onKeyPressCapture:Q=>{Q.stopPropagation()},onKeyPress:Q=>{Q.stopPropagation()}},ne.default.createElement(g,{width:"100%",flexShrink:0,ref:X},ne.default.createElement(g,{direction:"row",alignItems:"start",justifyContent:"space-between",width:"100%",sx:{bgcolor:"rgba(0, 0, 0, 0.87)",borderRadius:"8px",padding:"2px 2px 2px 12px",gap:"10px","&:has(+ .max-ai__action__set_variables_modal--description)":{borderRadius:"8px 8px 0 0"}}},ne.default.createElement(L,{width:0,flex:1,component:"div",display:"flex",alignItems:"center"},ne.default.createElement(T,{fontSize:"14px",color:"#fff",fontWeight:600,height:"32px",lineHeight:"30px",sx:{textAlign:"left",width:"100%"},noWrap:!0},Za(I?.MaxAIPromptActionConfig?.prompt_id||"",I?.title||""))),ne.default.createElement(ee,{"data-testid":"close-modal-button",sx:{width:"32px",height:"32px",flexShrink:0},onMouseDown:()=>{Zt.current()}},ne.default.createElement(e3.default,{sx:{fontSize:"20px",color:"#fff!important"}}))),I?.description&&ne.default.createElement(g,{className:"max-ai__action__set_variables_modal--description",sx:{padding:"8px",border:"1px solid",borderTop:"none",borderColor:"border.main",gap:"4px",width:"100%",borderRadius:"0 0 8px 8px"}},ne.default.createElement(g,{direction:"row",alignItems:"center",gap:"8px"},ne.default.createElement(z,{icon:I.description.icon,sx:{flexShrink:0,fontSize:"20px",color:"text.primary"}}),ne.default.createElement(T,{fontSize:"14px",color:"text.primary",fontWeight:500,lineHeight:"20px",width:0,flex:1,noWrap:!0},n(`package__features:context_menu__prompt__${I.extraDataByPromptAction?.prompt_id}`)||I.description.label)),c?ne.default.createElement(g,null,ne.default.createElement(vt,{height:21,animation:"wave"})):P?ne.default.createElement(g,{sx:{alignItems:"flex-start"}},ne.default.createElement(cA,{error:P}),ne.default.createElement(ug,{sx:{marginTop:"8px"},onClick:()=>{Se(se.current)}})):ne.default.createElement(wa,{in:!0},ne.default.createElement(T,{fontSize:"14px",color:"text.secondary",fontWeight:400,lineHeight:"21px"},I.description.content)))),ne.default.createElement(g,{direction:"row",alignItems:"center",gap:"4px",sx:{padding:"8px 0",width:"100%"}},s!=="free_chat"&&Y.length>0&&Y.map((Q,Te)=>Q.hidden?null:ne.default.createElement(Fa,{key:Q.name,control:D,name:`selectVariables.${Te}.default_value`,defaultValue:Q.default_value,render:({field:Be})=>ne.default.createElement(Rd,{systemVariableSelectKey:Q.name,key:Q.name,defaultValue:Be.value,onChange:Le=>{mp.setVariablesModalSelectCache(Q.name,Le),Be.onChange(Le)}})}))),ne.default.createElement(g,{component:"div",direction:"row",flexWrap:"wrap",flex:1,height:0,sx:{gap:"8px",overflowY:"auto",scrollbarColor:"auto","&::-webkit-scrollbar":{width:"7px"},"&::-webkit-scrollbar-thumb":{borderRadius:"20px",backgroundColor:"text.secondary"}},ref:l},G===1&&F.map((Q,Te)=>Q.hidden?null:ne.default.createElement(Fa,{control:D,rules:{required:!0},key:Q.name,render:({field:Be})=>ne.default.createElement(Z4,{"data-testid":`custom-variable--${Q.name}`,value:Be.value||"",onChange:Be.onChange,TextareaProps:{minLine:4,placeholder:(Q.hintI18nKey?n(Q.hintI18nKey):Q.hint)||`Enter ${Q.name}`},onEnter:Zo,onClickSuggestion:async Le=>{await zt(Le.actions)},liteContextMenuPath:J?I?.MaxAIPromptActionConfig?.path:void 0,footerLeftNode:_e}),name:`textVariables.${Te}.default_value`})),G>1&&ne.default.createElement(g,{sx:{height:"100%",width:"100%",overflow:"hidden",gap:"12px"}},ne.default.createElement(g,{sx:{flex:1,overflow:"auto",gap:"8px",flexWrap:"wrap",flexDirection:"row"}},F.map((Q,Te)=>{let Be=(R==="lg"||R==="xl")&&F.length>1?"calc(50% - 8px)":"100%";return Q.hidden?null:ne.default.createElement(Fa,{control:D,rules:{required:!0},key:Q.name,name:`textVariables.${Te}.default_value`,render:({field:Le})=>ne.default.createElement(Lt,{fullWidth:!0,"data-testid":`custom-variable--${Q.name}`,size:"small",key:Q.name,label:Q.hint||"Label",value:Le.value||"",sx:{width:Be,mt:"8px"},InputProps:{sx:{fontSize:"16px",minHeight:"63px"}},inputProps:{style:{fontSize:"16px",textAlign:"left"}},FormHelperTextProps:{sx:{ml:0,fontSize:"12px"}},onChange:Ee=>{Le.onChange(Ee.target.value)},onKeyUp:Ee=>{Ee.stopPropagation()},onKeyDown:async Ee=>{Ee.key==="Enter"&&!Ee.shiftKey&&!ie.current?(Ee.stopPropagation(),Ee.preventDefault(),Zo()):Ee.stopPropagation()},onCompositionStart:()=>{ie.current=!0},onCompositionEnd:()=>{ie.current=!1},onPaste:Ee=>{Ee.stopPropagation()},onFocus:Ee=>{f(Te),x(Te)},onBlur:()=>{f(null)},InputLabelProps:{shrink:!0,sx:{fontSize:"16px"}},multiline:!0,placeholder:Q.hint||`Enter ${Q.name}`,minRows:2,maxRows:2})})})),ne.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"end",width:"100%"},ar?null:ne.default.createElement(g,{sx:{flexDirection:"row",flex:1}},_e),Z?ne.default.createElement(ls,{value:{isVoiceInput:ar,setIsVoiceInput:ot}},ne.default.createElement(lp,{onMouseDown:async()=>{try{if(ke.current)return;To.current&&clearTimeout(To.current),w(!0),clearTimeout(j.current),ke.current=!0,ce.current=await navigator.mediaDevices.getUserMedia({audio:!0}),ke.current=!1,ue(!0),window.addEventListener("mouseup",()=>{ke.current||(clearTimeout(j.current),j.current=setTimeout(()=>{w(!1)},200))},{once:!0})}catch{ke.current=!1,To.current=setTimeout(()=>{w(!1)},3e3)}},onStartRecording:we,onStopRecording:tt,onSpeechToTextSuccess:Q=>{ae.current!==null&&(K(`textVariables.${ae.current}.default_value`,Q),yt(ae.current),y(!1))},onSpeechToTextFinally:()=>{at()}})):ne.default.createElement(ee,{title:n("package__features:chat__inputbox__button__send_to_ai__tooltip"),description:"\u23CE",tooltipProps:{sx:{minWidth:"unset",p:1}},variant:"contained","data-testid":"sidebar_actions__send_btn",sx:{width:32,height:32,minWidth:"unset",borderRadius:1,boxSizing:"border-box","&[disabled]":{color:"background.paper"},"&:hover":{color:Q=>Q.palette.mode==="dark"?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 1)"}},disabled:B,onClick:Zo,styleType:"default"},ne.default.createElement(t3.default,{sx:{fontSize:"16px",color:"inherit !important"}})))))):null},o3=uA;var r3=()=>{let o=document.createElement("div");o.contentEditable="true",o.style.all="initial",o.style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",document.body.appendChild(o),o.focus(),document.execCommand("paste",!1,"");let e=document.createElement("div");return o.childNodes.forEach(t=>{e.appendChild(t.cloneNode(!0))}),o.remove(),e},pi=o=>{let e=[];return o.forEach(t=>{document.querySelectorAll(t).forEach(r=>{r instanceof HTMLElement&&e.push(r)})}),e};async function pf(o,e=!1){if(o.focus(),await new Promise(t=>setTimeout(t,0)),o.focus(),!e)document.execCommand("selectAll",!1,"");else{let t=window.getSelection(),r=document.createRange();r.selectNodeContents(o),r.collapse(!1),t?.removeAllRanges(),t?.addRange(r)}}var dg=async(o,e=!1)=>{await pf(o,e),document.execCommand("paste",!1,""),(o.lastElementChild||o).scrollIntoView({block:"center",inline:"center"})},mA=async(o,e=!1)=>{let t=o.innerText||o.textContent||"";if(await pf(o,e),document.execCommand("paste",!1,""),await new Promise(a=>setTimeout(a,10)),!((o.innerText||o.textContent||"").trim()!==t.trim())){let a=await navigator.clipboard.read();for(let s of a)if(s.types.includes("text/plain")){let c=await(await s.getType("text/plain")).text();c.trim()&&(await pf(o,e),document.execCommand("insertText",!1,c),await pf(o,e),document.execCommand("paste",!1,""));break}}(o.lastElementChild||o).scrollIntoView({block:"center",inline:"center"})},n3={selectors:['div[id][contenteditable="true"]'],insertContent:async(o,e,t)=>{let r=n3.selectors,n=t||pi(r)[0];if(!n){let d=pi([".amn .ams.bkH",".amn .ams.bkI",".amn span:first-of-type button"]),h=d[d.length-1];h&&(h.click(),await _1(document.body,r[0],100,5e3),n=pi(r)[0])}if(!n)return;let i=document.createElement("div");i.className="F0iAze";let a=r3();a.className="Znr6db";let s=document.createElement("br");a.appendChild(s),i.appendChild(a),n.scrollIntoView({block:"center",inline:"center"});let l=!1,c=Array.from(n.childNodes);c.length===1&&c[0]instanceof HTMLElement&&(c=Array.from(c[0].childNodes)),c.forEach(d=>{if(d instanceof HTMLElement){let h=d;if((h.tagName==="HR"||h.matches(".gmail_quote")||h.querySelector(".gmail_quote"))&&(l=!0),l)return}d.remove()}),n.focus(),n.prepend(i);let u=document.createRange();u.selectNodeContents(a),u.collapse(!1);let p=window.getSelection();p?.removeAllRanges(),p?.addRange(u),(a.lastElementChild||a).scrollIntoView({block:"center",inline:"center"}),setTimeout(()=>{i.classList.remove("F0iAze")},1e3)}},cf={selectors:['div[id^=editor] div[aria-multiline][spellcheck][contenteditable="true"]'],insertContent:async(o,e,t)=>{let r=cf.selectors,n=t||pi(r)[0];if(!n){let m=pi(['button[role="menuitem"]:has(i[data-icon-name="ArrowReplyRegular"])','button[role="menuitem"]:has(i[data-icon-name="ArrowReplyAllRegular"])']),d=m[m.length-1];d&&(d.click(),await _1(document.body,r[0],100,5e3),n=pi(r)[0])}if(!n)return;let i=document.createElement("div"),a=r3();a.innerHTML=a.innerHTML.replace(/\n/g,"<br />");let s=document.createElement("br");a.appendChild(s),a.querySelectorAll("li > br:first-child").forEach(m=>{m.remove()}),i.appendChild(a);let l=!1;Array.from(n.children).forEach(m=>{(m.id.includes("RplyFwdMsg")||m.matches("#divRplyFwdMsg")||m.matches("#RplyFwdMsg")||m.querySelector("#divRplyFwdMsg")||m.querySelector("#RplyFwdMsg")||m.tagName==="HR")&&(l=!0),!l&&m.remove()}),n.focus(),n.prepend(i);let c=document.createRange();c.selectNodeContents(a),c.collapse(!1);let u=window.getSelection();u?.removeAllRanges(),u?.addRange(c),(a.lastElementChild||a).scrollIntoView({block:"center",inline:"center"})}},i3={selectors:["div[id][contenteditable]","div#contents ytd-commentbox:not([hidden]) div[id][contenteditable]"],needFindInstantReplyButtonIdToInput:!0,insertContent:async(o,e,t)=>{let r=i3.selectors,n=t||pi(r)[0];if(!n)return;let i=n.querySelector("a.yt-simple-endpoint[href]"),a=i?.innerHTML;mA(n),a&&(i.innerHTML=a)}},mg=null,a3={selectors:['div.ql-editor[contenteditable="true"]','div.msg-form__contenteditable[contenteditable="true"]'],needFindInstantReplyButtonIdToInput:!0,insertContent:async(o,e,t)=>{let r=a3.selectors,n=t||pi(r)[0];if(!n)return;mg&&clearTimeout(mg);let a=n.querySelector("a.ql-mention[href]")?.cloneNode(!0)?.outerHTML;dg(n),a&&(mg=setTimeout(()=>{let s=n.querySelector("p");s&&(s.innerHTML=a+" "+s.innerHTML)},50))}},s3={selectors:['div.ql-editor[contenteditable="true"]'],insertContent:async(o,e,t)=>{let r=s3.selectors,n=t||pi(r)[0];n&&dg(n)}};var l3={selectors:['[class^="channelTextArea"] [class^="textArea"] div[role="textbox"][contenteditable="true"]'],insertContent:async(o,e,t)=>{let r=l3.selectors,n=t||pi(r)[0];n&&dg(n)}};var p3={selectors:["textarea[id]"],needFindInstantReplyButtonIdToInput:!0,insertContent:async(o,e,t)=>{let r=p3.selectors,n=t||pi(r)[0];if(!n)return;n.focus(),n.select(),document.execCommand("paste",!1,""),n.setSelectionRange(n.value.length,n.value.length),n.closest("div#id.style-scope.ytcp-form-input-container")?.scrollIntoView()}},c3={"outlook.live.com":cf,"outlook.office.com":cf,"outlook.office365.com":cf,"mail.google.com":n3,"youtube.com":i3,"studio.youtube.com":p3,"linkedin.com":a3,"app.slack.com":s3,"discord.com":l3};async function uf(o){let e=new Map,t=o,r=0,n=/```[\s\S]*?```/g,i;for(;(i=n.exec(o))!==null;){let l=`CODEBLOCK${r}CODEBLOCK`,c=i[0],u=t.replace(c,"");for(;u.includes(l);)r++,l=`CODEBLOCK${r}CODEBLOCK`;let p=c.replace(/^```\w*\n?/,"").replace(/\n?```$/,"");e.set(l,p),t=t.replace(c,l),r++}let s=(await ZC().use(QC).process(t)).toString();e.forEach((l,c)=>{s=s.replace(new RegExp(c,"g"),l)}),await navigator.clipboard.writeText(s.trim())}var fg=class o{constructor(){this.lastFocusInstantReplyInput=void 0}static getInstance(){return this.instance||(this.instance=new o),this.instance}setLastFocusInstantReplyInput(e){this.lastFocusInstantReplyInput=e}getLastFocusInstantReplyInput(){return this.lastFocusInstantReplyInput}},u3=fg;var ro=S(M()),m3=async(o,e,t)=>{if(t){let r=pl('.markdown-body[data-testid="chat-ai-message--markdown"]',e);if(!r)return m3(o,e,!1);pm(o,r,[])}else{let r=ec(o,!1,[]);await uf(r)}},dA=()=>{let{AIMessage:o}=Ze(),{t:e}=v(),{chatHubLoading:t}=rt(),{pageUrl:r}=nf(),[n,i]=(0,ro.useState)(!1),a=(0,ro.useMemo)(()=>{let u=Np();return c3[u]||null},[r]),s=(0,ro.useRef)(!1),l=BC.getInstance(),c=async(u,p)=>{let m=u.currentTarget,d=null;if(a?.needFindInstantReplyButtonIdToInput&&!s.current){let f=l.getLastActiveInput();f&&(cl(f)?d=f:l.deleteLastActiveInput()),s.current=!0}let h=d||u3.getInstance().getLastFocusInstantReplyInput();a&&m&&(h&&(cl(h)||(h=void 0)),await m3(o,m,p),await a.insertContent(o,p,h)),lf()};return(0,ro.useEffect)(()=>{if(a){let u=()=>{if(a.selectors.length){let m=!1;for(let d of a.selectors){let h=document.querySelector(d);if(h&&cl(h)){m=!0;break}}i(m)}};u();let p=setInterval(u,1e3);return()=>{clearInterval(p)}}},[a]),!a||!n?null:ro.default.createElement(ro.default.Fragment,null,ro.default.createElement(St,{disabled:t,sx:{p:0},onClick:u=>{c(u,!0)},"data-testid":"maxai-client--ai-message--next-action--insert-result-to-input-with-format-item"},ro.default.createElement(g,{width:"100%"},ro.default.createElement(g,{direction:"row",alignItems:"center",width:"100%",sx:{px:1},gap:1},ro.default.createElement(z,{icon:"InsertBelow",sx:{flexShrink:0,fontSize:"20px",color:"text.secondary"}}),ro.default.createElement(ni,{TooltipProps:{disableInteractive:!0},width:0,flex:1,lineClamp:1,fontSize:"16px",whiteSpace:"normal",color:"text.primary",fontWeight:400,sx:{height:"40px",lineHeight:"40px"}},e("package__features:chat__chat_with_any_content__next_actions__insert_content_with_format__title"))),ro.default.createElement(It,null))),ro.default.createElement(St,{disabled:t,sx:{p:0},onClick:u=>{c(u,!1)},"data-testid":"maxai-client--ai-message--next-action--insert-result-to-input-without-format-item"},ro.default.createElement(g,{width:"100%"},ro.default.createElement(g,{direction:"row",alignItems:"center",width:"100%",sx:{px:1},gap:1},ro.default.createElement(z,{icon:"ArrowInsert",sx:{flexShrink:0,fontSize:"20px",color:"text.secondary"}}),ro.default.createElement(ni,{TooltipProps:{disableInteractive:!0},width:0,flex:1,lineClamp:1,fontSize:"16px",whiteSpace:"normal",color:"text.primary",fontWeight:400,sx:{height:"40px",lineHeight:"40px"}},e("package__features:chat__chat_with_any_content__next_actions__insert_content_without_format__title"))),ro.default.createElement(It,null))))},d3=dA;var Vn=S(M()),fA=o=>{let{nextActions:e}=o,{chatHubLoading:t}=rt(),{askAIWithShortcutsV2:r}=Re(),{AIMessage:n}=Ze(),i=(0,Vn.useMemo)(()=>p_(n),[n]),a=async s=>{let l=Hs(s);if(l.actions){let c=[],u=Bn(n,!1);u=u.replace(ml,""),c.push({type:"SET_VARIABLE_MAP",parameters:{VariableMap:{[De.PRESET_VARIABLE__SELECTED_TEXT.name]:u}}}),c.push({type:"SET_VARIABLE",parameters:{Variable:{key:Uu,value:"sidebar_related_rewrite"}}}),c.push(...l.actions),await r(c,{disabledMaxAIDocumentIds:!0,keepLoadingAfterExecution:!0})}};return Vn.default.createElement(wa,{in:!0,timeout:150},Vn.default.createElement(g,{sx:{mt:"0!important"}},e.length>0&&!i&&Vn.default.createElement(d3,null),e.map((s,l)=>{let c=l===e.length-1;if(!s.input?.prompt_action)return null;let u=s.input.prompt_action;return Vn.default.createElement(St,{key:u.prompt_id,disabled:t,sx:{p:0},onClick:async()=>{await a(u)},id:"maxai-client--ai-message--next-action--use-prompt-action-item","data-testid":`maxai-client--ai-message--next-action--use-prompt-action-item-${l}`},Vn.default.createElement(g,{width:"100%"},Vn.default.createElement(g,{direction:"row",alignItems:"center",width:"100%",sx:{px:1},gap:1},u.prompt_icon&&Vn.default.createElement(z,{icon:u.prompt_icon,sx:{flexShrink:0,fontSize:"20px",color:"text.secondary"}}),Vn.default.createElement(ni,{TooltipProps:{disableInteractive:!0},width:0,flex:1,lineClamp:1,fontSize:"16px",whiteSpace:"normal",color:"text.primary",fontWeight:400,sx:{height:"40px",lineHeight:"40px"}},Za(u.prompt_id,u.prompt_title))),!c&&Vn.default.createElement(It,null)))})))},f3=fA;var xn=S(M());var mf=new Map,h3=(o,e)=>{window.dispatchEvent(new CustomEvent(o,{detail:{...e,appVersion:g1,runTimeEnv:Hp}}))},g3=(o,e)=>{if(mf.get(e))return;let t=r=>{let{appVersion:n,runTimeEnv:i}=r.detail||{};n===g1&&i===Hp&&e(r)};mf.set(e,t),window.addEventListener(o,t)},x3=(o,e)=>{let t=mf.get(e);t&&(mf.delete(e),window.removeEventListener(o,t))};var Rc=S(M()),hA=()=>({chatScreenshots:te(e=>e.chatScreenshots)}),gg=()=>{let{uploadDocument:o}=T_(),{getChatHubState:e,setChatScreenshots:t}=te(s=>({getChatHubState:s.getChatHubState,setChatScreenshots:s.setChatScreenshots})),r=(0,Rc.useCallback)(s=>{t(l=>{let c=[...l];return s.forEach(u=>{let p=c.findIndex(m=>m.id===m.id);p<0?c.push({...u}):c[p]={...c[p],...u}}),c})},[]),n=(0,Rc.useCallback)(s=>{t(l=>l.filter(c=>!s.includes(c.id)))},[]),i=(0,Rc.useCallback)(async s=>{if(!s.length)return;let{supportedFiles:l}=await C_(s,{maxCount:H0});if(!l.length)return;let c=await jp.isLogin(),u={},p=l.map(m=>{let d=Eo();u[d]=m.file;let h={id:d,title:m.file.name||"Chat file",status:"uploading",selected:!0,maxAIDocumentType:m.documentType,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return c||(h.status="pending",h.preUploadMetadata={previewIcon:URL.createObjectURL(m.file)}),h});r(p),await Promise.all(p.map(async m=>{let{data:d,reason:h}=await Pl.analyzeToDocument(u[m.id]);if(!d)return n([m.id]),dt.error(h,{autoHideDuration:3e3}),null;if(m.maxAIDocumentId=d.doc_id,m.maxAIDocumentType=d.doc_type,r([m]),!c&&!await Fe())return n([m.id]),null;let f=await o(d);e().chatScreenshots.find(x=>x.id===m.id)&&(f.success&&f.data?r([{...m,link:f.data.s3?.doc_url,status:"success",updatedAt:new Date().toISOString()}]):(n([m.id]),dt.error(f.message,{autoHideDuration:3e3})))}))},[]),a=(0,Rc.useCallback)(()=>{t(()=>[])},[]);return{addOrUpdateChatScreenshots:r,removeChatScreenshots:n,uploadChatScreenshotFiles:i,removeAllChatScreenshots:a}},Ip=()=>{let o=hA(),e=gg();return{...o,...e}};var _3=S(B7());var Rn=S(M()),gA=({order:o,title:e,disabled:t,onClick:r})=>Rn.default.createElement(St,{disabled:t,sx:{p:0},onClick:r,"data-testid":`maxai-client--ai-message--next-action--related-question-item-${o}`},Rn.default.createElement(g,{width:"100%"},Rn.default.createElement(It,null),Rn.default.createElement(g,{direction:"row",alignItems:"center",width:"100%",sx:{px:1},gap:1},Rn.default.createElement(ni,{TooltipProps:{disableInteractive:!0},lineClamp:1,fontSize:"16px",whiteSpace:"normal",color:"text.primary",fontWeight:400,sx:{height:"40px",lineHeight:"40px"}},e),Rn.default.createElement(_3.default,{sx:{ml:"auto",mr:0,fontSize:"24px",color:"text.primary"}})))),xA=o=>{let{nextActions:e}=o,{chatHubLoading:t}=rt(),{chatScreenshots:r}=Ip(),n=(0,Rn.useMemo)(()=>r.some(i=>["uploading","pending"].includes(i.status)),[r]);return Array.isArray(e)?Rn.default.createElement(wa,{in:!0,timeout:150},Rn.default.createElement(g,{className:"chat-ai-message--related-questions-container"},e.map((i,a)=>i.input?.content?Rn.default.createElement(gA,{order:a+1,title:i.input.content,key:i.input.content,disabled:t||n,onClick:async()=>{Zi.send("SetVariablesModalClose",null),await g0(),h3("MAXAI_CLIENT__CHAT_INPUT__SEND_MESSAGE",{value:i.input.content})}}):null))):null},C3=xA;var _A=o=>{let{nextActions:e,nextActionsStatus:t}=o,{t:r}=v(),{variant:n}=Ce(),{isLoading:i}=Ze(),{relatedQuestions:a,usePromptActionPrompts:s}=(0,xn.useMemo)(()=>{let l=[],c=[];return e.forEach(u=>{switch(u.type){case"UsePromptAction":{c.push(u);break}case"FollowUpQuery":{l.push(u);break}case"FocusedSearch":}}),{usePromptActionPrompts:c,relatedQuestions:l}},[e]);return!i&&e.length===0||n==="share"?null:xn.default.createElement(xn.default.Fragment,null,xn.default.createElement(It,{sx:{mt:"32px!important"}}),t&&t!=="complete"&&xn.default.createElement(g,{direction:"row",alignItems:"center",spacing:1},xn.default.createElement(L,{sx:{display:"inline-block",width:"12px",height:"12px",margin:"0 0 0 4px !important",borderRadius:"50%",backgroundColor:l=>l.palette.mode==="dark"?"#fff":"#000"}})),t==="complete"&&a.length>0&&xn.default.createElement(xn.default.Fragment,null,xn.default.createElement(Ri,{title:{title:r("package__features:chat__chat_with_any_content__next_actions__related__title"),titleIcon:"Stacks"}})),a.length>0&&xn.default.createElement(C3,{nextActions:a}),xn.default.createElement(f3,{nextActions:s}))},y3=_A;var b3=S(Cr());var fa=S(M()),CA=o=>{let{message:e}=o,{metadata:t}=Ze(),{variant:r}=Ce(),{isPayingUser:n}=Mt(),{showPricingHooksPopup:i}=Ml(),{updateMessage:a}=Li(),{paywallClickDebounce:s}=za(),l=t.embeddedPaywall,c=async p=>{if(!l)return;s({conversationId:e.conversationId,paywallType:"response",paywallReason:"ProChat",buttonType:"upgrade",targetElement:p?.currentTarget});let m=await Us.sendUserAction(l.cta_action_name);m?.paywall&&i(e.conversationId,m.paywall)},u=()=>{if(!l)return;let p=Qo([{},e,{originalMessage:{metadata:{embeddedPaywall:{status:"hidden"}}}}]);a(e.conversationId,p),Us.sendUserAction(l.close_action_name)};return r==="share"||n||!l||l.status==="hidden"?null:fa.default.createElement(g,{spacing:1,direction:"row",alignItems:"center",sx:{border:"1px solid",borderColor:"border.main",borderRadius:1,px:1.5,py:"10px"}},fa.default.createElement(Da,{sx:{color:"text.primary",fontSize:"20px"}}),fa.default.createElement(g,{flex:1,spacing:.5},fa.default.createElement(T,{fontSize:"14px",fontWeight:500,color:"text.primary"},l.title),fa.default.createElement(T,{fontSize:"14px",color:"text.secondary"},l.message)),fa.default.createElement(le,{variant:"contained",onClick:c,sx:{borderRadius:"9999px",px:"12px"}},l.cta_button_title),fa.default.createElement(ee,{onClick:u,sx:{width:36,height:36}},fa.default.createElement(b3.default,{sx:{fontSize:20}})))},df=CA;var hf=S(M());var zn=S(M()),yA=o=>{let{contentType:e="text"}=o;return e==="image"?zn.default.createElement(g,{mt:1,width:"60%",minWidth:Kp-16-16},zn.default.createElement(g,{width:"100%",sx:{position:"relative",paddingBottom:"100%",bgcolor:"rgba(249, 249, 249)",borderRadius:"8px",alignItems:"center",justifyContent:"center"}},zn.default.createElement(L,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}}),zn.default.createElement(Cx,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"54px",height:"54px",color:"#5f5f5f"}}))):zn.default.createElement(g,{mt:1},zn.default.createElement(vt,{animation:"wave",height:10}),zn.default.createElement(vt,{animation:"wave",height:10}),zn.default.createElement(vt,{animation:"wave",height:10}),zn.default.createElement(vt,{animation:"wave",height:10}),zn.default.createElement(vt,{animation:"wave",height:10}),zn.default.createElement(vt,{animation:"wave",height:10}))},I3=yA;var no=S(M());var v3=S(nm()),M3=S(S3());var zc=S(M()),vA=o=>{let{collapsed:e,disabled:t,onClick:r,children:n}=o,i=typeof e=="boolean"&&!t;return zc.default.createElement(g,{direction:"row",onClick:i?r:void 0,sx:{width:"max-content",alignItems:"center",color:a=>a.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)","&:hover":i?{cursor:"pointer",color:a=>a.palette.mode==="dark"?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.6)"}:void 0}},zc.default.createElement(T,{fontSize:16,fontWeight:400},n||""),i?e?zc.default.createElement(v3.default,{sx:{fontSize:20,color:"inhert"}}):zc.default.createElement(M3.default,{sx:{fontSize:20,color:"inhert"}}):null)},Sp=vA;var MA=o=>{let{message:e}=o,{t}=v(),{isDarkMode:r}=tn(),{metadata:n,content:i}=Ze(),[a,s]=(0,no.useState)(!0),[l,c]=(0,no.useState)(1),u=(0,no.useMemo)(()=>Ir(void 0,n.AIModel),[n.AIModel]),p=(0,no.useMemo)(()=>{let m=n?.AIModel,d=n?.processingText,h=n?.thinkingText,f=n?.copilot,_=n_(e);return h?_?"reasoningText":"reasonedText":_?f?"skeleton":d?"processingText":m?o_(m)&&u?.disableStreaming?"countdown":"understandingText":"point":"empty"},[n,i.contentType,u]);return(0,no.useEffect)(()=>{if(p==="reasoningText"&&s(!1),p==="reasonedText"&&s(!0),p==="countdown"){c(1);let m=setInterval(()=>{c(d=>d+1)},1e3);return()=>clearInterval(m)}},[p]),p==="empty"?null:no.default.createElement(g,{spacing:1},p==="skeleton"&&no.default.createElement(I3,{contentType:i.contentType}),p==="processingText"&&no.default.createElement(Sp,null,e.originalMessage?.metadata?.processingText||""),p==="countdown"&&no.default.createElement(Sp,{collapsed:a,onClick:()=>s(!a),disabled:!n.thinkingText},t("package__features:chat__ai_message__think_for_x_seconds",{COUNTDOWN:l})),p==="understandingText"&&no.default.createElement(Sp,{collapsed:a,onClick:()=>s(!a),disabled:!n.thinkingText},t("package__features:chat__ai_message__understanding_text")),p==="reasoningText"&&no.default.createElement(Sp,{collapsed:a,onClick:()=>s(!a),disabled:!n.thinkingText},t("package__features:chat__ai_message__reasoning_text")),p==="reasonedText"&&no.default.createElement(Sp,{collapsed:a,onClick:()=>s(!a),disabled:!n.thinkingText},t("package__features:chat__ai_message__reasoned_text",{AI_MODEL:u?.title||n.AIModel||""})),n?.thinkingText&&!a&&no.default.createElement(L,{className:`markdown-body ${r?"markdown-body-dark":""}`,sx:{borderLeft:"2px solid",borderColor:"border.main",pl:1}},no.default.createElement(L,{sx:{fontSize:14,color:m=>m.palette.mode==="dark"?"rgba(255,255,255,0.6)":"rgba(0,0,0,0.6)","& a":{color:"inherit!important",fontSize:14,textDecoration:"none!important",pointerEvents:"none"}}},no.default.createElement(no.Suspense,{fallback:no.default.createElement(un,{loading:!0})},no.default.createElement(Ya,{message:e,enableTextToStreaming:n.AIModel==="deepseek-r1"},n.thinkingText)))))},T3=MA;var E3=S(M());var w3=S(M()),TA=o=>{let{loading:e,loadingVariant:t="dots",children:r,sx:n,...i}=o;return w3.default.createElement(T,{sx:e?t==="dots"?{position:"relative","&::after":{content:'""',animation:"dots 1.5s infinite"},"@keyframes dots":{"0%":{content:'"."'},"25%":{content:'".."'},"50%":{content:'"..."'},"75%":{content:'".."'},"100%":{content:'"."'}},...n}:{position:"relative",background:a=>a.palette.mode==="dark"?`linear-gradient(
                  to left,
                  rgba(255, 255, 255, 0.38),
                  rgba(255, 255, 255, 0.87) 80%,
                  rgba(255, 255, 255, 0.38)
                )`:`linear-gradient(
                  to left,
                  rgba(0, 0, 0, 0.38),
                  rgba(0, 0, 0, 0.87) 80%,
                  rgba(0, 0, 0, 0.38)
                )`,backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",backgroundSize:"200% 100%",animation:"gradientMove 1.8s linear infinite",...n,"@keyframes gradientMove":{"100%":{backgroundPosition:"-400%"}}}:n,...i},r?.replace("...",""))},_n=TA;var wA=o=>{let{t:e}=v(),{metadata:t,processingStep:r}=Ze();return r==="RESPONDING"||r==="RESPONDED"?null:E3.default.createElement(_n,{fontSize:16,color:"text.tertiary",loading:!0,loadingVariant:"gradient"},t.processingText||e("package__features:chat__ai_message__understanding_text"))},P3=wA;var ze=S(M());var A3=S(rm()),k3=S(nm());var rr=S(M()),EA=Jr(q0)(({theme:o})=>({position:"relative",borderRadius:o.shape.borderRadius,"&::before":{display:"none"},[`&.${As.expanded}`]:{margin:0}})),PA=Jr(Z0)(()=>({color:"text.secondary",minHeight:"auto",padding:0,[`&.${As.expanded}`]:{minHeight:"auto",padding:0},[`& .${As.content}`]:{margin:0,padding:"4px 0"},[`& .${As.expandIconWrapper}`]:{alignSelf:"flex-start",height:"32px",alignItems:"center"},[`& .${As.content}.${As.expanded}`]:{margin:0},"&:hover":{cursor:"pointer",opacity:.8}})),AA=Jr(X0)({padding:0}),kA=o=>{let{size:e}=o;return rr.default.createElement(L,{position:"relative",width:e,height:e,zIndex:1},rr.default.createElement(L,{position:"absolute",width:e,height:e,sx:{bgcolor:t=>t.palette.mode==="light"?"rgb(235,235,235)":"rgb(185,185,185)",borderRadius:"50%",animation:"anim 1.0s infinite ease-in-out","@keyframes anim":{"0%,100%":{transform:"scale(1.1)"},"50%":{transform:"scale(0.9)"}}}}),rr.default.createElement(L,{position:"absolute",width:e/2,height:e/2,sx:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",bgcolor:"text.primary",borderRadius:"50%"}}))},LA=o=>{let{title:e,icon:t,loading:r,customize:n,extraNode:i,titleSx:a,iconSx:s,headerSx:l,contentSx:c,children:u,hideExpandIcon:p,...m}=o,d=t;d||(d=rr.default.createElement(L,{display:"flex",justifyContent:"center",alignItems:"center",width:20,height:"1.5em"},r?rr.default.createElement(kA,{size:16}):rr.default.createElement(A3.default,{sx:{fontSize:16,color:"text.tertiary"}})));let h=()=>n?u:u?rr.default.createElement(rr.default.Fragment,null,rr.default.createElement(L,{sx:{position:"absolute",left:"9.5px",top:"22px",bottom:"4px",width:"1px",bgcolor:"text.tertiary"}}),rr.default.createElement(g,{gap:.5,pl:"28px",pb:.5,sx:{alignItems:"flex-start",...c}},u)):null;return rr.default.createElement(EA,{variant:"outlined",...m},rr.default.createElement(PA,{expandIcon:!p&&rr.default.createElement(k3.default,{sx:{fontSize:"24px"}}),sx:{minHeight:"32px!important"}},rr.default.createElement(g,{flex:1,direction:"row",alignItems:"center",justifyContent:"space-between",sx:l},rr.default.createElement(Ri,{title:{title:e,titleIcon:d},fontSx:{fontSize:16,color:"text.secondary",flex:1,...a},iconSx:{...s},sx:{alignItems:"flex-start"}}),rr.default.createElement(g,{direction:"row",alignItems:"center"},i))),rr.default.createElement(AA,null,h()))},zi=LA;var Xe=S(M());var L3={padding:"6px 8px",borderRadius:"8px",height:"32px",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",cursor:"pointer",borderColor:o=>o.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.08)","&:hover":{background:o=>o.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}},O3=o=>{let{i18nKey:e,options:t}=o,{t:r}=v();return r(e,t)},OA=(0,Xe.memo)(o=>{let{results:e,expanded:t,animation:r,defaultShowCount:n=3}=o,[i,a]=(0,Xe.useState)(!1),s=i?e:e.slice(0,n),l=P1(r);(0,Xe.useEffect)(()=>{if(t===!1){if(!l.current){a(!1);return}let p=setTimeout(()=>{a(!1)},500);return()=>{clearTimeout(p)}}},[t]);let c=async p=>{y_()?await Pl.previewWebpage(p.url,{title:p.title}):window.open(p.url)},u=p=>{let{children:m,...d}=p;return Xe.default.createElement(yr,{variant:"outlined",sx:L3,...d},m)};return Xe.default.createElement(g,{gap:1,direction:"row",alignItems:"center",flexWrap:"wrap"},s.map((p,m)=>Xe.default.createElement(u,{key:`${p.from||""}-${m}`},Xe.default.createElement(Al,{citation:{content:"",search_result_index:1,source:{doc_id:"",type:"search_results",engine:"",title:p.title,from:p.from||"",body:p.body,url:p.url,searchQuery:""}}},Xe.default.createElement(g,{sx:{cursor:"pointer",flexDirection:"row",alignItems:"center",gap:.5,maxWidth:200},onClick:()=>c(p)},Xe.default.createElement(L,{width:20,height:20,borderRadius:"50%",overflow:"hidden",flexShrink:0},Xe.default.createElement("img",{src:Yi(p.url),style:{width:"100%",height:"100%",objectFit:"contain"},alt:p.from||""})),Xe.default.createElement(T,{fontSize:14,color:"text.secondary",noWrap:!0},p.from||""))))),e.length>n&&!i&&Xe.default.createElement(u,{onClick:()=>a(!0)},Xe.default.createElement(g,{height:"100%",direction:"row",alignItems:"center",spacing:.5},Xe.default.createElement(T,{fontSize:14,color:"text.secondary",noWrap:!0},`+ ${e.length-n} `,Xe.default.createElement(O3,{i18nKey:"package__common:more"})))))}),BA=(0,Xe.memo)(o=>{let{keywords:e,expanded:t,animation:r,defaultShowCount:n=1}=o,[i,a]=(0,Xe.useState)(!1),s=i?e:e.slice(0,n),l=P1(r);(0,Xe.useEffect)(()=>{if(t===!1){if(!l.current){a(!1);return}let p=setTimeout(()=>{a(!1)},500);return()=>{clearTimeout(p)}}},[t]);let c=p=>{let{children:m,...d}=p;return Xe.default.createElement(yr,{variant:"outlined",sx:{...L3,maxWidth:"calc(50% - 8px)",cursor:"auto","&:hover":{}},...d},m)},u={whiteSpace:"normal",fontSize:14,wordBreak:"break-all",color:p=>p.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"};return Xe.default.createElement(g,{gap:1,direction:"row",alignItems:"center",flexWrap:"wrap",sx:{flex:"1!important",width:"100%"}},s?.map(p=>Xe.default.createElement(c,{key:p},Xe.default.createElement(ni,{TooltipProps:{disableInteractive:!0},lineClamp:1,sx:u},p))),e.length>n&&!i&&Xe.default.createElement(c,{onClick:()=>a(!0)},Xe.default.createElement(T,{sx:{...u,cursor:"pointer"}},`+ ${e.length-1} `,Xe.default.createElement(O3,{i18nKey:"package__common:more"}))))}),DA=o=>{let{searchPlan:e,loading:t,expanded:r,animation:n,...i}=o,{t:a}=v();return Xe.default.createElement(zi,{title:Xe.default.createElement(_n,{loading:!1},e.topic),sx:{border:"none"},loading:t,expanded:r,...i},Xe.default.createElement(_n,{fontSize:14,color:"text.tertiary",loading:t&&e.status==="searching",loadingVariant:"gradient"},a("package__features:chat__ai_message__searching_text")),e.keywords&&e.keywords.length&&Xe.default.createElement(BA,{expanded:r,animation:n,keywords:e.keywords}),e.status==="reading"||e.results?Xe.default.createElement(Xe.default.Fragment,null,Xe.default.createElement(_n,{fontSize:14,color:"text.tertiary",loading:t&&e.status==="reading",loadingVariant:"gradient"},a("package__features:chat__ai_message__reading_text")),e.results&&e.results.length>0&&Xe.default.createElement(OA,{expanded:r,animation:n,results:e.results})):null)},B3=DA;var HA=o=>{let{message:e}=o,{t}=v(),{isDarkMode:r}=tn(),{metadata:n,processingStep:i}=Ze(),[a,s]=(0,ze.useState)(!0),[l,c]=(0,ze.useState)(!1),[u,p]=(0,ze.useState)({}),[m,d]=(0,ze.useState)(!1),[h,f]=(0,ze.useState)(!1),{chatHubLoading:_}=rt(),x=$e({expanded:l}),C=(0,ze.useMemo)(()=>Ir(void 0,n.AIModel),[n.AIModel]),y=n.searchPlans||[],b=n.preprocessingTrackers||[],w=(0,ze.useMemo)(()=>n.thinkingText?t_(n.thinkingText?.replace(/\s*```\w*/g,"")||""):n.thinkingText,[n.thinkingText]),I=Math.max(y.length-1,0),E=i==="UNDERSTANDING",P=y.length||i==="SEARCHING",O=b.length>0||i==="ANALYZING",N=typeof w=="string"||i==="REASONING",V=(0,ze.useCallback)(()=>{x.current.expanded||(s(!1),clearTimeout(x.current.timeout),x.current.timeout=setTimeout(()=>{s(!0)},100))},[]),A=(0,ze.useRef)(!1),D=(0,ze.useCallback)(()=>{A.current||c(!0)},[c]);(0,ze.useEffect)(()=>(i==="UNDERSTANDING"&&(V(),D()),i==="SEARCHING"&&(V(),D(),p({[I]:!0})),i==="ANALYZING"&&(V(),D(),p({}),d(!0)),i==="REASONING"&&(V(),D(),p({}),d(!1),f(!0)),i==="RESPONDING"&&(c(!1),A.current=!0),()=>{clearTimeout(x.current.timeout)}),[i]),(0,ze.useEffect)(()=>{P&&p({[I]:!0})},[P,I]);let W=()=>y.length?y.map((K,H)=>{let R=i==="SEARCHING"&&H===y.length-1,F=!!u[H];return ze.default.createElement(B3,{key:H,searchPlan:K,expanded:F,animation:a,loading:R,slotProps:{transition:a&&!_?{}:{timeout:0}},onChange:(Y,$)=>p(ie=>({...ie,[H]:$}))})}):null,k=()=>b.length?b.map((K,H)=>{let R=i=="ANALYZING"&&H===b.length-1,F=K.status.replace("...","");return ze.default.createElement(_n,{key:H,fontSize:14,color:R?"text.primary":"text.tertiary",loading:R,loadingVariant:"gradient",noWrap:!0},F)}):null,U=()=>w?ze.default.createElement(L,{className:`markdown-body ${r?"markdown-body-dark":""}`},ze.default.createElement(L,{sx:{fontSize:14,color:i==="REASONING"?"text.primary":"text.tertiary","& li::marker, *":{color:"inherit!important"},"& a":{color:"inherit!important",fontSize:14,textDecoration:"none!important",pointerEvents:"none"}}},ze.default.createElement(ze.Suspense,{fallback:ze.default.createElement(un,{loading:!0})},ze.default.createElement(Ya,{message:e,enableTextToStreaming:n.AIModel==="deepseek-r1"},w)))):null;return ze.default.createElement(zi,{title:"Pro chat",icon:ze.default.createElement(Da,{sx:{color:"text.primary"}}),sx:{px:1,py:.5},titleSx:{color:"text.primary",fontWeight:500},slotProps:{transition:_?{timeout:0}:{}},expanded:l,customize:!0,onChange:()=>{let K=!l;c(K),V(),K&&(p({}),d(!1),f(!1),N?f(!0):O?d(!0):P&&p({[I]:!0}))},extraNode:ze.default.createElement(ze.default.Fragment,null,ze.default.createElement(Jo,{size:16,model:n.AIModel||""}),ze.default.createElement(T,{sx:{mx:.5,fontSize:12,color:K=>K.palette.mode==="dark"?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)"}},Ir(void 0,n.AIModel)?.title))},ze.default.createElement(g,null,E&&ze.default.createElement(zi,{title:ze.default.createElement(_n,{loading:!0,loadingVariant:"gradient"},t("package__features:chat__ai_message__understanding_text")),expanded:!0,loading:!0,slotProps:{transition:a&&!_?{}:{timeout:0}},sx:{border:"none"},headerSx:{py:0}}),P&&W(),O&&ze.default.createElement(zi,{title:ze.default.createElement(_n,{loading:!1},i==="ANALYZING"?t("package__features:chat__ai_message__analyzing_text"):t("package__features:chat__ai_message__analyzed_text")),expanded:m,loading:i==="ANALYZING",onChange:()=>d(!m),slotProps:{transition:a&&!_?{}:{timeout:0}},sx:{border:"none"},headerSx:{py:0}},k()),N?ze.default.createElement(zi,{title:ze.default.createElement(_n,{loading:!1},i==="REASONING"?t("package__features:chat__ai_message__reasoning_text"):t("package__features:chat__ai_message__reasoned_text",{AI_MODEL:C?.title||n.AIModel||""})),expanded:h,loading:i==="REASONING",onChange:()=>f(!h),slotProps:{transition:a&&!_?{}:{timeout:0}},sx:{border:"none"},headerSx:{py:0}},U()):null))},D3=HA;var FA=o=>{let{metadata:e}=Ze();return e.chatMode==="pro_chat"?hf.default.createElement(D3,{...o}):e.chatMode==="free_chat"?hf.default.createElement(P3,{...o}):e.thinkingText||!e.isComplete?hf.default.createElement(T3,{...o}):null},xg=FA;var Wr=S(M());var NA=()=>{let[o,e]=(0,Wr.useState)(!0),{metadata:t}=Ze(),{chatHubLoading:r}=rt(),n=(0,Wr.useMemo)(()=>t.copilot?.steps.some(i=>i.status==="loading"),[t.copilot]);return(0,Wr.useEffect)(()=>{n||e(!1)},[n]),Wr.default.createElement(zi,{title:"AI art",icon:Wr.default.createElement(Da,{sx:{color:"text.primary"}}),sx:{px:1,py:.5},titleSx:{color:"text.primary",fontWeight:500},expanded:o,customize:!0,onChange:()=>{e(!o)},slotProps:{transition:r?{timeout:0}:{}},extraNode:t.AIModel&&Wr.default.createElement(Wr.default.Fragment,null,Wr.default.createElement(Jo,{size:16,model:t.AIModel||""}),Wr.default.createElement(T,{sx:{mx:.5,fontSize:12,color:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)"}},Ir(void 0,t.AIModel)?.title))},t.copilot?.steps.map(i=>Wr.default.createElement(zi,{title:Wr.default.createElement(_n,{loading:i.status!=="complete"},i.title),loading:n,sx:{border:"none"},hideExpandIcon:!0})))},H3=NA;var N3=S(F3());var uo=S(M()),UA=uo.default.memo(({knowledgeSources:o})=>{let[e,t]=(0,uo.useState)(!1),r=()=>{t(!e)},{t:n}=v();return uo.default.createElement(yr,{variant:"outlined",sx:{borderRadius:"8px",padding:"12px",width:"100%",overflow:"hidden",position:"relative",border:"0px",bgcolor:i=>i.palette.mode==="dark"?"rgba(59, 61, 62, 1)":"rgba(244, 244, 244, 1)"}},uo.default.createElement(L,{display:"flex",alignItems:"center",mb:2},uo.default.createElement("img",{src:`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://${o.title}.com&size=64`,alt:"Logo",style:{width:40,height:40,borderRadius:"8px",marginRight:"8px"}}),uo.default.createElement(L,{flex:1},uo.default.createElement(g,{direction:"row",justifyContent:"space-between",sx:{}},uo.default.createElement(T,{sx:{fontSize:16,fontWeight:600,lineHeight:"150%"},component:"div"},o.title),uo.default.createElement(le,{onClick:r,sx:{color:"text.primary",height:"25px",borderRadius:"13px",bgcolor:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}},uo.default.createElement(N3.default,{sx:{fontSize:"16px",transition:"all 0.2s",transform:e?"rotate(0deg)":"rotate(180deg)",marginRight:"3px",marginLeft:"-3px"}}),n(e?"package__features:chat__ai_message__knowledge__hide":"package__features:chat__ai_message__knowledge__show_all"))),uo.default.createElement(T,{variant:"body2",color:"textSecondary"},o.titleDescription))),uo.default.createElement(It,null),uo.default.createElement(L,{sx:{marginTop:"8px",maxHeight:e?"1000px":"140px",overflow:"hidden"}},o?.knowledgePanelList&&o?.knowledgePanelList.map(i=>uo.default.createElement(L,{className:"knowledge-source-item",key:i.title,mx:1,my:1,sx:{display:"flex",alignItems:"flex-start"}},uo.default.createElement(T,{variant:"body2",sx:{fontWeight:"600",fontSize:"14px",width:"130px",minWidth:"130px",maxWidth:"130px",lineHeight:1.6}},i.title),uo.default.createElement(L,{flex:1},i.content&&i.content.map((a,s)=>uo.default.createElement(uo.default.Fragment,{key:s},a.type==="a"?uo.default.createElement(Si,{target:"_blank",href:a.href,sx:{display:"inline",fontSize:"14px",color:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)",textDecorationColor:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}},a.text):uo.default.createElement(T,{sx:{display:"inline",fontSize:"14px",color:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}},a.text))))))))}),V3=UA;var z3=S(O7());var Un=S(M());var Cn=S(M()),WA=o=>{let{message:e,images:t,loading:r,handleUpdateMessageOnImageError:n}=o,[i,a]=(0,Cn.useState)([]),[s,l]=(0,Cn.useState)(),c=zx(i,300,[]);(0,Cn.useEffect)(()=>{if(r||c.length===0)return;let p=setTimeout(()=>{let m=He(e),d=m.originalMessage?.metadata?.searchResults;if(!d)return;let h=!1;d.forEach(f=>{f.images=f.images?.filter(_=>c.includes(_.src)?(h=!0,!1):!0)}),h&&n(m)},400);return()=>{clearTimeout(p)}},[r,c]);let u=(0,Cn.useMemo)(()=>Rx(t.filter(p=>!i.includes(p.src)),"src"),[i,t]);return Cn.default.createElement(Cn.default.Fragment,null,u.map(p=>Cn.default.createElement(L,{component:"div",key:p.src,sx:{img:{border:m=>m.palette.mode==="dark"?"1px solid  rgba(255, 255, 255, 0.16)":"1px solid rgba(0, 0, 0, 0.08)"}}},Cn.default.createElement(On,{width:64,height:64,imgStyle:{borderRadius:"8px",cursor:"pointer",objectFit:"cover",display:"block",overflow:"hidden"},onImageClick:()=>{l(p.src)},src:p.src,alt:p.alt||"",onError:()=>{a(m=>[...new Set([...m,p.src])])}}))),Cn.default.createElement(Pi,{images:u.map(p=>({src:p.src,alt:p.alt})),selectedImage:s,setSelectedImage:l}))},R3=WA;var GA=o=>{let{loading:e,message:t,images:r,videos:n,knowledgePanels:i}=o,{openVideoPopup:a}=$2(),{updateMessage:s}=Li();return Un.default.createElement(Un.default.Fragment,null,(r.length>0||n.length>0)&&Un.default.createElement(g,{className:"media_sources",spacing:1},r.length>0&&Un.default.createElement(g,{spacing:1,direction:"row",className:"image_sources",sx:{overflowX:"scroll","&::-webkit-scrollbar":{display:"none",width:0,background:"transparent"}}},Un.default.createElement(R3,{key:t?.conversationId,message:t,loading:e,images:r,handleUpdateMessageOnImageError:l=>{l.conversationId&&s(l.conversationId,l)}})),n.length>0&&Un.default.createElement(g,{spacing:1,direction:"row",className:"image_sources",sx:{overflowX:"scroll","&::-webkit-scrollbar":{display:"none",width:0,background:"transparent"}}},n.map(l=>Un.default.createElement(g,{sx:{position:"relative",cursor:"pointer",img:{border:c=>c.palette.mode==="dark"?"1px solid rgba(255, 255, 255, 0.16)":"1px solid rgba(0, 0, 0, 0.08)"}},className:"videoItem",key:l.src,onClick:()=>{a(l.src,"",!0)}},Un.default.createElement(On,{width:114,height:64,imgStyle:{borderRadius:"8px",cursor:"pointer",objectFit:"cover",display:"block",overflow:"hidden"},src:l.imgSrc||l.poster||"",alt:""}),Un.default.createElement(L,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",height:16,width:16,color:"white",p:2,borderRadius:"50%",lineHeight:0,bgcolor:"#00000080",backdropFilter:"blur(4px)"}},Un.default.createElement(z3.default,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:16}})))))),i.length>0&&Un.default.createElement(V3,{knowledgeSources:i[0]}))},U3=GA;var rn=S(M());var W3=S(X1()),G3=S(im());var ur=S(M()),KA=o=>{let{contextMenuList:e=[],onSelectActions:t,onClose:r,placement:n,query:i,onChange:a,platformFeatureCover:s}=o,{t:l}=v(),c=(0,ur.useRef)(null),{contextMenuPath:u}=lo(),p=(0,ur.useRef)(null),m=()=>{p.current?.querySelector("input")?.focus()},d=()=>{m()},h=x=>{m(),x&&x.actions&&u&&(t?.(x),r?.())},[f,_]=(0,ur.useState)(null);return ur.default.createElement(g,{ref:_,direction:n?.startsWith("top")?"column-reverse":"column",height:"100%",sx:{bgcolor:"background.default",border:"1px solid",borderColor:"border.main",borderRadius:1,boxShadow:"rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px"}},ur.default.createElement(xl,{mouseEvent:"onClick",onClickAway:()=>{r?.()}},ur.default.createElement(Lt,{placeholder:l("package__features:context_menu__use_prompt_button__input__placeholder"),value:i,onChange:x=>a(x.target.value),"aria-autocomplete":"none",ref:p,"data-testid":"context-menu-use-prompt--textfield",autoFocus:!0,sx:{bgcolor:"background.paper",borderRadius:1,padding:.5,"& input":{p:0,height:"39px",borderRadius:1,fontSize:"16px"}},onKeyDownCapture:x=>{c.current?.proxyKeyboardEvent(x.nativeEvent)&&(x.preventDefault(),x.stopPropagation()),x.key==="Escape"&&(r?.(),x.preventDefault(),x.stopPropagation());let C=c.current?.getSelectedItem();x.key==="Enter"&&C&&(h(C),r?.(),x.preventDefault(),x.stopPropagation())},onKeyDown:x=>{x.stopPropagation()},onKeyUp:x=>{x.stopPropagation()},InputProps:{startAdornment:ur.default.createElement(Ii,{position:"start"},ur.default.createElement(G3.default,{sx:{fontSize:"24px"}})),endAdornment:i?ur.default.createElement(Ii,{position:"end"},ur.default.createElement(je,{onClick:()=>a(""),sx:{p:.5,mr:-.5},edge:"end"},ur.default.createElement(W3.default,{sx:{fontSize:"18px"}}))):null},inputProps:{autoComplete:"off"}})),f&&ur.default.createElement(Dd,{platformFeatureCover:s,ref:c,menuList:e,menuWidth:300,menuMaxHeight:`${f.clientHeight-50}px`,defaultPlacement:n,defaultFallbackPlacements:[],onClickGroup:d,referenceElement:ur.default.createElement(L,{position:"relative",left:0,top:n?.startsWith("top")?"3px":"-3px"}),root:f,open:!0,onClickItem:h,zIndex:1e4,noOptionFallback:ur.default.createElement(T,{width:"100%",p:1,textAlign:"left",color:x=>x.palette.text.secondary,fontSize:"14px"},l("package__features:context_menu__button__use__prompt_no_options")),sx:{boxShadow:"none",border:"none",width:298}}))},K3=KA;var jA=o=>{let{className:e,sx:t,disabled:r,message:n,open:i,onOpenChange:a,platformFeatureCover:s,menuPlacement:l,menuFallbackPlacements:c,tooltipPlacement:u,label:p}=o,m="max-ai__actions__button--use-prompt",[d,h]=(0,rn.useState)(null),{t:f}=v(),{contextMenuPath:_}=lo(),{askAIWithShortcutsV2:x}=Re(),{context:C,placement:y,floatingStyles:b,refs:w}=Ua({open:i,strategy:"fixed",onOpenChange(k){a(k)},placement:l||"bottom-start",middleware:[Iu(8),vu({fallbackPlacements:c||["top-start","top-end","bottom-end"]}),Su(),Q0({apply({availableHeight:k,elements:U}){U.floating.style.maxHeight=`${k}px`}})],whileElementsMounted:_l}),I=em(C),E=om(C),{getReferenceProps:P,getFloatingProps:O}=wl([I,E]),[N,V]=(0,rn.useState)(""),{liteContextMenuActionsItems:A}=Bi(N,{enabledVisibilitySettings:!0,enabledFavorite:!0,selectionInputAble:!0}),D=async k=>{let U=k.actions,K="";n&&(typeof n=="string"?K=n:typeof n=="function"?K=n():(K=Bn(n,!1),K=K.replace(ml,"")));let H=[{type:"SET_VARIABLE",parameters:{Variable:{key:"SELECTED_TEXT",value:K,label:"Selected text",isBuiltIn:!0,overwrite:!0}}},{type:"SET_VARIABLE",parameters:{Variable:{key:"VARIABLE_MODAL_KEY",value:"Sidebar",overwrite:!0,isBuiltIn:!0}}}];s&&H.push({type:"SET_VARIABLE",parameters:{Variable:{key:Uu,value:s}}}),await x(He(U),{beforeActions:H,disabledMaxAIDocumentIds:!0,keepLoadingAfterExecution:!0,isClearInput:!0})},W=(0,rn.useMemo)(()=>A.flatMap(k=>{if(k.type==="group"){let U=`context_menu__prompt__${k.prompt_id}`,K=`package__features:${U}`,H=f(K),R=wn?H==="package__features:"+U:H===U;return(!H||H===k.prompt_id||R||U===K)&&(H=k.prompt_title),[H+"__CONTEXT_MENU_LABEL_SLOT_PLACEHOLDER__"+k.prompt_id,...k.children??[]]}return[k]}),[A,f]);return rn.default.createElement(rn.default.Fragment,null,rn.default.createElement(ee,{tooltipProps:{placement:u||"top"},title:f("package__features:context_menu__button__use__prompt"),sx:{p:"6px",...t},"data-testid":m,className:e,onClick:k=>{h(d?null:k.currentTarget)},disabled:r,buttonRefBind:w.setReference,...P()},rn.default.createElement(z,{sx:{fontSize:"20px"},icon:"Rewrite"}),p),i&&rn.default.createElement(L,{ref:w.setFloating,style:b,...O(),sx:{width:300,height:400,zIndex:9999}},rn.default.createElement(K3,{platformFeatureCover:s,placement:y,onSelectActions:D,onClose:()=>{V(""),a(!1)},query:N,onChange:k=>V(k),contextMenuList:W})))},$A=function(o){return rn.default.createElement(is,{defaultContextMenuPath:"/rewrite"},rn.default.createElement(jA,{...o}))},xf=$A;var Gr=S(M());var $3=S(j3()),Uc=S(M()),qA=o=>{let{message:e,...t}=o,{t:r}=v(),[n,i]=(0,Uc.useState)(!1),a=f_(e),s=async()=>{i(!0),await Promise.all(a.map(async l=>{let c=l.uploadedUrl;if(!c)return;let u=d_(c);if(u){let p=u.endsWith(".webp")?u.replace(".webp",".png"):u;c=(await S0.fetchDocument(p)).data?.s3?.doc_url||c}try{let p=await M0(Qr.fetch(c,{method:"GET",parse:"blob",headers:{"Content-Type":"image/png"}}),2e4,{success:!1}),m=!1;if(p.success&&p?.data?.contentType)try{let d=e.text;mn(e)&&(d=e.originalMessage?.metadata?.title?.title||""),(0,$3.saveAs)(d0(p.data.base64,"image/png"),`${d}.png`),m=!0}catch{}if(!m){let d=document.createElement("a");d.href=c,d.download="download",d.click(),d.remove()}}catch{}})).then().catch().finally(()=>{i(!1)})};return a.length===0?null:Uc.default.createElement(ee,{title:r("package__features:chat__ai_message__download_image"),onClick:s,disabled:n,...t,sx:{p:"6px",borderRadius:"4px",...t.sx}},Uc.default.createElement(z,{icon:n?"Loading":"FileDownload",sx:{fontSize:"20px"}}))},q3=qA;var Wc=S(M()),XA=o=>{let{message:e,...t}=o,{t:r}=v(),[n,i]=(0,Wc.useState)(!1),a=async s=>{let l=pl(".maxai-ai-message__image__content__box img",s.currentTarget);if(l?.src){i(!0);try{let c=new Image;await new Promise(u=>{let p=async m=>{if(m){let d=new ClipboardItem({"image/png":m});navigator.clipboard.write([d]).then(function(){u(!0)}).catch(function(h){u(!1)})}else u(!1)};try{let m=new URL(l.src);c.src=m.href+"&#",c.crossOrigin="anonymous",c.onload=()=>{let d=document.createElement("canvas");d.width=c.naturalWidth,d.height=c.naturalHeight;let h=d.getContext("2d");h&&(h.drawImage(c,0,0),d.toBlob(p))},c.onerror=async()=>{let d=await dl.proxyFetch(l.src,{method:"GET",parse:"blob",blobContentType:"image/png"});if(d?.data){let h=d.data;await p(h)}else u(!1)}}catch{u(!1)}})}catch{}finally{i(!1)}}};return Wc.default.createElement(ee,{title:r("package__common:copy_image"),disabled:n,onClick:a,...t,sx:{p:"6px",...t.sx}},Wc.default.createElement(z,{icon:n?"Loading":"Copy",sx:{fontSize:"20px"}}))},X3=XA;var Wo=S(M()),Y3=[Ex,Ax,Px,Gp],YA=(o,e)=>e==="free_chat"?Y3:Y3.filter(t=>t.value!==o),ZA=o=>{let{message:e}=o,{isLastMessage:t}=Ze(),r=e.conversationId||"",n=te(p=>p.conversationType),i=Ka(r),[a,s]=(0,Wo.useState)(!1),l=e.originalMessage?.metadata?.AIModel||"",c=e.originalMessage?.metadata?.chatMode,u=(0,Wo.useMemo)(()=>n!=="Chat"||!t||!a?null:{suggestions:YA(l,c)},[e.messageId,n,t,l,c,a]);return(0,Wo.useEffect)(()=>{i&&r?Ds(r).then(p=>{p.lastRunActions.length>0?s(!0):s(!1)}):s(!1)},[i,r]),!u||l===Du.value?null:Wo.default.createElement(QA,{conversationId:r,conversationType:n,suggestionAIModels:u.suggestions})},QA=o=>{let{conversationId:e,conversationType:t,suggestionAIModels:r}=o,{t:n}=v(),{switchConversationModel:i}=Ve(),a=ge(e),s=r[r.length-1],l=ko.use.setChatAIModelAndProvider(),{isPayingUser:c}=Mt(),{chatMode:u,updateChatMode:p}=cs(),[m,d]=(0,Wo.useState)(!1),h=async _=>{try{if(!e||!_)return;if(u!=="pro_chat")if(c)await p("pro_chat");else{d(!0);return}let{lastRunActionsParams:x,lastRunActions:C}=await Ds(e);l({AIProvider:_.AIProvider,AIModel:_.value}),await i(t,_.AIProvider,_.value);let{setShortcuts:y,runShortcuts:b}=vm(e);y(C),await b(x)}catch{}finally{}},f=(0,Wo.useMemo)(()=>r.map(_=>({value:_.value,label:_.title,icon:Wo.default.createElement(Jo,{model:_.value})})),[r]);return f.length===0?null:Wo.default.createElement(Wo.default.Fragment,null,Wo.default.createElement(ee,{disabled:a,placement:"top-start",options:f,testid:"maxai--chat-message--compare-answers",sx:{p:"6px"},OptionsCardProps:{sx:{width:"240px"},title:n("package__features:chat__chat_message_tools__compare_answers__title")},onSelectOption:_=>{let x=r.find(C=>C.value===_);x&&h(x)},defaultOptionValue:s.value,autoClosePopoverOnSelectDefaultOption:!0},Wo.default.createElement(Jo,{model:s.value})),Wo.default.createElement(Bt,{trigger:m,placement:"top-start",anchorElementSelectors:'[data-testid="maxai--chat-pro-chat-switch"]',onClose:()=>{d(!1)},ctaButtonText:n("package__features:onboarding__onboarding_popover__cta_button__try_it"),onCTAButtonClick:async()=>{await p("pro_chat")}},Wo.default.createElement(g,{spacing:.5},Wo.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},"Pro chat"),Wo.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},n("package__features:onboarding__onboarding_popover__pro_chat__compare_models__description",{NAME:"Pro chat"})))))},Z3=ZA;var Ue=S(M()),JA=o=>`${Zr}/share?id=${o}`,ek=()=>{let{t:o}=v(),{conversation:e,updateConversation:t,getConversation:r}=ki(),n=e?.share?.id,[i,a]=(0,Ue.useState)(!1),[s,l]=(0,Ue.useState)(!1),c=e?.share?.enable===!0,u=(0,Ue.useRef)(null),[p,m]=(0,Ue.useState)(!1),d=(0,Ue.useMemo)(()=>[{testid:"maxai--conversation--share-button--download",value:"download",icon:Ue.default.createElement(z,{icon:"FileDownload"}),label:o("package__features:chat__ai_message__tools__download_this_chat")},{testid:"maxai--conversation--share-button--share",value:"share",icon:Ue.default.createElement(z,{icon:c?"IosShare":"Lock"}),label:o("package__features:chat__ai_message__tools__share_this_chat")}],[o,c]),h=(x=o("package__features:chat__navbar__conversation_share__share_panel__error_tip"))=>{dt.error(x,{anchorOrigin:{vertical:"top",horizontal:"center"}})},f=async()=>{if(!e?.id)return;let x="";if(n)m(!0),c||await _(!0),x=n;else try{if(!x){l(!0);let y=await r(e.id);if(!y){h();return}await Co.getService().checkUpdate(e.id),await Dn.getService().checkUpdate(e.id);let b=(await Co.getService().shareConversation(y.id,!0))?.share;b?.id&&b.enable&&(x=b.id,await t(y.id,{share:{enable:!0,id:b.id}}))}}catch{h()}finally{m(!0),l(!1)}let C=JA(x);navigator.clipboard.writeText(C)},_=async x=>{if(e?.id)try{a(!0);let C=(await Co.getService().shareConversation(e.id,x))?.share;C?.id?await t(e.id,{share:{enable:C.enable,id:C.id}}):h()}catch{h()}finally{a(!1)}};return Ue.default.createElement(Ue.default.Fragment,null,Ue.default.createElement(ee,{placement:"top-start",buttonRefBind:x=>{u.current=x},loading:s,defaultOptionValue:"share",options:d,closePopoverOnClick:!0,onSelectOption:async x=>{x==="download"&&await c_(e),x==="share"&&await f()},testid:"maxai--conversation--share-button",sx:{width:"max-content",height:32,p:"6px",gap:"4px"},OptionsCardProps:{sx:{width:"max-content",minWidth:200}}},Ue.default.createElement(z,{icon:c?"IosShare":"Lock"}),Ue.default.createElement(T,{noWrap:!0,fontSize:"14px",lineHeight:"21px",fontWeight:500,component:"div"},o("package__features:chat__navbar__conversation_share__share_button__title"))),Ue.default.createElement(Pu,{open:p,anchorEl:u.current,onClose:()=>{m(!1)},anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},slotProps:{paper:{elevation:0,sx:{overflow:"unset",background:"transparent"}}}},Ue.default.createElement(g,{sx:{borderBottom:"8px solid transparent"}},Ue.default.createElement(_r,{sx:{py:1,px:2,width:"320px",boxSizing:"border-box",display:"flex",flexDirection:"column",gap:1,border:"1px solid",borderColor:"border.main",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.03);0px 12px 16px -4px rgba(16, 24, 40, 0.08);"}},Ue.default.createElement(T,{fontSize:16,fontWeight:500},o("package__features:chat__navbar__conversation_share__share_panel__title")),Ue.default.createElement(g,{sx:{"& > button":{border:"1px solid",width:"100%",p:1,borderColor:"border.main",borderRadius:"0 0 8px 8px",alignItems:"center",justifyContent:"start","&:not(:last-child)":{borderBottom:"none",borderRadius:"8px 8px 0 0"}}}},Ue.default.createElement(le,{"data-testid":"maxai--conversation--share-private-button",disabled:i,onClick:async()=>{await _(!1)}},Ue.default.createElement(g,{width:"100%"},Ue.default.createElement(g,{direction:"row",alignItems:"center",gap:1},i?Ue.default.createElement(Jt,{size:16}):Ue.default.createElement(z,{icon:"Lock",sx:{fontSize:"16px"}}),Ue.default.createElement(T,{textAlign:"left",fontSize:"14px",color:"text.primary"},o("package__features:chat__navbar__conversation_share__share_panel__private_button__title")),!c&&Ue.default.createElement(z,{icon:"GreenCircleCheck",sx:{ml:"auto",mr:0,fontSize:"20px"}})),Ue.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"text.secondary"},o("package__features:chat__navbar__conversation_share__share_panel__private_button__description")))),Ue.default.createElement(le,{disabled:i,onClick:async()=>{await _(!0)}},Ue.default.createElement(g,{width:"100%"},Ue.default.createElement(g,{direction:"row",alignItems:"center",gap:1},i?Ue.default.createElement(Jt,{size:16}):Ue.default.createElement(z,{icon:"Share",sx:{fontSize:"16px"}}),Ue.default.createElement(T,{textAlign:"left",fontSize:"14px",color:"text.primary"},o("package__features:chat__navbar__conversation_share__share_panel__public_button__title")),c&&Ue.default.createElement(z,{icon:"GreenCircleCheck",sx:{ml:"auto",mr:0,fontSize:"20px"}})),Ue.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"text.secondary"},o("package__features:chat__navbar__conversation_share__share_panel__public_button__description"))))),c&&Ue.default.createElement(g,{direction:"row",alignItems:"center",gap:1},Ue.default.createElement(z,{icon:"GreenCircleCheck",sx:{fontSize:"16px"}}),Ue.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"#379837"},o("package__features:chat__navbar__conversation_share__share_panel__copied_tip")))))))},Q3=ek;var nn=S(M()),tk=o=>{let{message:e,onCopy:t}=o,{t:r}=v(),n=te(x=>x.chatDocuments),i=(0,nn.useRef)(null),[a,s]=(0,nn.useState)(""),[l,c]=(0,nn.useState)("top-start"),u=()=>{if(!i.current)return"top-start";let x=i.current.getBoundingClientRect(),C=window.innerHeight,w=_.length*40+12,I=8,E=8,P=x.top,O=C-x.bottom,N=P>=w+I+E,V=O>=w+I+E;return N?"top-start":V?"bottom-start":P>O?"top-start":"bottom-start"},p=async x=>{let C=i.current;if(!C)return;let y=pl('.markdown-body[data-testid="chat-ai-message--markdown"]',C);y&&(pm(e,y,n),f(x))},m=async x=>{let C=ec(e,!0,n),y=await th(C);await uf(y),f(x)},d=async x=>{let C=ec(e,!0,n),y=(await th(C)).trim();navigator.clipboard.writeText(y),f(x)},h=(0,nn.useRef)(),f=x=>{clearTimeout(h.current),t?.(),s(x),h.current=setTimeout(()=>{s("")},1e3)},_=(0,nn.useMemo)(()=>[{value:"copy_with_formatting",testid:"ai-message-tools__copy-with-formatting",icon:nn.default.createElement(z,{icon:a==="copy_with_formatting"?"Check":"CopyWithFormatting",sx:{fontSize:"20px"}}),title:r(a==="copy_with_formatting"?"package__common:copied":"package__common:copy_to_clipboard"),label:r("package__common:copy_with_formatting"),ButtonProps:{tooltipProps:{placement:"left"}}},{value:"copy_without_formatting",testid:"ai-message-tools__copy-without-formatting",icon:nn.default.createElement(z,{icon:a==="copy_without_formatting"?"Check":"CopyWithoutFormatting",sx:{fontSize:"20px"}}),title:r(a==="copy_without_formatting"?"package__common:copied":"package__common:copy_to_clipboard"),label:r("package__common:copy_without_formatting"),ButtonProps:{tooltipProps:{placement:"left"}}},{value:"copy_as_plain_text",testid:"ai-message-tools__copy-as-plain-text",icon:nn.default.createElement(z,{icon:a==="copy_as_plain_text"?"Check":"CopyTextOnly",sx:{fontSize:"20px"}}),title:r(a==="copy_as_plain_text"?"package__common:copied":"package__common:copy_to_clipboard"),label:r("package__common:copy"),ButtonProps:{tooltipProps:{placement:"left"}}}],[r,a]);return nn.default.createElement(ee,{placement:l,defaultOptionValue:"copy_as_plain_text",testid:"ai-message-tools__hover-to-copy",options:_,buttonRefBind:x=>{i.current=x,x&&setTimeout(()=>{c(u())},0)},disabledOnSelectOptionAutoClosePopup:!0,onClick:()=>{d("copy_as_plain_text")},onSelectOption:x=>{x==="copy_with_formatting"&&p("copy_with_formatting"),x==="copy_without_formatting"&&m("copy_without_formatting"),x==="copy_as_plain_text"&&d("copy_as_plain_text")},sx:{p:"6px"},OptionsCardProps:{sx:{width:"max-content",minWidth:"240px"}}},nn.default.createElement(z,{icon:"CopyTextOnly",sx:{fontSize:"20px"}}))},J3=tk;var ok=o=>{let{message:e,...t}=o,{AIMessage:r}=CI(),{renderTools:n}=r||{},{conversationId:i,variant:a}=Ce(),s=ge(i),l=e.originalMessage?.metadata?.AIModel||"",c=e.originalMessage?.content?.contentType||"text",u=Gr.default.useRef(null),p=e.originalMessage?.metadata?.navMetadata?.key==="transcript"||e.originalMessage?.metadata?.videoTranscripts?.length||e.originalMessage?.metadata?.videoTimestamped?.length,m=a==="normal"&&c==="text"&&!p&&l!==Du.value,{setUsePromptOpen:d,usePromptOpen:h,isLastMessage:f}=(0,Gr.useContext)(tf),_={shareConversationButton:f&&Gr.default.createElement(Q3,null),imageCopyButton:c==="image"&&Gr.default.createElement(X3,{message:e}),textCopyButton:c==="text"&&Gr.default.createElement(J3,{message:e}),attachmentsDownloadButton:e&&Gr.default.createElement(q3,{message:e}),usePromptButton:m&&Gr.default.createElement(xf,{disabled:s,message:e,open:h,onOpenChange:d,iconButton:!0,className:"max-ai__actions__button--use-max-ai",platformFeatureCover:"sidebar_response_rewrite",menuPlacement:"bottom-start",menuFallbackPlacements:["top-start"],tooltipPlacement:"top",sx:{color:C=>C.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}}),regenerateButton:a==="normal"&&Gr.default.createElement(Q4,{message:e}),modelSuggestions:a==="normal"&&Gr.default.createElement(Z3,{message:e}),divider:Gr.default.createElement(It,{sx:{minWidth:"1px",maxWidth:"1px",minHeight:"14px",maxHeight:"14px"},orientation:"vertical"})},x=n?n(_,e,{isLastMessage:f}):Gr.default.createElement(Gr.default.Fragment,null,_.shareConversationButton,_.imageCopyButton,_.textCopyButton,_.attachmentsDownloadButton,_.usePromptButton,_.regenerateButton,_.modelSuggestions);return Gr.default.createElement(g,{direction:"row",alignItems:"center",spacing:1,ref:u,...t,sx:{position:"relative",marginTop:"8px!important",...t.sx}},x)},eS=ok;var tS=S(nm());var Me=S(M());function rk(o){return typeof o=="string"?o.split(","):Array.isArray(o)&&typeof o[0]=="string"?o:[]}var Gc={px:1,borderRadius:"8px",height:"25px",display:"flex",alignItems:"center",border:"0px",bgcolor:o=>o.palette.mode==="dark"?"rgba(59, 61, 62, 1)":"rgba(244, 244, 244, 1)"},nk=({copilotType:o,copilot:e,messageIsComplete:t})=>{let r=e.steps.findIndex(p=>p.status==="loading"),[n,i]=(0,Me.useState)(),a=(()=>{let p=r===-1?e.steps:e.steps.slice(0,r+1);return o==="art"&&(p=p.map(m=>m.title==="Optimizing art prompt"||m.title==="Generating art"?{...m,value:void 0}:m)),p})(),s=(0,Me.useMemo)(()=>a.some(p=>p.status==="loading"),[a]),l=typeof n>"u"?s:n,c=p=>p?m=>m.palette.mode==="dark"?"#fff":"#000":m=>m.palette.mode==="dark"?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.38)",u=(p,m)=>!(a.length-1!==m&&p.status==="complete");return Me.default.createElement(g,{direction:"column",spacing:1,sx:{border:p=>p.palette.mode==="dark"?"1px solid rgba(255, 255, 255, 0.16)":"1px solid rgba(0, 0, 0, 0.08)",padding:"8px 10px",borderRadius:"8px"}},e.title&&Me.default.createElement(g,{direction:"row",justifyContent:"space-between",sx:{userSelect:"none","&:hover":{cursor:"pointer"}},onClick:()=>i(!l)},Me.default.createElement(Ri,{title:e.title}),Me.default.createElement(tS.default,{sx:{transform:l?"rotate(180deg)":"rotate(0deg)",fontSize:"24px",transition:"all 0.2s"}})),l&&Me.default.createElement(Me.default.Fragment,null,Me.default.createElement(It,{sx:{borderColor:p=>p.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}}),a.map((p,m)=>Me.default.createElement(g,{spacing:.5,key:p.title},Me.default.createElement(g,{spacing:1,direction:"row",alignItems:"center"},Me.default.createElement(g,{alignItems:"center",justifyContent:"center",width:16,height:16},!t&&p.status==="loading"?Me.default.createElement(Jt,{size:16,sx:{color:c(!0)}}):Me.default.createElement(z,{sx:{color:c(!1),fontSize:20},icon:"CheckCircle"})),Me.default.createElement(T,{fontSize:14,fontWeight:500,color:c(!t&&p.status==="loading"),noWrap:!0,sx:{p:0,pl:"6px"}},p.title)),(p.value||!u(p,m))&&Me.default.createElement(g,{direction:"row"},Me.default.createElement(L,{sx:{minHeight:"14px",marginLeft:"7px",width:"2px",borderRadius:"2px",bgcolor:d=>u(p,m)?"transparent":d.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}}),p.value&&Me.default.createElement(g,{spacing:1,direction:"row",alignItems:"center",sx:{flex:"1!important"}},Me.default.createElement(g,{alignItems:"center",justifyContent:"center",width:16,height:16}),(p.valueType==="text"||p.valueType===void 0)&&Me.default.createElement(yr,{variant:"outlined",sx:Gc},Me.default.createElement(me,{title:String(p.value)},Me.default.createElement(T,{fontSize:14,color:"text.primary",noWrap:!0,maxWidth:256},String(p.value)))),p.valueType==="tags"&&Me.default.createElement(g,{gap:1,direction:"row",alignItems:"center",flexWrap:"wrap",sx:{flex:"1!important"}},rk(p.value).map((d,h)=>Me.default.createElement(yr,{key:d+h,variant:"outlined",sx:Gc},Me.default.createElement(me,{title:d},Me.default.createElement(T,{noWrap:!0,maxWidth:160,fontSize:14,color:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},d))))),p.valueType==="source"&&Me.default.createElement(ik,{sources:p.value})))))))},ik=({sources:o})=>{let{t:e}=v(),[t,r]=(0,Me.useState)(!1),n=(0,Me.useMemo)(()=>t?o:o.slice(0,3),[t]);return Me.default.createElement(g,{gap:1,direction:"row",alignItems:"center",flexWrap:"wrap",width:0,sx:{flex:"1!important"}},n.map((i,a)=>Me.default.createElement(yr,{key:`${i.title}-${a}`,variant:"outlined",sx:{...Gc,"&:hover":{background:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}}},Me.default.createElement(Al,{citation:{content:"",search_result_index:1,source:{doc_id:"",type:"search_results",engine:"",...i}}},Me.default.createElement(Si,{href:i.url,target:"_blank",underline:"none",maxWidth:200},Me.default.createElement(g,{direction:"row",alignItems:"center",spacing:.5},Me.default.createElement(L,{width:16,height:16,borderRadius:"50%",overflow:"hidden",flexShrink:0},Me.default.createElement("img",{src:i.favicon||Yi(i.url),alt:i?.from,width:"100%",height:"100%"})),Me.default.createElement(T,{fontSize:12,color:"text.secondary",noWrap:!0},i?.from)))))),o.length>3&&!t&&Me.default.createElement(yr,{variant:"outlined",sx:{...Gc,"&:hover":{background:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)",cursor:"pointer"}},onClick:()=>r(!0)},Me.default.createElement(g,{height:"100%",direction:"row",alignItems:"center",spacing:.5},Me.default.createElement(T,{fontSize:12,color:"text.secondary",noWrap:!0},`+ ${o.length-3} ${e("package__features:chat__ai_message__sources__more")}`))),o.length>3&&t&&Me.default.createElement(yr,{variant:"outlined",sx:{...Gc,"&:hover":{background:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)",cursor:"pointer"}},onClick:()=>r(!1)},Me.default.createElement(g,{height:"100%",direction:"row",alignItems:"center",spacing:.5,color:"text.secondary"},Me.default.createElement(T,{fontSize:12,color:"text.secondary",noWrap:!0},e("package__features:chat__ai_message__sources__hide")))))},oS=nk;var Qe=S(M());var rS=S(Cr());var eo=S(M()),_f=(o=1)=>({overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":String(o)}),ak=({searchResult:o,searchResultIndex:e,key:t})=>eo.default.createElement(yr,{key:t,sx:{marginBottom:"16px",borderRadius:"8px",border:"1px solid",backgroundColor:"initial",boxShadow:"initial",borderColor:r=>r.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)","&:hover":{cursor:"pointer",bgcolor:r=>r.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)"}}},eo.default.createElement(ox,null,eo.default.createElement(Si,{href:o.url,target:"_blank",underline:"none"},eo.default.createElement(g,{sx:{gap:"6px",p:"16px"}},eo.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{gap:"16px"}},eo.default.createElement(T,{sx:{fontSize:"16px",fontWeight:"500",lineHeight:"24px",height:"24px",color:"text.primary",..._f()}},o.title)),eo.default.createElement(g,{sx:{flexDirection:"row",alignItems:"center",gap:"4px"}},eo.default.createElement(L,{component:"img",src:Yi(o.redirectedUrl||o.url),alt:o.from,sx:{width:"16px",height:"16px",borderRadius:"50%",objectFit:"cover",objectPosition:"center",border:"1px solid",borderColor:r=>r.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}}),eo.default.createElement(T,{sx:{fontSize:"12px",fontWeight:"500",lineHeight:"18px",color:"text.secondary",..._f()}},o.from),eo.default.createElement(T,{sx:{fontSize:"12px",fontWeight:"500",lineHeight:"18px",color:"text.secondary"}},"\xB7 ",e+1)),eo.default.createElement(T,{sx:{fontSize:"14px",fontWeight:"400",lineHeight:"21px",color:"text.secondary",..._f(4)}},o.body))))),sk=({open:o,onClose:e,searchResults:t,metadataTitle:r})=>{let n=(0,eo.useMemo)(()=>!Ma(),[]),{t:i}=v();return eo.default.createElement(Pa,{anchor:n?"right":"bottom",disableScrollLock:!0,disableEnforceFocus:!0,open:o,onClose:e,sx:{zIndex:1502,position:n?"fixed":"absolute",[`& .${Ea.paper}`]:{position:"absolute",borderRadius:n?"16px 0 0 16px":"16px 16px 0 0",minHeight:"80vh",maxHeight:n?"100vh":"80vh",bgcolor:"background.paper",backgroundImage:"unset"}},slotProps:{backdrop:{sx:{position:"absolute"}}}},eo.default.createElement(g,{sx:{maxWidth:n?"520px":"100%",height:"100%",overflow:"hidden",borderRadius:"16px, 16px, 0px, 0px"}},eo.default.createElement(g,{sx:{p:"16px",position:"relative"}},eo.default.createElement(T,{sx:{fontSize:"24px",fontWeight:"700",lineHeight:"34px"}},`${t.length} ${i("package__features:chat__ai_message__sources__modal__title")}`),eo.default.createElement(T,{sx:{fontSize:"16px",fontWeight:"400",lineHeight:"24px",color:"text.secondary",..._f()}},r?.title),eo.default.createElement(je,{onClick:e,sx:{position:"absolute",top:"12px",right:"12px"}},eo.default.createElement(rS.default,{sx:{fontSize:24}}))),eo.default.createElement(It,null),eo.default.createElement(L,{sx:{flex:1,height:"0px",p:"16px",pd:0,overflowY:"auto"}},t.map((a,s)=>eo.default.createElement(ak,{key:s,searchResult:a,searchResultIndex:s})))))},nS=sk;var lk=o=>{let e=Na(),{searchResults:t,loading:r}=o,[n,i]=(0,Qe.useState)(!1),a=(0,Qe.useMemo)(()=>e==="xs"||e==="sm"?6:e==="md"?4:e==="lg"||e==="xl"?3:6,[e]),s=(0,Qe.useMemo)(()=>12/a,[a]),l=(0,Qe.useMemo)(()=>t.length>s?t.slice(0,s-1):t,[n,t]),c=(0,Qe.useMemo)(()=>t.length>s?t.slice(s-1).map(p=>Yi(p.redirectedUrl||p.url)).filter(Boolean):[],[n,t,s]),{t:u}=v();return Qe.default.createElement(Qe.default.Fragment,null,Qe.default.createElement(ti,{container:!0,spacing:1,sx:{ml:"-8px!important"}},r?Array(6).fill("").map((p,m)=>Qe.default.createElement(ti,{item:!0,xs:a,key:m},Qe.default.createElement(vt,{variant:"rounded",width:"100%",height:60}))):Qe.default.createElement(Qe.default.Fragment,null,l.map((p,m)=>Qe.default.createElement(ti,{item:!0,xs:a,key:m,className:"sourceGrid"},Qe.default.createElement(Al,{citation:{content:"",search_result_index:1,source:{doc_id:"",type:"search_results",...p,from:p?.from||"",engine:p?.engine||"",searchQuery:p?.searchQuery||""}}},Qe.default.createElement(yr,{variant:"outlined",sx:{backgroundColor:d=>d.palette.mode==="dark"?"rgba(59, 61, 62, 1)":"rgba(244, 244, 244, 1)",borderRadius:"8px",border:"0px","&:hover":{background:d=>d.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}}},Qe.default.createElement(Si,{href:p.url,target:"_blank",underline:"none"},Qe.default.createElement(g,{p:1,spacing:.5,className:"test"},Qe.default.createElement(T,{fontSize:14,color:"text.primary",noWrap:!0,sx:{p:0}},p.title),Qe.default.createElement(g,{direction:"row",alignItems:"center",spacing:.5},Qe.default.createElement(L,{width:16,height:16,borderRadius:"50%",overflow:"hidden",flexShrink:0},Qe.default.createElement("img",{src:Yi(p.url),alt:p?.from,width:"100%",height:"100%"})),Qe.default.createElement(T,{fontSize:12,color:"text.secondary",noWrap:!0},p?.from),Qe.default.createElement(T,{fontSize:12,color:"text.secondary",flexShrink:0},"\xB7 ",m+1)))))))),t.length>s&&Qe.default.createElement(ti,{item:!0,xs:a,onClick:()=>{i(!0)}},Qe.default.createElement(yr,{variant:"outlined",sx:{backgroundColor:p=>p.palette.mode==="dark"?"rgba(59, 61, 62, 1)":"rgba(244, 244, 244, 1)",borderRadius:"8px",border:"0px","&:hover":{cursor:"pointer",background:p=>p.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"rgba(0, 0, 0, 0.08)"}}},Qe.default.createElement(g,{p:1,spacing:1},Qe.default.createElement(g,{direction:"row",spacing:1},c.map((p,m)=>Qe.default.createElement(L,{key:m+(p||""),width:16,height:16,borderRadius:"50%",overflow:"hidden",flexShrink:0},Qe.default.createElement("img",{src:p,width:"100%",height:"100%"})))),Qe.default.createElement(g,{direction:"row",alignItems:"center",spacing:.5},Qe.default.createElement(T,{fontSize:12,color:"text.secondary",flexShrink:0},u("package__features:chat__ai_message__sources__view")," ",c.length," ",u("package__features:chat__ai_message__sources__more")))))))),Qe.default.createElement(nS,{open:n,onClose:()=>i(!1),searchResults:t,metadataTitle:o.metadataTitle}))},iS=lk;var pk={whiteSpace:"pre-wrap",width:"100%",boxSizing:"border-box",wordBreak:"break-word",color:"text.primary"},ck=o=>{let{message:e,order:t,loading:r=!1,hasError:n}=o,{t:i}=v(),{content:a,metadata:s,isAutoHideTools:l,isLoading:c}=Ze(),[u,p]=Ke.default.useState(!1);(0,Ke.useEffect)(()=>{if(a.status==="complete"){let I=setTimeout(()=>{p(!0)},vC);return()=>clearTimeout(I)}else p(!1)},[a.status]);let m=s.shareType!=="art"&&a.status==="complete"?u:a.status===void 0?!c:!1,d=(a.status==="complete"?u:!0)&&!n&&s?.nextActions,{copilotComplete:h,searchImages:f,searchVideos:_,knowledgePanels:x}=(0,Ke.useMemo)(()=>{let I=s.copilot?s.copilot.steps.every(N=>N.status==="complete"):!0,E=[],P=[],O=[];return s.searchResults?.forEach(N=>{N.images&&E.push(...N.images),N.videos&&P.push(...N.videos),N.knowledgePanel&&O.push(N.knowledgePanel)}),{copilotComplete:I,searchImages:E,searchVideos:P,knowledgePanels:O}},[s]),C=s.includeHistory===!1,y=s.isTriggeredContentReview===!0,[b,w]=(0,Ke.useState)(!1);return Ke.default.createElement(L,{component:"div",className:"chat-message chat-message--AI",sx:{[`& .${ef}`]:{opacity:l&&!b?0:1},"&:hover":{[`& .${ef}`]:{opacity:1}}},onMouseEnter:()=>{w(!0)},onMouseLeave:()=>{w(!1)}},C&&!y&&t!==1&&Ke.default.createElement(rf,{message:e}),Ke.default.createElement(g,{className:"chat-message--text",sx:pk},Ke.default.createElement(g,{spacing:3},Ke.default.createElement(df,{message:e}),!n&&s.title&&s.shareType!=="art"&&Ke.default.createElement(Ri,{title:s.title,fontSx:{fontWeight:"700",fontSize:"24px",color:"text.primary",whiteSpace:s.shareType==="search"?"":"nowrap",textOverflow:"ellipsis",overflow:"hidden"}}),!n&&s.copilot&&(s.shareType==="art"?Ke.default.createElement(H3,null):Ke.default.createElement(oS,{copilotType:s.shareType,copilot:s.copilot,messageIsComplete:!!s.isComplete})),!n&&h&&s.searchResults&&s.searchResults.length>0&&Ke.default.createElement(g,{spacing:1,marginBottom:"8px !important"},Ke.default.createElement(g,{direction:"row",alignItems:"center",spacing:1},Ke.default.createElement(Ls,{icon:"CaptivePortal",sx:{fontSize:"18px"}}),Ke.default.createElement(T,{fontSize:"18px"},"Sources")),Ke.default.createElement(iS,{metadataTitle:s.title,searchResults:s.searchResults,loading:!1})),h&&a.title?.title!=="noneShowContent"&&Ke.default.createElement(g,{spacing:2},s.chatMode?Ke.default.createElement(Ke.default.Fragment,null,Ke.default.createElement(xg,{message:e,loading:r}),Ke.default.createElement(ag,{message:e}),Ke.default.createElement(lg,{message:e,hasError:n})):Ke.default.createElement(Ke.default.Fragment,null,Ke.default.createElement(ag,{message:e}),Ke.default.createElement(xg,{message:e,loading:r}),!n&&(f.length>0||_.length>0||x.length>0)&&Ke.default.createElement(U3,{message:e,images:f,videos:_,knowledgePanels:x,loading:r}),Ke.default.createElement(lg,{message:e,hasError:n}))),!c||m?Ke.default.createElement(eS,{className:ef,message:e}):Ke.default.createElement(L,{height:"16px"}),s.nextActions&&d&&Ke.default.createElement(y3,{nextActions:s.nextActions,nextActionsStatus:s.nextActionsStatus}))),y&&s.isComplete&&t!==1&&Ke.default.createElement(It,{sx:{mt:2}},Ke.default.createElement(T,{color:"text.secondary",fontSize:"12px"},i("package__features:chat__ai_message__context_triggered_content_review"))))},aS=ck;var uk=o=>yg.default.createElement(of,{...o},yg.default.createElement(aS,{...o})),sS=gp(uk);var Nt=S(M());var Kc=S(M());var qs=S(M()),mk=o=>{let{message:e}=o,{t}=v(),r=e.conversationId||"",n=Ka(r),i=e?.messageId===n,a=ge(r),{regenerate:s}=Re(),[l,c]=(0,qs.useState)(!1);return(0,qs.useEffect)(()=>{i&&Ds(r).then(({lastRunActions:p})=>{c(p.length>0)})},[i]),i&&l?qs.default.createElement(ee,{placement:"top",disabled:a,title:t("package__features:chat__ai_message__tools__regenerate_button"),onClick:()=>s(r),testid:"sidebar_actions__regenerate",sx:{p:"6px"}},qs.default.createElement(z,{sx:{fontSize:"20px"},icon:"Regenerate"})):null},lS=mk;var dk=o=>{let{message:e}=o,{conversationId:t,variant:r}=Ce(),n=er(t),i=_i(n),a=e.meta?.systemMessageType||e.extra?.systemMessageType||"normal",s=e.meta?.status||e.extra?.status||"success",l=(0,Kc.useMemo)(()=>e.type==="system"&&s==="error"&&i?.messageId===e.messageId?!0:s!=="success"&&a==="normal"&&i?.messageId===e.messageId&&e.parentMessageId,[e.type,e.parentMessageId,e.messageId,i?.messageId,s,a]);return Kc.default.createElement(g,{direction:"row",alignItems:"center",flexWrap:"wrap",gap:1,className:"chat-system--message-tools"},r==="chatHub"||!l?null:Kc.default.createElement(lS,{message:e}))},bg=dk;var fk=Nt.default.lazy(()=>import("./ZSS4KAZV.js")),hk=o=>{let{message:e,loading:t,sx:r}=o,{isDarkMode:n}=tn(),i=so(),a=e?.extra?.systemMessageType==="needUpgrade"||e?.meta?.systemMessageType==="needUpgrade",s=e.meta.chatMode,l=e.meta.paywallData,c=e.meta?.AIModel||e.originalMessage?.metadata?.AIModel,u=(0,Nt.useMemo)(()=>Bn(e,!1),[e]),p=(0,Nt.useMemo)(()=>a?{width:"100%",whiteSpace:"pre-wrap",wordBreak:"break-word",gap:1,"& > div[data-permission-scene-type]":{mb:1}}:{whiteSpace:"pre-wrap",width:"100%",wordBreak:"break-word",borderRadius:"8px",bgcolor:"background.paper"},[a]),m=(0,Nt.useMemo)(()=>i?.id==="USE_CHAT_GPT_AI_ROOT_Context_Menu_Portal",[i]),d=()=>c?s==="free_chat"?Nt.default.createElement(da,null):Nt.default.createElement(_p,{AIProvider:Ir(void 0,c,{fallback:!1,checkValid:!0})?.AIProvider,AIModel:c}):Nt.default.createElement(da,null);return Nt.default.createElement(g,{className:"chat-message chat-message--text",gap:1,sx:{boxSizing:"border-box",...p,...r}},a&&l?Nt.default.createElement(Nt.default.Fragment,null,m?null:d(),Nt.default.createElement(MC,{paywallData:l}),Nt.default.createElement(bg,{message:e,loading:t})):Nt.default.createElement(Nt.default.Fragment,null,d(),Nt.default.createElement(bu,{severity:e?.meta?.status||"info",sx:{p:1,[`& .${yu.message}`]:{p:0,width:"100%"},"& > div:first-of-type":{display:"none"},"& .markdown-body":{"& > p:first-of-type":{mt:0}}},icon:Nt.default.createElement(Nt.default.Fragment,null)},Nt.default.createElement(L,null,Nt.default.createElement(g,{direction:"row",alignItems:"flex-start",spacing:1.5},Nt.default.createElement("div",{className:`markdown-body ${n?"markdown-body-dark":""}`},Nt.default.createElement(Nt.Suspense,{fallback:Nt.default.createElement(un,{sx:{my:0},loading:!0})},Nt.default.createElement(fk,{message:e},u)))))),Nt.default.createElement(bg,{message:e,loading:t})))},Cf=gp(hk);var Wn=S(M());var gk=({message:o})=>{let[e,t]=(0,Wn.useState)(!1),{getState:r}=k2(),n=(0,Wn.useMemo)(()=>r().conversationType==="Art",[r]),i=o?.meta?.messageChatDocuments||[];if(i.length===0)return null;let[a,s]=(0,Wn.useState)(),l=3,c=i.length-l;return Wn.default.createElement(g,{width:"100%",direction:"column",gap:1},Wn.default.createElement(Pi,{hideMenu:!0,images:i.map(u=>({src:u.link||"",alt:u.title})),selectedImage:a,setSelectedImage:s}),Wn.default.createElement(g,{direction:"row",gap:1,width:"100%",justifyContent:"flex-end",flexWrap:"wrap"},(e?i:i.slice(0,l)).map(u=>Wn.default.createElement(xk,{key:u.id||u.maxAIDocumentId,chatDocument:u,propOnClick:n?()=>{s(u.link||"")}:void 0})),!e&&c>0&&Wn.default.createElement(qa,{text:`+${c} more`,onClick:()=>t(!0)})))},xk=o=>{let{chatDocument:e,propOnClick:t}=o,r=e.maxAIDocumentId?cC(e.maxAIDocumentId):!0;return Wn.default.createElement(Vl,{onClick:t,disabled:r,chatDocument:e})},pS=gk;var cS=(o,e)=>{let t=o.indexOf(e);if(t===-1)return"";let r=o.indexOf(`
`,t);return r===-1?"":o.substring(t,r).replace(e,"").trim()},_k=o=>{o.length;let e=o.find(i=>i.name===De.PRESET_VARIABLE__CURRENT_WEBSITE_DOMAIN.name)?.default_value||"",t=[],r=o.find(i=>i.name===De.PRESET_VARIABLE__INSTANT_REPLY__WEBSITE_TYPE.name)?.default_value,n=o.find(i=>i.name===De.PRESET_VARIABLE__INSTANT_REPLY__TARGET_CONTEXT.name)?.default_value||o.find(i=>i.name===De.PRESET_VARIABLE__INSTANT_REPLY__FULL_CONTEXT.name)?.default_value||"";if(r&&n)switch(r){case"EMAIL":{let i=cS(n,"**Subject:**");i?t.push(`Email content of "${i}".`):t.push(`Email content of "${n}"`);break}case"SOCIAL_MEDIA":{let i=n.indexOf("**Comment:**");if(i!==-1){let a=n.slice(i).replace("**Comment:**","").trim();t.push(a)}else if(e.includes("youtube.com")){let a=cS(n,"**Post title:**");a&&t.push(`Video content of "${a}".`)}else{let a=n.indexOf("**Post caption/description:**");if(a!==-1){let s=n.slice(a).replace("**Post caption/description:**","").trim();t.push(s)}}break}case"CHAT_APP_WEBSITE":{let i=n.indexOf("**Content:**");if(i!==-1){let a=n.slice(i).replace("**Content:**","").replace(`
+`,`
`).trim();t.push(a)}break}case"UNKNOWN":default:}return t.join(`
`)},Ck=o=>{let e=[];return o.forEach(t=>{t.name.startsWith("CUSTOM_VARIABLE")&&t.default_value&&typeof t.default_value=="string"&&t.default_value.trim()!==""&&e.push({type:"text",key:t.hint||t.name,value:t.default_value})}),e.sort((t,r)=>t.value.length-r.value.length)};function jc(o=[],e=[]){let t,r=o.find(i=>i.key==="Selected text"||i.key==="Draft"||i.key.endsWith("draft"));r&&(t=r.value),t||(t=_k(e));let n=o.filter(i=>i.key!=="Draft"&&i.key!=="Selected text"&&!i.key.endsWith("draft"));return n.length===0&&e.length>0&&(n=Ck(e)),{text:t,userVariables:n}}var mo=S(M());var yk=Jr(({className:o,...e})=>mo.default.createElement(kn,{...e,classes:{popper:o}}))(({theme:o})=>({[`& > .${Br.tooltip}`]:{background:o.palette.mode==="dark"?"#2C2C2C":"#ffffff",color:"rgba(0, 0, 0, 0.87)",fontSize:12,boxShadow:"0px 12px 16px -4px rgba(0, 0, 0, 0.08), 0px 4px 6px -2px rgba(0, 0, 0, 0.03)",maxWidth:"none",borderRadius:o.spacing(1),border:`1px solid ${o.palette.border.main}`,backgroundClip:"padding-box"},[`& .${Br.arrow}`]:{color:o.palette.mode==="dark"?"#2C2C2C":"#ffffff","&::before":{border:`1px solid ${o.palette.border.main}`,background:o.palette.mode==="dark"?"#2C2C2C":"#ffffff",backgroundClip:"padding-box"}}})),bk=(0,mo.forwardRef)(function({variable:e,sx:t,container:r,children:n,virtualRect:i,popperSx:a,suffix:s,anchorElSx:l,descriptionEl:c},u){let[p,m]=(0,mo.useState)(!1),d=(0,mo.useRef)(null);(0,mo.useImperativeHandle)(u,()=>({close:()=>m(!1)}));let h=e.key==="Selected Text"||e.key==="Draft"?"Context":e.key,f={container:r,className:"maxai-variable-tooltip",sx:{zIndex:2147483619,...a},transition:!0};return i&&(f.anchorEl={getBoundingClientRect(){return i}}),mo.default.createElement(xl,{onClickAway:_=>{p&&_.target instanceof HTMLElement&&(d.current?.contains(_.target)||d.current===_.target)||m(!1)}},mo.default.createElement(g,{direction:"row",width:"100%",sx:t},mo.default.createElement(yk,{open:p,PopperProps:f,title:mo.default.createElement(g,{direction:"column",maxHeight:"min(500px, 40vh)",overflow:"hidden",height:"max-content"},mo.default.createElement(g,{direction:"row",width:"100%",gap:1.25,p:1.25,ref:d,boxSizing:"border-box",flexGrow:1,overflow:"hidden"},mo.default.createElement(L,{width:"2px",minWidth:"2px",bgcolor:_=>_.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)"}),mo.default.createElement(g,{direction:"column",flexGrow:1,overflow:"hidden"},mo.default.createElement(g,{direction:"row",gap:1.25,alignItems:"center",maxWidth:"100%"},mo.default.createElement(T,{fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",noWrap:!0,color:_=>_.palette.mode==="dark"?"rgba(255, 255, 255, 0.50)":"rgba(0, 0, 0, 0.38)"},h),mo.default.createElement(Fr,{sx:{padding:"5px",fontSize:"20px",borderRadius:"4px",color:"text.secondary"},defaultIconSx:{fontSize:"15px"},PopperProps:{placement:"top",container:r},copyText:e.value})),c,mo.default.createElement(T,{width:"100%",whiteSpace:"pre-wrap",color:"text.primary",textAlign:"left",lineHeight:"24px",fontSize:"16px",flexGrow:1,overflow:"auto"},e.value))),s),placement:"top",arrow:!0,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0},mo.default.createElement(L,{onClick:()=>{m(!p)},sx:l},typeof n=="function"?n({variable:e,open:p}):n))))}),vp=bk;var gS=S(Ig());var Vt=S(M()),vg=S(M());var $c=S(M());var Mk=/(\.py|\.ipynb|\.js|\.jsx|\.html|\.css|\.java|\.cs|\.php|\.c|\.cpp|\.cxx|\.h|\.hpp|\.rs|\.R|\.Rmd|\.swift|\.go|\.rb|\.kt|\.kts|\.ts|\.tsx|\.m|\.scala|\.rs|\.dart|\.lua|\.pl|\.pm|\.t|\.sh|\.bash|\.zsh|\.csv|\.log|\.ini|\.config|\.json|\.yaml|\.yml|\.toml|\.lua|\.sql|\.bat|\.md|\.coffee|\.tex|\.latex)/,Tk=({filetype:o,filename:e,sx:t})=>(o=o.toLowerCase(),o.endsWith("pdf")?$c.default.createElement(Ix,{sx:t}):e.endsWith(".txt")?$c.default.createElement(Sx,{sx:t}):Mk.test(e)?$c.default.createElement(bx,{sx:t}):$c.default.createElement(vx,{sx:t})),uS=Tk;var mS=S(V7());var ht=S(M()),wk={borderRadius:o=>o.spacing(1),border:o=>`1px solid ${o.palette.border.main}`,background:o=>o.palette.background.default,display:"flex",flexDirection:"row",position:"relative",p:1.25,gap:1.5,height:"62px",boxSizing:"border-box",width:"282px",minWidth:"282px",overflow:"hidden"},Ek={height:"40px",width:"40px",fontSize:"40px",cursor:"pointer"},dS={fontWeight:500,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"14px"},Pk={...dS,color:o=>o.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)"},Mp=228,Sg=200,Ak=({message:o})=>{let[e,t]=(0,ht.useState)(void 0),[r,n,i]=(0,ht.useMemo)(()=>{let m=(o.meta?.attachments||[]).filter(f=>f.uploadStatus==="success"),d=m.filter(f=>f.icon==="image"),h=m.filter(f=>f.icon!=="image");return[d,h.map(f=>({...f,attachmentExtractedContent:s_(f,o)})),m]},[o,o.meta?.attachments]),[a,s]=(0,ht.useState)({width:`${Mp}px`,height:`${Mp/1.5}px`}),l=(0,ht.useMemo)(()=>r.length===1?a:r.length>3?{width:"64px",height:"64px"}:{width:"112px",height:"112px"},[r]),c=m=>{if(r.length!==1)return;let{naturalWidth:d,naturalHeight:h}=m,f=d/h;if(f>=1&&f<=1.5){let _=`${Mp/1.5}px`,x=`${Mp}px`;s({width:x,height:_})}else if(f>1.5){let _=`${Mp/2}px`,x=`${Mp}px`;s({width:x,height:_})}else if(f<1&&f>=.75){let _=`${Sg}px`;s({width:"228px",height:_})}else{let _=`${Sg}px`,x=`${Sg*.75}px`;s({width:x,height:_})}},u=(0,ht.useMemo)(()=>r.map(m=>({src:m.uploadedUrl||m.base64Data||m.blobUrl||"",alt:m.fileName})),[r]),p=(0,ht.useRef)(null);if(i.length!==0)return ht.default.createElement(g,{width:"100%",direction:"column",gap:1},r.length>0&&ht.default.createElement(g,{gap:1,direction:"row",justifyContent:"flex-end",overflow:"auto",width:"100%"},r.map(m=>ht.default.createElement(On,{key:m.id,width:l.width,height:l.height,alt:m.fileName,onLoaded:c,SkeletonSx:{borderRadius:d=>d.spacing(1),width:l.width,height:l.height,overflow:"hidden"},src:m.uploadedUrl||m.base64Data||m.blobUrl||"",imageSx:{borderRadius:d=>d.spacing(1),width:l.width,height:l.height,overflow:"hidden",objectFit:"cover",cursor:"pointer",border:d=>`1px solid ${d.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0,0,0,0.08)"}`},onImageClick:()=>{t(m.uploadedUrl||m.base64Data||m.blobUrl||"")}}))),ht.default.createElement(Pi,{images:u,selectedImage:e,setSelectedImage:t}),n.length>0&&ht.default.createElement(g,{direction:"column",gap:1,width:"100%",alignItems:"flex-end",ref:p},n.map(m=>ht.default.createElement(kk,{key:m.id,file:m,getFilesContainer:()=>p.current}))))},kk=(0,ht.memo)(function({file:e,container:t,getFilesContainer:r}){let{t:n}=v(),i=(0,ht.useRef)(null),[a,s]=(0,ht.useState)(null),[l,c]=(0,ht.useState)(360);return ht.default.createElement(L,{ref:i,onClick:()=>{let u=r?.()??null;if(i.current&&u){let p=u.getBoundingClientRect(),m=i.current.getBoundingClientRect(),d=m.left+20,h=p.left+p.width/2,f=Math.max(h,d);c(f===h?Math.min(p.width-40,600):Math.max((m.right-m.left-20)*2,140)),s(new DOMRect(f,m.top,1,m.height))}}},ht.default.createElement(vp,{variable:{key:e.fileName,value:e.attachmentExtractedContent},anchorElSx:wk,virtualRect:a,sx:{width:"fit-content",cursor:"pointer"},container:t,popperSx:{width:l},descriptionEl:ht.default.createElement(g,{direction:"column"},ht.default.createElement(T,{textAlign:"left",fontSize:"14px",color:"text.secondary",noWrap:!0,flexShrink:0},`${b0(e.fileSize||0)} \u2022 ${e.fileType}`),ht.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"text.secondary",noWrap:!0,flexShrink:0,display:"flex",alignItems:"center",gap:1},ht.default.createElement(mS.default,{sx:{fontSize:"12px",color:"inherit"}}),n("package__features:chat__user_message__contexts__file__preview__tips")))},ht.default.createElement(uS,{filename:e.fileName,filetype:e.fileType,sx:Ek}),ht.default.createElement(g,{direction:"column",overflow:"hidden",flexGrow:1},ht.default.createElement(T,{sx:dS},e.fileName),ht.default.createElement(T,{sx:Pk},e.fileType.toUpperCase()))))}),fS=Ak;var xs=S(M()),Lk=({iconSx:o,message:e,formatMessageContent:t,...r})=>{let{t:n}=v(),{inputMediator:i}=Ce(),a=so(),{askAIWithShortcutsV2:s}=Re(),{chatHubLoading:l}=rt(),c=e.meta?.MaxAIPromptActionConfig?.prompt_id,u=(0,xs.useMemo)(()=>e.meta?.MaxAIPromptActionConfig===void 0,[e.meta?.MaxAIPromptActionConfig]),p=(0,xs.useMemo)(()=>e.meta?.MaxAIPromptActionConfig&&Hs(e.meta?.MaxAIPromptActionConfig),[e.meta?.MaxAIPromptActionConfig]),m=(0,xs.useMemo)(()=>["AI_RESPONSE_LANGUAGE",De.PRESET_VARIABLE__INTERFACE_LANGUAGE.name,De.PRESET_VARIABLE__SYSTEM_CURRENT_DATE.name,De.PRESET_VARIABLE__REFINE_DRAFT__FOLLOW_UP_INSTRUCTION.name,De.PRESET_VARIABLE__INSTANT_REPLY__WEBSITE_TYPE.name,De.PRESET_VARIABLE__INSTANT_REPLY__DRAFT_CONTEXT.name,De.PRESET_VARIABLE__INSTANT_REPLY__TARGET_CONTEXT.name,De.PRESET_VARIABLE__INSTANT_REPLY__FULL_CONTEXT.name,De.PRESET_VARIABLE__INSTANT_REPLY__SOCIAL_MEDIA__POST_DRAFT.name,De.PRESET_VARIABLE__INSTANT_REPLY__EMAIL__DRAFT.name,De.PRESET_VARIABLE__INSTANT_REPLY__CHAT_APP__MESSAGE_DRAFT.name,De.PRESET_VARIABLE__CURRENT_WEBSITE_DOMAIN.name,De.PRESET_VARIABLE__CURRENT_WEBPAGE_URL.name,De.PRESET_VARIABLE__AI_RESPONSE_WRITING_STYLE.name,De.PRESET_VARIABLE__AI_RESPONSE_TONE.name,De.OUTPUT_PRESET_VARIABLE__CHAT_COMPLETE.name],[]),d=(0,xs.useMemo)(()=>{if(e.meta?.disableEditQuestion)return!1;if(u)return!0;let f=p?.origin?.variables;return f&&f?.some(x=>x.name==="KEY_POINTS")?!0:c&&a2.includes(c)?!1:!!f?.filter(x=>x.name&&!m.includes(x.name))?.length},[u,p?.origin?.variables,m,e.meta?.disableEditQuestion,c]),h=async()=>{if(u){lf(),i.updateInputValue(t);let f=i.ref;f&&(f.focus(),f.setSelectionRange(f.value.length,f.value.length));return}else if(p){let f=p.actions;if(f.length>0){let _=p?.origin?.variables;if(_){let C=_.reduce((y,b)=>(y&&!m.includes(b.name)?y[b.name]={key:b.name,value:b.default_value,overwrite:!0,isBuiltIn:!0,label:b.label||b.hint||b.name}:y&&c==="47070ec6-8700-43fd-a519-20fe3841df38"&&(b.name==="MAXAI__INSTANT_REPLY__TARGET_CONTEXT"||b.name==="MAXAI__INSTANT_REPLY__FULL_CONTEXT"||b.name==="MAXAI__INSTANT_REPLY__LAST_CONTEXT")&&(y[b.name]={key:b.name,value:b.default_value,overwrite:!0,isBuiltIn:!0,label:b.label||b.hint||b.name}),y??{}),{});f.unshift({type:"SET_VARIABLE_MAP",parameters:{VariableMap:C}})}let x=f.find(C=>C.type==="SET_VARIABLES_MODAL");if(x){if(x.parameters.SetVariablesModalConfig={...x.parameters.SetVariablesModalConfig,disableAutoExecuteWhenAllVariableHaveValue:!0},c==="47070ec6-8700-43fd-a519-20fe3841df38"){let b=s2[0].parameters.SetVariablesModalConfig;b&&(x.parameters.SetVariablesModalConfig={...x.parameters.SetVariablesModalConfig,...b})}let C=x.parameters?.MaxAIPromptActionConfig?.variables.find(b=>b.name==="SELECTED_TEXT"),y="8c0c38d4-1dfe-498e-8229-05e758b2dc03"===c;C&&(C.hidden=!1,y&&(C.hidden=!0))}await s(f,{isClearInput:!0,isFocusInput:!0}),Ok(a)}}};return d?xs.default.createElement(fm,{title:n("package__features:chat__user_message__action__edit"),...r,onClick:h,sx:{mr:.5,p:"6px",borderRadius:1,color:"text.secondary",...r.sx},disabled:l},xs.default.createElement(z,{icon:"DefaultIcon",sx:{fontSize:"20px",...o}})):null},hS=Lk;function Ok(o){if(o){let e=o.querySelector('*[data-testid="maxai--chat-box--chat-input--main"] textarea');if(e&&e?.focus){e.focus(),e.setSelectionRange(e.value.length,e.value.length);return}let t=o.querySelector("*[data-testid^=custom-variable--] textarea");if(t&&t?.focus){t.focus(),t.setSelectionRange(t.value.length,t.value.length);return}}}var yn=S(M()),Bk=["www.linkedin.com"],Dk=({variable:o,container:e,getMessageContainer:t,zIndex:r})=>{let n=(0,yn.useRef)(null),[i,a]=(0,yn.useState)(null),[s,l]=(0,yn.useState)(360);return yn.default.createElement(g,{direction:"row",width:"100%",gap:"4px",sx:{"& .maxai-user-message-variable-copy-icon":{transition:"opacity 0.2s ease-in-out",opacity:0},"&:hover .maxai-user-message-variable-copy-icon":{opacity:1}}},yn.default.createElement(L,null,yn.default.createElement(Fr,{tooltipPlacement:"top",tabIndex:-1,sx:{padding:"6px",fontSize:"20px",borderRadius:"8px",color:"text.secondary"},defaultIconSx:{},className:"maxai-user-message-variable-copy-icon",PopperProps:{container:e,sx:{zIndex:r}},copyText:o.value,onCopy:()=>{Bk.includes(window.location.host)&&Hp.includes("extension")&&setTimeout(()=>{dl.hideSidebar()},1)}})),yn.default.createElement(vp,{variable:o,container:e,sx:{flexGrow:1,overflow:"hidden"},virtualRect:i,popperSx:{width:s,boxSizing:"border-box",zIndex:r},anchorElSx:{width:"100%"}},yn.default.createElement(g,{direction:"column",gap:1,ref:n,sx:{width:"100%",p:1,borderRadius:c=>c.spacing(.5),background:c=>c.palette.mode==="dark"?"rgba(255, 255, 255, 0.04)":"rgba(0, 0, 0, 0.04)",boxSizing:"border-box"},onClick:()=>{let c=t?.()??null;if(n.current&&c){let u=c.getBoundingClientRect(),p=n.current.getBoundingClientRect(),m=p.left+20,d=u.left+u.width/2,h=Math.max(d,m);if(h===d){let f=Math.min(u.width-40,600);l(f)}else l(Math.max((p.right-p.left-20)*2,140));a(new DOMRect(h,p.top,1,p.height))}}},yn.default.createElement(T,{color:c=>c.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)",fontSize:"14px"},o.key),yn.default.createElement(T,{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",fontSize:"14px",color:"text.primary"},o.value))))},bf=Dk;var If="maxai-client--user-message--action-icon--visible-on-hover",Hk={whiteSpace:"pre-wrap",wordBreak:"break-word",p:o=>o.spacing(1.5),bgcolor:o=>o.palette.secondary.main,borderRadius:o=>o.spacing(1),color:"text.primary",maxWidth:"100%",width:"auto",flexWrap:"wrap",overflow:"hidden"},Fk={width:"auto",maxWidth:"100%",flexDirection:"row",justifyContent:"flex-end",gap:"2px",[`& .${If}`]:{width:"32px",height:"32px",transition:"opacity 0.2s ease-in-out",opacity:0},[`&:hover .${If}`]:{opacity:1}},Nk=o=>{let{message:e,order:t,container:r}=o,{t:n}=v(),{inputMediator:i}=Ce(),a=e.meta?.MaxAIPromptActionConfig===void 0,s=(0,vg.useMemo)(()=>!e.meta?.includeHistory&&t!==1,[e,t]),{quote:l,userVariables:c,formatMessageContent:u}=(0,vg.useMemo)(()=>{let C=Bn(e,!1),y=[],b=jc(e.meta?.contexts,e.meta?.MaxAIPromptActionConfig?.variables),w=(e.meta?.messageChatDocuments?.length??0)>0,E=w?"":b?.text?b.text:e.meta?.MaxAIPromptActionConfig?.variables?.find(O=>O.name==="SELECTED_TEXT")?" ":"";return b?.userVariables.forEach(P=>{P.key===De.PRESET_VARIABLE__COMPOSE_KEY_POINTS.hint||P.key===De.PRESET_VARIABLE__REPLY_KEY_POINTS.hint||P.key===De.PRESET_VARIABLE__REFINE_DRAFT__FOLLOW_UP_INSTRUCTION.hint?C=P.value:y.push(P)}),{formatMessageContent:C,userVariables:y,quote:E}},[e]),[p,m]=(0,Vt.useState)(null),[d,h]=(0,Vt.useState)(360),f=(0,Vt.useRef)(null),_=(0,Vt.useRef)(null),x=()=>{i.updateInputValue(u);let C=i.ref;C&&(C.focus(),C.setSelectionRange(C.value.length,C.value.length))};return Vt.default.createElement(g,{className:"chat-message chat-message--user",direction:"column",gap:1,ref:f,width:"100%"},s&&Vt.default.createElement(rf,{message:e}),!!l&&Vt.default.createElement(Vt.default.Fragment,null,Vt.default.createElement(L,{sx:{display:"flex",flexDirection:"row",justifyContent:"flex-end",width:"100%"}},Vt.default.createElement(vp,{variable:{key:"Quote",value:l},sx:{maxWidth:"100%",width:"auto"},virtualRect:p,popperSx:{width:d,boxSizing:"border-box"},container:r},Vt.default.createElement(g,{gap:1,direction:"row",color:C=>C.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)",width:"100%",ref:_,onClick:()=>{if(_.current&&f.current){let C=f.current.getBoundingClientRect(),y=_.current.getBoundingClientRect(),b=y.left+40,w=C.left+C.width/2,I=Math.max(w,b);if(I===w){let E=Math.min(C.width-40,600);h(E)}else h(Math.min(Math.max((y.width-20)*2,140),C.width-40,600));m(new DOMRect(I,y.top,1,y.height))}}},Vt.default.createElement(gS.default,{sx:{fontSize:"18px"}}),Vt.default.createElement(v_,{maxLine:2,fontSize:"14px",flex:1},l))))),Vt.default.createElement(pS,{message:e}),Vt.default.createElement(fS,{message:e}),Vt.default.createElement(g,{direction:"row",justifyContent:"flex-end",width:"100%",paddingLeft:C=>C.spacing(6)},Vt.default.createElement(g,{sx:Fk},Vt.default.createElement(L,null,Vt.default.createElement(hS,{message:e,formatMessageContent:u,tabIndex:-1,className:If,PopperProps:{disablePortal:!0}})),Vt.default.createElement(L,null,Vt.default.createElement(Fr,{tabIndex:-1,sx:{mr:.5,p:"6px",borderRadius:1,color:"text.secondary"},className:If,PopperProps:{disablePortal:!0},copyText:u})),Vt.default.createElement(L,{className:"chat-message--text",sx:Hk,onClick:C=>{if(C.detail===3){let y=C.target;if(y){let b=y.innerText;navigator.clipboard.writeText(b),C.preventDefault();let w=document.createRange();w.selectNodeContents(y);let I=window.getSelection();I&&(I.removeAllRanges(),I.addRange(w))}}}},Vt.default.createElement(T,{fontSize:"16px"},u),Vt.default.createElement(g,{width:"100%",direction:"column",gap:1},c.map((C,y)=>Vt.default.createElement(bf,{variable:C,key:`${C.key}-${y}`,getMessageContainer:()=>f.current,container:r})))))))},xS=gp(Nk);var CS=S(Cr()),yS=S(_S());var $t=S(M()),Uk=({message:o,sx:e})=>{let[t,r]=(0,$t.useState)(!1),[n,i]=(0,$t.useState)(new Set),[a,s]=(0,$t.useState)(""),l=(0,$t.useMemo)(()=>JSON.stringify(o,null,2),[o]);return $t.default.createElement($t.default.Fragment,null,$t.default.createElement(L,{position:"absolute",top:16,right:16,zIndex:1,sx:e},$t.default.createElement(kn,{open:t,title:$t.default.createElement(g,null,o&&$t.default.createElement(g,{sx:{gap:1,flexDirection:"row"}},$t.default.createElement(Mu,{size:"small",sx:{width:"auto",flex:1,color:"#fff"},options:Object.keys(o),onChange:(c,u)=>{s(u??"")},renderInput:c=>$t.default.createElement(Lt,{...c,variant:"outlined"})}),$t.default.createElement(le,{size:"small",variant:"contained",onClick:()=>{a&&i(c=>{let u=new Set(c);return u.add(a),u})}},"\u6DFB\u52A0\u76D1\u89C6\u5B57\u6BB5")),$t.default.createElement(g,{sx:{flexDirection:"row",gap:1,justifyContent:"space-between",alignItems:"center"}},$t.default.createElement(Fr,{copyText:l,sx:{color:"#fff"}}),$t.default.createElement(je,{onClick:()=>r(!1)},$t.default.createElement(CS.default,{sx:{color:"#fff"}}))),$t.default.createElement("pre",{style:{fontSize:"12px",overflowY:"auto"}},l))},$t.default.createElement(je,{onClick:()=>r(c=>!c),sx:{fontSize:24}},$t.default.createElement(yS.default,null)))),n?.size>0&&$t.default.createElement(L,{sx:{borderRadius:1,border:"1px solid #ccc",p:1,background:"#f0f0f0"}},Array.from(n)?.map(c=>$t.default.createElement("div",{key:c},c,":"," ",JSON.stringify(c.split(".").reduce((u,p)=>u?.[p],o))))))},Wk=o=>cu?$t.default.createElement(Uk,{...o}):null,vf=Wk;var Gk=o=>{let{message:e,sx:t,order:r,loading:n,onChangeHeight:i,...a}=o,s=(0,bn.useRef)(null),l=(0,bn.useRef)(0);return uC(e),(0,bn.useEffect)(()=>{if(s.current){let c=s.current,u=()=>{if(!c)return;let m=c.offsetHeight;m&&m!==l.current&&Math.abs(m-l.current)>10&&(l.current=m,i?.(m,e.messageId))},p=new ResizeObserver(()=>{u()});return p.observe(c),()=>{p.disconnect()}}},[i]),bn.default.createElement(L,{"data-message-id":e.messageId,"data-scroll-position":e.type==="system"?"bottom":"top",ref:s,sx:{padding:c=>`${c.spacing(2.25)} ${c.spacing(1.5)}`,position:"relative",boxSizing:"border-box",maxWidth:"var(--max-width)",width:"100%",mx:"auto",color:"text.primary",userSelect:"text","& .chat-message--text":{textAlign:"left",fontSize:"16px",lineHeight:1.4,fontWeight:400},...t},...a},bn.default.createElement(vf,{message:e}),wi(e)&&bn.default.createElement(Cf,{message:e}),mn(e)&&bn.default.createElement(sS,{order:r,loading:n??!1,message:e}),r_(e)&&bn.default.createElement(xS,{order:r,message:e}))},bS=(0,bn.memo)(Gk);var IS=S(M()),Kk=o=>{let{conversationId:e}=o,t=Ol(e);return IS.default.createElement(vf,{message:t,sx:{left:0,right:"inherit"}})},SS=Kk;var Oe=S(M());var vS=S(N7());var Mf=S(M()),jk=o=>{let{onClick:e,container:t}=o,{t:r}=v();return Mf.default.createElement(je,{onClick:()=>e(),sx:{position:"absolute",bottom:"16px",left:"50%",transform:"translateX(-50%)",bgcolor:"background.paper",padding:0,border:"1px solid",width:"32px",height:"32px",borderColor:n=>n.palette.mode==="dark"?"rgb(64,64,64)":"rgb(234,234,234)",boxShadow:"0px 12px 16px -4px rgba(0, 0, 0, 0.08), 0px 4px 6px -2px rgba(0, 0, 0, 0.03)","&:hover":{bgcolor:n=>n.palette.mode==="dark"?"rgb(64,64,64)":"rgb(234,234,234)"}}},Mf.default.createElement(me,{PopperProps:{container:t},title:r("package__features:chat__message_list__scroll_to_bottom__title"),placement:"top"},Mf.default.createElement(vS.default,{sx:{boxSizing:"border-box",padding:"8px",fontSize:"32px"}})))},Tf=jk;var $k="message-list-scroll-container",Mg=4*24+2*18,MS=o=>{let e=o.scrollTop,t=o.scrollHeight,r=o.clientHeight;return Math.abs(r+e-t)>10},qk=(o,e,t,r)=>{if(!o)return;let n=o.querySelectorAll("[data-message-id]"),i=Array.from(n).findIndex(s=>s.getAttribute("data-message-id")===e),a=n[i];if(a){let s=a.getAttribute("data-scroll-position")||"bottom";o.scrollTo(0,s==="bottom"?o?.scrollHeight:a.offsetTop-Mg),t?.()}r?.()},Xk=o=>{let{conversationId:e}=Ce(),{conversationId:t=e,sx:r,emptyNode:n,children:i}=o,a=K_(t),s=$e(a),[l,c]=(0,Oe.useState)(null);(0,Oe.useEffect)(()=>{if(a)c(a);else{let X=setTimeout(()=>{s.current||c(s.current)},100);return()=>{clearTimeout(X)}}},[a,s]);let u=(0,Oe.useMemo)(()=>l,[l]),p=Ka(t),m=(0,Oe.useRef)(null),[d,h]=(0,Oe.useState)(0),f=(0,Oe.useRef)(oi(qk,50,{leading:!1,trailing:!0})),_=(0,Oe.useRef)(null),x=(0,Oe.useRef)(null),{messages:C,isLoading:y,isFetchingNextPage:b,hasNextPage:w,fetchNextPage:I,lastMessageId:E,previousPageLastMessageId:P}=N_(t),[O,N]=(0,Oe.useState)(!1),V=(0,Oe.useRef)(!1);(0,Oe.useEffect)(()=>{V.current=!1},[t]);let[A,D]=(0,Oe.useState)(!1);(0,Oe.useLayoutEffect)(()=>{D(!1)},[t]);let W=y||!A,k=(0,Oe.useRef)(!1),U=(0,Oe.useCallback)(()=>{b||!w||k.current||(k.current=!0,I().then().catch())},[b,w,I]),K=$e(U),H=()=>{let X=m.current;X&&(X.scrollTo(0,X.scrollHeight),N(!1))},R=(0,Oe.useCallback)(()=>{if(!_.current){D(!0);return}let X=m.current;if(X&&N(MS(X)),x.current===_.current){D(!0);return}let oe=_.current;f.current(m.current,_.current,()=>{x.current=oe,V.current=!0,k.current&&(k.current=!1)},()=>{setTimeout(()=>{D(!0)},100)})},[]);(0,Oe.useEffect)(()=>{let X=m.current;if(!X)return;let oe=j=>{if(N(MS(X)),j.deltaY<0){X.scrollTop<=X.offsetHeight/10&&K.current();return}},ue=new ResizeObserver(()=>{let j=X.clientHeight;h(j)});ue.observe(X);let Z=oi(oe,100),J=Dr(oe,300);return X.addEventListener("wheel",Z),X.addEventListener("wheel",J),X.addEventListener("scroll",Z),X.addEventListener("scroll",J),()=>{X.removeEventListener("wheel",Z),X.removeEventListener("wheel",J),X.removeEventListener("scroll",Z),X.removeEventListener("scroll",J),ue.disconnect()}},[m.current,t]);let F=(0,Oe.useRef)(null);Nu(()=>{F.current=_.current}),(0,Oe.useEffect)(()=>{F.current&&(_i(C)?.messageId!==F.current&&H(),F.current=null)},[C]),(0,Oe.useEffect)(()=>{let X=u?.messageId||"";X&&E!==X?_.current=X:E&&E!==_.current&&(_.current=E)},[u?.messageId,E]),(0,Oe.useEffect)(()=>{P&&k.current&&(_.current=P)},[P]),(0,Oe.useEffect)(()=>{x.current=null},[t]);let Y=(0,Oe.useRef)({}),$=(0,Oe.useMemo)(()=>{u&&(Y.current[t]=u);let X=He(C),oe=Y.current[t],ue=oe?.messageId;if(!ue)return{writingMessageId:"",currentMessages:X};let Z=C.findIndex(J=>J.messageId===ue);if(Z>-1){let J=!1;if(u&&u.updated_at&&X[Z].updated_at){if(new Date(u.updated_at).getTime()<new Date(X[Z].updated_at).getTime())return{writingMessageId:ue,currentMessages:X};J=!0}return!u&&!J?(delete Y.current[t],{writingMessageId:"",currentMessages:X}):(X[Z]=Qo([X[Z],u]),{writingMessageId:ue,currentMessages:X})}else if(oe){let J=_i(C);J&&wi(J)?delete Y.current[t]:X=[...C,oe]}return{writingMessageId:ue,currentMessages:X}},[t,u,C]),ie=(0,Oe.useMemo)(()=>!(y||b||w||$.currentMessages.length||$.writingMessageId||p),[y,b,w,$.currentMessages.length,$.writingMessageId,p]);(0,Oe.useEffect)(()=>{},[p,w,b,y,ie,$.currentMessages.length,$.writingMessageId]);let G=_i(C)?.type,B=(0,Oe.useMemo)(()=>({flex:1,height:"0",overflowY:"auto",display:ie?"none":"block","&:focus":{outline:"none"},"& .maxai__message-item":{"&:last-of-type":{minHeight:G==="system"?"unset":d===0?`calc(100vh - ${Mg+200}px)`:`calc(${d}px - ${Mg}px)`}},...r}),[d,G,r,ie]),ae=Oe.default.createElement(g,{"data-testid":"maxai--chat-panel--message-list",key:t,sx:{height:0,flex:1,width:"100%",position:"relative",display:ie?"none":"flex","& *":{boxSizing:"border-box"},...r}},Oe.default.createElement(SS,{conversationId:t}),ie&&n,W&&Oe.default.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2}},Oe.default.createElement(un,{loading:!0,sx:{backgroundColor:"background.default"}})),Oe.default.createElement(L,{ref:m,id:$k,tabIndex:-1,sx:B},b&&Oe.default.createElement(g,{width:"100%",alignItems:"center",justifyContent:"center",sx:{my:"16px"}},Oe.default.createElement(Jt,{size:16,sx:{m:"0 auto"}})),$.currentMessages.map((X,oe)=>Oe.default.createElement(bS,{key:`${X.messageId}_${oe}`,className:`maxai__message-item maxai__message-item--${X.type}`,"data-testid":`maxai__message-item-${oe+1}`,message:X,order:oe+1,onChangeHeight:R,loading:$.writingMessageId===X.messageId}))),O&&!ie&&Oe.default.createElement(Tf,{onClick:()=>H()}));return i?i({isShowHomeView:ie,isLoading:y,isFetchingNextPage:b,hasNextPage:w,messages:$.currentMessages,listNode:ae}):ae},Tp=Xk;var Et=S(M());var wf=S(M()),TS=({children:o,fallback:e=null})=>{let[t,r]=(0,wf.useState)(!1);return(0,wf.useEffect)(()=>{r(!0)},[]),t?o:e};var Is=S(M());var LS=S(bi());var No=S(M());var PS=S(Cr());var wr=S(M());var an=S(M());var wS=S(M()),Ef=[{betaFeature:"appearance_v2",optionTitle:"package__features:beta_features__modal__option__appearance_v2__title",betaFeatureCardTitle:"package__features:beta_features__modal__feature_card__appearance_v2__title",betaFeatureCardImages:[I1("/images/beta-features/appearance/1.png")],betaFeatureCardDescription:"package__features:beta_features__modal__feature_card__appearance_v2__description",onButtonText:"package__features:beta_features__modal__feature_card__appearance_v2__on",offButtonText:"package__features:beta_features__modal__feature_card__appearance_v2__off"},{betaFeature:"enabled_artifacts",optionTitle:"package__features:beta_features__modal__option__artifacts__title",betaFeatureCardTitle:"package__features:beta_features__modal__feature_card__artifacts__title",betaFeatureCardImages:[I1("/images/beta-features/artifacts/1.webp")],betaFeatureCardDescription:"package__features:beta_features__modal__feature_card__artifacts__description",onButtonText:"package__features:beta_features__modal__feature_card__common__on",offButtonText:"package__features:beta_features__modal__feature_card__common__off"}],_s=(0,wS.createContext)({mode:"full",selectedBetaFeature:Ef[0].betaFeature,betaFeatureOptions:Ef,openBetaFeature:()=>{},handleSelectBetaFeature:()=>{},closeBetaFeature:()=>{},open:!1});var Yk=o=>{let{betaFeature:e,onChange:t}=o,{t:r}=v(),{selectedBetaFeature:n,betaFeatureOptions:i}=(0,an.useContext)(_s),a=i.find(s=>s.betaFeature===n);return!a||a.betaFeature!==e?null:an.default.createElement(g,{gap:1.5,width:"100%"},a.betaFeatureCardImages[0]&&an.default.createElement("img",{alt:r(a.betaFeatureCardTitle),width:"100%",src:a.betaFeatureCardImages[0]}),an.default.createElement(g,{gap:1},an.default.createElement(g,{direction:"row",alignItems:"center",gap:1},an.default.createElement(T,{width:0,flex:1,noWrap:!0,fontSize:"16px",fontWeight:"400",color:"text.primary",textAlign:"left"},r(a.betaFeatureCardTitle)),an.default.createElement(g,{onClick:async()=>{let s=!a?.enabled;a?.setEnabled?.(s),t?.(s)},direction:"row",alignItems:"center",gap:.5,sx:{flexShrink:0,py:.5,px:1,cursor:"pointer"}},an.default.createElement(T,{fontSize:"14px",fontWeight:"400",color:"text.primary"},r(a.offButtonText)),an.default.createElement(g,{alignItems:"center",justifyContent:"center",p:"2px"},an.default.createElement(hm,{checked:a.enabled,height:16})),an.default.createElement(T,{fontSize:"14px",fontWeight:"400",color:"text.primary"},r(a.onButtonText)))),an.default.createElement(T,{fontSize:"14px",fontWeight:"400",color:"text.secondary"},r(a.betaFeatureCardDescription))))},Tg=Yk;var wp=S(M());var Zk=()=>{let{t:o}=v(),{selectedBetaFeature:e,betaFeatureOptions:t,handleSelectBetaFeature:r}=(0,wp.useContext)(_s);return wp.default.createElement(wu,{sx:{width:"100%"}},t.map(n=>wp.default.createElement(Eu,{sx:{p:"8px 12px"},key:n.betaFeature,selected:e===n.betaFeature,onClick:()=>r(n.betaFeature)},wp.default.createElement(T,{fontSize:"14px",fontWeight:500,color:"text.primary"},o(n.optionTitle)))))},ES=Zk;var Qk=()=>{let{t:o}=v(),{mode:e,open:t,closeBetaFeature:r}=(0,wr.useContext)(_s),{appSettings:n,setAppSettings:i}=en(),a=so(),{betaSettings:s,updateBetaSettings:l}=Sr();return wr.default.createElement(yi,{container:a,open:t,onClose:c=>{c.stopPropagation(),r()},sx:{position:e==="full"?"fixed":"absolute"},slotProps:{root:{onClick:c=>{c.stopPropagation()}},backdrop:{sx:{position:e==="full"?"fixed":"absolute"}}}},wr.default.createElement(Tu,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",borderRadius:1,bgcolor:c=>c.palette.mode==="dark"?"#3d3d3d":"#fff",maxWidth:"768px!important",width:e==="full"?"100%":"448px",p:"0!important"}},wr.default.createElement(g,null,wr.default.createElement(g,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:"8px 16px",borderBottom:"1px solid",borderColor:"border.main",boxSizing:"border-box"}},wr.default.createElement(T,{fontSize:"16px",fontWeight:600,lineHeight:"20px",color:"text.primary"},o("package__features:beta_features__modal__title")),wr.default.createElement(je,{"aria-label":"close",sx:{width:30,height:30},onClick:()=>{r()}},wr.default.createElement(PS.default,{sx:{width:20,height:20}}))),wr.default.createElement(g,{sx:{flexDirection:e==="lite"?"column":"row"}},wr.default.createElement(g,{sx:{p:"12px 16px",width:e==="lite"?"100%":"208px",boxSizing:"border-box"}},wr.default.createElement(ES,null)),wr.default.createElement(g,{sx:{p:"12px 16px",width:e==="lite"?"100%":"0",flex:1,boxSizing:"border-box"}},wr.default.createElement(Tg,{betaFeature:"enabled_artifacts",onChange:async()=>{await i({userSettings:{features:{artifacts:{enabled:!n.userSettings?.features?.artifacts?.enabled}}}})}}),wr.default.createElement(Tg,{betaFeature:"appearance_v2",onChange:async()=>{await l({appearance_v2_enabled:!s?.appearance_v2_enabled})}}))))))},AS=Qk;var kS=o=>{let{sx:e}=o;return No.default.createElement(LS.default,{sx:{...e}},No.default.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},No.default.createElement("g",null,No.default.createElement("path",{d:"M3.74989 15.75C3.11239 15.75 2.65927 15.4656 2.39052 14.8969C2.12177 14.3281 2.18739 13.8 2.58739 13.3125L6.74989 8.25V3.75H5.99989C5.78739 3.75 5.60927 3.67813 5.46552 3.53437C5.32177 3.39062 5.24989 3.2125 5.24989 3C5.24989 2.7875 5.32177 2.60938 5.46552 2.46562C5.60927 2.32187 5.78739 2.25 5.99989 2.25H11.9999C12.2124 2.25 12.3905 2.32187 12.5343 2.46562C12.678 2.60938 12.7499 2.7875 12.7499 3C12.7499 3.2125 12.678 3.39062 12.5343 3.53437C12.3905 3.67813 12.2124 3.75 11.9999 3.75H11.2499V8.25L15.4124 13.3125C15.8124 13.8 15.878 14.3281 15.6093 14.8969C15.3405 15.4656 14.8874 15.75 14.2499 15.75H3.74989ZM5.24989 13.5H12.7499L10.1999 10.5H7.79989L5.24989 13.5ZM3.74989 14.25H14.2499L9.74989 8.775V3.75H8.24989V8.775L3.74989 14.25Z",fill:"currentColor"}))))},Jk=o=>{let{mode:e,buttonSize:t="small",sx:r,tooltipProps:n,...i}=o,{t:a}=v(),{userSettings:s}=en(),{betaSettings:l}=Sr(),{loaded:c,features:u}=B_(),[p,m]=(0,No.useState)(!1),[d,h]=(0,No.useState)(void 0),f=(0,No.useMemo)(()=>e||(Ma()?"lite":"full"),[e]),_=(0,No.useMemo)(()=>He(Ef).map(I=>(I.enabled=!1,I.hasBetaFeatureAccess=!1,c&&u[I.betaFeature]&&I.betaFeature==="enabled_artifacts"&&(I.enabled=s?.features?.artifacts?.enabled,I.hasBetaFeatureAccess=!0),I)).filter(I=>I.hasBetaFeatureAccess),[u,c,s,l?.appearance_v2_enabled]),x=_.find(I=>I.enabled),C=I=>{let E=_.find(O=>O.hasBetaFeatureAccess),P=I||E?.betaFeature;P&&(h(P),m(!0))},w={mode:f,open:p,selectedBetaFeature:d,handleSelectBetaFeature:I=>{h(I)},betaFeatureOptions:_,openBetaFeature:C,closeBetaFeature:()=>{h(void 0),m(!1)}};return _.find(I=>I.hasBetaFeatureAccess)?No.default.createElement(_s.Provider,{value:w},t==="small"?No.default.createElement(ks,{"data-testid":"maxai--chat--beta-features-button",title:a("package__features:beta_features__toggle_button__title"),tooltipProps:{disableInteractive:!0,...n},color:"primary",sx:{position:"relative",...r},onClick:()=>{C()},...i},No.default.createElement(L,{component:"svg",sx:{position:"absolute",opacity:x?1:0,top:"4px",right:"4px",width:"6px",height:"6px",borderRadius:"50%",bgcolor:"currentColor",color:"inherit"}}),No.default.createElement(kS,{sx:{fontSize:"20px"}})):No.default.createElement(ks,{"data-testid":"maxai--chat--beta-features-button",onClick:()=>{C()},color:"primary",sx:{position:"relative",width:"100%",justifyContent:"flex-start",padding:"8px 10px",height:"unset",gap:"12px",display:"flex",alignItems:"center","& > :not(div)":{flexShrink:0}},...i},No.default.createElement(L,{component:"svg",sx:{position:"absolute",opacity:x?1:0,top:"4px",left:"28px",width:"6px",height:"6px",borderRadius:"50%",bgcolor:"currentColor",color:"inherit"}}),No.default.createElement(kS,{sx:{fontSize:"20px"}}),No.default.createElement(T,{component:"div",flex:1,width:0,fontSize:"14px",color:"inherit",fontWeight:400,textAlign:"left"},a("package__features:beta_features__toggle_button__title"))),No.default.createElement(AS,null)):null},OS=Jk;var wg=S(bi()),Go=S(M()),eL=o=>Go.default.createElement(wg.default,{...o},Go.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Go.default.createElement("mask",{id:"mask0_240_14735",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"20",height:"20"},Go.default.createElement("rect",{width:"20",height:"20",fill:"#D9D9D9"})),Go.default.createElement("g",{mask:"url(#mask0_240_14735)"},Go.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.95161 15.5565C3.24536 15.8502 3.59849 15.9971 4.01099 15.9971H16.011C16.4235 15.9971 16.7766 15.8502 17.0704 15.5565C17.3641 15.2627 17.511 14.9096 17.511 14.4971V5.5C17.511 5.0875 17.3641 4.73438 17.0704 4.44063C16.7766 4.14688 16.4235 4 16.011 4H4.01099C3.59849 4 3.24536 4.14688 2.95161 4.44063C2.65786 4.73438 2.51099 5.0875 2.51099 5.5V14.4971C2.51099 14.9096 2.65786 15.2627 2.95161 15.5565ZM16.011 14.4971H4.01099V7.75001H16.011V14.4971ZM4.01172 5.90688C4.01172 5.58379 4.27364 5.32188 4.59672 5.32188C4.91981 5.32188 5.18172 5.58379 5.18172 5.90688C5.18172 6.22997 4.91981 6.49188 4.59672 6.49188C4.27364 6.49188 4.01172 6.22997 4.01172 5.90688ZM5.62256 5.90688C5.62256 5.58379 5.88448 5.32188 6.20756 5.32188C6.53065 5.32188 6.79257 5.58379 6.79257 5.90688C6.79257 6.22997 6.53065 6.49188 6.20756 6.49188C5.88448 6.49188 5.62256 6.22997 5.62256 5.90688ZM7.23323 5.90688C7.23323 5.58379 7.49514 5.32188 7.81823 5.32188C8.14132 5.32188 8.40323 5.58379 8.40323 5.90688C8.40323 6.22997 8.14132 6.49188 7.81823 6.49188C7.49514 6.49188 7.23323 6.22997 7.23323 5.90688Z",fill:"currentColor"})))),tL=o=>Go.default.createElement(wg.default,{...o},Go.default.createElement("svg",{width:"21",height:"21",viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Go.default.createElement("mask",{id:"mask0_248_17101",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"21",height:"21"},Go.default.createElement("rect",{x:"0.75",y:"0.5",width:"20",height:"20",fill:"#D9D9D9"})),Go.default.createElement("g",{mask:"url(#mask0_248_17101)"},Go.default.createElement("path",{d:"M7.02758 14.223H12.2387V12.7341H7.02758V14.223ZM7.02758 11.2452H14.472V9.75634H7.02758V11.2452ZM7.02758 8.26745H14.472V6.77856H7.02758V8.26745ZM5.53869 17.2008C5.12925 17.2008 4.77874 17.055 4.48717 16.7634C4.19559 16.4718 4.0498 16.1213 4.0498 15.7119V5.28967C4.0498 4.88023 4.19559 4.52972 4.48717 4.23814C4.77874 3.94657 5.12925 3.80078 5.53869 3.80078H15.9609C16.3704 3.80078 16.7209 3.94657 17.0124 4.23814C17.304 4.52972 17.4498 4.88023 17.4498 5.28967V15.7119C17.4498 16.1213 17.304 16.4718 17.0124 16.7634C16.7209 17.055 16.3704 17.2008 15.9609 17.2008H5.53869ZM5.53869 15.7119H15.9609V5.28967H5.53869V15.7119Z",fill:"currentColor"})))),oL=o=>{let{sx:e}=o,{t}=v(),{conversationId:r,currentDocument:n,setCurrentDocument:i}=te(m=>({conversationId:m.conversationIds[0],currentDocument:m.currentDocument,setCurrentDocument:m.setCurrentDocument})),{updateConversation:a}=Ve(),{inputMediator:s}=Ce();if(!n)return null;let l=()=>{let m=!n.selected;i(d=>d?{...d,selected:m}:null),a(r,{meta:{chatSources:{enableCurrent:m}}},{syncToRemote:!1,isPartialUpdate:!0,updateUpdatedAt:!1}),s.focus()},c=n.maxAIDocumentType,u=t("package__features:chat__current_document_button__file__tooltip"),p=Go.default.createElement(mm,{chatDocument:n});return c&&c.startsWith("page_content")&&!c.includes("pdf")&&(u=t("package__features:chat__current_document_button__webpage__tooltip")),n.selected||(ao?p=Go.default.createElement(eL,null):p=Go.default.createElement(tL,null)),Go.default.createElement(me,{title:u,disableInteractive:!0},Go.default.createElement(L,null,Go.default.createElement(qa,{text:t("package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__current__title"),icon:p,mode:"normal",selected:n.selected,onClick:l,iconSx:{"& > img":{width:"20px",height:"20px",padding:"1px"}},sx:{userSelect:"none",...n.selected?{borderColor:"transparent",bgcolor:"active.main",color:"active.contrastText","&:hover":{bgcolor:"active.hover",color:"active.hoverText"}}:{},...e},...o})))},BS=oL;var DS=S(bi()),Cs=S(M()),rL=o=>Cs.default.createElement(DS.default,{...o},Cs.default.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Cs.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10.4278C3 6.87783 5.87783 4 9.42782 4C12.9778 4 15.8556 6.87783 15.8556 10.4278C15.8556 11.8691 15.3813 13.1996 14.5801 14.2717L18.729 18.4206C19.0903 18.7819 19.0903 19.3677 18.729 19.729C18.3677 20.0903 17.7819 20.0903 17.4206 19.729L13.2718 15.5801C12.1997 16.3812 10.8691 16.8556 9.42782 16.8556C5.87783 16.8556 3 13.9778 3 10.4278ZM9.42782 5.85034C6.89975 5.85034 4.85034 7.89975 4.85034 10.4278C4.85034 12.9559 6.89975 15.0053 9.42782 15.0053C11.9559 15.0053 14.0053 12.9559 14.0053 10.4278C14.0053 7.89975 11.9559 5.85034 9.42782 5.85034Z",fill:"currentColor"}))),nL=o=>{let{sx:e,...t}=o,{t:r}=v(),{check:n}=tc(),{conversationId:i,enableSearch:a,setEnableSearch:s}=te(p=>({conversationId:p.conversationIds[0],enableSearch:p.enableSearch,setEnableSearch:p.setEnableSearch})),{updateConversation:l}=Ve(),{inputMediator:c}=Ce(),u=()=>{let p=!a;p&&!n(!0)||(s(p),l(i,{meta:{chatSources:{enableSearch:p}}},{syncToRemote:!1,isPartialUpdate:!0,updateUpdatedAt:!1}),c.focus())};return Cs.default.createElement(me,{title:r("package__features:chat__enable_search_button__web__tooltip"),disableInteractive:!0},Cs.default.createElement(L,null,Cs.default.createElement(qa,{text:r("package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__search__title"),icon:Cs.default.createElement(rL,{sx:{mx:"-2px"}}),mode:"normal",selected:a,onClick:u,sx:{userSelect:"none",...a?{borderColor:"transparent",bgcolor:"active.main",color:"active.contrastText","&:hover":{bgcolor:"active.hover",color:"active.hoverText"}}:{},...e},...t})))},HS=nL;var FS=S(M());var iL=()=>{let o="feedback",{userInfo:e,subscriptionType:t}=Mt(),{syncSurveyStatus:r}=Il(!1),n=bt(r2),i=bt(n2),a=(0,FS.useMemo)(()=>!(!i||e===null||t!=="yearly"&&t!=="oneTimePayment"||n[o]),[e,t,i,o,n]);return bl(r),{loaded:i,canShowSurvey:a}},NS=iL;var VS=S(bi());var In=S(M()),aL=({sx:o})=>{let e="feedback",t=`${Zr}/survey/feedback/`,{isLogin:r}=Po(),{t:n}=v(),{canShowSurvey:i}=NS(),{syncSurveyStatus:a}=Il(!1),[s,l]=(0,In.useState)(!1),c=()=>{l(!0),window.open(t),o2("survey_card_clicked",{survey_type:e})};return bl(()=>{s&&(a(void 0,!0),l(!1))}),!r||!i?null:In.default.createElement(In.default.Fragment,null,In.default.createElement(me,{placement:"top",title:n("package__features:chat__chat_input__feedback_button__description"),disableInteractive:!0},In.default.createElement("div",null,In.default.createElement(cn,{"data-testid":"maxai--chat--feedback-button",sx:{borderRadius:1,p:"6px",bgcolor:u=>u.palette.mode==="dark"?"rgba(178, 115, 255, 0.16)":"rgba(118, 1, 211, 0.08)","&:hover":{bgcolor:u=>u.palette.mode==="dark"?"rgba(178, 115, 255, 0.24)":"rgba(118, 1, 211, 0.12)"},...o},onClick:c},In.default.createElement(sL,{sx:{fontSize:20}}),In.default.createElement(T,{ml:.5,my:0,fontSize:12,fontWeight:400,lineHeight:1.5,color:"text.primary",sx:{userSelect:"none",opacity:1}},n("package__features:chat__chat_input__feedback_button"))))))},RS=aL,sL=({sx:o})=>In.default.createElement(VS.default,{viewBox:"0 0 20 20",sx:o},In.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},In.default.createElement("path",{d:"M4.8127 6.80792H15.1877M4.8127 10.0007H15.1877M4.46686 14.0898V16.9173L8.15621 14.0898H16.5724C17.5269 14.0898 18.3002 13.3151 18.3002 12.3606V4.81315C18.3002 3.85865 17.5255 3.08398 16.571 3.08398H3.42936C2.47486 3.08398 1.7002 3.85865 1.7002 4.81315V12.3606C1.7002 13.3151 2.47486 14.0898 3.42936 14.0898H4.46686Z",stroke:"currentColor",strokeOpacity:"0.87",strokeWidth:"1.60645"})));var zS=S(M()),lL=({open:o,onClose:e,onConfirm:t})=>{let{t:r}=v();return zS.default.createElement(rs,{open:o,title:r("package__features:context_menu__lite_editor__modal__delete_all__title"),description:r("package__features:context_menu__lite_editor__modal__delete_all__description"),confirmButtonText:r("package__features:context_menu__lite_editor__modal__delete_all__button__delete"),onConfirm:t,onClose:e})},US=lL;var ov=S(Cr()),rv=S(im());var We=S(M());var Eg=S(M()),Pf=()=>{let{t:o}=v(),{refetch:e}=Lo(),t=(0,Eg.useCallback)(n=>{dt.error(n||"",{autoHideDuration:3e3})},[]);return{movePrompt:(0,Eg.useCallback)(async(n,i,a={})=>{let{optimisticUpdate:s,getSourceName:l,getTargetName:c,onSuccess:u,onError:p,onFinally:m,hasLocalUpdateRef:d}=a;s?.(n,i);try{let h=await Ao.moveContextMenuNode(n,"",i,0);if(h.data?.status==="OK"){let f=l?Fl(l(n),null,230,new Map)[0]:n,_=c?Fl(c(i),null,230,new Map)[0]:i||o("package__features:chat__inputbox__button__my_own_tools__menu__my_own_tools");t(o("package__features:chat__inputbox__my_own_tools__modal__action__move_success",{FILE_NAME:f,FOLDER_NAME:_})),u?.()}else t(h.data?.detail||h.data?.msg||"Move failed"),p?.()}catch{t("Move failed"),p?.()}finally{d&&(d.current=!1),await e(),m?.()}},[o,t,e])}};var gt=S(M()),qS=S(M());var Ep=S(M());var Pp=o=>{let e=bt(K1(o));return{isShown:(0,Ep.useMemo)(()=>e.moreButton||e.addButton||e.editButton,[e]),buttonMoreIsShown:e.moreButton,buttonAddIsShown:e.addButton,buttonEditIsShown:e.editButton}},Af=o=>{let e=Qt(K1(o)),t=(0,Ep.useCallback)(i=>{e(a=>({...a,moreButton:i}))},[e]),r=(0,Ep.useCallback)(i=>{e(a=>({...a,addButton:i}))},[e]),n=(0,Ep.useCallback)(i=>{e(a=>({...a,editButton:i}))},[e]);return{updateMoreButtonShownState:t,updateAddButtonShownState:r,updateEditButtonShownState:n}};var WS=S(R7());var Ap=S(M()),pL=({onClick:o,sx:e,item:t,...r})=>{let{t:n}=v(),{isShown:i}=Pp(t?.id??""),a=(0,Ap.useMemo)(()=>i?null:{opacity:0,pointerEvents:"none",position:"absolute"},[i]);return Ap.default.createElement(L,{className:"maxai_my_prompt_node__group__add_sources",onMouseDown:s=>{s.stopPropagation()},onMouseUp:s=>{s.stopPropagation()},onClick:s=>{s.stopPropagation()},sx:a},Ap.default.createElement(ee,{title:n("package__features:chat__inputbox__my_own_tools__modal__add_prompt_inside__tooltip"),placement:"top",tooltipProps:{disableInteractive:!0,enterNextDelay:50,placement:"top-end"},sx:e,onClick:s=>{s.stopPropagation(),o?.(s),s.currentTarget&&s.currentTarget.blur()},...r},Ap.default.createElement(WS.default,{sx:{fontSize:20}})))},GS=pL;var ha=S(M()),cL=({onClick:o,sx:e,item:t,...r})=>{let{t:n}=v(),[i,a]=(0,ha.useState)(!1),{isOpen:s,promptData:l}=Oo(),{isOpen:c,groupData:u}=Nr(),{isShown:p}=Pp(t?.id??""),{updateEditButtonShownState:m}=Af(t?.id??""),d=(0,ha.useMemo)(()=>{let h=s&&l?.prompt_id===t?.id,f=c&&u?.prompt_id===t?.id;return p||(h||f)?null:{opacity:0,pointerEvents:"none",position:"absolute"}},[p,s,l?.prompt_id,c,u?.prompt_id,t?.id]);return ha.default.useEffect(()=>{let h=s&&l?.prompt_id===t?.id,f=c&&u?.prompt_id===t?.id;m(h||f)},[s,l?.prompt_id,c,u?.prompt_id,t?.id,m]),ha.default.createElement(L,{className:"maxai_my_prompt_node__group__add_sources",onMouseDown:h=>{h.stopPropagation()},onMouseUp:h=>{h.stopPropagation()},onClick:h=>{h.stopPropagation()},sx:d},ha.default.createElement(ee,{title:n("package__common:edit"),placement:"top",tooltipProps:{disableInteractive:!0,enterNextDelay:50,placement:"top-end"},sx:e,loading:i,onClick:async h=>{if(h.stopPropagation(),o){a(!0);try{await o(h)}catch{}finally{a(!1)}}h.currentTarget&&h.currentTarget.blur()},...r},ha.default.createElement(z,{icon:"DefaultIcon"})))},KS=cL;var Kr=S(M());var Xs=S(M()),uL=({isFolder:o,onClickRename:e,onClickMove:t,onClickDelete:r,onCloseMenuList:n})=>{let{t:i}=v(),a=(0,Xs.useMemo)(()=>{let s=[];return o?s.push({value:"rename",icon:Xs.default.createElement(z,{icon:"DefaultIcon"}),label:i("package__common:rename"),divider:!0}):s.push({value:"move",icon:Xs.default.createElement(z,{icon:"Move"}),label:i("package__features:project__move_target_modal__button__move"),divider:!0}),s.push({value:"delete",icon:Xs.default.createElement(z,{icon:"Delete",sx:{color:"rgba(255, 14, 39, 1)!important"}}),label:i("package__common:delete"),labelSx:{color:"rgba(255, 14, 39, 1)!important"}}),s},[o,i]);return Xs.default.createElement(vi,{placement:"bottom-end",offset:{top:0,right:0,bottom:0,left:0},options:a,sx:{width:"248px",gap:"4px"},onSelectOption:async s=>{s==="rename"?(e?.(),n()):s==="move"?(t?.(),n()):s==="delete"&&(r?.(),n())}})},jS=uL;var mL=o=>{let{itemId:e,onClickDelete:t,onClickRename:r,onClickMove:n,onOpenChanged:i,closeTooltip:a,sx:s,title:l,isFolder:c,tooltipProps:u,containerSx:p}=o,[m,d]=(0,Kr.useState)(null),h=(0,Kr.useRef)(null),[f,_]=(0,Kr.useState)("bottom"),x=!!m,{isOpen:C,promptData:y}=Oo(),{isOpen:b,groupData:w}=Nr(),{isShown:I}=Pp(e??""),{updateMoreButtonShownState:E}=Af(e??""),P=(0,Kr.useMemo)(()=>{let V=C&&y?.prompt_id===e,A=b&&w?.prompt_id===e;return I||(V||A)?null:{opacity:0,pointerEvents:"none",position:"absolute"}},[I,C,y?.prompt_id,b,w?.prompt_id,e]);(0,Kr.useEffect)(()=>{let V=C&&y?.prompt_id===e,A=b&&w?.prompt_id===e;E(x||(V||A))},[x,C,y?.prompt_id,b,w?.prompt_id,e,E]);let O=V=>{let A=V.getBoundingClientRect();return window.innerHeight-A.bottom>=150?"bottom":"top"},N=()=>{d(null),i?.(!1),setTimeout(()=>{a?.()},500)};return Kr.default.createElement(L,{className:"maxai_my_prompt_node__tree_more_actions",onMouseDown:V=>{V.stopPropagation()},onMouseUp:V=>{V.stopPropagation()},onClick:V=>{V.stopPropagation()},sx:{...P,...p}},Kr.default.createElement(ee,{ref:h,title:l,tooltipProps:{disableInteractive:!0,disableFocusListener:!0,arrow:!0,placement:"top-end",...u},sx:s,onClick:V=>{V.stopPropagation();let A=V.currentTarget,D=O(A);_(D),d(A),i?.(!0)}},Kr.default.createElement(z,{icon:"More",size:20})),Kr.default.createElement(An,{disableScrollLock:!0,anchorOrigin:{vertical:f==="bottom"?"bottom":"top",horizontal:"right"},transformOrigin:{vertical:f==="bottom"?"top":"bottom",horizontal:"right"},anchorEl:m,open:x,onClose:N,slotProps:{paper:{elevation:0,sx:{overflow:"unset",background:"transparent"}}}},Kr.default.createElement(jS,{isFolder:c,onClickDelete:t,onClickRename:r,onClickMove:n,onCloseMenuList:N})))},$S=mL;var XS=o=>o.sort((e,t)=>e.type!==t.type?e.type==="group"?-1:1:(e.name??"").localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"})),YS=(o,e,t,r=new Map)=>{let n=o.map(i=>{let a={id:i.prompt_id,name:i.prompt_title,type:i.type==="group"?"group":"item",parentId:e?.id||null,metadata:i};return a.type==="group"&&t.add(a.id),i.children&&i.children.length>0&&YS(i.children,a,t,r),r.set(i.prompt_id,a),a});return e&&(e.children=XS(n)),{parentDataItem:e,treeDataFlatMap:r}},ZS=(0,gt.forwardRef)((o,e)=>{let{liteContextMenuActionsItems:t,rootLiteContextMenu:r,disabledTooltip:n,sx:i,onClose:a,isSearchMode:s=!1,highlightedItemId:l,setHighlightWithAutoClear:c,onClickMove:u}=o,{t:p}=v(),{createNewPrompt:m,editPrompt:d,openDeletePromptConfirm:h}=Oo(),{editGroup:f,openDeleteGroupConfirm:_}=Nr(),{askAIWithShortcutsV2:x}=Re(),{movePrompt:C}=Pf(),y=(0,gt.useRef)(null),[b,w]=(0,gt.useState)(null);(0,gt.useEffect)(()=>{},[t]);let[I,E]=(0,gt.useState)(null),P=(0,gt.useRef)(new Map),O=(0,gt.useRef)(!1),{openedGroups:N}=(0,qS.useMemo)(()=>{let H=new Set,{parentDataItem:R,treeDataFlatMap:F}=YS(t,{id:r.prompt_id,name:p("package__features:chat__inputbox__my_own_tools__modal__title"),type:"group",parentId:null,metadata:r},H,P.current);return E(R),P.current.set(r.prompt_id,R),F.forEach((Y,$)=>{P.current.set($,Y)}),{openedGroups:H}},[t,r,p]),V=(0,gt.useCallback)(H=>({...H.id===b&&{backgroundColor:R=>R.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)"},...H.id===l&&{backgroundColor:R=>R.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.06)"},"&:hover":{".maxai_my_prompt_node__tree_more_actions":{opacity:1,pointerEvents:"auto",position:"static"},".maxai_my_prompt_node__group__add_sources":{opacity:1,pointerEvents:"auto",position:"static"}},pr:"4px",pl:"16px",my:"2px",height:"44px"}),[b,l]),A=(0,gt.useCallback)((H,R)=>H.type==="group"?gt.default.createElement(Xa,{size:20,isExpand:R}):gt.default.createElement(z,{sx:{color:"text.secondary",flexShrink:0},icon:um(H.metadata.prompt_icon),size:20}),[]),D=(0,gt.useCallback)((H,R)=>{let F="actions"in H.metadata?H.metadata.origin:H.metadata;return gt.default.createElement(g,{alignItems:"center",direction:"row",gap:"2px"},gt.default.createElement($S,{isFolder:H.type==="group",title:H.type==="group"?p("package__features:chat__inputbox__my_own_tools__modal__group_more_actions_button__tooltip"):p("package__features:chat__inputbox__my_own_tools__modal__prompt_more_actions_button__tooltip"),tooltipProps:{open:n?!1:void 0,disabled:n,enterNextDelay:50},itemId:H.id,onClickDelete:()=>{F&&(H.type==="group"?_(F):h(F))},onClickRename:()=>{F&&f(F)},onClickMove:()=>{u?.(H.metadata)},closeTooltip:R,onOpenChanged:Y=>{w(Y?H.id:null)}}),H.type==="group"?gt.default.createElement(GS,{item:H,onClick:()=>{m({parent_prompt_id:H.id,prompt_icon:"Shuriken"},{createSuccessCallback:Y=>{y.current?.toggleGroup(H.id,!0),Y&&c?.(Y.prompt_id)}})}}):gt.default.createElement(KS,{item:H,onClick:async()=>{F&&await d(F)}}))},[p,n,d,_,h,f,m,c]),W=(0,gt.useCallback)(H=>({...H,children:H.children?.map(R=>W(R))}),[]),k=(0,gt.useCallback)((H,R)=>{let F=P.current.get(H);if(!F)return;let Y=F.parentId||"";E($=>{if(!$)return null;let ie=W($),G=new Map,B=ue=>{G.set(ue.id,ue),ue.children&&ue.children.forEach(Z=>B(Z))};B(ie);let ae=G.get(H),X=G.get(Y),oe=G.get(R);return ae?(ae.parentId=R,X&&(X.children=X.children?.filter(ue=>ue.id!==H)||[]),oe&&(oe.children=oe.children||[],oe.children.push(ae),oe.children=XS(oe.children)),P.current=G,ie):$})},[W]);(0,gt.useImperativeHandle)(e,()=>({moveItemInLocal:k}),[k]);let U=(0,gt.useCallback)((H,R)=>{let F=H[0],Y=R.id,$=P.current.get(F);$&&C(F,Y,{optimisticUpdate:k,getSourceName:()=>$.name,getTargetName:()=>R.name,hasLocalUpdateRef:O})},[k,C,O]),K=(0,gt.useCallback)(async H=>{H.type==="item"&&await Fe({emitEvent:!0})&&H.metadata.actions&&(a?.(),await x(H.metadata.actions,{isClearInput:!0,isFocusInput:!0}))},[x,a]);return(0,gt.useEffect)(()=>{},[I]),(0,gt.useEffect)(()=>{if(l&&I){let H=setTimeout(()=>{y.current?.scrollToItemIfNotVisible(l)},100);return()=>clearTimeout(H)}},[l,I]),I&&gt.default.createElement(Em,{itemHeight:44,ref:y,temporarilyOpenAllChildren:s,disableToggleGroup:s,disabledGroupDrag:!0,rootItem:I,defaultOpenedGroups:N,slotItemRight:D,slotTitleLeft:A,onItemMove:U,onItemClick:K,hideCheckbox:!0,itemSx:V,groupChildrenContainerSx:{pl:"8px"},edgeDropZoneWidth:8,sx:i})});ZS.displayName="MyToolsTreeView";var QS=ZS;var ev=S(Cr());var Er=S(M());var Gn=S(M());var dL=(o,e,t,r)=>{let i=o.filter(s=>s.type==="group").map(s=>({...s,canMove:s.prompt_id!==e.parent_prompt_id,isRoot:!1})).sort((s,l)=>s.prompt_title.localeCompare(l.prompt_title,void 0,{numeric:!0,sensitivity:"base"})),a=t?{...t,prompt_title:r("package__features:chat__inputbox__button__my_own_tools__menu__my_own_tools"),canMove:e.parent_prompt_id!==t.prompt_id,isRoot:!0}:null;return a?[a,...i]:i},fL=o=>{let{sx:e,movePrompt:t,onMoveConfirm:r}=o,{t:n}=v(),{originLiteContextMenuList:i,rootLiteContextMenu:a}=Lo(),s=(0,Gn.useMemo)(()=>dL(i,t,a,n),[i,t,a,n]),l=(0,Gn.useCallback)(c=>u=>{u.stopPropagation(),c.canMove&&r?.(c.prompt_id)},[r]);return Gn.default.createElement(g,{sx:{height:"100%",overflow:"auto",...e}},s.map(c=>Gn.default.createElement(L,{key:c.prompt_id,sx:{display:"flex",alignItems:"center",height:"36px",minHeight:"36px",borderRadius:1,fontSize:14,mx:2,my:.25,px:1,overflow:"hidden",whiteSpace:"nowrap",...!c.canMove&&{opacity:.5,"&:hover":{backgroundColor:"transparent"}},"&:hover":{backgroundColor:u=>u.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)","& .move-button":{opacity:1}},transition:"all 0.2s ease-in-out"}},!c.isRoot&&Gn.default.createElement(Xa,{sx:{fontSize:20,mr:1.5}}),Gn.default.createElement(wm,{text:c.prompt_title,tip:c.prompt_title,resizeListener:!0,sx:{flex:1,fontSize:14,color:"text.primary",fontWeight:400,overflow:"hidden",wordBreak:"break-all",...c.isRoot&&{ml:0}}}),Gn.default.createElement(me,{title:n("package__features:chat__inputbox__my_own_tools__modal__move_target_modal__already_in_this_folder"),disabled:c.canMove,disableInteractive:!0,leaveDelay:0,PopperProps:{style:{zIndex:99999}}},Gn.default.createElement(L,null,Gn.default.createElement(le,{className:"move-button",variant:"contained",size:"small",disabled:!c.canMove,onClick:l(c),sx:{height:"32px",mx:.5,minWidth:"51px",padding:"6px 0",borderRadius:9999,fontSize:"14px",lineHeight:"140%",fontWeight:500,opacity:0,transition:"opacity 0.2s ease-in-out"}},n("package__features:project__move_target_modal__button__move")))))))},JS=fL;var hL=o=>{let{open:e,onClose:t,onConfirm:r,movePrompt:n,title:i}=o,{t:a}=v(),s=(0,Er.useCallback)(p=>{r(p)},[r]),l=(0,Er.useCallback)(()=>{t()},[t]);(0,Er.useEffect)(()=>{let p=m=>{m.key==="Escape"&&e&&(m.stopPropagation(),m.preventDefault(),l())};return e&&document.addEventListener("keydown",p,!0),()=>{document.removeEventListener("keydown",p,!0)}},[e,l]);let c=(0,Er.useMemo)(()=>n?`${a("package__features:project__move_target_modal__button__move")} "${n.prompt_title}"`:"",[n,a]);return Er.default.createElement(Tm,{show:e,onClose:l,hideDefaultCloseBtn:!0,width:"616px",height:"484px",maxWidth:"calc(100vw - 32px)",modalSx:{zIndex:9999},sx:{maxHeight:"calc(100vh - 32px)",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:0,display:"flex",flexDirection:"column",bgcolor:p=>p?.palette?.mode==="dark"?"rgb(44, 44, 44) !important":"#FFFFFF"}},Er.default.createElement(g,{sx:{height:"100%",display:"flex",flexDirection:"column"}},Er.default.createElement(ee,{sx:{position:"absolute",top:16,right:16,zIndex:1,"& svg":{fontSize:"24px"}},onClick:l},Er.default.createElement(ev.default,null)),Er.default.createElement(g,{sx:{p:3,flexDirection:"row",borderBottom:p=>`1px solid ${p.palette.divider}`}},Er.default.createElement(T,{sx:{fontWeight:500,fontSize:20,pr:5,lineHeight:"120%",color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"}},i||c)),Er.default.createElement(g,{sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",py:1}},n&&n.origin&&Er.default.createElement(JS,{movePrompt:n.origin,onMoveConfirm:s,sx:{overflow:"auto"}}))))},tv=hL;var gL=({sx:o,onClose:e})=>{let{t}=v(),r=(0,We.useRef)(null),n=(0,We.useRef)(null),i=(0,We.useRef)(!1);(0,We.useEffect)(()=>{if(r.current){let k=setTimeout(()=>{r.current?.focus()},500);return()=>clearTimeout(k)}},[]);let[a,s]=(0,We.useState)(""),{liteContextMenuActionsItems:l,rootLiteContextMenu:c}=Bi(a,{contextMenuPath:"/my_own_tools",enabledFavorite:!1}),u=!!a,{createNewPrompt:p}=Oo(),{createNewGroup:m}=Nr(),[d,h]=(0,We.useState)(!1),{originLiteContextMenuList:f,refetch:_}=Lo(),{movePrompt:x}=Pf(),[C,y]=(0,We.useState)(!1),[b,w]=(0,We.useState)(null),[I,E]=(0,We.useState)(void 0),P=()=>{E(void 0)},O=(k,U=3e3)=>{E(k),setTimeout(()=>{P()},U)};(0,We.useEffect)(()=>{if(!I)return;let k=()=>{P()};return document.addEventListener("click",k),document.addEventListener("keydown",k),()=>{document.removeEventListener("click",k),document.removeEventListener("keydown",k)}},[I]);let N=()=>{h(!0)},V=()=>{h(!1)},A=async()=>{let k=l.map(K=>K.prompt_id),U=await Ao.deleteContextMenuNodes(k);if(U&&U.success&&U.data?.data){try{let K=Ei.getService("CONTEXT_MENU_SUGGEST");for(let H of k)await K.removeUsageRecord(H)}catch{}dt.error(t("package__features:chat__inputbox__my_own_tools__modal__all_prompts__delete_success"))}else dt.error(t("package__features:chat__inputbox__my_own_tools__modal__delete_error"));return await _("onConfirmDeleteAllPrompt"),!0},D=async k=>{y(!1);let U=b;if(w(null),O(U?.prompt_id||"",5e3),!U)return;let K=F=>U.prompt_title||F,H=F=>!F||F===c?.prompt_id?t("package__features:chat__inputbox__button__my_own_tools__menu__my_own_tools"):f.find($=>$.prompt_id===F)?.prompt_title||F,R=(F,Y)=>{u&&!l.some($=>$.prompt_id===Y)||n.current?.moveItemInLocal(F,Y)};await x(U.prompt_id,k,{optimisticUpdate:R,getSourceName:K,getTargetName:H})},W=k=>{w(k),y(!0)};return We.default.createElement(g,{sx:{height:"100%",overflow:"hidden",...o},tabIndex:-1},We.default.createElement(g,{direction:"row",alignItems:"center",sx:{p:2,gap:1,borderBottom:"1px solid",borderColor:"border.main"}},We.default.createElement(Lt,{onCopy:k=>{k.stopPropagation()},onCut:k=>{k.stopPropagation()},onPaste:k=>{k.stopPropagation()},onKeyUpCapture:k=>{k.key!=="Escape"&&k.stopPropagation()},onKeyDownCapture:k=>{(k.key!=="Escape"||i.current)&&k.stopPropagation()},onCompositionStart:()=>{i.current=!0},onCompositionEnd:k=>{i.current=!1,s(k.target.value)},fullWidth:!0,inputRef:r,placeholder:t("package__features:chat__inputbox__my_own_tools__modal__search_placeholder"),inputProps:{autocomplete:"off"},sx:{[`&  .${Ji.input}`]:{boxSizing:"border-box",height:"32px",p:0,pl:1,fontSize:"16px",lineHeight:"1.5",fontWeight:400},[`& > .${Ji.root} > fieldset`]:{borderColor:"transparent !important"}},onChange:k=>{i.current||s(k.target.value)}}),We.default.createElement(je,{onClick:e,sx:{p:"6px"}},We.default.createElement(ov.default,{sx:{color:"text.secondary"}}))),!u&&We.default.createElement(g,{p:1,pb:0},We.default.createElement(le,{onClick:()=>p({prompt_icon:"Shuriken"},{createSuccessCallback:k=>{k&&O(k.prompt_id)}}),sx:{justifyContent:"flex-start",gap:2,px:2,py:1.5}},We.default.createElement(yx,{sx:{fontSize:20,color:"text.primary"}}),We.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},t("package__features:chat__inputbox__my_own_tools__modal__new_prompt")))),!u&&We.default.createElement(g,{p:1,py:"6px",pr:1.5,direction:"row",alignItems:"center"},We.default.createElement(T,{fontSize:12,lineHeight:1.5,color:"text.secondary",fontWeight:500,textAlign:"left",p:1,flex:1},t("package__features:chat__inputbox__my_own_tools__modal__title")),We.default.createElement(g,{direction:"row",gap:"2px",alignItems:"center"},We.default.createElement(ee,{optionsMenuTriggerMode:"click",title:t("package__features:chat__inputbox__my_own_tools__modal__root_more_actions_button__tooltip"),placement:"bottom-end",tooltipProps:{disableInteractive:!0,disableFocusListener:!0,arrow:!0,placement:"top-end"},sx:o,OptionsCardProps:{sx:{width:"248px"}},onClick:k=>{k.stopPropagation()},onSelectOption:k=>{k==="delete"&&N()},options:[{value:"delete",icon:We.default.createElement(z,{icon:"Delete",sx:{color:l.length===0?"text.disabled":"rgba(255, 14, 39, 1)!important"}}),label:t("package__features:context_menu__lite_editor__modal__delete_all_prompts__button__delete"),labelSx:{color:l.length===0?"text.disabled":"rgba(255, 14, 39, 1)!important"},disabled:l.length===0}]},We.default.createElement(z,{icon:"More",size:20})),We.default.createElement(US,{open:d,onClose:V,onConfirm:A}),We.default.createElement(ee,{title:t("package__features:chat__inputbox__my_own_tools__modal__new_folder_button__tooltip"),tooltipProps:{disableInteractive:!0,disableFocusListener:!0,arrow:!0,placement:"top-end"},sx:o,onClick:k=>{k.stopPropagation(),m({prompt_title:t("package__features:project__add_sources__modal__create_folder_modal__input_default_value")},{onSuccess:U=>{U&&O(U.prompt_id)}})}},We.default.createElement(Ou,{sx:{fontSize:20}})))),l.length===0&&(u?We.default.createElement(g,{sx:{flexDirection:"row",justifyContent:"flex-start",gap:2,px:2,py:1.5}},We.default.createElement(rv.default,{sx:{color:k=>k.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.38)"}}),We.default.createElement(T,{sx:{fontSize:14,lineHeight:1.5,fontWeight:400,textAlign:"left",color:k=>k.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.38)"}},t("package__features:chat__inputbox__my_own_tools__modal__search_no_data"))):We.default.createElement(g,{sx:{height:"50px",justifyContent:"center",alignItems:"center"}},We.default.createElement(T,{sx:{fontSize:14,lineHeight:1.5,fontWeight:400,textAlign:"left",color:k=>k.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.38)"}},t("package__features:chat__inputbox__my_own_tools__modal__no_data")))),We.default.createElement(g,{sx:{flex:1,height:"0",overflow:"auto",paddingBottom:"16px"}},c&&We.default.createElement(QS,{ref:n,liteContextMenuActionsItems:l,rootLiteContextMenu:c,onClose:e,isSearchMode:u,highlightedItemId:I,setHighlightWithAutoClear:O,onClickMove:W})),We.default.createElement(tv,{open:C,onClose:()=>{y(!1),w(null)},onConfirm:D,movePrompt:b}))},nv=gL;var kf=S(M()),xL=({open:o,onClose:e})=>(lm((t,r)=>{t==="SyncContextMenuConversationInSidebar"&&o&&e?.()}),kf.default.createElement(Pa,{open:o,onClose:e,anchor:"bottom",sx:{zIndex:1502,position:"absolute",[`& .${Ea.paper}`]:{position:"absolute",borderTopRightRadius:16,borderTopLeftRadius:16,height:"90vh",bgcolor:"background.paper"}},disableEnforceFocus:!0,disableRestoreFocus:!0,slotProps:{backdrop:{sx:{position:"absolute"}}}},kf.default.createElement(_r,{tabIndex:-1,onKeyDown:t=>{o&&t.key==="Escape"&&e?.()},elevation:0,sx:{boxSizing:"border-box",width:"100%",height:"100%",borderRadius:0}},o&&kf.default.createElement(nv,{onClose:e})))),iv=xL;var Lf=S(M()),_L=o=>{let[e,t]=(0,Lf.useState)(!1),{inputMediator:r}=Ce(),{chatHubLoading:n}=rt();return Lf.default.createElement(xf,{disabled:n,open:e,onOpenChange:t,className:"max-ai__actions__button--use-max-ai",message:()=>r.getInputValue(),platformFeatureCover:"sidebar_input_rewrite",...o})},Of=_L;var Io=S(M()),CL=()=>{let{t:o}=v(),{inputMediator:e}=Ce(),{selectedType:t,changeMyOwnToolsType:r,resetMyOwnToolsType:n}=Hr(),{chatHubLoading:i}=rt(),{chatScreenshots:a}=Ip(),[s,l]=(0,Io.useState)(!1),[c,u]=(0,Io.useState)(!1),p={SUGGESTED:"PromptMyOwnTools",MY_OWN_TOOLS:"PromptMyOwnTools",REWRITE:"Rewrite"},{changeContextMenuPath:m,changeMode:d}=lo(),{rewriteDisabled:h}=dC(),{conversationId:f}=ki(),_=er(f),x=(0,Io.useRef)(),C=(0,Io.useMemo)(()=>a.some(D=>["uploading","pending"].includes(D.status)),[a]),y=(0,Io.useMemo)(()=>s?!0:t!=="SUGGESTED",[s,t]),b=(0,Io.useMemo)(()=>[{value:"MY_OWN_TOOLS",testid:"maxai--chat-my-own-tools-button--my-own-tools",label:o("package__features:chat__inputbox__button__my_own_tools__menu__my_own_tools"),icon:Io.default.createElement(z,{icon:"PromptMyOwnTools"})},{value:"REWRITE",testid:"maxai--chat-my-own-tools-button--rewrite",label:o("package__features:chat__inputbox__button__my_own_tools__menu__rewrite"),title:h?o("package__features:home_view__chat_with_any_content__tab__rewrite__disabled_title"):null,disabled:h,ButtonProps:{key:`REWRITE-${h}`,tooltipProps:{placement:"right",disabled:!1}},icon:Io.default.createElement(z,{icon:"Rewrite"})}],[o,h]),w=(0,Io.useMemo)(()=>b.find(D=>s?D.value==="REWRITE":D.value===t),[s,t,b]),I=D=>{let W=D;t===W?n():r(W),e.updateInputValue(""),e.focus()},E=()=>{u(!0);let D=D1("MY_OWN_TOOLS");D&&m(D)},P=()=>{u(!1),m(null)};(0,Io.useEffect)(()=>{let D=D1(t);m(D||null),d("list")},[t]);let O=(0,Io.useRef)(!1),{refetch:N,clearRootLiteContextMenu:V}=Lo("/my_own_tools");_m(V);let{isLogin:A}=Po();return Io.default.createElement(L,{ref:x,position:"relative"},Io.default.createElement(ks,{disabled:i||C,testid:"maxai--chat-my-own-tools-button",defaultOptionValue:"MY_OWN_TOOLS",options:y?void 0:b,closePopoverOnClick:!0,title:y?o(s?"package__features:chat__inputbox__button__my_own_tools__menu__rewrite":"package__features:chat__inputbox__button__my_own_tools__menu__my_own_tools"):null,tooltipProps:{disableInteractive:!0},placement:_.length===0?"bottom-end":"top-end",onClick:async()=>{let D=!A;if(y)n();else{if(!await Fe({emitEvent:!0}))return;D&&(await Ao.forceRefresh(),await N()),E()}},onSelectOption:async D=>{if(D==="REWRITE")l(!0);else if(D==="MY_OWN_TOOLS"){if(!await Fe({emitEvent:!0}))return;E(),O.current||(O.current=!0,N("FirstClickMyToolsButton"))}else I(D)},OptionsCardProps:{sx:{width:"144px",marginLeft:"-12px"}},sx:{height:"32px",lineHeight:1.5,...y?{padding:"0 6px",gap:"6px",fontSize:"14px",bgcolor:"active.main",color:"active.contrastText","&:hover":{bgcolor:"active.hover",color:"active.hoverText"}}:{}}},Io.default.createElement(z,{icon:s?p.REWRITE:p[t]||p.SUGGESTED,sx:{...y?{color:"inherit !important"}:{}}})),Io.default.createElement(iv,{open:c,onClose:P}),Io.default.createElement(Of,{sx:{position:"absolute",top:0,left:0,opacity:0,zIndex:-1},open:s,onOpenChange:l,menuPlacement:"bottom-end",menuFallbackPlacements:["top-end"],tooltipPlacement:"top"}))},av=CL;w7();E7();var ga=S(M()),sv=S(Vp()),yL=o=>{let{rootContainer:e,customElementName:t,children:r,style:n,checkVisibility:i=!0,onSetContainer:a}=o,[s,l]=(0,ga.useState)(null),c=(0,ga.useRef)(null);return(0,ga.useEffect)(()=>{if(e&&!s){if(i&&!cl(e))return;let u="customElements"in window,p=document.createElement(u?t:"div");n&&(p.style.cssText=n),e.insertBefore(p,e.firstChild);let m=p.attachShadow({mode:"open"}),d=document.createElement("style"),h=document.createElement("div");m.appendChild(d),m.appendChild(h);let f=String(t).toLowerCase().replace(/_/g,"-");c.current=G0({key:`${f}-emotion-cache`,prepend:!0,container:d}),l(_=>(_&&_.getRootNode()?.host?.remove(),h))}else s&&!e&&l(null);return()=>{}},[e,s,t,i,n]),(0,ga.useEffect)(()=>{a&&s&&a(s)},[s,a]),!s||!c.current?null:(0,sv.createPortal)(ga.default.createElement(K0,{value:c.current},r),s)},lv=yL;var cv=S(U7());var Pr=S(M());var Bf=S(M()),Ys=S(M()),bL=o=>{let{onChange:e}=o,[t,r]=(0,Ys.useState)(!1),n=(0,Ys.useRef)([0,0]),[i,a]=(0,Ys.useState)([0,0,0,0]),s=p=>{n.current=[p.clientX,p.clientY],r(!0)},l=p=>{if(t){let[m,d]=n.current,[h,f]=[p.clientX,p.clientY],[_,x,C,y]=[Math.min(m,h),Math.min(d,f),Math.abs(m-h),Math.abs(d-f)];a([_,x,C,y])}},c=async p=>{r(!1);let m=await o.getScreenshot();if(m){let d=document.createElement("canvas"),h=d.getContext("2d"),f=new Image;f.src=m,f.onload=()=>{let _=window.innerWidth,x=f.naturalWidth/_,[C,y,b,w]=i.map(E=>E*x);d.width=b,d.height=w,h?.drawImage(f,C,y,b,w,0,0,b,w);let I=d.toDataURL("image/png");d.toBlob(async E=>{if(E)e?.({image:I,rect:i,imageFile:new File([E],"screenshot.png",{type:"image/png"})});else{let P=await m0(I,"screenshot.png");e?.({image:I,rect:i,imageFile:P})}})}}},u=(0,Ys.useMemo)(()=>{let[,,p,m]=[0,0,window.innerWidth,window.innerHeight],[d=0,h=0,f=0,_=0]=i;return[[0,0,f+d,h],[d+f,0,p-d-f,h+_],[0,h,d,m-h],[d,h+_,p-d,m-h-_]]},[i]);return Bf.default.createElement(L,{onMouseDown:s,onMouseMove:l,onMouseUp:c,position:"fixed",sx:{width:"100vw",height:"100vh",top:0,left:0,zIndex:2147483647,cursor:"crosshair"}},Bf.default.createElement(L,{sx:{position:"absolute",top:`${i[1]}px`,left:`${i[0]}px`,width:`${i[2]}px`,height:`${i[3]}px`,outline:"3px dashed",outlineColor:"#9065B0"}}),u.map((p,m)=>Bf.default.createElement(L,{key:p.join(","),sx:{position:"absolute",top:p[1],left:p[0],width:p[2],height:p[3],backgroundColor:"rgba(0,0,0,0.3)"}})))},pv=bL;var IL=o=>{let{getScreenshot:e,disabled:t,tooltip:r,sx:n}=o,i=Pr.default.useRef(null),{t:a}=v(),[s,l]=(0,Pr.useState)(null),{uploadChatScreenshotFiles:c}=gg(),{chatHubLoading:u}=rt(),{isUnavailableUploadSource:p}=Hr(),m=t??(u||p);(0,Pr.useEffect)(()=>{function f(_){if(_.key==="Escape"){s?.remove(),l(null),o.onCropEnd?.();return}}return s&&window.addEventListener("keydown",f,!0),()=>{window.removeEventListener("keydown",f,!0)}},[s]);let d=(0,Pr.useMemo)(()=>r||(p?a("package__features:chat__inputbox__button__ai_screenshot__rewrite_disabled_tooltip"):m?"":a("package__features:chat__inputbox__button__ai_screenshot__tooltip")),[r,a,p,m]);return Pr.default.createElement(Pr.default.Fragment,null,Pr.default.createElement(me,{placement:"top",title:d,disableInteractive:!0},Pr.default.createElement(L,null,Pr.default.createElement(ee,{buttonRefBind:f=>i.current=f,disabled:m,"data-testid":"maxai-take-screenshot",tooltipProps:{disableInteractive:!0},onClick:async()=>{if(!await Fe({emitEvent:!0})||!v0("7.4.1"))return;o.onCropStart?.();let f=document.createElement("div");f.style.width="100vw",f.style.height="100vh",f.style.position="fixed",f.style.zIndex="2147483647",document.body.appendChild(f),l(f)},sx:n},Pr.default.createElement(cv.default,{sx:{transform:"rotate(-90deg)",fontSize:"20px"}})))),s&&!m&&Pr.default.createElement(lv,{customElementName:"max-ai-screenshot",rootContainer:s},Pr.default.createElement(pv,{getScreenshot:e||(()=>dl.getCurrentTabScreenshot()),onChange:async({imageFile:f})=>{if(s?.remove(),l(null),o.onCropEnd?.(),o.onFile){o.onFile(f);return}await c([f])}})))},uv=IL;var mv=S(bi());var to=S(M());var SL=()=>to.default.createElement(mv.default,null,to.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},to.default.createElement("path",{d:"M10.7698 4.27077C10.7698 3.84616 10.4256 3.50195 10.001 3.50195C9.57637 3.50195 9.23216 3.84616 9.23216 4.27077V9.23314H4.26979C3.84519 9.23314 3.50098 9.57735 3.50098 10.002C3.50098 10.4266 3.84519 10.7708 4.26979 10.7708H9.23216V15.7331C9.23216 16.1577 9.57637 16.502 10.001 16.502C10.4256 16.502 10.7698 16.1577 10.7698 15.7331V10.7708H15.7322C16.1568 10.7708 16.501 10.4266 16.501 10.002C16.501 9.57735 16.1568 9.23314 15.7322 9.23314H10.7698V4.27077Z",fill:"currentColor"}))),vL=o=>{let{sx:e,...t}=o,{t:r}=v(),n=te(b=>b.chatDocuments),[i,a]=(0,to.useState)(null),[s,l]=En(O_),{inputMediator:c}=Ce(),{openSelectDocumentModal:u}=bC(),{syncNodesFromRemote:p}=fC(),{getNodeByDocId:m}=tC(),{removeChatDocuments:d}=X_(),h=n.filter(b=>b.link!==window.location.href&&b.id!==xu&&b.selected),f=(0,to.useCallback)(async()=>{if(!h.length)return;let b=[];h.forEach(w=>{w.maxAIDocumentId&&(m(w.maxAIDocumentId)||b.push(w.maxAIDocumentId))}),b.length>0&&d(b,!0)},[h,m,d]),_=async()=>{u(!0),c.focus()},x=(0,to.useRef)(null);if((0,to.useEffect)(()=>(s?x.current=window.setTimeout(()=>{l(!1)},5e3):x.current&&window.clearTimeout(x.current),()=>{x.current&&window.clearTimeout(x.current)}),[s]),Ro(()=>{ao&&h.length>0&&p().then(()=>{f()})}),!h.length)return to.default.createElement(ee,{"data-testid":"maxai--chat-document-selector--button",title:r("package__features:home_view__chat_with_any_content__chat__chat_document_selector__button_title"),tooltipProps:{disableInteractive:!0},onClick:_,onMouseEnter:()=>{l(!1)},sx:{border:"1px solid",borderColor:"border.main",width:32,height:32,color:b=>b.palette.mode==="dark"?"#ffffff":"rgba(0, 0, 0, 0.87)",...e},...t,buttonRefBind:a},to.default.createElement(SL,null));let C=3,y=h.length;return to.default.createElement(to.default.Fragment,null,to.default.createElement(me,{title:r("package__features:chat__select_document_button__edit__tooltip"),disableInteractive:!0},to.default.createElement(g,{onMouseEnter:()=>{l(!1)}},to.default.createElement(qa,{toRef:a,dataTestId:"maxai--chat-document-selector--button",mode:"normal",selected:!0,onClick:_,sx:{userSelect:"none",borderColor:"transparent",bgcolor:"active.main",color:"active.contrastText","&:hover":{bgcolor:"active.hover",color:"active.hoverText"},...e},...t},h.slice(0,C).map((b,w)=>to.default.createElement(g,{key:b.id,justifyContent:"center",alignItems:"center",sx:{width:20,height:20,border:"1px solid",borderRadius:12,ml:w>0?"-10px":0,bgcolor:I=>I.palette.mode==="light"?"rgba(182, 218, 239, 1)":"rgba(65, 108, 155, 1)",borderColor:I=>I.palette.mode==="light"?"rgba(213, 239, 255, 1)":"rgba(42, 74, 109, 1)","& > svg":{width:"12px",height:"12px",fontSize:"12px"},"& > img":{width:"12px",height:"12px"}}},to.default.createElement(S_,{documentType:b.maxAIDocumentType,file:{name:b.title},link:b.link,size:14}))),to.default.createElement(T,{ml:"-2px",fontSize:"13px",color:"inherit"},y===1?r("package__features:chat__select_sources__sources_singular__title",{COUNT:y}):r("package__features:chat__select_sources__sources_plural__title",{COUNT:y}))))),to.default.createElement(me,{open:s,title:r("package__features:chat__select_sources_error__maximum__text",{MAX_COUNT:Lx}),placement:"top",arrow:!0,PopperProps:{anchorEl:i},sx:{maxWidth:240}},to.default.createElement(L,null)))},dv=vL;var xa=S(M()),ML=({sx:o})=>{let{loaded:e,subscriptionType:t}=Mt(),{isLogin:r}=Po(),{t:n}=v(),{getPlansInfoByType:i}=Qu(),{showPricingUpgradeContentPopup:a}=j2(),s=i(Xx),l=!1,c=K2(),u=m=>{a("proactive_modal")},p=(0,xa.useMemo)(()=>(t==="monthly"||t==="quarterly")&&s.discount_title?n("package__features:pricing__save_to",{NUM:s.discount_title}):n("package__common:upgrade"),[n,t,s.discount_title]);return!e||!r||t==="yearly"||t==="oneTimePayment"?null:xa.default.createElement(xa.default.Fragment,null,xa.default.createElement(me,{title:c,disableInteractive:!0},xa.default.createElement(cn,{"data-testid":"maxai--chat--upgrade-plan-button",variant:"contained",sx:{borderRadius:"9999px",p:"6px 12px 6px 8px",...o},loading:l,onClick:u},xa.default.createElement(Bu,{sx:{fontSize:20,color:"inherit"}}),xa.default.createElement(T,{ml:.5,my:0,fontSize:14,lineHeight:"20px",color:"text.primary",sx:{userSelect:"none",opacity:l?0:1,color:"inherit"}},p))))},fv=ML;var hv=S(X1());var jr=S(M());var TL={position:"relative",width:56,height:56,flex:"0 0 56px",borderRadius:1,border:"1px solid",borderColor:"border.secondary",bgcolor:"background.default","& > .chat-screenshot-list-cancel-icon":{transition:"opacity 0.1s ease-in-out",position:"absolute",top:0,right:0,transform:"translate3d(50%, -50%, 0)",fontSize:"16px",zIndex:10,overflow:"visible",cursor:"pointer",color:"text.primary"}},wL=o=>{let{sx:e}=o,{artReferenceImages:t,removeArtReferenceImages:r,clearArtReferenceImages:n}=nC(),{AIModel:i}=ko.use.art();(0,jr.useEffect)(()=>{i!=="gpt-image-1"&&n()},[i]);let[a,s]=(0,jr.useState)(),l=(0,jr.useMemo)(()=>t.map(c=>({src:c.link||"",alt:c.title})),[t]);return i!=="gpt-image-1"||!t.length?null:jr.default.createElement(L,{width:"100%",position:"relative",sx:e},jr.default.createElement(Pi,{hideMenu:!0,images:l,selectedImage:a,setSelectedImage:s}),jr.default.createElement(g,{direction:"row",tabIndex:-1,mt:"-10px",pt:"10px",pr:"10px",sx:{gap:1,overflowX:"auto",boxSizing:"border-box",overflowY:"hidden",outline:"0px"}},t.map((c,u)=>{if(c.maxAIDocumentType==="image"){let p=c.preUploadMetadata?.previewIcon||c.link||"";return jr.default.createElement(L,{key:c.id,sx:TL},jr.default.createElement(On,{width:"100%",height:"100%",alt:c.title,src:p,SkeletonSx:{borderRadius:1},imageSx:{borderRadius:1,objectFit:"cover",cursor:"pointer"},onImageClick:()=>{s(c.link||"")}}),jr.default.createElement(hv.default,{className:"chat-screenshot-list-cancel-icon",onClick:()=>r([c.id])}),c.status==="uploading"&&jr.default.createElement(L,{sx:{position:"absolute",zIndex:1,top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%",bgcolor:"transparent",backdropFilter:"blur(2px)"}},jr.default.createElement(Jt,{size:30,thickness:4})))}return null})))},gv=wL;var Rt=S(M());var xv=S(Cr());var ci=S(M()),EL=[{value:"prompt",testId:"input--big-text-paste-selector--prompt",labelI18nKey:"package__features:chat__big_text_paste__options__prompt"},{value:"source",testId:"input--big-text-paste-selector--source",labelI18nKey:"package__features:chat__big_text_paste__options__source"}],PL=o=>{let{text:e="",onConfirm:t,onClose:r,sx:n,...i}=o,{t:a}=v(),s=te(f=>f.conversationType),{createNewPrompt:l}=Oo(),{changeMyOwnToolsType:c}=Hr(),{setTemplate:u}=Oi(),{handleUploadFiles:p}=oC(),m=t??(f=>{if(f==="prompt")c("MY_OWN_TOOLS"),l(),u(Ot(s).getInputValue()+e);else if(f==="source"){let _=new File([e],zp().t("package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__pasted__title",{fileName:`text ${J2()}.txt`}),{type:"text/plain"});p([_])}}),d=()=>{r?.({},"closeClick")},h=f=>{m?.(f),r?.({},"confirmClick")};return ci.default.createElement(yi,{onClose:r,sx:{position:"absolute",...n},slotProps:{backdrop:{sx:{position:"absolute"}}},...i},ci.default.createElement(L,{sx:{outline:"none",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:"min(448px, calc(100% - 32px))",maxWidth:"min(calc(1168px - 32px), calc(100% - 32px))",maxHeight:"calc(100% - 32px)",overflow:"auto",backgroundColor:"background.paper",boxSizing:"border-box",borderRadius:"16px",width:"448px",padding:"24px"}},ci.default.createElement(g,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",position:"relative",height:"24px"}},ci.default.createElement(Lu,{sx:{color:"text.primary"}}),ci.default.createElement(je,{sx:{position:"absolute",right:0,top:0,width:"24px",height:"24px"},onClick:d},ci.default.createElement(xv.default,{sx:{color:"text.secondary"}}))),e&&ci.default.createElement(L,{sx:{boxSizing:"border-box",padding:"12px",border:f=>`1px solid ${f.palette.border.main}`,borderRadius:"8px",marginTop:"16px"}},ci.default.createElement(T,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",fontWeight:400,fontSize:"16px",lineHeight:"150%",color:"text.tertiary"}},e)),ci.default.createElement(g,{sx:{gap:1,marginTop:"24px"}},EL.map(f=>ci.default.createElement(le,{key:f.value,variant:"contained",onClick:()=>h(f.value),"data-testid":f.testId,sx:{padding:"10px 16px",lineHeight:"20px"}},a(f.labelI18nKey))))))},_v=PL;var AL=o=>{let{headerNode:e,headerLeftNode:t,headerRightNode:r,footerNode:n,footerLeftNode:i,footerRightNode:a,minLine:s=3,error:l,textareaProps:c,sx:u,defaultValue:p,sendButtonProps:m}=o,{t:d}=v(),{conversationId:h,conversationType:f}=te($=>({conversationId:$.conversationIds[0],conversationType:$.conversationType})),{askAIQuestionV2:_,askAIQuestion:x}=Re(),{getConversationLoading:C}=Ve(),{betaSettings:y}=Sr(),b=Hl(),{loading:w}=ja(),{pastedBigText:I,setPastedBigText:E,handlePasteEvent:P,handleAIArtInputPasteEvent:O}=pC(),{AIModel:N}=ko.use.art(),V=(0,Rt.useMemo)(()=>{if(f==="Summary")switch(R0()){case"PAGE_SUMMARY":return d("package__features:chat__input__summary_page__placeholder");case"YOUTUBE_VIDEO_SUMMARY":return d("package__features:chat__input__summary_video__placeholder");case"DEFAULT_EMAIL_SUMMARY":return d("package__features:chat__input__summary_email__placeholder");case"PDF_CRX_SUMMARY":return d("package__features:chat__input__summary_pdf__placeholder");default:return d("package__features:chat__input__summary_page__placeholder")}return d(f==="Search"?"package__features:chat__input__search__placeholder":f==="Art"?"package__features:chat__input__art__placeholder":"package__features:chat__input__chat__placeholder")},[f,d]),A=b.getInputValue();(0,Rt.useEffect)(()=>{let $=ie=>{let G=ie.detail?.value;G&&(y?.appearance_v2_enabled||f==="Art"?_({type:"user",text:G,meta:{includeHistory:!0}}):x({type:"user",text:G,meta:{includeHistory:!0}}))};return g3("MAXAI_CLIENT__CHAT_INPUT__SEND_MESSAGE",$),()=>{x3("MAXAI_CLIENT__CHAT_INPUT__SEND_MESSAGE",$)}},[_,x]);let D=(0,Rt.useCallback)(async()=>{if(!b.isComposing){if(!await Fe({emitEvent:!0})){b.focus();return}w||await C(h)||A&&(y?.appearance_v2_enabled||f==="Art"?_({type:"user",text:A,meta:{includeHistory:!0}}):x({type:"user",text:A,meta:{includeHistory:!0}}))}},[x,_,h,w,b,A,y?.appearance_v2_enabled,f]);(0,Rt.useEffect)(()=>{if(b.ref){let $=b.getInputValue();b.focus(),b.ref?.setSelectionRange($.length,$.length)}},[h,b]),(0,Rt.useEffect)(()=>{p&&b.updateInputValue(p)},[p]);let[W,k]=(0,Rt.useState)(!1),[U,K]=(0,Rt.useState)(!1),H=Rt.default.createElement(Rt.default.Fragment,null,W?null:a,Rt.default.createElement(ls,{value:{isVoiceInput:W,setIsVoiceInput:k}},Rt.default.createElement(pp,{voiceButtonProps:{onStartRecording:()=>{K(!0)},onStopRecording:$=>{$!=="done"&&K(!1)},onSpeechToTextFinally:()=>{K(!1)}},...m}))),{disabled:R,...F}=c||{},Y=R||U;return Rt.default.createElement(Rt.default.Fragment,null,Rt.default.createElement(g,{direction:"column",width:"100%",borderRadius:1,border:"1px solid",borderColor:`${l?"rgb(239, 83, 80)":"border.main"}`,boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.05)",boxSizing:"border-box",sx:{"& > *":{order:1},...u}},e,Rt.default.createElement(L,{"data-testid":"maxai--chat-box--chat-input--main",sx:{p:"10px"}},t||r?Rt.default.createElement(L,{"data-testid":"maxai--chat-box--chat-input--main-header",display:"flex",alignItems:"center",justifyContent:"space-between"},Rt.default.createElement(g,{direction:"row",spacing:.5,flex:1,mb:1,sx:{"&:empty":{display:"none"}}},t),Rt.default.createElement(g,{direction:"row",spacing:.5,mb:1,sx:{"&:empty":{display:"none"}}},r)):null,Rt.default.createElement(cp,{ref:$=>b.bindRef($),"data-testid":"chat-input-textarea","data-disabled-button-clicked":!0,value:A,placeholder:V,minLine:s,onChangeText:$=>b.updateInputValue($),onPaste:$=>{b.emit("onPaste",$),f==="Art"?N==="gpt-image-1"&&O($):P($)},onEnter:D,onCompositionStart:()=>b.setIsComposing(!0),onCompositionEnd:()=>b.setIsComposing(!1),stopPropagation:!0,disabled:Y,...F}),i||H?Rt.default.createElement(L,{display:"flex",alignItems:"center",justifyContent:"space-between",mt:1},!W&&Rt.default.createElement(g,{direction:"row",spacing:.5},i),Rt.default.createElement(g,{direction:"row",spacing:1,flex:1,justifyContent:"flex-end",overflow:"hidden"},H)):null),n),Rt.default.createElement(_v,{open:!!I,text:I,onClose:()=>E("")}))},Cv=AL;var yv=S(X1());var ui=S(M());var kL={position:"relative",width:56,height:56,borderRadius:1,border:"1px solid",borderColor:"border.secondary",bgcolor:"background.default","& > .chat-screenshot-list-cancel-icon":{opacity:1,transition:"opacity 0.1s ease-in-out",position:"absolute",top:0,right:0,transform:"translate3d(50%, -50%, 0)",fontSize:"16px",zIndex:10,overflow:"visible",cursor:"pointer",color:"text.primary"}},LL=o=>{let{sx:e}=o,{t}=v(),{chatScreenshots:r,removeChatScreenshots:n,removeAllChatScreenshots:i}=Ip(),{isInStepTour:a}=te(s=>({isInStepTour:s.isInStepTour}));return(0,ui.useEffect)(()=>{if(r.length>0){let s=()=>{i()};return $1.addListener("MAXAI_PROJECT_UPLOAD_SUCCESS",s),()=>{$1.removeListener("MAXAI_PROJECT_UPLOAD_SUCCESS",s)}}},[r.length]),!r.length||a?null:ui.default.createElement(L,{className:"maxai-chat-screenshot-list-view",width:"100%",position:"relative",sx:e},ui.default.createElement(g,{direction:"row",tabIndex:-1,mt:"-10px",pt:"10px",pr:"10px",sx:{gap:1,overflowX:"auto",boxSizing:"border-box",overflowY:"hidden",scrollbarColor:"auto","&::-webkit-scrollbar":{height:0,width:0,background:"transparent",display:"none"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}},r.map((s,l)=>{if(s.maxAIDocumentType==="image"){let c=s.preUploadMetadata?.previewIcon||s.link||"";return ui.default.createElement(L,{key:s.id,sx:kL},ui.default.createElement(On,{width:"100%",height:"100%",alt:s.title,src:c,SkeletonSx:{borderRadius:1},imageSx:{borderRadius:1,objectFit:"cover",cursor:"pointer"},onImageClick:()=>{s.maxAIDocumentId&&Pl.previewDocument(s.maxAIDocumentId,{documentType:s.maxAIDocumentType,title:s.title,url:s.link})}}),ui.default.createElement(me,{disableInteractive:!0,title:t("package__features:chat__select_document_button__remove__tooltip")},ui.default.createElement(yv.default,{className:"chat-screenshot-list-cancel-icon",onClick:()=>n([s.id])})),s.status==="uploading"&&ui.default.createElement(L,{sx:{position:"absolute",zIndex:1,top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%",bgcolor:"transparent",backdropFilter:"blur(2px)"}},ui.default.createElement(Jt,{size:30,thickness:4})))}return null})))},bv=LL;var Iv=S(Cr());var Zs=S(M()),OL=o=>{let{sx:e}=o,{selectionContent:t,setSelectionContent:r}=te(n=>({selectionContent:n.selectionContent,setSelectionContent:n.setSelectionContent}));return t?Zs.default.createElement(g,{width:"100%",border:"1px solid",borderColor:"border.main",borderRadius:1,p:"10px",sx:e},Zs.default.createElement(g,{direction:"row",justifyContent:"space-between",gap:1},Zs.default.createElement(T,{fontSize:"14px",color:"text.secondary"},"Text from your selection"),Zs.default.createElement(ee,{sx:{width:20,height:20,borderRadius:.5},onClick:()=>r(null)},Zs.default.createElement(Iv.default,{sx:{fontSize:"16px!important"}}))),Zs.default.createElement(T,{fontSize:"14px",color:"text.tertiary",sx:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden",textOverflow:"ellipsis"}},t.selectedText)):null},Sv=OL;var vv=S(H7());var mr=S(M()),Df=[{title:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__file__title",icon:mr.default.createElement(ra,{sx:{fontSize:"20px"},icon:"File"}),addContextType:"files",testid:"maxai--chat-document-selector--modal--preset-button--files"},{title:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__text__title",icon:mr.default.createElement(ra,{sx:{fontSize:"20px"},icon:"Text"}),addContextType:"text",testid:"maxai--chat-document-selector--modal--preset-button--text"},{title:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__choose_sources__urls__title",icon:mr.default.createElement(ra,{sx:{fontSize:"20px"},icon:"URLs"}),addContextType:"urls",testid:"maxai--chat-document-selector--modal--preset-button--urls"}],Mv=[{chatDocumentId:xu,title:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__search__title",icon:mr.default.createElement(ra,{sx:{fontSize:"20px"},icon:"Search"}),addContextType:"search",testid:"maxai--chat-document-selector--modal--preset-button--search"}],BL=o=>{let{t:e}=v(),{chatDocuments:t}=Dl(),{dataList:r,activeIndex:n,onSelect:i,showEnterIcon:a=!1}=o;return mr.default.createElement(Pn,{sx:{p:0,overflowY:"auto",position:"relative",width:"100%",gap:"2px"}},r.map((s,l)=>{let c=n===l,u=t.find(d=>d.id===s.chatDocumentId),p=u?.selected,m=location.href===u?.link?[e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__current__title")]:[];return mr.default.createElement(St,{disabled:s.disabled,key:l,selected:c,onClick:()=>i&&i(s,l,r),sx:{p:"1px 0",width:"calc(100% - 12px)",left:"6px",borderRadius:"6px",minHeight:"unset"},"data-testid":s.testid||`maxai--chat-document-selector--modal--existing-document-button--${u?.maxAIDocumentType||"chat_file"}`},mr.default.createElement(me,{zIndex:2147483621,title:s.tooltip||"",placement:"left",PopperProps:{modifiers:[{name:"flip",enabled:!0,options:{fallbackPlacements:["top","right"]}}],sx:{[`&.${Br.popper}[data-popper-placement*="left"] > .${Br.tooltip}`]:{mr:"20px"}}}},mr.default.createElement(g,{direction:"row",sx:{alignItems:"center",p:1,borderRadius:"8px",gap:"12px",position:"relative",width:"100%","& > button:last-of-type":{display:"none"},"&:hover":{"& > button:last-of-type":{display:"block"}}}},p&&mr.default.createElement(L,{sx:{position:"absolute",width:"3px",height:"100%",left:"-6px",top:0,backgroundColor:"primary.main"}}),mr.default.createElement(sx,{sx:{width:"20x",height:"20px",minWidth:"20px!important",flexShrink:0}},u?mr.default.createElement(mm,{size:20,chatDocument:u}):s.icon),mr.default.createElement(g,{direction:"row",gap:"4px",width:0,flex:1},mr.default.createElement(T,{width:0,flex:1,noWrap:!0,sx:{textAlign:"left",fontSize:"14px",color:"text.primary"}},e(s.title)," ",s.disabled?" (TODO)":""),mr.default.createElement(g,{direction:"row",gap:"4px",alignItems:"center",component:"div",flexShrink:0},m.map(d=>mr.default.createElement(CC,{key:d,sx:{color:"text.secondary"},label:d})))),c&&a&&mr.default.createElement(vv.default,{sx:{flexShrink:0,fontSize:"16px",color:"text.secondary"}}),s.suffix)))}))},Tv=BL;var Qs=S(M()),DL=o=>{let{onAddContextClick:e,disabled:t}=o,{t:r}=v(),{selectedChatDocuments:n,toggleSelectedChatDocument:i,setChatDocuments:a}=Im(),{chatHubLoading:s}=rt(),l=(0,Qs.useMemo)(()=>Qi(n,["createdAt"],["desc"]).sort((u,p)=>u.link===window.location.href?-1:p.link===window.location.href?1:0),[n]),c=u=>{u.status==="uploading"?a(p=>p.filter(m=>m.id!==u.id)):i(u.id)};return l.length>0?Qs.default.createElement(Qs.default.Fragment,null,l.map(u=>Qs.default.createElement(Vl,{disabled:s,dataTestId:"maxai--chat-document-selector--selected-document-button",key:u.id,onClose:()=>{c(u)},showClose:!0,chatDocument:u}))):Qs.default.createElement(T,{fontSize:"14px",sx:{color:t?"action.disabled":"text.secondary",userSelect:"none"},onClick:e},r("package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__title"))},wv=DL;var Kn=S(M()),HL=Jr(J0)(({theme:o})=>({fontFamily:o.typography.fontFamily,width:"100%",display:"block",padding:"16px",boxSizing:"border-box",fontSize:"16px",backgroundColor:"transparent",border:"none",outline:"none",resize:"none",lineHeight:"1.5",color:o.palette.text.primary,scrollbarColor:o.palette.scrollbarColor})),Ev=(0,Kn.forwardRef)(({minHeight:o,maxHeight:e,style:t,...r},n)=>{let i=(0,Kn.useRef)(null),[a,s]=(0,Kn.useState)(null);(0,Kn.useEffect)(()=>{if(i.current){let u=window.getComputedStyle(i.current),p=parseInt(u.lineHeight,10)||parseInt(u.height,10),m=parseInt(u.paddingTop,10),d=parseInt(u.paddingBottom,10);s({lineHeight:p,paddingY:m+d})}},[]);let{minRows:l,maxRows:c}=(0,Kn.useMemo)(()=>{if(!a||!o)return{minRows:void 0,maxRows:void 0};let{lineHeight:u,paddingY:p}=a,m=Math.max(Math.ceil((o-p)/u),1),d=e?Math.max(Math.ceil((e-p)/u),m):void 0;return{minRows:m,maxRows:d}},[a,o,e]);return Kn.default.createElement(HL,{ref:u=>{typeof n=="function"?n(u):n&&(n.current=u),i.current=u},minRows:l,maxRows:c,style:t,...r})});Ev.displayName="MaxAITextareaAutosize";var Pv=Ev;var Sn=S(M()),FL=o=>{let{t:e}=v(),t=Sn.default.useRef(null),[r,n]=(0,Sn.useState)(""),{show:i,BackdropTransparent:a,onClose:s,onConfirm:l,onBack:c}=o,u=h=>{n(""),s(h)};(0,Sn.useEffect)(()=>{i&&(setTimeout(()=>{t.current?.focus()},0),setTimeout(()=>{t.current?.focus()},100))},[i]);let p=(0,Sn.useCallback)(h=>{n(h.target.value)},[]),m=(0,Sn.useCallback)(()=>{l?.(r),u()},[l,r,u]),d=(0,Sn.useCallback)(h=>{h.key!=="Escape"&&h.stopPropagation()},[]);return Sn.default.createElement($a,{confirmBtnTextId:"maxai--project--paste-text-modal--confirm-button",show:i,BackdropTransparent:a,onClose:u,title:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_text__title"),confirmBtnDisabled:r.trim()==="",onConfirm:m,onBack:c},Sn.default.createElement(g,{sx:{borderTop:"1px solid",borderBottom:"1px solid",borderColor:"border.main"}},Sn.default.createElement(Pv,{ref:t,value:r,onChange:p,onKeyDown:d,placeholder:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_text__placeholder"),minHeight:269,maxHeight:511})))},Av=FL;var So=S(M()),NL={INVALID_URL:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_url__error__invalid_url",EXISTS_URL:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_url__error__exists_url",TOO_MUCH_URL:"package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_url__error__too_much_url"},kv=()=>({INVALID_URL:!1,EXISTS_URL:!1,TOO_MUCH_URL:!1}),VL=o=>{let{t:e}=v(),{show:t,BackdropTransparent:r,onClose:n,onChange:i,onBack:a}=o,[s,l]=(0,So.useState)(""),[c,u]=(0,So.useState)(kv),{chatDocuments:p}=Dl(),[m,d]=(0,So.useState)([]),h=(0,So.useRef)(null),f=(0,So.useRef)(!1),_=(0,So.useMemo)(()=>{let b=Object.keys(c).find(w=>c[w]);return b?e(NL[b]):""},[c,e]),x=(0,So.useMemo)(()=>m.length===0||_!=="",[m,_]),C=b=>{let w=p.map(P=>P.link).concat(m.map(P=>P.link)),I=b.map(P=>P.startsWith("http")?P:`https://${P}`).filter(P=>!w.includes(P));if(I.length===0){u(P=>({...P,EXISTS_URL:!0}));return}u(P=>({...P,EXISTS_URL:!1}));let E=I.map(P=>({id:Eo(),status:"idle",title:P,link:P,maxAIDocumentType:"page_content__webpage"}));d(P=>P.concat(E))};return(0,So.useEffect)(()=>{t&&(setTimeout(()=>{h.current?.focus()},0),setTimeout(()=>{h.current?.focus()},100))},[t]),(0,So.useEffect)(()=>{m.length>F0?u(b=>({...b,TOO_MUCH_URL:!0})):u(b=>({...b,TOO_MUCH_URL:!1}))},[m]),So.default.createElement($a,{confirmBtnTextId:"maxai--project--paste-url-modal--confirm-button",show:t,BackdropTransparent:r,onClose:b=>{l(""),d([]),n(b),u(kv)},title:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_url__modal__title"),confirmBtnText:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__modal__done__title"),cancelBtnText:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__modal__cancel__title"),confirmBtnDisabled:x,onConfirm:()=>(i?.(m.map(b=>b.link)),!0),onBack:a},So.default.createElement(g,{sx:{padding:"24px",gap:"8px",maxHeight:"264px",boxSizing:"border-box",borderTop:"1px solid",borderBottom:"1px solid",borderColor:"border.main"}},m.length>0&&So.default.createElement(g,{direction:"row",gap:"8px",flexWrap:"wrap"},m.map(b=>So.default.createElement(Vl,{showClose:!0,key:b.id,onClose:()=>{d(w=>w.filter(I=>I.id!==b.id))},chatDocument:b}))),So.default.createElement(L,{component:"textarea",ref:h,value:s,onCompositionStart:b=>{f.current=!0},onCompositionEnd:b=>{f.current=!1,l(b.currentTarget.value)},onKeyDown:b=>{if(b.key!=="Escape"&&b.stopPropagation(),b.key==="Enter"||b.code==="Space"){if(f.current)return;let w=s.trim();Fp(w)&&(C([w]),u(I=>({...I,INVALID_URL:!1})),l(""),b.preventDefault())}},onChange:b=>{l(b.target.value)},onPaste:b=>{let E=b.clipboardData.getData("text").trim().split(`
`).filter(P=>Fp(P));E.length>0?(C(E),u(P=>({...P,INVALID_URL:!1}))):u(P=>({...P,INVALID_URL:!0})),l(""),b.preventDefault()},placeholder:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__paste_url__placeholder"),sx:{fontFamily:b=>b.typography.fontFamily,display:"block",width:"100%",height:"232px",padding:"0",fontSize:"16px",boxSizing:"border-box",border:"none",outline:"none",backgroundColor:"transparent",resize:"none",color:"text.primary",lineHeight:"1.5",scrollbarColor:b=>b.palette.scrollbarColor}})),_&&So.default.createElement(g,{sx:{gap:"4px",padding:"16px"}},So.default.createElement(yC,{errorText:_})))},Lv=VL;var Pg=S(M()),RL=o=>{let{chatDocuments:e}=Dl(),t=(0,Pg.useMemo)(()=>{let r=He(Mv);return Qi(e,["createdAt"],["asc"]).forEach(i=>{if(i.hidden)return;let a={title:i.title,tooltip:i.title,addContextType:"document",link:i.link,chatDocumentId:i.id};a.link===window.location.href?r.unshift(a):r.push(a)}),r},[e]);return(0,Pg.useMemo)(()=>{if(!o)return{showTitle:!0,chatDocumentsMenuList:t,filteredMenuList:Df,matchCount:Df.length};let r=Df.filter(i=>i.title.toLowerCase().includes(o.toLowerCase()));if(r.length)return{showTitle:!1,chatDocumentsMenuList:[],filteredMenuList:r,matchCount:r.length};let n=t.filter(i=>i.title.toLowerCase().includes(o.toLowerCase()));return{showTitle:!1,chatDocumentsMenuList:[],filteredMenuList:n,matchCount:n.length}},[o,t])},Ov=RL;var Fv=S(bi());var xe=S(M());var Bv=S(Cr());var oo=S(M()),zL=[{value:"prompt",testId:"input--big-text-paste-selector--prompt",labelI18nKey:"package__features:chat__big_text_paste__options__prompt"},{value:"source",testId:"input--big-text-paste-selector--source",labelI18nKey:"package__features:chat__big_text_paste__options__source"}],Dv=(0,oo.forwardRef)((o,e)=>{let{t}=v(),[r,n]=(0,oo.useState)(!1),[i,a]=(0,oo.useState)(""),s=(0,oo.useRef)(),l=(0,oo.useCallback)(()=>{n(!1),s.current?.resolve(!1)},[]),c=(0,oo.useCallback)(p=>{n(!1),s.current?.resolve(p)},[]),u=(0,oo.useCallback)(async p=>(n(!0),a(p),new Promise((m,d)=>{s.current={resolve:m,reject:d}})),[]);return(0,oo.useImperativeHandle)(e,()=>({confirmSelect:u})),oo.default.createElement(yi,{open:r,onClose:l,sx:{position:"absolute"},slotProps:{backdrop:{sx:{position:"absolute"}}}},oo.default.createElement(L,{sx:{outline:"none",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:"min(448px, calc(100% - 32px))",maxWidth:"min(calc(1168px - 32px), calc(100% - 32px))",maxHeight:"calc(100% - 32px)",overflow:"auto",backgroundColor:"background.paper",boxSizing:"border-box",borderRadius:"16px",width:"448px",padding:"24px"}},oo.default.createElement(g,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",position:"relative",height:"24px"}},oo.default.createElement(Lu,{sx:{color:"text.primary"}}),oo.default.createElement(je,{sx:{position:"absolute",right:0,top:0,width:"24px",height:"24px"},onClick:l},oo.default.createElement(Bv.default,{sx:{color:"text.secondary"}}))),i&&oo.default.createElement(L,{sx:{boxSizing:"border-box",padding:"12px",border:p=>`1px solid ${p.palette.border.main}`,borderRadius:"8px",marginTop:"16px"}},oo.default.createElement(T,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",fontWeight:400,fontSize:"16px",lineHeight:"150%",color:"text.tertiary"}},i)),oo.default.createElement(g,{sx:{gap:1,marginTop:"24px"}},zL.map(p=>oo.default.createElement(le,{key:p.value,variant:"contained",onClick:()=>c(p.value),"data-testid":p.testId,sx:{padding:"10px 16px",lineHeight:"20px"}},t(p.labelI18nKey))))))});Dv.displayName="ChatDocumentBigTextPasteSelector";var Hv=Dv;var UL=o=>{let{t:e}=v(),{hideFileList:t=!1}=o,r=xe.default.useRef(null),n=(0,xe.useRef)(null),{createNewPrompt:i}=Oo(),{setTemplate:a}=Oi(),[s,l]=(0,xe.useState)(!1),[c,u]=(0,xe.useState)(!1),[p,m]=(0,xe.useState)(!1),[d,h]=(0,xe.useState)(0),[f,_]=(0,xe.useState)(""),x=te(B=>B.conversationType),{chatHubLoading:C}=rt(),{chatDocuments:y,toggleSelectedChatDocument:b,handleUploadFilesToChatDocuments:w,handleUploadLinksToChatDocuments:I,toggleMaxAISearchFeature:E}=Im(),P=(0,xe.useMemo)(()=>y.map(B=>B.link),[y]),O=(0,xe.useRef)(P);(0,xe.useEffect)(()=>{O.current=P},[P]);let{isUnavailableUploadSource:N,changeMyOwnToolsType:V}=Hr(),A=(0,xe.useMemo)(()=>C||N,[N,C]),{showTitle:D,chatDocumentsMenuList:W,filteredMenuList:k,matchCount:U}=Ov(f),K=(0,xe.useCallback)(B=>{let ae=B.key==="ArrowUp",X=B.key==="ArrowDown",oe=0,ue=U-1;return U&&(ae||X)?(B.preventDefault(),B.stopPropagation(),h(Z=>ae?Z-1<0?ue:Z-1:Z+1>ue?oe:Z+1),!0):!1},[U]),H=(0,xe.useRef)(K);(0,xe.useEffect)(()=>{H.current=K},[U]);let R=(0,xe.useRef)(s);(0,xe.useEffect)(()=>{h(0),R.current=s},[k,s]),(0,xe.useEffect)(()=>{let B=Ot(x).ref;if(B&&!1){let oe=Z=>{if(Z.key==="@"){l(!0);return}if(Z.key==="Escape"){l(!1);return}R.current&&H.current(Z)},ue=Z=>{let J=Z.key==="ArrowUp",j=Z.key==="ArrowDown";if((J||j)&&R.current&&U>0)return;let ce=B.selectionStart,ke=B.value;if(ce){let at=ke.slice(0,ce),we=[],tt=at.indexOf("@");for(;tt!==-1;)we.push(tt),tt=at.indexOf("@",tt+1);let At=we.reverse().find(Zt=>Zt<ce);if(At!==void 0){let Zt=at.slice(At+1);l(!0),_(Zt);return}}_(""),l(!1)};return B.addEventListener("keydown",oe,{capture:!0}),B.addEventListener("keyup",ue,{capture:!0}),()=>{B.removeEventListener("keydown",oe,{capture:!0}),B.removeEventListener("keyup",ue,{capture:!0})}}let X=async oe=>{if(A)return;let ue=oe.clipboardData?.getData("text").trim();if(ue){if(ue.length>=8e3){if(oe.preventDefault(),oe.stopPropagation(),!await Fe({emitEvent:!0}))return;let Z=Ot(x);switch(await n.current?.confirmSelect(ue)){case"prompt":{V("MY_OWN_TOOLS"),i(),a(Z.getInputValue()+ue);return}break;case"source":{oe.preventDefault(),oe.stopPropagation();let J=new File([ue],e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__pasted__title",{fileName:"text.txt"}),{type:"text/plain"});await w([J]);return}default:break}}if(Fp(ue,!0)&&!O.current.includes(ue)){oe.preventDefault(),oe.stopPropagation(),await I([ue]);return}}};return Ot(x).addListener("onPaste",X),()=>{Ot(x).removeListener("onPaste",X)}},[x,A]);let F=()=>{if(A)return;l(!s);let B=Ot(x).ref;B&&B.focus()},Y=async()=>{let B=await f0({accept:N0});B.length>0&&(await w(B),l(!1))},$=async()=>{u(!0)},ie=async()=>{m(!0)},G=async B=>{if(await Fe({emitEvent:!0}))switch(B){case"file":await Y();break;case"text":await $();break;case"url":await ie();break}};return xe.default.createElement(L,{sx:{position:"relative"}},xe.default.createElement(g,{direction:"row",alignItems:"center",gap:"8px",flexWrap:"wrap"},xe.default.createElement(me,{placement:"top",title:N?e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__button__unavailable__tooltip"):void 0,disableInteractive:!0},xe.default.createElement(g,null,xe.default.createElement(ee,{disabled:A,"data-testid":"maxai--chat-document-selector--button",title:e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__button_title"),onClick:F,buttonRefBind:B=>{r.current=B},sx:{color:B=>B.palette.mode==="dark"?"#ffffff":"rgba(0, 0, 0, 0.87)"},tooltipProps:{disableInteractive:!0}},xe.default.createElement(Fv.default,null,xe.default.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},xe.default.createElement("path",{d:"M13.1002 3.8002C13.1002 3.19268 12.6077 2.7002 12.0002 2.7002C11.3927 2.7002 10.9002 3.19268 10.9002 3.8002V10.9002H3.8002C3.19268 10.9002 2.7002 11.3927 2.7002 12.0002C2.7002 12.6077 3.19268 13.1002 3.8002 13.1002H10.9002V20.2002C10.9002 20.8077 11.3927 21.3002 12.0002 21.3002C12.6077 21.3002 13.1002 20.8077 13.1002 20.2002V13.1002H20.2002C20.8077 13.1002 21.3002 12.6077 21.3002 12.0002C21.3002 11.3927 20.8077 10.9002 20.2002 10.9002H13.1002V3.8002Z",fill:"currentColor"})))))),!t&&xe.default.createElement(wv,{disabled:A,onAddContextClick:F})),xe.default.createElement(El,{placement:"bottom-start",fallbackPlacements:["top-start"],disableScrollLock:!0,onClose:()=>{l(!1)},open:s&&U>0,anchorEl:r.current,PaperProps:{sx:{border:"none"}}},xe.default.createElement(g,{"data-testid":"maxai--chat-document-selector--card",sx:{borderRadius:1,maxWidth:"360px",minWidth:"240px",width:"fit-content",maxHeight:"264px",boxSizing:"border-box",border:"1px solid",borderColor:"border.main",py:"4px",bgcolor:B=>B.palette.mode==="dark"?"rgba(61, 61, 61, 1)":"#fff",alignItems:"center",justifyContent:"center","& > div":{boxSizing:"border-box",width:"100%"}}},xe.default.createElement(g,{sx:{flexShrink:0}},D&&xe.default.createElement(T,{px:"8px",textAlign:"left",fontSize:"12px",lineHeight:"32px",height:"32px",color:"text.secondary",flexShrink:0,noWrap:!0},e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__title")),xe.default.createElement(g,{direction:"row",alignItems:"center",px:1},xe.default.createElement(ee,{sx:{height:"36px"},onClick:()=>G("url")},xe.default.createElement(ra,{icon:"URLs"}),xe.default.createElement("span",null,e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__url__title"))),xe.default.createElement(ee,{sx:{height:"36px"},onClick:()=>G("text")},xe.default.createElement(ra,{icon:"Text"}),xe.default.createElement("span",null,e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__text__title"))),xe.default.createElement(ee,{sx:{height:"36px"},onClick:()=>G("file")},xe.default.createElement(ra,{icon:"File"}),xe.default.createElement("span",null,e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__add_sources__file__title"))))),xe.default.createElement(It,{sx:{my:"4px",width:"100%",flexShrink:0}}),W.length>0&&xe.default.createElement(g,{width:"100%",sx:{flex:1,height:0}},xe.default.createElement(T,{sx:{flexShrink:0},textAlign:"left",fontSize:"12px",lineHeight:"32px",height:"32px",color:"text.secondary",flexShrink:0,noWrap:!0,px:"8px"},e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__choose_sources__title")),xe.default.createElement(Tv,{onSelect:B=>{if(B.addContextType==="search"){E();return}B.chatDocumentId&&b(B.chatDocumentId)},dataList:W})))),xe.default.createElement(Av,{show:c,onClose:()=>{u(!1)},onConfirm:async B=>{let ae=new File([B],e("package__features:home_view__chat_with_any_content__chat__chat_document_selector__chip__pasted__title",{fileName:"text.txt"}),{type:"text/plain"});await w([ae])}}),xe.default.createElement(Lv,{show:p,onClose:()=>{m(!1)},onChange:async B=>{await I(B)}}),xe.default.createElement(Hv,{ref:n}))},Nv=UL;var WL=o=>{let{enableState:e,disableState:t,children:r}=o,{isEnable:n,isDisable:i}=te(a=>({isEnable:e?e(a):!0,isDisable:t?t(a):!1}));return typeof r=="function"?r({isEnable:n,isDisable:i}):!n||i?null:r},qc=WL;var it=S(M());var Js=S(M());var Gv=S(Vv()),Kv=S(Rv()),jv=S(zv()),$v=S(Uv()),qv=S(Wv());var sn=S(M()),iO=(o,e=24)=>{try{let[t,r]=o.split(":").map(Number),n=!1;r>t&&(o=`${r}:${t}`,n=!0);let i={"1:1":sn.default.createElement(qv.default,{sx:{fontSize:e,transform:n?"rotate(90deg)":"none"}}),"3:2":sn.default.createElement(Gv.default,{sx:{fontSize:e,transform:n?"rotate(90deg)":"none"}}),"5:4":sn.default.createElement(Kv.default,{sx:{fontSize:e,transform:n?"rotate(90deg)":"none"}}),"7:5":sn.default.createElement(jv.default,{sx:{fontSize:e,transform:n?"rotate(90deg)":"none"}}),"16:9":sn.default.createElement($v.default,{sx:{fontSize:e,transform:n?"rotate(90deg)":"none"}})};return i[o]||i["1:1"]}catch{return null}},aO=()=>{let{t:o}=v(),{localSettings:e,setLocalSettings:t}=_t(),r=e.thirdProviderSettings?.MAXAI_DALLE,[n,i]=(0,sn.useState)(!1),a=Cl.aspectRatios.map(s=>({label:s.label(o),value:s.value,origin:s}))||[];return sn.default.createElement(Aa,{"data-testid":"maxai-chat--advanced--settings--art--aspect-ratio"},sn.default.createElement(ka,{sx:{fontSize:16,color:"text.primary"}},o("package__features:art__text_to_image__advanced__aspect_ratio__title")),sn.default.createElement(Oa,{sx:{fontSize:"16px",[`& .${La.icon}`]:{fontSize:24}},MenuProps:{elevation:1,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}},size:"small",open:n,onClose:()=>i(!1),onOpen:()=>i(!0),label:o("package__features:art__text_to_image__advanced__aspect_ratio__title"),value:r?.aspectRatio||"1:1",onChange:async(s,l)=>{let c=a.find(u=>u.value===s.target.value);c&&t({thirdProviderSettings:{MAXAI_DALLE:{generateCount:r?.generateCount||1,contentType:r?.contentType||"image",aspectRatio:c.value,resolution:c.origin.resolution||[1024,1024]}}})}},a.map((s,l)=>sn.default.createElement(St,{key:l,"data-value":s.value,value:s.value},sn.default.createElement(g,{direction:"row",alignItems:"center",spacing:1},iO(s.value),sn.default.createElement(T,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},s.label,` (${s.value})`))))))},Xv=aO;var Ui=S(M()),sO=()=>{let{t:o}=v(),{localSettings:e,setLocalSettings:t}=_t(),r=e.thirdProviderSettings?.MAXAI_DALLE,[n,i]=(0,Ui.useState)(!1),a=Cl.contentTypes.map(s=>({label:s.label(o),value:s.value,origin:s}))||[];return Ui.default.createElement(Aa,{"data-testid":"maxai-chat--advanced--settings--art--content-type"},Ui.default.createElement(ka,{sx:{fontSize:16,color:"text.primary"}},o("package__features:art__text_to_image__advanced__content_type__title")),Ui.default.createElement(Oa,{sx:{fontSize:"16px",[`& .${La.icon}`]:{fontSize:24}},MenuProps:{elevation:1,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}},size:"small",open:n,onClose:()=>i(!1),onOpen:()=>i(!0),label:o("package__features:art__text_to_image__advanced__content_type__title"),value:r?.contentType||"vivid",onChange:(s,l)=>{l.props.disabled||t({thirdProviderSettings:{MAXAI_DALLE:{generateCount:r?.generateCount||1,aspectRatio:r?.aspectRatio||"1:1",resolution:r?.resolution||[1024,1024],contentType:s.target.value}}})}},a.map((s,l)=>Ui.default.createElement(St,{key:l,"data-value":s.value,value:s.value},Ui.default.createElement(g,{direction:"row",alignItems:"center",spacing:1},s.origin?.exampleImage?Ui.default.createElement("img",{width:24,height:24,alt:`${s.value} example`,src:s.origin?.exampleImage}):null,Ui.default.createElement(T,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},s.label))))))},Yv=sO;var lO=()=>{let{t:o}=v();return Js.default.createElement(g,{spacing:1},Js.default.createElement(g,{direction:"row",mb:1},Js.default.createElement(T,{fontSize:"16px",fontWeight:600,color:"text.primary"},o("package__features:chat__art__text_to_image__advanced__title"))),Js.default.createElement(g,{spacing:2},Js.default.createElement(Xv,null),Js.default.createElement(Yv,null)))},Zv=lO;var el=S(M());var ys=S(M()),pO=[{value:"sogou",label:"Sogou Search"},{value:"brave",label:"Brave Search"},{value:"yandex",label:"Yandex Search"},{value:"naver",label:"Naver Search"},{value:"bing",label:"Bing Search"},{value:"yahoo",label:"Yahoo Search"},{value:"baidu",label:"Baidu Search"},{value:"google",label:"Google Search"}],cO=o=>{let{t:e}=v(),{localSettings:t,setLocalSettings:r}=_t(),[n,i]=(0,ys.useState)(!1);return ys.default.createElement(Aa,null,ys.default.createElement(ka,{sx:{fontSize:16,color:"text.primary"}},e("package__features:chat__app__search_advanced__search_engine__title")),ys.default.createElement(Oa,{sx:{fontSize:"16px",[`& .${La.icon}`]:{fontSize:24}},MenuProps:{elevation:1,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}},"data-testid":"chat-search--engine-selector",size:"small",open:n,onClose:()=>i(!1),onOpen:()=>i(!0),label:e("package__features:chat__app__search_advanced__search_engine__title"),value:t.sidebarSettings?.search?.searchEngine||"google",onChange:(a,s)=>{s.props.disabled||r({sidebarSettings:{search:{searchEngine:a.target.value}}})},...o},pO.map((a,s)=>ys.default.createElement(St,{key:s,"data-value":a.value,value:a.value},ys.default.createElement(T,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},a.label)))))},Qv=cO;var bs=S(M()),uO=Array.from({length:10},(o,e)=>e+1).map(o=>({value:o,label:`${o} result${o===1?"":"s"}`})),mO=()=>{let{t:o}=v(),{localSettings:e,setLocalSettings:t}=_t(),[r,n]=(0,bs.useState)(!1);return bs.default.createElement(Aa,null,bs.default.createElement(ka,{sx:{fontSize:16,color:"text.primary"}},o("package__features:chat__app__search_advanced__search_results__title")),bs.default.createElement(Oa,{sx:{fontSize:"16px",[`& .${La.icon}`]:{fontSize:24}},MenuProps:{elevation:1,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"}},"data-testid":"chat-search--results-count-selector",size:"small",open:r,onClose:()=>n(!1),onOpen:()=>n(!0),label:o("package__features:chat__app__search_advanced__search_results__title"),value:e.sidebarSettings?.search?.maxResultsCount||6,onChange:(i,a)=>{a.props.disabled||t({sidebarSettings:{search:{maxResultsCount:Vu(i.target.value)?i.target.value:6}}})}},uO.map((i,a)=>bs.default.createElement(St,{key:a,"data-value":i.value,value:i.value},bs.default.createElement(T,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},i.label)))))},Jv=mO;var dO=()=>{let{t:o}=v();return el.default.createElement(g,{spacing:1},el.default.createElement(g,{direction:"row",mb:1},el.default.createElement(T,{fontSize:"16px",fontWeight:600,color:"text.primary"},o("package__features:chat__app__search_advanced__title"))),el.default.createElement(g,{spacing:2},el.default.createElement(Qv,null),el.default.createElement(Jv,null)))},e8=dO;var dr=S(M()),fO=o=>{let{conversationType:e,conversationId:t}=Ai(),{conversationType:r=e,children:n,...i}=o,{t:a}=v(),s=ge(t),[l,c]=(0,dr.useState)(null),u=h=>{c(h.currentTarget)},p=()=>{c(null)},m=!!l,d=(0,dr.useRef)(null);return["Search","Art"].includes(r)?dr.default.createElement(dr.default.Fragment,null,dr.default.createElement(ks,{title:a("package__features:chat__inputbox__button__advanced_options__tooltip"),id:"MaxAIAIAdvanced","data-button-clicked-name":"maxai-advanced-button","aria-owns":m?"mouse-over-popover":void 0,"aria-haspopup":"true",disabled:s,onClick:u,...i,sx:{position:"relative",...i.sx},testid:`maxai-chat--advanced--settings-button--${r.toLowerCase()}`},dr.default.createElement(z,{icon:"Tune",sx:{color:"text.primary",fontSize:"20px"}})),dr.default.createElement(Pu,{open:m,anchorEl:l,id:"mouse-over-popover",elevation:2,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},onClose:p,disableScrollLock:!0},dr.default.createElement(L,{ref:d,sx:{borderRadius:1,border:"1px solid #EBEBEB",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.16)",width:402,display:"flex",alignItems:"stretch",justifyContent:"center",flexDirection:"row"}},dr.default.createElement(g,{spacing:1,p:1,width:"100%"},r==="Search"&&dr.default.createElement(e8,null),r==="Art"&&dr.default.createElement(Zv,null),n,dr.default.createElement(g,{sx:{minHeight:"28px"},width:"100%",spacing:1,alignItems:"center",direction:"row",justifyContent:"end",flexDirection:"row"},dr.default.createElement(je,{onClick:h=>{h.stopPropagation(),p()}},dr.default.createElement(z,{icon:"Close",sx:{fontSize:"24px"}}))))))):null},t8=fO;var jn=S(M());var hO=o=>{let{anchorElementSelectors:e='[data-testid="maxai-chat-history-button"]',placement:t=ao?"bottom-start":"left-end",...r}=o,{t:n}=v(),[i,a]=jn.default.useState(!1),[s,l]=jn.default.useState(!0),c=te(h=>h.conversationIds),u=er(c[0]),p=ge(c[0]),m=(0,jn.useCallback)(async()=>{let h=await qe.getOnboardingDataByKey(wc),f=await Co.cachedChatConversationService.getCacheConversationsByType("Chat");h&&u.length<=0&&p===!1&&f.length>0&&setTimeout(()=>{a(!0)},1e3)},[u,p]),{extensionTourOnBoardingOpened:d}=on();return(0,jn.useEffect)(()=>{d&&qe.getOnboardingDataByKey($h).then(h=>l(!!h))},[d]),(0,jn.useEffect)(()=>{s||m()},[s,m]),s?null:jn.default.createElement(Bt,{placement:t,trigger:i,anchorElementSelectors:e,keepPollingCheckAnchorEl:!0,onShow:()=>{qe.setOnboardingData($h,!0)},CtaButtonProps:{"data-button-clicked-name":"Onboarding > Chat history > Got it"},...r},jn.default.createElement(g,{spacing:.5},jn.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},n("package__features:onboarding__onboarding_popover__chat_history__title")),jn.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},n("package__features:onboarding__onboarding_popover__chat_history__description"))))},o8=hO;var Wt=S(M());var mi=S(M());var Ag=class o extends du{constructor(){super(...arguments);this.inputEl=null}static getInstance(){return o.instance||(o.instance=new o),o.instance}getInputEl(){return this.inputEl}setInputEl(t){this.inputEl=t}},Ko=Ag;var gO=()=>{let{t:o}=v(),e=(0,mi.useRef)(null),t=(0,mi.useRef)(null),[r,n]=(0,mi.useState)(!1),{updateConversationFolder:i}=Ve(),a=(0,mi.useCallback)(()=>{n(!1),Ko.getInstance().emit("renameGroupOnClose")},[n]),s=(0,mi.useCallback)(async u=>{try{if(!t.current)return null;let p=await i(t.current.id,t.current.group_type,u.trim());if(typeof p=="string")return p;p===!0&&Ko.getInstance().emit("renameGroupSuccess",t.current),n(!1)}catch{}return null},[i]),[l,c]=(0,mi.useState)("");return Ru(Ko.getInstance(),{showRenameGroupModal:u=>{t.current=u,c(u.group_name),n(!0),requestAnimationFrame(()=>{e.current?.focus(),e.current?.select()})}}),mi.default.createElement(xC,{inputTestId:"maxai-create-history-folder-input",name:l,show:r,modalHeaderTitle:o("package__features:chat__history_view__rename_folder__dialog__title"),onClose:a,onConfirm:s,confirmBtnTextId:"maxai--history--rename-folder-modal--confirm-button",confirmBtnText:o("package__common:done"),SelectTextImmediately:!0})},r8=gO;var di=S(M());var _a=S(M());var xO=o=>{let{show:e,onSubmit:t,loading:r,title:n,onClose:i,inputBoxTestId:a,inputRef:s,defaultName:l}=o,{t:c}=v(),{control:u,handleSubmit:p,reset:m,watch:d,formState:{errors:h}}=Sl({mode:"onChange",defaultValues:{name:l||""}});(0,_a.useEffect)(()=>{e&&m({name:l||""})},[l,m,e]);let f=d("name",""),_=(0,_a.useCallback)(()=>{m({name:l||""}),i?.(),Ko.getInstance().emit("renameOnClose")},[i,l,m]);return _a.default.createElement($a,{isFixed:!0,loading:r,show:e,onClose:_,title:n,wrapSx:{width:"460px"},footerVariant:"horizontal",confirmBtnDisabled:!f?.trim()||!!h.name,onConfirm:p(t)},_a.default.createElement(L,{component:"form",onSubmit:p(t),sx:{padding:"0 24px",gap:"8px"}},_a.default.createElement(Fa,{disabled:r,name:"name",rules:{validate:x=>!!x?.trim(),maxLength:{value:w1,message:c("package__features:chat__history_view__rename__dialog__name_too_long",{MAX_LENGTH:w1})}},control:u,render:({field:x,fieldState:{error:C}})=>_a.default.createElement(Lt,{onCopy:y=>{y.stopPropagation()},onCut:y=>{y.stopPropagation()},onPaste:y=>{y.stopPropagation()},onKeyUpCapture:y=>{y.key!=="Escape"&&y.stopPropagation()},onKeyDownCapture:y=>{y.key==="Escape"&&y.nativeEvent.isComposing&&y.stopPropagation()},fullWidth:!0,"data-testid":a,inputRef:s,error:!!C?.message,helperText:C?.message,sx:{[`& .${nx.root}`]:{fontSize:"12px"}},InputProps:{sx:{fontSize:"16px"}},...x})})))},n8=xO;var _O=()=>{let{t:o}=v(),e=(0,di.useRef)(null),t=(0,di.useRef)(null),[r,n]=(0,di.useState)(!1),{editing:i,editingNameRef:a,setEditing:s,updateConversationName:l}=Sm(),c=(0,di.useCallback)(()=>{s(!1),Ko.getInstance().emit("renameOnClose")},[s]),u=(0,di.useCallback)(async({name:d})=>{n(!0),await y0(async()=>{t.current&&(a.current=d,await l(t.current,!0),Ko.getInstance().emit("renameSuccess",t.current))}),n(!1),s(!1)},[a,s,l]),[p,m]=(0,di.useState)("");return Ru(Ko.getInstance(),{showRenameModal:d=>{t.current=d,m(d.name||cm(d)),s(!0),requestAnimationFrame(()=>{e.current?.focus(),e.current?.select()})}}),di.default.createElement(n8,{defaultName:p,inputRef:e,inputBoxTestId:"chat--history-view--rename-input",loading:r,show:i,onClose:c,title:o("package__features:chat__history_view__rename__dialog__title"),onSubmit:u})},i8=_O;var Mn=S(M());var s8=S(Cr());var kr=S(M());var $n=S(M());var Ar=S(M());var CO=(0,Ar.createContext)({chatHistoryPagination:{conversations:[],isLoading:!1,isRefetching:!1,isFetchingNextPage:!1,fetchNextPage:()=>Promise.resolve(),hasNextPage:!1,refetch:()=>Promise.resolve()},liteHistoryData:[],isSearchMode:!1,query:"",setQuery:()=>{},activeConversationIds:[],folderChildren:[],setFolderChildren:()=>{},folderQueriesRef:{current:new Map},deleteConversationFolder:()=>Promise.resolve(!1),allFolders:[]}),H_e=({autoInitFetch:o})=>{let[e,t]=(0,Ar.useState)(""),{isLogin:r}=Po(),n=(0,Ar.useRef)(new Map),[i,a]=(0,Ar.useState)([]),{conversationIds:s,conversationType:l,setConversationIds:c,layout:u}=te(k=>({conversationIds:k.conversationIds.slice(0,k.layout),conversationType:k.conversationType,setConversationIds:k.setConversationIds,layout:k.layout})),{newestConversations:p,removeNewestConversationByGroupId:m}=ym();z_(l);let d=W_(l,void 0,o),h=G_(l,{keyword:e}),f=h.isSearchMode,{conversations:_,isLoading:x,isRefetching:C,isFetchingNextPage:y,fetchNextPage:b,hasNextPage:w,refetch:I}=(0,Ar.useMemo)(()=>f?h:d,[f,h,d]),{folderIds:E}=d,[P,O]=(0,Ar.useState)([]),N=(0,Ar.useMemo)(()=>d.conversations.filter(k=>k.item_type==="group"),[d.conversations]),V=(0,Ar.useMemo)(()=>f?_:[..._,...P],[_,P,f]),{removeConversation:A}=Cm(),{createConversation:D}=Ve(),W=Rp(({set:k})=>async U=>{let K=await Co.getService().deleteConversationFolder(U);if(K){k(k_(U),Y=>Y&&{...Y,isDelete:!0}),A(U);let H=n.current.get(U);H&&H.reset?.(),O(Y=>Y.filter($=>$.group_id!==U));let R=s;if(await Promise.all(R.map(async Y=>await Co.getService(!0).getConversationById(Y)!==void 0)).then(Y=>Y.some(Boolean)))try{let $=(await D(l,{reason:"initCreate"})).filter((ie,G)=>G<u).map(ie=>ie.id);c($)}catch{}m(U)}return K},[s,l,u,D,c,O,m,A]);return(0,Ar.useEffect)(()=>{if(!r){a([]);return}if(!f){let k=setTimeout(()=>{let U=new Map;[...V,...p].forEach(R=>{R.item_type!=="group"&&(R.group_id&&!E.includes(R.group_id)||(!U.has(R.id)||new Date(R.updated_at)>new Date(U.get(R.id).updated_at))&&U.set(R.id,R))});let H=Array.from(U.values()).sort((R,F)=>new Date(F.updated_at).getTime()-new Date(R.updated_at).getTime()).slice(0,3).map(R=>R);a(H)},50);return()=>{clearTimeout(k)}}},[f,V,p,r,E]),{chatHistoryPagination:{conversations:V,isLoading:x,isRefetching:C,isFetchingNextPage:y,fetchNextPage:b,hasNextPage:w,refetch:I},liteHistoryData:i,isSearchMode:f,query:e,setQuery:t,activeConversationIds:s,folderChildren:P,setFolderChildren:O,folderQueriesRef:n,deleteConversationFolder:W,allFolders:N}},yO=()=>(0,Ar.useContext)(CO),Wi=yO;var bO=o=>{let{sx:e,moveConversation:t,onMoveConfirm:r}=o,{t:n}=v(),{allFolders:i}=Wi(),a=(0,$n.useMemo)(()=>{let l=t.group_id,u=i.map(m=>({id:m.id,name:m.group_name||m.id,type:"folder",canMove:m.id!==l,isRoot:!1})).sort((m,d)=>m.name.localeCompare(d.name,void 0,{numeric:!0,sensitivity:"base"}));return[{id:"root",name:n("package__features:chat__chat_history_view__root__title"),type:"root",canMove:!!l,isRoot:!0},...u]},[i,t,n]),s=(0,$n.useCallback)(l=>c=>{if(c.stopPropagation(),l.canMove){let u=l.id==="root"?"":l.id;r?.(u)}},[r]);return $n.default.createElement(g,{sx:{height:"100%",overflow:"auto",...e}},a.map(l=>$n.default.createElement(L,{key:l.id,sx:{display:"flex",alignItems:"center",height:"36px",minHeight:"36px",borderRadius:1,fontSize:14,mx:2,my:.25,px:1,overflow:"hidden",whiteSpace:"nowrap",...!l.canMove&&{opacity:.5,"&:hover":{backgroundColor:"transparent"}},"&:hover":{backgroundColor:c=>c.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)","& .move-button":{opacity:1}},transition:"all 0.2s ease-in-out"}},!l.isRoot&&$n.default.createElement(Xa,{sx:{fontSize:20,mr:1.5}}),$n.default.createElement(wm,{text:l.name,tip:l.name,resizeListener:!0,sx:{flex:1,fontSize:14,color:"text.primary",fontWeight:400,overflow:"hidden",wordBreak:"break-all",...l.isRoot&&{ml:0}}}),$n.default.createElement(me,{title:n("package__features:chat__inputbox__my_own_tools__modal__move_target_modal__already_in_this_folder"),disabled:l.canMove,disableInteractive:!0,leaveDelay:0,PopperProps:{style:{zIndex:99999}}},$n.default.createElement(L,null,$n.default.createElement(le,{className:"move-button",variant:"contained",size:"small",disabled:!l.canMove,onClick:s(l),sx:{height:"32px",mx:.5,minWidth:"51px",padding:"6px 0",borderRadius:9999,fontSize:"14px",lineHeight:"140%",fontWeight:500,opacity:0,transition:"opacity 0.2s ease-in-out"}},n("package__features:project__move_target_modal__button__move")))))))},a8=bO;var IO=o=>{let{open:e,onClose:t,onConfirm:r,moveConversation:n,title:i}=o,{t:a}=v(),s=(0,kr.useCallback)(p=>{r(p)},[r]),l=(0,kr.useCallback)(()=>{t()},[t]);(0,kr.useEffect)(()=>{let p=m=>{m.key==="Escape"&&e&&(m.stopPropagation(),m.preventDefault(),l())};return e&&document.addEventListener("keydown",p,!0),()=>{document.removeEventListener("keydown",p,!0)}},[e,l]);let c=(0,kr.useMemo)(()=>n?`${a("package__features:project__move_target_modal__button__move")} "${n.name}"`:"",[n,a]);return kr.default.createElement(Tm,{show:e,onClose:l,hideDefaultCloseBtn:!0,width:"616px",height:"484px",maxWidth:"calc(100vw - 32px)",modalSx:{zIndex:9999},sx:{maxHeight:"calc(100vh - 32px)",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:0,display:"flex",flexDirection:"column"}},kr.default.createElement(g,{sx:{height:"100%",display:"flex",flexDirection:"column"}},kr.default.createElement(ee,{sx:{position:"absolute",top:16,right:16,zIndex:1,"& svg":{fontSize:"24px"}},onClick:l},kr.default.createElement(s8.default,null)),kr.default.createElement(g,{sx:{p:3,flexDirection:"row",borderBottom:p=>`1px solid ${p.palette.divider}`}},kr.default.createElement(T,{sx:{fontWeight:500,fontSize:20,pr:5,lineHeight:"120%",color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"}},i||c)),kr.default.createElement(g,{sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",py:1}},n&&kr.default.createElement(a8,{moveConversation:n,onMoveConfirm:s,sx:{overflow:"auto"}}))))},l8=IO;var jo=S(M());var vn=S(M());var p8=S(M()),SO=({onDelete:o})=>{let{t:e}=v(),t=e("package__features:chat__conversation_item__delete_chat__dialog__title"),r=e("package__features:chat__conversation_item__delete_chat__description"),n=e("package__common:delete"),{openConfirm:i,closeConfirm:a}=Ra();return{openDeleteConfirm:(0,p8.useCallback)(()=>{i({title:t,content:r,confirmButtonText:n,confirmDangerColor:!0,contentSx:{lineHeight:"1.4",fontSize:"14px",textAlign:"left",fontWeight:400,color:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},onConfirm:async l=>(l&&await o?.(),!0)})},[n,r,t,o,i]),closeDeleteConfirm:a}},c8=SO;var vO=o=>{let{conversation:e,displaysText:t,onClose:r,onClickDelete:n,onClickMove:i,onOpenChanged:a,sx:s}=o,{deleteConversation:l}=Ve(),{t:c}=v(),{removeNewestConversationByIds:u}=ym(),[p,m]=(0,vn.useState)(null),[d,h]=(0,vn.useState)("bottom"),f=b=>{let w=b.getBoundingClientRect();return window.innerHeight-w.bottom>=160?"bottom":"top"},_=b=>{b.preventDefault(),b.stopPropagation(),m(null),a?.(!1),r?.()},x=async()=>{n?n():await l(e.id,()=>{u([e.id]),y()})&&dt.error(c("package__features:chat__conversation_item__delete_chat__button__toast__history_deleted"))},{openDeleteConfirm:C,closeDeleteConfirm:y}=c8({onDelete:x});return vn.default.createElement(vn.default.Fragment,null,vn.default.createElement(ee,{title:c("package__features:chat__chat_history_view__item__more_actions_button__tooltip"),placement:"top-end",tooltipProps:{disableInteractive:!0},onClick:b=>{b.stopPropagation();let w=b.currentTarget,I=f(w);h(I),m(w),a?.(!0)},sx:{...s}},vn.default.createElement(z,{icon:"More",size:16})),vn.default.createElement(An,{anchorEl:p,open:!!p,onClose:_,onClick:_,slotProps:{paper:{elevation:0,sx:{overflow:"unset",background:"transparent"}}},anchorOrigin:{vertical:d==="bottom"?"bottom":"top",horizontal:"right"},transformOrigin:{vertical:d==="bottom"?"top":"bottom",horizontal:"right"}},vn.default.createElement(vi,{offset:{top:0,right:0,bottom:0,left:0},options:[{value:"rename",testid:"chat-conversation--rename-chat-button",icon:vn.default.createElement(z,{icon:"DefaultIcon"}),label:c("package__common:rename")},...i?[{value:"move",testid:"chat-conversation--move-chat-button",icon:vn.default.createElement(z,{icon:"Move"}),label:c("package__features:project__move_target_modal__button__move"),divider:!0}]:[],{value:"delete",testid:"chat-conversation--delete-chat-button",icon:vn.default.createElement(z,{icon:"Delete",sx:{color:"rgba(255, 14, 39, 1)!important"}}),label:c("package__common:delete"),labelSx:{color:"rgba(255, 14, 39, 1)!important"}}],sx:{width:200},onSelectOption:b=>{b==="rename"?Ko.getInstance().emit("showRenameModal",e):b==="move"?i?.(e):b==="delete"&&C(),m(null)}})))},zf=vO;var kg=({conversation:o,size:e=24})=>{let t=o.last_msg||o.match_message;if((t?.meta?.chatMode||t?.originalMessage?.metadata?.chatMode)==="free_chat")return jo.default.createElement(oa,{sx:{fontSize:22}});let n=t?.originalMessage?.metadata?.AIModel||t?.meta?.AIModel||o.meta.AIModel;return n?jo.default.createElement(Jo,{size:e,provider:o.meta.AIProvider,model:n}):jo.default.createElement(oa,{sx:{fontSize:22}})},MO=o=>{let{conversation:e,selected:t,onClick:r,sx:n,style:i,order:a}=o,[s,l]=(0,jo.useState)(!1),{editingNameRef:c,editing:u,setEditing:p,updateConversationName:m}=Sm(),{displaysText:d,displaysTime:h}=J_({...e,name:c.current||e.name});return jo.default.createElement(g,{id:`conversation-item-${e.id}`,"data-testid":a?`conversation-item-${a}`:"conversation-item",spacing:1,style:i,sx:n},jo.default.createElement(g,{direction:"row",alignItems:"center",pl:1.5,pr:1,height:40,onMouseOver:()=>{l(!0)},onMouseOut:()=>{l(!1)},onClick:()=>r?.(e),sx:{cursor:"pointer",borderRadius:"6px",userSelect:"none",...t||u?{bgcolor:f=>f.palette.mode==="dark"?"#383838":"#F0F0F0"}:{"&:hover":{bgcolor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, .1)":"rgba(0, 0, 0, 0.04)"}}},spacing:2},jo.default.createElement(g,{width:"24px",height:"24px",alignItems:"center",justifyContent:"center"},jo.default.createElement(kg,{conversation:e})),jo.default.createElement(g,{width:0,flex:1,position:"relative",direction:"row",alignItems:"center",gap:"2px"},u?jo.default.createElement(xl,{mouseEvent:"onMouseDown",onClickAway:()=>m(e)},jo.default.createElement(Lt,{onClick:f=>{f.stopPropagation()},variant:"standard","data-testid":"maxai--conversation--rename-chat--input",size:"small",ref:f=>{f&&setTimeout(()=>{f.querySelector("input")?.focus()},0)},defaultValue:d,onChange:f=>{f.stopPropagation(),c.current=f.target.value.trim()},onKeyDownCapture:f=>{f.stopPropagation(),f.key==="Enter"&&m(e),f.key==="Escape"&&p(!1)},onPaste:f=>{f.stopPropagation()},sx:{flex:1,"& input":{fontSize:"14px"}}})):jo.default.createElement(T,{color:"text.primary",fontSize:"14px",lineHeight:"24px",noWrap:!0,width:0,flex:1,textAlign:"left"},d),jo.default.createElement(T,{flexShrink:0,color:"text.secondary",fontSize:"12px",lineHeight:"16px",sx:{display:t||s?"none":"block",textAlign:"right",width:"40px"}},h),jo.default.createElement(g,{flexDirection:"row",sx:{width:"40px",justifyContent:"flex-end",...t||s?null:{position:"absolute",right:0,opacity:0}}},jo.default.createElement(zf,{conversation:e,displaysText:d,onClose:()=>l(!1)})))))},yCe=(0,jo.memo)(MO,A_);var u8=S(M()),TO=({onDelete:o})=>{let{t:e}=v(),t=e("package__features:chat__conversation_item__delete_chat_folder__dialog__title"),r=e("package__features:chat__conversation_item__delete_chat_folder__description"),n=e("package__common:delete"),{openConfirm:i,closeConfirm:a}=Ra();return{openDeleteConfirm:(0,u8.useCallback)(()=>{i({title:t,content:r,confirmButtonText:n,confirmDangerColor:!0,contentSx:{lineHeight:"1.4",fontSize:"14px",textAlign:"left",fontWeight:400,color:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},onConfirm:async l=>(l&&await o?.(),!0)})},[n,r,t,o,i]),closeDeleteConfirm:a}},m8=TO;var fi=S(M()),wO=o=>{let{conversation:e,displaysText:t,onClose:r,onClickDelete:n,onOpenChanged:i,onFolderDeleteSuccess:a,sx:s}=o,{deleteConversationFolder:l}=Wi(),{t:c}=v(),[u,p]=(0,fi.useState)(null),m=_=>{_.preventDefault(),_.stopPropagation(),p(null),i?.(!1),r?.()},d=async()=>{n?n():await l(e.id)&&(a?.(e.id),dt.error(c("package__features:chat__conversation_item__delete_chat__button__toast__folder_deleted")),f())},{openDeleteConfirm:h,closeDeleteConfirm:f}=m8({onDelete:d});return fi.default.createElement(fi.default.Fragment,null,fi.default.createElement(ee,{title:c("package__features:chat__chat_history_view__item__more_actions_button__tooltip"),placement:"top-end",tooltipProps:{disableInteractive:!0},onClick:_=>{_.stopPropagation(),p(_.currentTarget),i?.(!0)},sx:{...s}},fi.default.createElement(z,{icon:"More",size:16})),fi.default.createElement(An,{anchorEl:u,open:!!u,onClose:m,onClick:m,slotProps:{paper:{elevation:0,sx:{overflow:"unset",background:"transparent"}}},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},fi.default.createElement(vi,{offset:{top:0,right:0,bottom:0,left:0},options:[{value:"rename",testid:"chat-conversation--rename-chat-button",icon:fi.default.createElement(z,{icon:"DefaultIcon"}),label:c("package__common:rename")},{value:"delete",testid:"chat-conversation--delete-chat-button",icon:fi.default.createElement(z,{icon:"Delete",sx:{color:"rgba(255, 14, 39, 1)!important"}}),label:c("package__common:delete"),labelSx:{color:"rgba(255, 14, 39, 1)!important"}}],sx:{width:200},onSelectOption:_=>{_==="rename"?Ko.getInstance().emit("showRenameGroupModal",e):_==="delete"&&h(),p(null)}})))},d8=wO;var Ae=S(M()),Og=S(M());var Lg=S(M()),Uf=()=>{let{t:o}=v(),{executeMoveOperation:e,cleanupOptimisticUpdates:t,rollbackMove:r}=R_(),n=(0,Lg.useCallback)((a,s=!1)=>{dt.error(a||"",{autoHideDuration:3e3})},[]);return{moveConversation:(0,Lg.useCallback)(async(a,s,l={})=>{let{getSourceName:c,getTargetName:u,onSuccess:p,onError:m,onHighlight:d}=l;try{if(a.item_type&&a.item_type!=="conversation")return;let h=a.group_id||"",f=s;if(h===f)return;let _={itemId:a.id,conversation:a,oldGroupId:h,newGroupId:f,updatedConversation:{...a,group_id:f}},{newQueryKey:x}=await e(_);d?.(a.id),await Co.getService().addOrUpdateConversation(a.id,_.updatedConversation,{syncToRemote:!0,updateUpdatedAt:!1,waitForRemoteSync:!0}),setTimeout(()=>t(x),500);let C=c?c(a):a.name,y=u?u(s):s||o("package__features:chat__chat_history_view__root__title");n(o("package__features:project__success_msg__move_single__successful",{DRAG_ITEM:Fl(C,null,230,new Map)[0],DROP_ITEM:Fl(y,null,230,new Map)[0]})),p?.()}catch(h){let f=a.group_id||"",_=s,x={itemId:a.id,conversation:a,oldGroupId:f,newGroupId:_,updatedConversation:{...a,group_id:_}},C=f?Ll(a.type,f):j1(a.type),y=_?Ll(a.type,_):j1(a.type);r(x,C,y),n(o("package__features:project__error_msg__move_single_failed"),!0),m?.(h)}},[o,n,e,t,r])}};var f8=o=>o.sort((e,t)=>{if(e.type!==t.type)return e.type==="group"?-1:1;if(e.type==="group")return(e.name??"").localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"});{let r=e.metadata?.updated_at||"";return(t.metadata?.updated_at||"").localeCompare(r)}}),EO=(o,e,t,r=new Map,n,i,a)=>{let s=new Map,l=new Map,c=[];return o.forEach(u=>{if(s.set(u.id,u),u.item_type==="group"){let p=n?.get(u.id),m=p?.isLoading||!1,d=p?.hasNextPage||!1,h=p?.isFetchingNextPage||!1,f={id:u.id,name:u.group_name,type:"group",parentId:null,metadata:u,loading:m,childrenHasMore:d,childrenIsFetchingNextPage:h,children:[]};l.set(u.id,f),r.set(u.id,f)}else{let p=cm(u),m=u_(u.updated_at),d={id:u.id,name:p,type:"item",parentId:null,metadata:u,extra:{displaysText:p,displaysTime:m}};l.set(u.id,d),r.set(u.id,d)}}),l.forEach(u=>{let p=u.metadata;if(p.item_type==="group")u.parentId=e?.id||null,c.push(u);else if(!p.group_id)u.parentId=e?.id||null,c.push(u);else if(l.has(p.group_id)){let m=l.get(p.group_id);u.parentId=p.group_id,m.children||(m.children=[]),m.children.push(u)}else(i||a)&&(u.parentId=e?.id||null,c.push(u))}),e&&(e.children=f8(c),l.forEach(u=>{u.type==="group"&&u.children&&u.children.length>0&&(u.children=f8(u.children))})),{parentDataItem:e,treeDataFlatMap:r}},h8=(0,Ae.memo)(o=>{let{conversationType:e,groupId:t,onQueryStateUpdate:r}=o,n=U_("ChildrenQueryManager",Ll(e,t),e,t,!1);return(0,Ae.useEffect)(()=>{r(t,n)},[n,r,t]),(0,Ae.useEffect)(()=>()=>{r(t,null)},[]),Ae.default.createElement(Ae.default.Fragment,null)});h8.displayName="ChildrenQueryManager";var g8=(0,Ae.forwardRef)((o,e)=>{let{isLiteMode:t=!1,conversations:r,folderChildren:n,setFolderChildren:i,activeConversationIds:a,disabledTooltip:s,sx:l,onClose:c,isSearchMode:u=!1,nextPageOptions:p,onHistoryItemClick:m,setOnResetFolderStates:d,folderHighlightedItems:h=new Set,historyHighlightedItems:f=new Set,isShowNoParentConversation:_=!1,onMoveConversation:x,onHighlight:C}=o,y=(0,Ae.useRef)(null),{t:b}=v();(0,Ae.useImperativeHandle)(e,()=>({toggleGroup:(Z,J)=>{y.current?.toggleGroup(Z,J)},scrollToItem:Z=>{y.current?.scrollToItem(Z)},scrollToItemIfNotVisible:Z=>{y.current?.scrollToItemIfNotVisible(Z)}}),[]);let[w,I]=(0,Ae.useState)(null),[E,P]=(0,Ae.useState)(new Map),{switchConversation:O,asyncUpdateConversation:N}=Ve(),{queryClient:V}=Cm(),{folderQueriesRef:A}=Wi(),{moveConversation:D}=Uf(),W=(0,Ae.useCallback)(()=>{A.current?.forEach((Z,J)=>{Z.reset?.()}),A.current?.clear(),P(new Map)},[]),k=(0,Ae.useCallback)(Z=>{let J=A.current?.get(Z);J&&J.reset?.(),i(j=>j.filter(ce=>ce.group_id!==Z))},[]);(0,Ae.useEffect)(()=>{d&&d(W)},[d,W]);let[U,K]=(0,Ae.useState)(null),H=(0,Ae.useRef)(new Map),{treeViewData:R,openedGroups:F}=(0,Og.useMemo)(()=>{let Z=new Set,J={id:"root",name:"",type:"group",parentId:null,metadata:{}},{parentDataItem:j,treeDataFlatMap:ce}=EO(r,J,Z,H.current,E,u,_);return K(j),H.current.set(J.id,j),{treeViewData:j,openedGroups:Z}},[r,E,u,_]),Y=(0,Og.useMemo)(()=>{let Z=new Set;return a.forEach(J=>Z.add(J)),h.forEach(J=>Z.add(J)),f.forEach(J=>Z.add(J)),Z},[a,h,f]),$=(0,Ae.useCallback)(Z=>({...Y.has(Z.id)&&{backgroundColor:J=>J.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.06)"},...Z.id===w&&{backgroundColor:J=>J.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)",".maxai_history__item__time":{display:"none"},".maxai_history__item__more_actions":{position:"static",opacity:1}},"&:hover":{".maxai_history__item__time":{display:"none"},".maxai_history__item__more_actions":{position:"static",opacity:1}},padding:t?"0 2px 0 8px":"0 16px!important",height:t?"36px":"44px",m:"2px 0"}),[w,Y,t]),ie=(0,Ae.useCallback)((Z,J)=>Z.type==="group"?Z.loading?Ae.default.createElement(g,{sx:{width:"20px",height:"20px",alignItems:"center",justifyContent:"center"}},Ae.default.createElement(Jt,{size:16})):Ae.default.createElement(Xa,{size:20,isExpand:J}):Ae.default.createElement(kg,{size:20,conversation:Z.metadata}),[]),G=(Z,J)=>{let j=Z.metadata;return j.item_type==="group"?Ae.default.createElement(Ae.default.Fragment,null,j.id&&Ae.default.createElement(h8,{conversationType:j.group_type,groupId:j.id,onQueryStateUpdate:ue}),Ae.default.createElement(g,{flexDirection:"row",className:"maxai_history__item__more_actions",sx:{width:"40px",justifyContent:"flex-end",position:"absolute",right:"18px",opacity:0}},Ae.default.createElement(d8,{conversation:j,displaysText:Z.extra?.displaysTime||"",onFolderDeleteSuccess:k,onOpenChanged:ce=>{I(ce?Z.id:null)}}))):Ae.default.createElement(g,{alignItems:"center",direction:"row",gap:"2px"},Ae.default.createElement(T,{flexShrink:0,color:"text.secondary",fontSize:"12px",lineHeight:"16px",className:"maxai_history__item__time",sx:{display:"block",textAlign:"right",width:"40px",mr:"2px"}},Z.extra?.displaysTime),Ae.default.createElement(g,{flexDirection:"row",className:"maxai_history__item__more_actions",sx:{width:"40px",justifyContent:"flex-end",position:"absolute",right:"18px",opacity:0}},Ae.default.createElement(zf,{conversation:j,displaysText:Z.extra?.displaysTime||"",onOpenChanged:ce=>{I(ce?Z.id:null)},onClickMove:x?()=>x(j):void 0})))},B=(0,Ae.useCallback)(async(Z,J)=>{let j=Z[0],ce=H.current.get(j);if(!ce)return;let ke=ce.metadata;if(!ke||ke.item_type==="group")return;let at=J.id==="root"?"":J.id;await D(ke,at,{getSourceName:we=>ce.name,getTargetName:we=>we===""?b("package__features:chat__chat_history_view__root__title"):J.name,onHighlight:C})},[H,D,b,C]),ae=(0,Ae.useCallback)(async(Z,J)=>{let{isOpened:j}=J,ce=A.current?.get(Z.id),ke=ce?.isLoading||!1,at=(ce?.data?.pages?.length||0)>0,we=ce?.isFetched||!1,tt=Ll(r[0]?.type||"Chat",Z.id),Zt=V.getQueryData(tt)?.pages?.[0]?.__hasOptimisticUpdates;j||ke||(Zt||!we)&&await ce?.refetch()},[A,V,r]),X=(0,Ae.useCallback)(Z=>{let J=A.current?.get(Z.id);J&&J.hasNextPage&&!J.isFetchingNextPage&&!J.isLoading&&J.fetchNextPage?.()},[]),oe=(0,Ae.useCallback)(async Z=>{if(Z.type!=="item")return;m?.(Z);let J=Z.metadata;if(a.includes(J.id)){c?.();return}if(J.item_type!=="group"&&J.id){await Co.getService().addOrUpdateConversation(J.id,J,{syncToRemote:!1,isPartialUpdate:!1,updateUpdatedAt:!1});let j={...J,updated_at:new Date().toISOString()};await eC(),await O(J.id,j),c?.(),N(J.id)}},[m,a,c,O,N]),ue=(0,Ae.useCallback)((Z,J)=>{if(J){A.current?.set(Z,J),i(at=>{let we=J.data?.pages.flatMap(tt=>tt.data)||[];return[...at.filter(tt=>tt.group_id!==Z),...we]});let j=J.isLoading,ce=J.hasNextPage||!1,ke=J.isFetchingNextPage||!1;P(at=>{let we=new Map(at);return we.set(Z,{isLoading:j,hasNextPage:ce,isFetchingNextPage:ke}),we})}else P(j=>{let ce=new Map(j);return ce.delete(Z),ce})},[]);return U&&Ae.default.createElement(Em,{itemHeight:t?40:48,ref:y,temporarilyOpenAllChildren:u,disableToggleGroup:u,disabledGroupDrag:!0,rootItem:U,defaultOpenedGroups:F,activatedItems:Y,slotItemRight:G,slotTitleLeft:ie,onItemMove:B,onItemClick:oe,onGroupItemClick:ae,onClickLoadMore:X,hideCheckbox:!0,itemSx:$,groupChildrenContainerSx:{pl:"8px"},edgeDropZoneWidth:t?16:8,nextPageOptions:p,maxTooltipLength:500})});g8.displayName="ChatHistoryTreeView";var x8=g8;var fr=S(M());var PO=o=>{let{anchorElementSelectors:e='[data-testid="sidebar-nav--new-chat-button"]',placement:t=ao?"bottom-start":"left-end",...r}=o,{t:n}=v(),[i,a]=fr.default.useState(!1),[s,l]=fr.default.useState(!0),c=te(f=>f.conversationIds),u=er(c[0]),p=ge(c[0]),m=(0,fr.useRef)(!1),d=(0,fr.useCallback)(async()=>{let f=await qe.getOnboardingDataByKey(Tc),_=await qe.getOnboardingDataByKey(Ld),x=f&&_,C=u.find(b=>b.type==="ai"),y=C&&C.originalMessage?.metadata?.chatMode==="pro_chat";(x||y)&&u.length>0&&p===!1&&m.current===!0&&a(!0)},[u,p]),{extensionTourOnBoardingOpened:h}=on();return(0,fr.useEffect)(()=>{h&&qe.getOnboardingDataByKey(wc).then(f=>l(!!f))},[h]),(0,fr.useEffect)(()=>{s||d()},[s,d]),(0,fr.useEffect)(()=>{p&&(m.current=!0)},[p]),s?null:fr.default.createElement(fr.default.Fragment,null,fr.default.createElement(Bt,{trigger:i,placement:t,anchorElementSelectors:e,onShow:()=>{qe.setOnboardingData(wc,!0)},CtaButtonProps:{"data-button-clicked-name":"Onboarding > New chat > Got it"},...r},fr.default.createElement(g,{spacing:.5},fr.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},n("package__features:onboarding__onboarding_popover__new_chat__title")),fr.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},n("package__features:onboarding__onboarding_popover__new_chat__description")))))},Bg=PO;var $o=S(M()),AO=o=>{let{variant:e="text",sx:t,title:r,tooltipProps:n,onNewChatSuccess:i,...a}=o,{t:s}=v(),{createConversation:l}=Ve(),{chatHubLoading:c}=rt(),{resetMyOwnToolsType:u}=Hr(),{layout:p,conversationType:m,setConversationIds:d,setCurrentDocument:h,setEnableSearch:f}=te(b=>({layout:b.layout,conversationType:b.conversationType,setConversationIds:b.setConversationIds,setCurrentDocument:b.setCurrentDocument,setEnableSearch:b.setEnableSearch})),{setLocalSettings:_}=I2(),[x,C]=(0,$o.useState)(!1),y=async()=>{if(C(!0),!await Fe({emitEvent:!0})){C(!1);return}try{let I=(await l(m,{reason:"manualClick"})).filter((E,P)=>P<p).map(E=>E.id);d(I),u(),h(E=>E&&{...E,selected:!0}),f(!1),_({chatSource:{enableCurrent:!0,enableSearch:!1}}),i?.()}catch{}finally{C(!1)}};return e==="text"?$o.default.createElement(le,{"data-testid":"sidebar-nav--new-chat-button",startIcon:$o.default.createElement(z,{icon:"NewChat",sx:{fontSize:"24px"}}),sx:{height:"32px",padding:"8px 12px!important",borderRadius:"8px",border:"1px solid",borderColor:b=>b.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)!important":"rgba(0, 0, 0, 0.12)!important",color:b=>b.palette.mode==="dark"?"rgba(255, 255, 255)":"rgba(0, 0, 0, 0.6)",fontSize:"16px",lineHeight:"20px",...t},onClick:y,...a},s("package__features:chat__create_button__chat_action__title")):e==="outlined"?$o.default.createElement($o.default.Fragment,null,$o.default.createElement(le,{"data-testid":"sidebar-nav--new-chat-button",variant:"outlined",color:"primary",startIcon:$o.default.createElement(z,{icon:"NewChat",sx:{fontSize:14}}),onClick:y,disabled:c,sx:{height:"40px",borderRadius:"9999px",borderWidth:"1px",borderColor:"border.main",[`.${ea.startIcon}`]:{marginRight:"10px"},...t},...a},$o.default.createElement(T,{component:"h2",sx:{fontSize:"inherit",fontWeight:"inherit"}},s("package__features:chat__create_button__chat_action__title"))),$o.default.createElement(Bg,null)):e==="item"?$o.default.createElement(cn,{onClick:y,disabled:c||x,loading:x,loadingPosition:"start",startIcon:$o.default.createElement(z,{icon:"NewChat",sx:{fontSize:19,color:"text.primary"}}),sx:{...t,justifyContent:"flex-start",gap:2,px:2,height:"44px",[`& .${ea.startIcon}`]:{m:0},[`& .${Xp.loadingIndicator}`]:{color:"text.primary",marginLeft:"12px"}}},$o.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},s("package__features:chat__create_button__chat_action__title"))):$o.default.createElement($o.default.Fragment,null,$o.default.createElement(ee,{tooltipProps:{placement:"left",...n},title:r||s("package__features:chat__navbar__button__new_chat"),testid:"sidebar-nav--new-chat-button",onClick:y,disabled:c,sx:t,...a},$o.default.createElement(z,{icon:"NewChat"})),$o.default.createElement(Bg,null))},ol=AO;var _8=S(M()),kO=o=>{let{open:e,onClose:t,onConfirm:r}=o,{t:n}=v(),i=n("package__features:chat__conversation_list__delete_all_chat__dialog__title"),a=n("package__features:chat__conversation_list__delete_all_chat__dialog__description"),s=n("package__common:delete"),{openConfirm:l}=Ra();return(0,_8.useEffect)(()=>{e&&l({title:i,content:a,confirmButtonText:s,confirmDangerColor:!0,contentSx:{lineHeight:"1.4",fontSize:"14px",textAlign:"left",fontWeight:400,color:c=>c.palette.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"},onConfirm:async c=>(c&&await r(),!0),onClose:t})},[e,l,t,r,i,a,s,n]),null},C8=kO;var qn=S(M()),LO=o=>{let{onDeleted:e,deleteOption:t,...r}=o,{t:n}=v(),{layout:i,conversationType:a,setConversationIds:s}=te(f=>({layout:f.layout,conversationType:f.conversationType,setConversationIds:f.setConversationIds})),{createConversation:l,deleteConversationsByType:c}=Ve(),[u,p]=(0,qn.useState)(null),[m,d]=(0,qn.useState)(!1),h=async()=>{try{await c(a);let _=(await l(a,{reason:"initCreate"})).filter((x,C)=>C<i).map(x=>x.id);s(_),dt.error(n("package__features:chat__conversation_item__delete_chat__button__toast__all_history_deleted")),e?.()}catch{}finally{d(!1)}};return qn.default.createElement(qn.default.Fragment,null,qn.default.createElement(ee,{title:n("package__common:more"),placement:"top-end",tooltipProps:{disableInteractive:!0},onClick:f=>{p(f.currentTarget)},...r},qn.default.createElement(z,{icon:"More",size:20})),qn.default.createElement(An,{anchorEl:u,open:!!u,onClose:()=>{p(null)},slotProps:{paper:{elevation:0,sx:{overflow:"unset",background:"transparent"}}},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},qn.default.createElement(vi,{offset:{top:0,right:0,bottom:0,left:0},options:[{value:"delete",icon:qn.default.createElement(z,{icon:"Delete",sx:t?.disabled?null:{color:"rgba(255, 14, 39, 1)!important"}}),label:n("package__features:chat__conversation_list__delete_all_chat__button__title"),labelSx:t?.disabled?null:{color:"rgba(255, 14, 39, 1)!important"},testid:"maxai-clear-all-chat-button",...t}],sx:{width:200},onSelectOption:f=>{f==="delete"&&d(!0),p(null)}})),qn.default.createElement(C8,{open:m,onClose:()=>d(!1),onConfirm:h}))},y8=LO;var b8=S(Cr()),I8=S(im());var he=S(M()),OO=({sx:o,onClose:e,onNewChatSuccess:t,onHistoryItemClick:r,setInternalHandleCloseRef:n})=>{let{t:i}=v(),a=(0,he.useRef)(null),[s,l]=(0,he.useState)(!1),c=te(j=>j.conversationType),{createConversationFolder:u}=Ve(),[p,m]=(0,he.useState)(!1),[d,h]=(0,he.useState)(null),{moveConversation:f}=Uf(),_=(0,he.useRef)(null),x=(0,he.useRef)(null),[C,y]=(0,he.useState)(new Set),[b,w]=(0,he.useState)(new Set),I=(0,he.useRef)(null),E=(0,he.useRef)(!1),P=(0,he.useCallback)(()=>{y(new Set)},[]),O=(0,he.useCallback)(()=>{I.current&&(clearTimeout(I.current),I.current=null),w(new Set)},[]),N=(0,he.useCallback)(()=>{P(),O()},[P,O]);(0,he.useEffect)(()=>{if(C.size===0&&b.size===0)return;let j=()=>{N()};return document.addEventListener("click",j),document.addEventListener("keydown",j),document.addEventListener("scroll",j,!0),()=>{document.removeEventListener("click",j),document.removeEventListener("keydown",j),document.removeEventListener("scroll",j,!0)}},[C.size,b.size,N]);let V=(0,he.useCallback)(j=>{I.current&&(clearTimeout(I.current),I.current=null),w(new Set([j])),setTimeout(()=>{x.current?.scrollToItemIfNotVisible(j)},100),I.current=setTimeout(()=>{w(new Set),I.current=null},3e3)},[]),A=async j=>{let ce=await u(c,j);return ce?typeof ce=="string"?ce:(l(!1),ce.id&&(y(new Set([ce.id])),setTimeout(()=>{x.current?.scrollToItemIfNotVisible(ce.id)},100)),""):""},{chatHistoryPagination:{conversations:D,isRefetching:W,isFetchingNextPage:k,fetchNextPage:U,hasNextPage:K,refetch:H},setQuery:R,isSearchMode:F,activeConversationIds:Y,folderChildren:$,setFolderChildren:ie,allFolders:G}=Wi();(0,he.useEffect)(()=>()=>{R(""),I.current&&clearTimeout(I.current)},[R]),(0,he.useEffect)(()=>{if(a.current){Ko.getInstance().setInputEl(a.current);let j=setTimeout(()=>{a.current?.focus()},500);return()=>clearTimeout(j)}},[]);let B=(0,he.useCallback)(()=>{R(""),_.current&&_.current(),e?.()},[e,R]),ae=(0,he.useMemo)(()=>({isFetchingNextPage:k,fetchNextPage:U,hasNextPage:K}),[k,U,K]);(0,he.useEffect)(()=>{n?.(B)},[B,n]);let X=(0,he.useCallback)(()=>{requestAnimationFrame(()=>{let j=Ko.getInstance().getInputEl();setTimeout(()=>{j?.focus()},500)})},[]),oe=(0,he.useCallback)(j=>{_.current=j},[]),ue=(0,he.useCallback)(async()=>{},[]),Z=(0,he.useCallback)(async j=>{m(!1);let ce=d;h(null),ce&&await f(ce,j,{getSourceName:ke=>ke.name,getTargetName:ke=>ke?G.find(we=>we.id===ke)?.group_name||ke:i("package__features:chat__chat_history_view__root__title"),onSuccess:()=>{F&&H()},onHighlight:V})},[d,G,i,f,H,F,V]),J=(0,he.useCallback)(j=>{h(j),m(!0)},[]);return(0,he.useEffect)(()=>(Ko.getInstance().on("renameOnClose",X),()=>{Ko.getInstance().off("renameOnClose",X)}),[X]),he.default.createElement(g,{sx:{width:"100%",height:"100%",overflow:"hidden",...o},tabIndex:-1},he.default.createElement(g,{direction:"row",alignItems:"center",sx:{p:2,gap:1,borderBottom:"1px solid",borderColor:"border.main",marginBottom:"8px"}},he.default.createElement(Lt,{onCopy:j=>{j.stopPropagation()},onCut:j=>{j.stopPropagation()},onPaste:j=>{j.stopPropagation()},onKeyUpCapture:j=>{j.key!=="Escape"&&j.stopPropagation()},onKeyUp:j=>{j.key!=="Escape"&&j.stopPropagation()},onKeyDownCapture:j=>{j.key!=="Escape"&&j.stopPropagation()},onKeyDown:j=>{(j.key!=="Escape"||E.current)&&j.stopPropagation()},onCompositionStart:()=>{E.current=!0},onCompositionEnd:j=>{E.current=!1,R(j.target.value)},fullWidth:!0,inputRef:a,placeholder:i("package__features:chat__chat_history_view__search_input__placeholder"),inputProps:{autoComplete:"off"},sx:{[`&  .${Ji.input}`]:{boxSizing:"border-box",height:"32px",p:0,pl:1,fontSize:"16px",lineHeight:"1.5",fontWeight:400},[`& > .${Ji.root} > fieldset`]:{borderColor:"transparent !important"}},onChange:j=>{E.current||R(j.target.value)}}),he.default.createElement(je,{onClick:B,sx:{p:"6px"}},he.default.createElement(b8.default,{sx:{color:"text.secondary"}}))),!F&&he.default.createElement(ol,{variant:"item",tooltipProps:{placement:"bottom"},sx:{mx:1,px:2,height:"44px",minWidth:"auto","& svg":{fontSize:24}},onNewChatSuccess:()=>{B(),t?.()}}),W?he.default.createElement(g,{spacing:1,px:2,py:1},[100,"100%",100,"100%"].map((j,ce)=>he.default.createElement(vt,{key:ce,variant:"rounded",width:j,height:20,sx:{borderRadius:"4px"}}))):he.default.createElement(he.default.Fragment,null,!F&&he.default.createElement(g,{sx:{mx:"8px",my:"2px",px:"16px",height:"44px",flexDirection:"row",alignItems:"center"}},he.default.createElement(T,{fontSize:12,lineHeight:1.5,color:"text.secondary",fontWeight:500,textAlign:"left",flex:1},i("package__features:chat__chat_history_view__root__title")),he.default.createElement(g,{direction:"row",gap:"2px",alignItems:"center"},he.default.createElement(y8,{deleteOption:{disabled:D.length===0},onDeleted:ue}),he.default.createElement(ee,{title:i("package__features:chat__inputbox__my_own_tools__modal__new_folder_button__tooltip"),tooltipProps:{disableInteractive:!0,disableFocusListener:!0,arrow:!0,placement:"top-end"},sx:o,onClick:j=>{j.stopPropagation(),l(!0)}},he.default.createElement(Ou,{sx:{fontSize:20}})),he.default.createElement(_C,{show:s,onClose:j=>{l(!1)},onConfirm:A}))),D.length===0&&(F?he.default.createElement(g,{sx:{flexDirection:"row",justifyContent:"flex-start",alignItems:"center",gap:2,mx:1,px:2,height:"44px"}},he.default.createElement(I8.default,{sx:{color:j=>j.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.38)"}}),he.default.createElement(T,{sx:{fontSize:14,lineHeight:1.5,fontWeight:400,textAlign:"left",color:j=>j.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.38)"}},i("package__features:chat__history_view__search_empty__title"))):he.default.createElement(g,{sx:{flexDirection:"row",height:"44px",justifyContent:"flex-start",alignItems:"center",padding:"0 24px"}},he.default.createElement(T,{sx:{fontSize:14,lineHeight:1.5,fontWeight:400,textAlign:"left",color:j=>j.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.38)"}},i("package__features:chat__history_view__empty__title")))),he.default.createElement(g,{sx:{flex:1,height:"0",overflow:"auto",paddingBottom:"16px"}},D.length>0&&he.default.createElement(x8,{ref:x,conversations:D,folderChildren:$,setFolderChildren:ie,onClose:B,onHistoryItemClick:r,isSearchMode:F,nextPageOptions:ae,activeConversationIds:Y,setOnResetFolderStates:oe,folderHighlightedItems:C,historyHighlightedItems:b,onHighlight:V,onMoveConversation:J}))),he.default.createElement(l8,{open:p,onClose:()=>{m(!1),h(null)},onConfirm:Z,moveConversation:d}))},S8=OO;var BO=o=>{let{open:e,onClose:t,onNewChatSuccess:r,onHistoryItemClick:n,paperRef:i}=o;lm((c,u)=>{c==="SyncContextMenuConversationInSidebar"&&e&&l?.()});let a=(0,Mn.useRef)(()=>{}),s=(0,Mn.useCallback)(c=>{a.current=c},[]),l=(0,Mn.useCallback)(()=>{a.current?.()},[]);return Mn.default.createElement(Mn.default.Fragment,null,Mn.default.createElement(i8,null),Mn.default.createElement(r8,null),Mn.default.createElement(Pa,{open:e,onClose:l,anchor:"bottom",disableEnforceFocus:!0,disableRestoreFocus:!0,sx:{zIndex:1502,position:"absolute",[`& .${Ea.paper}`]:{position:"absolute",borderTopRightRadius:16,borderTopLeftRadius:16,height:"90vh",bgcolor:"background.paper"}},slotProps:{backdrop:{sx:{position:"absolute"}}}},Mn.default.createElement(_r,{tabIndex:-1,onKeyDown:c=>{e&&c.key==="Escape"&&l()},ref:i,elevation:0,sx:{boxSizing:"border-box",width:"100%",height:"100%",borderRadius:0}},e&&Mn.default.createElement(S8,{onClose:t,onNewChatSuccess:r,onHistoryItemClick:n,setInternalHandleCloseRef:s}))))},v8=BO;var DO=o=>{let{placement:e="bottom-start",tooltipProps:t,sx:r,iconSx:n,onHistoryModalToggle:i}=o,{betaSettings:a}=Sr(),{t:s}=v(),{loaded:l,isLogin:c}=Po(),[u,p]=Wt.default.useState(!1),m=(0,Wt.useRef)(null),{conversationId:d,conversationType:h}=te(F=>({conversationId:F.conversationIds[0],conversationType:F.conversationType})),f=er(d),{switchConversation:_,asyncUpdateConversation:x}=Ve(),{chatHubLoading:C}=rt(),{setQuery:y,chatHistoryPagination:{refetch:b},liteHistoryData:w}=Wi(),I=(0,Wt.useCallback)(()=>{p(!1)},[]);(0,Wt.useEffect)(()=>{H.current&&(I(),H.current=!1)},[h,I]);let E=s("package__features:chat__inputbox__button__chat_history__tooltip"),[P,O]=(0,Wt.useState)(!1),N=f.length===0,[V,A]=(0,Wt.useState)(!1),D=(0,Wt.useMemo)(()=>c&&a?.appearance_v2_enabled&&N&&ao?[{testid:"maxai--chat-history-button--options--chat-history",value:"chat-history",label:s("package__features:chat__inputbox__button__chat_history__tooltip"),icon:Wt.default.createElement(z,{icon:"History"})},{testid:"maxai--chat-history-button--options--clear-history",value:"continue-last-chat",label:s("package__features:chat__chat_history_button__continue_last_chat"),icon:V?Wt.default.createElement(z,{sx:{width:"20px",fontSize:"16px"},icon:"Loading"}):Wt.default.createElement(z,{sx:{fontSize:"20px"},icon:"HistoryOne"}),sx:{paddingLeft:V?"14px":"10px"}}]:[],[a?.appearance_v2_enabled,N,V,c,s]),W=(0,Wt.useCallback)(async F=>{await Co.getService().addOrUpdateConversation(F.id,F,{syncToRemote:!1,isPartialUpdate:!1,updateUpdatedAt:!0}),F.updated_at=new Date().toISOString(),await _(F.id,F),await x(F.id)},[x,_]),k=$e(i),U=!P&&V,K=(0,Wt.useCallback)(async()=>{let F=null;if(A(!0),F=w.filter($=>$.lastMessageId)[0],!F){dt.info(s("package__features:chat__conversation_list__no_conversation__title"),{autoHideDuration:1500,disableWindowBlurListener:!0}),A(!1);return}await W({...F}),A(!1)},[W,w,s]);(0,Wt.useEffect)(()=>{u&&setTimeout(()=>{m.current?.focus()},100),k.current&&k.current(u)},[u]);let H=(0,Wt.useRef)(!1),R=(0,Wt.useCallback)(()=>{p(!0),y(""),b()},[]);return Wt.default.createElement(Wt.default.Fragment,null,Wt.default.createElement(ee,{placement:e||"bottom",title:D.length<1?E:null,"data-testid":"maxai-chat-history-button",disabled:C,tooltipProps:{placement:"bottom",...t},sx:r,OptionsCardProps:{sx:{width:"188px"}},options:D,onPopupStateChange:F=>{O(F)},defaultOptionValue:"chat-history",onClick:async()=>{if(D.length>0||!l)return;let F=c;F||(F=await Fe({emitEvent:!0})),F&&R()},onSelectOption:async F=>{F==="chat-history"?(setTimeout(()=>{m.current?.focus()},100),R()):F==="continue-last-chat"&&await K()}},Wt.default.createElement(z,{icon:U?"Loading":"History",sx:{fontSize:"20px",scale:U?"0.8":"1",...n}})),Wt.default.createElement(v8,{open:u,onClose:I,paperRef:m}),Wt.default.createElement(o8,null))},M8=DO;var kp=S(bi()),fo=S(M()),HO=o=>fo.default.createElement(kp.default,{...o},fo.default.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},fo.default.createElement("path",{d:"M10.8004 2.00012H5.20037C4.08026 2.00012 3.52021 2.00012 3.09239 2.21811C2.71606 2.40986 2.4101 2.71582 2.21835 3.09214C2.00037 3.51996 2.00037 4.08002 2.00037 5.20012V10.8001C2.00037 11.9202 2.00037 12.4803 2.21835 12.9081C2.4101 13.2844 2.71606 13.5904 3.09239 13.7821C3.52021 14.0001 4.08026 14.0001 5.20037 14.0001H10.8004C11.9205 14.0001 12.4805 14.0001 12.9083 13.7821C13.2847 13.5904 13.5906 13.2844 13.7824 12.9081C14.0004 12.4803 14.0004 11.9202 14.0004 10.8001V5.20012C14.0004 4.08002 14.0004 3.51996 13.7824 3.09214C13.5906 2.71582 13.2847 2.40986 12.9083 2.21811C12.4805 2.00012 11.9205 2.00012 10.8004 2.00012Z",stroke:"currentColor",strokeOpacity:"0.87",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}))),T8=o=>fo.default.createElement(kp.default,{...o},fo.default.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},fo.default.createElement("path",{d:"M8 2V14M5.2 2H10.8C11.9201 2 12.4802 2 12.908 2.21799C13.2843 2.40973 13.5903 2.71569 13.782 3.09202C14 3.51984 14 4.0799 14 5.2V10.8C14 11.9201 14 12.4802 13.782 12.908C13.5903 13.2843 13.2843 13.5903 12.908 13.782C12.4802 14 11.9201 14 10.8 14H5.2C4.07989 14 3.51984 14 3.09202 13.782C2.71569 13.5903 2.40973 13.2843 2.21799 12.908C2 12.4802 2 11.9201 2 10.8V5.2C2 4.07989 2 3.51984 2.21799 3.09202C2.40973 2.71569 2.71569 2.40973 3.09202 2.21799C3.51984 2 4.0799 2 5.2 2Z",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}))),FO=o=>fo.default.createElement(kp.default,{...o},fo.default.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},fo.default.createElement("path",{d:"M6 2V14M10 2V14M5.2 2H10.8C11.9201 2 12.4802 2 12.908 2.21799C13.2843 2.40973 13.5903 2.71569 13.782 3.09202C14 3.51984 14 4.0799 14 5.2V10.8C14 11.9201 14 12.4802 13.782 12.908C13.5903 13.2843 13.2843 13.5903 12.908 13.782C12.4802 14 11.9201 14 10.8 14H5.2C4.07989 14 3.51984 14 3.09202 13.782C2.71569 13.5903 2.40973 13.2843 2.21799 12.908C2 12.4802 2 11.9201 2 10.8V5.2C2 4.07989 2 3.51984 2.21799 3.09202C2.40973 2.71569 2.71569 2.40973 3.09202 2.21799C3.51984 2 4.0799 2 5.2 2Z",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}))),NO=o=>fo.default.createElement(kp.default,{...o},fo.default.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},fo.default.createElement("path",{d:"M2 8H14M8 2V14M5.2 2H10.8C11.9201 2 12.4802 2 12.908 2.21799C13.2843 2.40973 13.5903 2.71569 13.782 3.09202C14 3.51984 14 4.0799 14 5.2V10.8C14 11.9201 14 12.4802 13.782 12.908C13.5903 13.2843 13.2843 13.5903 12.908 13.782C12.4802 14 11.9201 14 10.8 14H5.2C4.07989 14 3.51984 14 3.09202 13.782C2.71569 13.5903 2.40973 13.2843 2.21799 12.908C2 12.4802 2 11.9201 2 10.8V5.2C2 4.07989 2 3.51984 2.21799 3.09202C2.40973 2.71569 2.71569 2.40973 3.09202 2.21799C3.51984 2 4.0799 2 5.2 2Z",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}))),VO=o=>fo.default.createElement(kp.default,{...o},fo.default.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},fo.default.createElement("path",{d:"M6 14L6 2M10 14V2M2 8H14M2 10.8L2 5.2C2 4.07989 2 3.51984 2.21799 3.09202C2.40973 2.71569 2.71569 2.40973 3.09202 2.21799C3.51984 2 4.0799 2 5.2 2H10.8C11.9201 2 12.4802 2 12.908 2.21799C13.2843 2.40973 13.5903 2.71569 13.782 3.09202C14 3.51984 14 4.07989 14 5.2V10.8C14 11.9201 14 12.4802 13.782 12.908C13.5903 13.2843 13.2843 13.5903 12.908 13.782C12.4802 14 11.9201 14 10.8 14H5.2C4.07989 14 3.51984 14 3.09202 13.782C2.71569 13.5903 2.40973 13.2843 2.21799 12.908C2 12.4802 2 11.9201 2 10.8Z",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}))),RO=o=>{let{layout:e,...t}=o;switch(e){case 1:return fo.default.createElement(HO,{...t});case 2:return fo.default.createElement(T8,{...t});case 3:return fo.default.createElement(FO,{...t});case 4:return fo.default.createElement(NO,{...t});case 6:return fo.default.createElement(VO,{...t});default:return fo.default.createElement(T8,{...t})}},Wf=RO;var $r=S(M());var zO=o=>{let{anchorElementSelectors:e='[data-testid="maxai--chat-hub--layout-selector--item--1"]',placement:t="top-start",...r}=o,{t:n}=v(),[i,a]=$r.default.useState(!1),[s,l]=$r.default.useState(!0),c=te(f=>f.conversationIds),u=er(c[0]),p=ge(c[0]),m=(0,$r.useRef)(!1),d=(0,$r.useCallback)(async()=>{let f=await qe.getOnboardingDataByKey(Ec),_=await qe.getOnboardingDataByKey("ON_BOARDING__RECORD_FIRST_SELECTOR_AI_MODEL");f&&u.length>0&&p===!1&&_&&m.current===!0&&a(!0)},[u,p]),{extensionTourOnBoardingOpened:h}=on();return(0,$r.useEffect)(()=>{h&&qe.getOnboardingDataByKey(qh).then(f=>l(!!f))},[h]),(0,$r.useEffect)(()=>{s||d()},[s,d]),(0,$r.useEffect)(()=>{p&&(m.current=!0)},[p]),s?null:$r.default.createElement(Bt,{placement:t,trigger:i,anchorElementSelectors:e,onShow:()=>{qe.setOnboardingData(qh,!0)},CtaButtonProps:{"data-button-clicked-name":"Onboarding > Compare answers side by side > Got it"},...r},$r.default.createElement(g,{spacing:.5},$r.default.createElement(T,{fontSize:20,lineHeight:1.4,color:"text.primary",fontWeight:700,textAlign:"left"},n("package__features:onboarding__onboarding_popover__cha_hub_selector__title")),$r.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},n("package__features:onboarding__onboarding_popover__cha_hub_selector__description"))))},w8=zO;var qt=S(M()),Hg=[{layout:1,tooltip:"package__features:chat__provider__chat_hub__layout__one__tooltip"},{layout:2,tooltip:"package__features:chat__provider__chat_hub__layout__two__tooltip"},{layout:3,tooltip:"package__features:chat__provider__chat_hub__layout__three__tooltip"},{layout:4,tooltip:"package__features:chat__provider__chat_hub__layout__four__tooltip"},{layout:6,tooltip:"package__features:chat__provider__chat_hub__layout__six__tooltip"}],UO=o=>{let{disabled:e,mode:t,size:r="medium",sx:n}=o,{conversationIds:i,conversationType:a,layout:s,setConversationIds:l,setLayout:c}=te(E=>({conversationIds:E.conversationIds,conversationType:E.conversationType,layout:E.layout,setConversationIds:E.setConversationIds,setLayout:E.setLayout})),{t:u}=v(),{createConversation:p}=Ve(),{chatHubLoading:m}=rt(),d=e||m,h=async E=>{let P=await xm(a);if(await F_(E),i.length<E){let O=await p(a,{reason:"createChatHub",triggerChange:!1,syncToRemote:!1}),N=[...i,...O.slice(i.length).map(V=>V.id)];l(N)}c(E),o.onChange?.(E,P)},f=(0,qt.useMemo)(()=>({p:"0px 0px",borderRadius:"6px",transition:"background-color 250ms cubic-bezier(0.4, 0, 0.2, 1)",gap:"2px",border:"1px solid",borderColor:"border.main",padding:"1px","& > button":{minWidth:"unset",color:"text.secondary",padding:r==="small"?"2px":"6px",borderRadius:"4px","&:hover,&.selected":{color:"text.primary",bgcolor:E=>E.palette.mode==="dark"?"rgba(255, 255, 255, 0.06)":"rgba(0, 0, 0, 0.06)"}}}),[r]),[_,x]=(0,qt.useState)(!1),[C,y]=(0,qt.useState)(!1),b=(0,qt.useRef)(null),w=(0,qt.useCallback)(E=>{y(E),E||x(!1)},[y]),I=(0,qt.useCallback)(()=>{w(!1),b.current?.matches(":hover")&&x(!0)},[w]);if(t==="mini"){let E=Hg.find(P=>s===P.layout);return qt.default.createElement(Ga,{width:220,sx:{zIndex:2147483621},open:C,onOpenChange:w,placement:"bottom-start",isMirror:!0,modifiers:[{name:"RTLSupport",enabled:typeof document<"u"&&document.querySelector("body")?.getAttribute("dir")==="rtl",phase:"main",fn({state:P}){if(P.modifiersData.popperOffsets){let N=P.rects.reference.x+P.rects.reference.width-P.rects.popper.width;N>0&&(P.modifiersData.popperOffsets.x=N)}}},{name:"offset",options:{offset:[0,5]}},{name:"flip",options:{fallbackPlacements:["top-start"]}}],referenceElement:qt.default.createElement(me,{title:E?u(E.tooltip):null,open:_&&!C},qt.default.createElement(le,{disableRipple:!0,disabled:d,ref:b,"data-testid":"maxai--chat-hub--layout-selector--button","aria-controls":C?"composition-menu":void 0,"aria-expanded":C?"true":void 0,"aria-haspopup":"true",onClick:()=>y(!C),sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",p:.5,pl:"6px",height:32,minWidth:"auto"},onMouseEnter:()=>{C||x(!0)},onMouseLeave:()=>{C||x(!1)}},qt.default.createElement(Wf,{sx:{fontSize:18},layout:E?.layout||1}),qt.default.createElement(z,{icon:"ExpandMore",sx:{color:"text.secondary",fontSize:"16px",transform:C?"rotate(180deg)":"rotate(0)"}})))},qt.default.createElement(Pn,{disableListWrap:!0,"data-testid":"maxai--chat-hub--layout-selector--group",sx:{overflowY:"auto",overflowX:"hidden",flexShrink:0,py:"6px",boxSizing:"border-box",bgcolor:P=>P.palette.mode==="dark"?"rgba(61, 61, 61, 1)":"#fff",...n}},Hg.map(P=>qt.default.createElement(St,{"data-testid":`maxai--chat--layout-selector--item--${P.layout}`,key:P.layout,selected:P.layout===s,onClick:()=>{h(P.layout),I()},sx:{borderRadius:"6px",mx:"6px",minHeight:"unset",p:"6px 10px 6px 8px","&:hover":{backgroundColor:O=>O.palette.mode==="dark"?"rgba(255, 255, 255, .1)":"rgba(0, 0, 0, 0.04)"},...P.layout===s&&{backgroundColor:O=>O.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.04)"}}},qt.default.createElement(g,{alignItems:"center",direction:"row",spacing:1,sx:{flex:1,height:24}},qt.default.createElement(Wf,{sx:{fontSize:18,color:"text.primary"},layout:P.layout}),qt.default.createElement(ds,{fontSize:"14px",lineHeight:"21px"},u(P.tooltip)))))))}return qt.default.createElement(g,{"data-testid":"maxai--chat-hub--layout-selector--group",direction:"row",alignItems:"center",sx:f},Hg.map(E=>qt.default.createElement(me,{title:u(E.tooltip),key:E.layout,disableInteractive:!0},qt.default.createElement(le,{"data-testid":`maxai--chat-hub--layout-selector--item--${E.layout}`,className:s===E.layout?"selected":"",disabled:d,key:E.layout,onClick:()=>h(E.layout)},qt.default.createElement(Wf,{sx:{fontSize:"16px"},layout:E.layout})))),qt.default.createElement(w8,null))},E8=UO;var qo=S(M());var WO=()=>te(e=>e.conversationType)==="Art"?qo.default.createElement(b4,null):qo.default.createElement(hs,null),Fg=()=>{let{variant:o}=Ce();return{newChatButton:qo.default.createElement(ol,{variant:"icon"}),aiModelSelector:o!=="chatHubInput"&&qo.default.createElement(WO,null),chatHubLayoutSelector:qo.default.createElement(E8,null),aiLanguageSelector:qo.default.createElement(ms,null),proChatSwitch:qo.default.createElement(us,null),portalRoot:qo.default.createElement(g,{direction:"row",alignItems:"center",gap:"4px","data-testid":"maxai--chat-box--tools--left-container--portal-root",sx:{"&:empty":{display:"none"}}})}},GO=o=>{let{renderLeftNode:e,renderRightNode:t}=o,r=Fg(),n={advancedButton:qo.default.createElement(t8,null),historyButton:qo.default.createElement(M8,null),newChatButton:qo.default.createElement(ol,{variant:"icon"})},i=e?e(r):qo.default.createElement(qo.default.Fragment,null,r.proChatSwitch,r.aiModelSelector,r.chatHubLayoutSelector,r.aiLanguageSelector,r.portalRoot),a=t?t(n):qo.default.createElement(qo.default.Fragment,null,n.advancedButton,n.historyButton);return qo.default.createElement(g,{direction:"row",justifyContent:"space-between",sx:{mb:1,gap:"8px"}},qo.default.createElement(g,{direction:"row",alignItems:"center","data-testid":"maxai--chat-box--tools--left-container",sx:{flexWrap:"wrap",gap:"4px","&:empty":{display:"none"}}},i),qo.default.createElement(g,{direction:"row",spacing:.5,alignItems:"start","data-testid":"maxai--chat-box--tools--right-container",sx:{"&:empty":{display:"none"}}},a))},P8=GO;var KO=o=>{let{isMessageEmpty:e,isMessageLoading:t,renderHeaderNode:r,renderHeaderLeftNode:n,renderHeaderRightNode:i,renderFooterLeftNode:a,renderFooterRightNode:s,renderFooterNode:l,...c}=o,{isInStepTour:u}=te(I=>({isInStepTour:I.isInStepTour})),p=(0,it.useCallback)(I=>u?!0:!I.chatScreenshots.length&&!I.selectionContent,[u]),m=Fg(),d={documentSelector:it.default.createElement(Nv,null),screenshotList:it.default.createElement(bv,null),artReferenceImageList:it.default.createElement(gv,null),selectionContent:it.default.createElement(Sv,null),currentDocumentButton:it.default.createElement(qc,{enableState:p},it.default.createElement(BS,null)),enableSearchButton:it.default.createElement(qc,{enableState:p},it.default.createElement(HS,null)),selectDocumentButton:it.default.createElement(qc,{enableState:p},it.default.createElement(dv,null)),screenshotButton:it.default.createElement(qc,{enableState:p},it.default.createElement(uv,null)),betaFeaturesButton:it.default.createElement(OS,null),upgradePlanButton:it.default.createElement(fv,null),feedbackButton:it.default.createElement(RS,null),usePromptButton:it.default.createElement(Of,null),myOwnToolsButton:it.default.createElement(av,null),autoSuggestion:it.default.createElement(sf,{isMessageEmpty:e,isMessageLoading:t}),uploadReferenceImageButton:it.default.createElement(lC,null),...m},h=r?r(d):it.default.createElement(g,{gap:1,pt:"10px",pl:"10px",pr:"10px",mb:"-10px",sx:{"&:empty":{display:"none"}},"data-testid":"maxai--chat-box--chat-input--header"},d.screenshotList,d.selectionContent),f=n?n(d):it.default.createElement(it.default.Fragment,null,d.currentDocumentButton,d.enableSearchButton,d.selectDocumentButton),_=i?i(d):it.default.createElement(it.default.Fragment,null,d.screenshotButton),x=a?a(d):it.default.createElement(it.default.Fragment,null,d.myOwnToolsButton,d.upgradePlanButton),C=s?s(d):null,y=l?l(d):it.default.createElement(it.default.Fragment,null,d.autoSuggestion),[b,w]=(0,it.useState)(!1);return it.default.createElement(Cv,{minLine:3,headerNode:h,headerLeftNode:f,headerRightNode:_,footerLeftNode:x,footerRightNode:C,footerNode:y,...c,sx:{boxShadow:I=>b?I.palette.mode==="dark"?"0px 0px 0px 1px rgba(255, 255, 255, 0.12)":"0px 0px 0px 1px rgba(0, 0, 0, 0.12)":void 0,...c.sx},textareaProps:{onFocus:()=>w(!0),onBlur:()=>w(!1),...c.textareaProps}})},A8=KO;var jO=o=>{let{toolsProps:e,inputProps:t,footerPrefix:r,sx:n,isMessageEmpty:i,isMessageLoading:a,updateChatBoxHeight:s,slotBottom:l}=o,{conversationId:c}=Ce(),u=Bl(c),[p,m]=(0,Is.useState)(!1);return u&&Tl(u)?null:Is.default.createElement(L,{"data-testid":"maxai--chat-panel--footer",sx:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-start",overflow:"hidden",alignItems:"center",backgroundColor:d=>d.palette.background.default,...n}},Is.default.createElement(g,{sx:{width:"100%",maxWidth:"var(--max-width)",margin:"0 auto",overflow:"hidden",p:1.5}},r,Is.default.createElement(o3,{onShow:()=>m(!0),onClose:()=>m(!1)}),!p&&Is.default.createElement(P8,{...e}),!p&&Is.default.createElement(A8,{isMessageEmpty:i,isMessageLoading:a,...t}),l))},Gf=jO;var k8=S(A7()),Ng=S(M()),$O=o=>{let{needSystemOrThirdMessage:e=!1}=o,{t}=v(),{conversationId:r,conversationMessages:n,getConversation:i}=ki();return n.filter(s=>e?!0:s.type!=="system"&&s.type!=="third").length===0||!r?null:Ng.default.createElement(fm,{title:t("package__features:chat__navbar__conversation_share__download_button__tooltip"),"data-testid":"history-text-download-button",sx:{border:s=>s.palette.mode==="dark"?"1px solid rgba(255, 255, 255, 0.12)":"1px solid rgba(0, 0, 0, 0.12)",borderRadius:"8px",padding:"6px"},onClick:async()=>{let s=await i(r);if(s?.title){let l=await l_(s,e),c=new Blob([l],{type:"text/plain;charset=utf-8"}),u=URL.createObjectURL(c),p=document.createElement("a");p.href=u,p.download=`MaxAI_Chat_${(0,k8.default)().format("YYYY_MM_DD_HH:mm")}.txt`,p.click(),URL.revokeObjectURL(u)}}},Ng.default.createElement(z,{icon:"FileDownload",sx:{fontSize:"18px",color:"text.secondary"}}))},L8=$O;var Je=S(M()),O8=o=>`${Zr}/share/?id=${o}`,qO=()=>{let{t:o}=v(),{features:e,loaded:t}=D_(),{conversation:r,conversationMessages:n,updateConversation:i,getConversation:a}=ki(),[s,l]=(0,Je.useState)(!1),[c,u]=(0,Je.useState)(!1),[p,m]=(0,Je.useState)(null),d=r?.share?.enable===!0,h=r?.share?.id,f=b=>{m(b.currentTarget)},_=()=>{m(null)},x=(b=o("package__features:chat__navbar__conversation_share__share_panel__error_tip"))=>{dt.error(b,{anchorOrigin:{vertical:"top",horizontal:"center"}})},C=async b=>{if(r?.id)try{u(!0);let w=(await Co.getService().shareConversation(r.id,b))?.share;w?.id?await i(r.id,{share:{enable:w.enable,id:w.id}}):x()}catch{x()}finally{u(!1)}},y=async b=>{if(!r?.id)return;let w=b.currentTarget.parentElement,I="";if(h)d||await C(!0),I=h;else try{if(!I){l(!0);let O=await a(r.id);if(!O){x();return}await Co.getService().checkUpdate(r.id),await Dn.getService().checkUpdate(r.id);let N=(await Co.getService().shareConversation(O.id,!0))?.share;N?.id&&N.enable&&(I=N.id,await i(O.id,{share:{enable:!0,id:N.id}}))}}catch{x()}finally{l(!1)}let E=O8(I);navigator.clipboard.writeText(E);let P=w?.querySelector('button[data-testid="maxai--conversation--share-button"]');f({currentTarget:b.currentTarget||P})};return t&&!e.chat_sync||n.length<=0?null:Je.default.createElement(g,{direction:"row",alignItems:"center",gap:1},d&&h&&Je.default.createElement(Fr,{copyText:O8(h),copyToClipboardTooltip:o("package__features:chat__navbar__conversation_share__copy_button__copy_link"),icon:Je.default.createElement(z,{icon:"Link"}),sx:{display:"flex",alignItems:"center",justifyContent:"center",border:b=>b.palette.mode==="dark"?"1px solid rgba(255, 255, 255, 0.12)":"1px solid rgba(0, 0, 0, 0.12)",borderRadius:"8px",minWidth:"unset",height:"32px",width:"32px"}}),Je.default.createElement(cn,{"data-testid":"maxai--conversation--share-button",variant:"contained",sx:{display:"flex",alignItems:"center",height:"32px",gap:.5,borderRadius:"8px",padding:"8px"},loading:s,onClick:y},d?Je.default.createElement(z,{sx:{fontSize:"18px"},icon:"IosShare"}):Je.default.createElement(z,{sx:{fontSize:"18px"},icon:"Lock"}),Je.default.createElement(T,{component:"span",fontSize:"12px"},o("package__features:chat__navbar__conversation_share__share_button__title"))),Je.default.createElement(An,{PaperProps:{sx:{mt:1,boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.16)"}},elevation:1,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:!!p,anchorEl:p,onClose:_},Je.default.createElement(g,{py:1,px:2,width:320,gap:1},Je.default.createElement(T,{fontSize:16,fontWeight:500},o("package__features:chat__navbar__conversation_share__share_panel__title")),Je.default.createElement(g,{sx:{"& > button":{border:"1px solid",width:"100%",p:1,borderColor:"border.main",borderRadius:"0 0 8px 8px",alignItems:"center",justifyContent:"start","&:not(:last-child)":{borderBottom:"none",borderRadius:"8px 8px 0 0"}}}},Je.default.createElement(le,{"data-testid":"maxai--conversation--share-private-button",disabled:c,onClick:async()=>{await C(!1)}},Je.default.createElement(g,{width:"100%"},Je.default.createElement(g,{direction:"row",alignItems:"center",gap:1},c?Je.default.createElement(Jt,{size:16}):Je.default.createElement(z,{icon:"Lock",sx:{fontSize:"16px"}}),Je.default.createElement(T,{textAlign:"left",fontSize:"14px",color:"text.primary"},o("package__features:chat__navbar__conversation_share__share_panel__private_button__title")),!d&&Je.default.createElement(z,{icon:"GreenCircleCheck",sx:{ml:"auto",mr:0,fontSize:"20px"}})),Je.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"text.secondary"},o("package__features:chat__navbar__conversation_share__share_panel__private_button__description")))),Je.default.createElement(le,{disabled:c,onClick:async()=>{await C(!0)}},Je.default.createElement(g,{width:"100%"},Je.default.createElement(g,{direction:"row",alignItems:"center",gap:1},c?Je.default.createElement(Jt,{size:16}):Je.default.createElement(z,{icon:"Share",sx:{fontSize:"16px"}}),Je.default.createElement(T,{textAlign:"left",fontSize:"14px",color:"text.primary"},o("package__features:chat__navbar__conversation_share__share_panel__public_button__title")),d&&Je.default.createElement(z,{icon:"GreenCircleCheck",sx:{ml:"auto",mr:0,fontSize:"20px"}})),Je.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"text.secondary"},o("package__features:chat__navbar__conversation_share__share_panel__public_button__description"))))),d&&Je.default.createElement(g,{direction:"row",alignItems:"center",gap:1},Je.default.createElement(z,{icon:"GreenCircleCheck",sx:{fontSize:"16px"}}),Je.default.createElement(T,{textAlign:"left",fontSize:"12px",color:"#379837"},o("package__features:chat__navbar__conversation_share__share_panel__copied_tip"))))))},B8=qO;var Xn=S(M());var D8=S(M()),XO=()=>{let o=gl(),e=$0(o.breakpoints.down("md")),t=Na();return{isMiniScreen:(0,D8.useMemo)(()=>uu()?e:t==="xs"||t==="sm",[t,e])}},Kf=XO;var Yc=S(M());var Vg="MAXAI_CLIENT__FEATURES__LAYOUT__WEBSITE_STATE";var H8="MAXAI_CLIENT__UI__HOME_NAVBAR_STATE",YO="MAXAI_SIDEBAR_FOLD_STATUS",Xc=()=>({chatHistoryOpen:!0,toolbarCollapsed:!1,miniScreenToolbarOpen:!1,rightToolbarCollapsed:!1,rightMiniScreenToolbarOpen:!1}),Rg=()=>{let o=Xc();try{let e=window.localStorage.getItem(Vg);if(e){let t=JSON.parse(e);Object.assign(o,t)}}catch{}try{let e=window.localStorage.getItem(H8);if(e){let t=JSON.parse(e);Object.assign(o,{chatHistoryOpen:t.conversationListPanelOpen??o.chatHistoryOpen})}}catch{}return window.localStorage.removeItem(H8),window.localStorage.removeItem(YO),{...o,miniScreenToolbarOpen:!1,rightMiniScreenToolbarOpen:!1}},F8=o=>{let e=Rg(),t=Qo([e,o]);window.localStorage.setItem(Vg,JSON.stringify(t))};var zg=xi({key:"AppWebsiteLayoutState",default:Xc(),effects:[({onSet:o})=>{o(e=>{F8(e)})}]}),ZO=xi({key:"AppWebsiteLayoutToolbarWidgetState",default:{disableExtensionAdCard:!1}});var QO=()=>{let o=bt(zg),{isLogin:e}=Po(),{hasExtension:t}=tc(),{isMiniScreen:r}=Kf(),n=!e||!t||r;return{...o,isMiniScreen:r,disabledCollapse:n,toolbarCollapsed:n?!1:o.toolbarCollapsed,rightToolbarCollapsed:r?!1:o.rightToolbarCollapsed}},JO=()=>{let o=Qt(zg),e=()=>{o(Rg())},t=(u,p)=>{o(m=>m[u]===p?m:{...m,[u]:p})};return{syncLocalState:e,setChatHistoryOpen:u=>{t("chatHistoryOpen",u)},setToolbarCollapsed:u=>{t("toolbarCollapsed",u)},setToolbarWidth:u=>{t("toolbarWidth",u)},setMiniScreenToolbarOpen:u=>{t("miniScreenToolbarOpen",u)},setRightToolbarCollapsed:u=>{t("rightToolbarCollapsed",u)},setRightToolbarWidth:u=>{t("rightToolbarWidth",u)},setRightMiniScreenToolbarOpen:u=>{t("rightMiniScreenToolbarOpen",u)}}},jf=()=>{let o=QO(),e=JO();return{...o,...e}};var Ug=S(M());var Rbe=(0,Ug.createContext)({...Xc(),setToolbarCollapsed:()=>null,setMiniScreenToolbarOpen:()=>null,setRightToolbarCollapsed:()=>null,setRightMiniScreenToolbarOpen:()=>null});var $f=S(M()),eB=o=>{let{...e}=o,{chatHistoryOpen:t,setChatHistoryOpen:r}=jf(),{t:n}=v();return $f.default.createElement(me,{placement:"bottom",title:n(t?"package__features:chat__navbar__button__hide_chat_history":"package__features:chat__navbar__button__show_chat_history")},$f.default.createElement(je,{"data-testid":"sidebar-nav-topbar-show-or-hide-chat-history-button",onClick:()=>r(!t),...e},$f.default.createElement(z,{icon:"LayoutLeftIcon",sx:{fontSize:"24px",color:i=>i.palette.mode==="dark"?"rgba(255, 255, 255)":"rgba(0, 0, 0, 0.6)"}})))},N8=eB;var tB=o=>{let{newChatProps:e,switchVisibilityProps:t,sx:r}=o,{isMiniScreen:n}=Kf();return Yc.default.createElement(g,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:r},n?Yc.default.createElement(L,{sx:{height:"40px"}}):Yc.default.createElement(N8,{...t}),Yc.default.createElement(ol,{...e,tooltipProps:{placement:"bottom",...e?.tooltipProps},sx:{p:1,height:"auto",minWidth:"auto","& svg":{fontSize:24},...e?.sx}}))},V8=tB;var R8=S(M()),oB=o=>{let{topBarProps:e}=o,{isMiniScreen:t,chatHistoryOpen:r}=jf(),{chatHubOrder:n,variant:i}=Ce();return i==="chatHub"&&n>0||t||r?null:R8.default.createElement(V8,{...e,sx:{pl:1,...e?.sx},newChatProps:{variant:"icon",...e?.newChatProps}})},z8=oB;var rB=o=>{let{leftNode:e,rightNode:t,footerNode:r,renderLeftNode:n,renderRightNode:i,sx:a}=o,s={actionsGroup:Xn.default.createElement(z8,null)},l={downloadButton:Xn.default.createElement(L8,null),shareButton:Xn.default.createElement(B8,null)},c=n?n(s):Xn.default.createElement(Xn.default.Fragment,null,s.actionsGroup,e),u=i?i(l):Xn.default.createElement(Xn.default.Fragment,null,t,l.downloadButton,l.shareButton);return Xn.default.createElement(g,{sx:{marginBottom:"-16px",...a},"data-testid":"maxai--chat-box-header"},Xn.default.createElement(g,{"data-testid":"maxai--chat-box-header--first-line",sx:{flexDirection:"row"}},Xn.default.createElement(g,{direction:"row",alignItems:"center",gap:1,pl:1},c),Xn.default.createElement(g,{direction:"row",flex:1,width:0,justifyContent:"end",alignItems:"center",gap:1,pr:1},u)),r)},qf=rB;var qr=S(M());var nB=()=>qr.default.createElement(L,{sx:{width:"100%",maxWidth:"var(--max-width)",margin:"0 auto",p:1.5}},qr.default.createElement(L,{sx:{border:"1px solid",borderColor:"border.secondary",mt:1,borderRadius:1,p:1.25}},qr.default.createElement(g,null,qr.default.createElement(g,{direction:"row",justifyContent:"space-between",alignItems:"center"},qr.default.createElement(g,{direction:"row",spacing:1},qr.default.createElement(vt,{variant:"rectangular",width:114,height:32,sx:{borderRadius:1,backgroundColor:"bgColor.secondary"}})),qr.default.createElement(vt,{variant:"rectangular",width:32,height:32,sx:{borderRadius:1,backgroundColor:"bgColor.secondary"}})),qr.default.createElement(L,{sx:{py:1}},qr.default.createElement(vt,{variant:"rectangular",width:"100%",height:76,sx:{borderRadius:1,backgroundColor:"bgColor.secondary"}})),qr.default.createElement(g,{direction:"row",justifyContent:"space-between",alignItems:"center"},qr.default.createElement(g,{direction:"row",spacing:1,alignItems:"center"},qr.default.createElement(vt,{variant:"rectangular",width:40,height:20,sx:{borderRadius:2,backgroundColor:"bgColor.secondary"}})),qr.default.createElement(g,{direction:"row",spacing:1,alignItems:"center"},qr.default.createElement(vt,{variant:"rectangular",width:32,height:32,sx:{borderRadius:1,backgroundColor:"bgColor.secondary"}})))))),U8=nB;var iB=o=>{let{headerProps:e,messageProps:t,toolsProps:r,inputProps:n,footerPrefix:i,footerProps:a,emptyNode:s,sx:l}=o,c=te(H=>H.conversationType),{betaSettings:u}=Sr(),p=c==="ContextMenu",{conversationId:m}=Ce(),d=ge(m),[h,f]=(0,Et.useState)(0),_=c==="Art",x=H=>Et.default.createElement(TS,{fallback:Et.default.createElement(U8,null)},Et.default.createElement(Gf,{...a,...H,inputProps:{...n,textareaProps:{...n?.textareaProps,disabled:n?.textareaProps?.disabled||d}},toolsProps:r,footerPrefix:i,updateChatBoxHeight:f})),C=({isMessageEmpty:H,isMessageLoading:R,...F})=>p?H?null:x({isMessageEmpty:H,isMessageLoading:R,...F}):u?.appearance_v2_enabled?R&&!H?null:x({isMessageEmpty:H,isMessageLoading:R,...F}):x({isMessageEmpty:H,isMessageLoading:R,...F}),y=so(),[b,w]=(0,Et.useState)(48);(0,Et.useEffect)(()=>{let H=()=>{if(y){let R=y.querySelector('[data-testid="maxai--chat-box-header"]');R&&w(R.clientHeight)}};H(),setTimeout(()=>{H()},1e3)},[]);let[I,E]=(0,Et.useState)("100%");(0,Et.useEffect)(()=>{let H=()=>{let R=Math.max(window.innerHeight-b,500);E(`${R}px`)};return H(),window.addEventListener("resize",H),()=>{window.removeEventListener("resize",H)}},[b]);let[P,O]=(0,Et.useState)(null),{rect:N}=G2({target:P,windowScroll:!0,observeOptions:{childList:!0,subtree:!0}}),V=500;(0,Et.useEffect)(()=>{if(N){let H=N.height;D(Math.max(H,V))}},[N]);let[A,D]=(0,Et.useState)(V),W=b-106,k="26dvh",U=b+32,K=(H,R)=>Et.default.createElement(g,{ref:O,"data-testid":"maxai--chat-box--center--container",sx:{"--chatGptMarginTopContainHeader":wn?"48px":"0px","--chatGptMarginTopExcludeAIReplyDescription":"0px","--headerHeight":`${b}px`,"--homeViewMinHeight":`${A}px`,"--minReservationHeight":`calc(var(--homeViewMinHeight) + ${U}px)`,width:"100%",alignItems:"center",marginTop:`max(${W}px, min(calc(100dvh - var(--minReservationHeight)), calc(${k} + var(--chatGptMarginTopContainHeader) - var(--chatGptMarginTopExcludeAIReplyDescription))))`,maxHeight:I}},Et.default.createElement(O4,{isMessageEmpty:H,chatBoxHeight:h,sx:{display:H?"flex":"none"}}),C({isMessageEmpty:H,isMessageLoading:R}));return Et.default.createElement(g,{className:"maxai--chat-box",sx:{flex:1,height:0,width:"100%","& *":{boxSizing:"border-box"},...d?{}:{[`.${kl}`]:{display:"none"}},...l}},Et.default.createElement(qf,{...e}),Et.default.createElement(g,{sx:{flex:1,justifyContent:"center",flexDirection:"row",height:0,width:"100%",maxHeight:"100%"}},Et.default.createElement(Rh.Provider,{value:t||_I},Et.default.createElement(Tp,{emptyNode:s},({isShowHomeView:H,isLoading:R,listNode:F})=>Et.default.createElement(g,{className:"maxai--chat-box--content","data-message-empty":H,"data-message-loading":R,sx:{flex:1,width:"100%",alignItems:"center",overflow:"hidden",justifyContent:"flex-start"}},_?Et.default.createElement(Et.default.Fragment,null,H&&Et.default.createElement(L4,{sx:{"--minReservationHeight":"380px",marginTop:`max(${W}px, min(calc(100dvh - var(--minReservationHeight)), ${k}))`}}),F,C({isMessageEmpty:H,isMessageLoading:R,slotBottom:H?Et.default.createElement(g,{alignItems:"center",maxWidth:768,mx:"auto",width:"100%",py:1.5,gap:1.5},Et.default.createElement(Jd,null)):null})):H?K(H,R):Et.default.createElement(Et.default.Fragment,null,F,C({isMessageEmpty:H,isMessageLoading:R})))))))},W8=iB;var ln=S(M()),aB=({isFullscreen:o,children:e,onClose:t})=>{let{t:r}=v(),n=(0,ln.useCallback)(l=>{l.key==="Escape"&&t()},[t]);(0,ln.useEffect)(()=>(o&&document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}),[o,n]);let i=(0,ln.useMemo)(()=>({width:"100%!important",height:"100%!important",maxWidth:"100%!important",maxHeight:"100%!important",position:"fixed",top:0,left:0,zIndex:1502,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center"}),[]),a=(0,ln.useMemo)(()=>({backgroundColor:"background.default",height:"95vh",padding:"24px",boxSizing:"border-box",maxHeight:"calc(100vh - 32px)",maxWidth:"768px!important",position:"relative",borderRadius:"8px",width:"calc(100vw - 32px)"}),[]),s=(0,ln.useMemo)(()=>({border:"1px solid",borderColor:"border.main",borderRadius:"8px",flex:1,height:"0"}),[]);return ln.default.createElement(L,{sx:{width:"100%",height:"100%",position:"relative",...o?i:{}},onClick:()=>t()},ln.default.createElement(g,{sx:{width:"100%",height:"100%",gap:"24px",...o?a:{}},onClick:l=>l.stopPropagation()},ln.default.createElement(g,{"data-testid":"chat-hub-chat-box-wrapper",sx:{width:"100%",height:"100%",...o?s:{}}},e),o&&ln.default.createElement(g,{sx:{flexDirection:"row",justifyContent:"flex-end"}},ln.default.createElement(le,{variant:"contained",onClick:()=>t()},r("package__features:chat__chat_hub_box__exit_full_screen")))))},G8=aB;var nr=S(M());var sB=o=>{let{headerProps:e,emptyNode:t,sx:r}=o,{t:n}=v(),i=te(u=>u.layout),[a,s]=(0,nr.useState)(!1),{chatHubOrder:l}=Ce(),{chatHubLoading:c}=rt();return nr.default.createElement(g,{component:"div",position:"relative",sx:{width:"100%","& *":{boxSizing:"border-box"},...c?{}:{[`.${kl}`]:{display:"none"}},...r}},nr.default.createElement(G8,{isFullscreen:a,onClose:()=>s(!1)},nr.default.createElement(qf,{...e}),nr.default.createElement(g,{sx:{flex:1,justifyContent:"center",flexDirection:"row",height:0,width:"100%"}},nr.default.createElement(g,{sx:{flex:1,width:"100%"}},nr.default.createElement(Tp,{emptyNode:t},({isShowHomeView:u,listNode:p})=>nr.default.createElement(nr.default.Fragment,null,u&&nr.default.createElement("div",{style:{flex:1}}),p)),a?null:nr.default.createElement(g,{sx:{p:"12px",flexDirection:"row",justifyContent:"space-between"}},nr.default.createElement(Od,null,u=>u==="pro_chat"?nr.default.createElement(I4,{order:l}):nr.default.createElement("div",null)),i>1&&nr.default.createElement(ee,{placement:"top",title:n("package__features:chat__chat_hub_box__full_screen"),onClick:()=>s(!a)},nr.default.createElement(_x,{sx:{color:"text.secondary"}})))))))},K8=sB;var Xf=S(M()),lB=o=>{let{sx:e,footerProps:t,inputProps:r,footerPrefix:n,toolsProps:i}=o;return Xf.default.createElement(g,{component:"div",position:"relative",sx:{flex:1,width:"100%","& *":{boxSizing:"border-box"},...e}},Xf.default.createElement(g,{sx:{flex:1,width:"100%"}},Xf.default.createElement(Gf,{...t,inputProps:r,toolsProps:i,footerPrefix:n})))},j8=lB;var rl=S(M());var pB=o=>{let{emptyNode:e,sx:t}=o,{conversationId:r}=Ce(),n=ge(r);return rl.default.createElement(g,{sx:{flex:1,width:"100%","& *":{boxSizing:"border-box"},...n?{}:{[`.${kl}`]:{display:"none"}},...t}},rl.default.createElement(g,{sx:{flex:1,justifyContent:"center",flexDirection:"row",height:0,width:"100%"}},rl.default.createElement(g,{sx:{flex:1,width:"100%"}},rl.default.createElement(Tp,{emptyNode:e},({listNode:i})=>rl.default.createElement(rl.default.Fragment,null,i)))))},$8=pB;var Ss=S(M()),cB=o=>{let{children:e,variant:t,conversationId:r,chatHubOrder:n,inputMediator:i=Ot("Chat"),...a}=o,s=(0,Ss.useMemo)(()=>({variant:t,conversationId:r,chatHubOrder:n,inputMediator:i}),[t,r,n,i]);return Ss.default.createElement(H_.Provider,{value:s},t==="normal"&&Ss.default.createElement(W8,{...a}),t==="chatHub"&&Ss.default.createElement(K8,{...a}),t==="chatHubInput"&&Ss.default.createElement(j8,{...a}),t==="share"&&Ss.default.createElement($8,{...a}),t==="custom"&&e)},Yf=cB;var q8=S(M()),uB=({children:o,...e})=>{let{sx:t,...r}=e;return q8.default.createElement(Pa,{anchor:"bottom",open:!0,sx:{display:"flex",zIndex:1502,position:"absolute",[`& .${Ea.paper}`]:{position:"absolute",borderTopRightRadius:8,borderTopLeftRadius:8,height:"80vh",bgcolor:"background.paper",backgroundImage:"unset"},"& .maxai--browser-window":{border:"none !important",borderRadius:"0px !important",boxShadow:"none !important"},...t},disableScrollLock:!0,disableEnforceFocus:!0,slotProps:{root:{},backdrop:{sx:{position:"absolute"}}},...r},o)},X8=uB;var Gi=S(M()),mB=o=>{let{children:e,reference:t,offset:r=16,sx:n}=o,[i,a]=(0,Gi.useState)(0),[s,l]=(0,Gi.useState)(0),[c,u]=(0,Gi.useState)(0),p=(0,Gi.useCallback)(()=>{if(!t)return;let d=t.getBoundingClientRect(),h=r*2,f=Math.min(616,d.left-h),_=Math.max(r,d.left-f-r);u(d.top),l(_),a(f)},[r,t]);(0,Gi.useEffect)(()=>{if(!t)return;let d=oi(()=>{p()},0),h=new ResizeObserver(d);return h.observe(t),window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d),h.disconnect()}},[p,t]);let m=Gu("maxai-animation-slide-in",{duration:250});return Gi.default.createElement(g,{sx:{position:"fixed",zIndex:1e3,width:i,marginTop:`${r}px`,height:`calc(100vh - ${r*2}px)`,left:s,top:c,display:i>0?"flex":"none",flexDirection:"column","&:empty":{display:"none"},...m,...n}},e)},Y8=mB;var vs=S(M());var nl=S(M());var Lr=S(M());var dB=()=>{let o=te(t=>t.conversationIds);return j_(o)>0?null:Lr.default.createElement(Td,{sx:{position:"relative",bottom:0,mb:1,mt:-.5,zIndex:1501}})},fB=o=>{let{footerProps:e,inputProps:t,toolsProps:r,footerPrefix:n}=o,i=te(A=>A),{conversationIds:a,conversationType:s,layout:l}=i,{askAIWithShortcuts:c,askAIWithShortcutsV2:u,stopGenerate:p}=Re(),m=$e({askAIWithShortcuts:c,askAIWithShortcutsV2:u,stopGenerate:p}),d=a.slice(0,l),h=d[0],{updateConversation:f,getConversation:_}=Ve(),{getDefaultValueModel:x,getChatHubDefaultValueModel:C}=Nl(),y=(0,Lr.useCallback)(async A=>A===0?await x():await C(A),[x,C]),b=ko.use.chatHub(),w=ko.use.chat(),I=(0,Lr.useCallback)(async(A,D)=>{if(!await _(A))return;let k=D===0?w:b[D],K=q1(k)?await y(D):k,H=Ir(K.AIProvider,K.AIModel);H&&await f(A,{meta:{AIProvider:H.AIProvider,AIModel:H.value,maxTokens:H.maxTokens}})},[f,_,y,w,b]),E=(0,Lr.useCallback)(async(A,D,W)=>{let k=i.layout;D[D.length-1].type==="SET_VARIABLES_MODAL"&&(k=1);let[U,K]=await Promise.all([y2.getLocalSettings(),g_.getBetaSettings()]);return U.chatMode!=="pro_chat"&&(k=1,i.setLayout(1)),await Promise.all(d.slice(0,k).map(async(H,R)=>{let F=R===0?w:b[R],$=q1(F)?await y(R):F,ie=He(D).map(G=>(G.parameters.ActionChatMessageOperationType==="add"&&G.parameters.ActionChatMessageConfig&&(G.parameters.ActionChatMessageConfig.conversationId=H,G.parameters.ActionChatMessageType==="system"&&(G.parameters.ActionChatMessageConfig.originalMessage={...G.parameters.ActionChatMessageConfig.originalMessage,metadata:{...G.parameters.ActionChatMessageConfig.originalMessage?.metadata,AIModel:$.AIModel}})),G.parameters.AskChatGPTActionQuestion&&(G.parameters.AskChatGPTActionQuestion.conversationId=H),G));return K.appearance_v2_enabled?m.current.askAIWithShortcutsV2(ie,{...W,conversationId:H,disabledMaxAIDocumentIds:!0,onBeforeRun:async()=>{await I(H,R)}}):m.current.askAIWithShortcuts(ie,{...W,conversationId:H,onBeforeRun:async()=>{await I(H,R)}})})),null},[d,w,b,y,I]),P=(0,Lr.useCallback)(()=>(d.forEach(A=>{m.current.stopGenerate(A)}),!0),[d]),O=(0,Lr.useMemo)(()=>f2(A=>({...i,onRunShortcutsActions:E,onStopShortcutsActions:P})),[]);(0,Lr.useEffect)(()=>{O.setState({...i,onRunShortcutsActions:E,onStopShortcutsActions:P})},[i,E,P]);let{chatHubLoading:N}=rt(),V=(0,Lr.useMemo)(()=>{let A=t?.(h,0,{conversationId:h});return{...A,textareaProps:{...A?.textareaProps,disabled:A?.textareaProps?.disabled||N},sendButtonProps:{...A?.sendButtonProps,loading:A?.sendButtonProps?.loading||N}}},[t,h,N]);return Lr.default.createElement(P2.Provider,{value:O},Lr.default.createElement(g,{sx:{flexShrink:0,"--max-width":"768px"}},Lr.default.createElement(Yf,{chatHubOrder:0,inputMediator:Ot(s),variant:"chatHubInput",conversationId:h,toolsProps:r?.(h,0,{conversationId:h}),inputProps:V,footerProps:e?.(h,0,{conversationId:h}),footerPrefix:n?.(h,0,{conversationId:h})}),Lr.default.createElement(dB,null)))},Z8=fB;var hB=o=>{let{chatHubSlot:e,children:t,...r}=o,n=te(a=>({conversationIds:a.conversationIds,layout:a.layout,conversationType:a.conversationType})),i=(0,nl.useMemo)(()=>{let a={flex:1,height:0,display:"flex",flexDirection:"row",flexWrap:"wrap"};return n.layout===1?{...a,"& > div":{width:"100%",maxWidth:"100%",height:"100%",borderBottom:"1px solid",borderRight:"1px solid",borderColor:"border.main",display:"none!important","&:nth-of-type(-n+1)":{display:"flex!important"}}}:n.layout===2?{...a,"& > div":{width:"50%",maxWidth:"50%",height:"100%",borderBottom:"1px solid",borderRight:"1px solid",borderColor:"border.main",display:"none!important","&:nth-of-type(-n+2)":{display:"flex!important"},"&:nth-of-type(2n)":{borderRight:"none"}}}:n.layout===3?{...a,"& > div":{width:"33.33%",maxWidth:"33.33%",height:"100%",borderBottom:"1px solid",borderRight:"1px solid",borderColor:"border.main",display:"none!important","&:nth-of-type(-n+3)":{display:"flex!important"},"&:nth-of-type(3n)":{borderRight:"none"}}}:n.layout===4?{...a,"& > div":{maxWidth:"50%",width:"50%",height:"50%",borderBottom:"1px solid",borderRight:"1px solid",borderColor:"border.main",display:"none!important","&:nth-of-type(-n+4)":{display:"flex!important"},"&:nth-of-type(2n),&:nth-of-type(4n)":{borderRight:"none"}}}:n.layout===6?{...a,"& > div":{maxWidth:"33.33%",width:"33.33%",height:"50%",borderBottom:"1px solid",borderRight:"1px solid",borderColor:"border.main",display:"none!important","&:nth-of-type(-n+6)":{display:"flex!important"},"&:nth-of-type(3n),&:nth-of-type(6n)":{borderRight:"none"}}}:a},[n.layout]);return n.conversationIds.length<=1||n.layout===1?nl.default.createElement(g,{className:"maxai-client--chat-hub--container",flex:1,width:"100%",height:"100%",sx:{backgroundColor:"background.default"}},x0(t)?t.slice(0,1):t):nl.default.createElement(g,{className:"maxai-client--chat-hub--container",flex:1,width:"100%",height:"100%",sx:{flexDirection:"column",backgroundColor:"background.default"}},e,nl.default.createElement(g,{sx:i},t),nl.default.createElement(Z8,{...r}))},Q8=hB;var gB=o=>{let{variant:e,leftPanelSide:t="flexbox",leftPanelContent:r,rightPanelSide:n="flexbox",rightPanelContent:i,chatHubSlot:a,chatHubSx:s,children:l,onPanelClose:c,headerProps:u,footerProps:p,inputProps:m,toolsProps:d,footerPrefix:h,messageProps:f,sx:_}=o,{conversationIds:x,conversationType:C,layout:y}=te(I=>({conversationIds:I.conversationIds,conversationType:I.conversationType,layout:I.layout})),b=vs.default.useRef(null),w=(I,E)=>{if(!E)return null;if(I==="separateWindow"&&b.current)return vs.default.createElement(Y8,{reference:b.current,sx:{top:0}},E);if(I==="flexbox")return vs.default.createElement(g,{flex:1,sx:{"&:empty":{display:"none"}}},E);if(I==="custom")return E;if(I==="drawer"&&b.current)return vs.default.createElement(X8,{onClose:c},E)};return vs.default.createElement(g,{ref:b,className:"maxai--chat-hub",sx:{width:"100%",height:"100%",flex:1,flexDirection:"row","--max-width":y>1||ao?"100%":"768px","& *":{boxSizing:"border-box"},...s}},w(t,r),vs.default.createElement(Q8,{chatHubSlot:a,...o},x.map((I,E)=>vs.default.createElement(Yf,{inputMediator:Ot(C),chatHubOrder:E,variant:e||(y>1?"chatHub":"normal"),conversationId:I,key:x.length===1?E:I,headerProps:u?.(I,E,{conversationId:I}),footerProps:p?.(I,E,{conversationId:I}),inputProps:m?.(I,E,{conversationId:I}),toolsProps:d?.(I,E,{conversationId:I}),footerPrefix:h?.(I,E,{conversationId:I}),messageProps:f?.(I,E,{conversationId:I}),sx:_?.(I,E,{conversationId:I})},l))),w(n,i))},J8=gB;var Or=S(M());var Ms=S(M());var xB=()=>{let[{stack:o},e]=En(ny),t=_i(o),r=!!t,{t:n}=v(["client","common"]),i=(0,Ms.useCallback)(async u=>{t&&(await JC.send("DiscardModalClose",{discardId:t.discardId,confirm:u==="confirm",cancel:u==="cancel"}),e(p=>({...p,stack:p.stack.slice(0,p.stack.length-1)})))},[t,e]),a=(0,Ms.useCallback)(()=>i("confirm"),[i]),s=(0,Ms.useCallback)(()=>i("cancel"),[i]),l=$e(s),c=$e(r);return(0,Ms.useEffect)(()=>{let u=p=>{c.current&&p.key==="Escape"&&(p.stopPropagation(),p.preventDefault(),l.current?.())};return window.addEventListener("keydown",u,!0),()=>{window.removeEventListener("keydown",u)}},[c,l]),Ms.default.createElement($a,{show:r,title:t?.content||"",onConfirm:a,onClose:s,modalSx:{zIndex:2147483621},wrapSx:{width:"288px"},variant:"danger",confirmBtnText:n("common:discard"),cancelBtnText:n("common:cancel"),isFixed:!0})},e9=xB;var pe=S(M());var et=S(M());var Lp=24,t9=8,_B=(o=window.innerHeight*.5)=>Math.max(Math.floor(o/24)||5),il=(o,e=0,t=0,r=0,n)=>{let i=o?.parentElement?.parentElement;if(o&&i){let a=window.getComputedStyle(o),s=Number(o.getAttribute("data-min-line"))||1,l=parseInt(a.paddingTop??t9,10)+parseInt(a.paddingBottom??t9,10);o.style.cssText="height:0px";let c=o.value?o.scrollHeight:Lp*s+l,u=Math.min(Lp*_B(n),c);r===0&&(r=o?.previousElementSibling?.offsetHeight||0);let p=Math.max(Lp*s+l,r||0);u=Math.max(p,u),o.style.cssText=`height: ${u}px`;let m=u+e+t;i.style.cssText=`height: ${m}px`}},CB=(o,e=0,t=0,r=0,n)=>{il(o,e,t,r,n),setTimeout(()=>{il(o,e,r,n);let i=o.value;o.focus(),o.setSelectionRange(i.length,i.length)},100)},Zf=(o,e=0,t=0,r=0)=>{if(!o)return;let n="",i=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(i?.nextElementSibling&&i.nextElementSibling.getAttribute("tabindex")==="-1"&&(n="mui",i.nextElementSibling.removeAttribute("tabindex")),window.location.host==="www.linkedin.com"){let a=document.querySelector('div[tabindex="-1"][role="dialog"]');a&&(n="linkedin",a.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{a.setAttribute("tabindex","-1")},100))}o.isSameNode(v2())||o.isSameNode(M2())||CB(o,e,t,r)},yB=o=>{let{defaultValue:e,onChange:t,onEnter:r,onKeydown:n,onKeydownCapture:i,loading:a,children:s,error:l=!1,InputId:c=fl,stopPropagation:u=!0,placeholder:p="Ask AI...",expandNode:m,sx:d,minLine:h=1,maxHeight:f,autoFocus:_,prefixNode:x,onControlledValueChange:C}=o,y=bt(Ox),{currentSidebarConversationId:b,currentSidebarConversationType:w}=jl(),I=bt(Wl),E=(0,et.useRef)(null),P=(0,et.useRef)(!1),O=(0,et.useRef)(!1),[N,V]=(0,et.useState)(e||""),A=(0,et.useRef)(0),D=(0,et.useRef)(0),W=(0,et.useRef)(0),k=(0,et.useRef)(null),U=(0,et.useRef)(null),K=(0,et.useRef)(null),H=(0,et.useMemo)(()=>oi(il,200),[]),R=(0,et.useRef)(Jp()),F=G=>[A.current,W.current,D.current,f],Y=(0,et.useCallback)(G=>{let B=G.target.value;c===fl?Ot("chatBoxInputMediator").updateInputValue(B):c===Ci&&Ot("floatingMenuInputMediator").updateInputValue(B),V(B),t&&t(B,{includeHistory:!O.current})},[t]),$=(0,et.useRef)({});(0,et.useEffect)(()=>{if(c===fl){let G=(B,ae)=>{ae&&($.current=ae),B.startsWith("``NO_HISTORY_&#``\n")&&(B=B.replace("``NO_HISTORY_&#``\n",""),O.current=!0),V(B)};return Ot("chatBoxInputMediator").subscribe(G),()=>{Ot("chatBoxInputMediator").unsubscribe(G)}}else if(c===Ci){let G=(B,ae)=>{B.startsWith("``NO_HISTORY_&#``\n")&&(B=B.replace("``NO_HISTORY_&#``\n",""),O.current=!0),V(B),ae?.selectAll&&setTimeout(()=>{E.current?.focus(),E.current?.setSelectionRange(0,B.length)},50)};return Ot("floatingMenuInputMediator").subscribe(G),()=>{Ot("floatingMenuInputMediator").unsubscribe(G)}}},[c]),(0,et.useEffect)(()=>{O.current=!1,$.current={}},[a]),(0,et.useEffect)(()=>{H(E.current,...F("inputValue1")),setTimeout(()=>{E.current&&il(E.current,...F("inputValue2"))},0)},[N]),(0,et.useEffect)(()=>{let G=new ResizeObserver(X=>{for(let oe of X)setTimeout(()=>{A.current=oe.target?.offsetHeight||0,E.current&&il(E.current,...F("children"))},30)}),B=new ResizeObserver(()=>{setTimeout(()=>{(K.current?.offsetHeight??0)!==W.current&&(W.current=K.current?.offsetHeight||0,E.current&&il(E.current,...F()))},0)}),ae=new ResizeObserver(X=>{for(let oe of X)setTimeout(()=>{D.current=oe.target?.offsetHeight||0,E.current&&il(E.current,...F("expand"))},100)});return U.current&&ae.observe(U.current),k.current&&G.observe(k.current),K.current&&B.observe(K.current),()=>{G.disconnect(),ae.disconnect(),B.disconnect()}},[]),(0,et.useEffect)(()=>{I&&E.current&&c===Ci&&Zf(E.current,...F("floatingDropdownMenu"))},[I]),(0,et.useEffect)(()=>{(y.open||R.current)&&E.current&&c===fl&&!Pm()&&Zf(E.current,...F("appState"))},[y.open,a,w,b]),Ro(()=>{if(c===fl&&R.current){let G=setTimeout(()=>{Zf(E.current,...F("appState"))},100);return()=>clearTimeout(G)}});let ie=Hm(C);return(0,et.useEffect)(()=>{ie.current?.(N,c)},[c,N,ie]),et.default.createElement(L,{component:"div",className:a?"chat-box__input--loading":"",borderRadius:"8px",border:"1px solid",borderColor:`${l?"rgb(239, 83, 80)":"border.main"}`,width:"100%",minHeight:34,sx:{display:"flex",alignItems:"center",flexDirection:"row",flexWrap:"wrap",overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...d}},et.default.createElement(L,{component:"div",className:"chat-box__input-skeleton"},et.default.createElement(vt,{height:Lp})),et.default.createElement(L,{ref:K,className:"chat-box__input\u2014prefix",sx:{width:"100%"}},x),et.default.createElement(g,{alignItems:"start",width:"100%",direction:"row",sx:{"& > textarea":{p:1,maxHeight:a?Lp*h+16:"unset",color:G=>G.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",my:1.5,fontSize:"16px",lineHeight:Lp+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}}},et.default.createElement(g,{ref:U,className:"max-ai-user-input__expand",sx:{"&:has(> div)":{py:1,pl:1},alignSelf:"start"}},m),et.default.createElement("textarea",{id:c,placeholder:p,disabled:a,ref:E,value:N,rows:1,"data-min-line":h,onCopy:G=>{G.stopPropagation()},onCut:G=>{G.stopPropagation()},onKeyUp:G=>{u&&G.stopPropagation()},onKeyPress:G=>{u&&G.stopPropagation()},onKeyDown:G=>{if(!(i&&i(G))){if(u){if((G.key==="ArrowUp"||G.key==="ArrowDown"||G.key==="ArrowLeft"||G.key==="ArrowRight"||G.key==="Escape")&&c===Ci)return;G.stopPropagation()}if(!P.current){if(!(G.key==="Enter"&&G.shiftKey)){if(G.key==="Enter"){G.preventDefault();let B=G.currentTarget.value;r&&r(B,{includeHistory:!O.current,meta:$.current}),O.current=!1,$.current={}}else if(G.code==="Space"){G.stopPropagation();return}}n&&n(G)}}},onClick:G=>{Zf(G.currentTarget,...F("click"))},onCompositionUpdate:G=>{u&&G.stopPropagation()},onCompositionStart:G=>{u&&G.stopPropagation(),P.current=!0},onCompositionEnd:G=>{u&&G.stopPropagation(),P.current=!1,Y(G)},onInput:G=>{u&&G.stopPropagation(),P.current?V(G.currentTarget.value):Y(G)},onBlur:G=>{H(G.currentTarget,...F("blur"))},autoFocus:_})),et.default.createElement(g,{ref:k,width:"100%"},s))},o9=yB;var Zc=S(M());var Wg=()=>{let{t:o}=v(["client"]),{setUserSettings:e,userSettings:t}=en(),{conversationId:r="",conversationMessages:n}=Tt(),{getConversation:i}=Ve(),{continueConversationInSidebar:a}=jl(),{floatingDropdownMenuOpen:s}=ts(),l=t?.alwaysContinueInSidebar,c=async()=>{if(!await Fe({emitEvent:!0}))return;let u=!l,p=await i(r);p?.lastMessageId&&u&&a(p.id),await e({...t,alwaysContinueInSidebar:u})};return!s||n.length?null:Zc.default.createElement(Ln,{title:o(l?"floating_menu__always_unpin_to_sidebar":"floating_menu__always_pin_to_sidebar"),onClick:c,floatingMenuTooltip:!0,placement:"top"},Zc.default.createElement("span",null,Zc.default.createElement(ee,{"data-testid":l?"maxai--context-window--always-responses-in-contextmenu--button":"maxai--context-window--always-responses-in-sidebar--button",sx:{width:32,height:32}},Zc.default.createElement(z,{icon:l?"AlwaysResponsesInContextMenu":"AlwaysResponsesInSidebar"}))))};var Qf=S(M());var Gg=o=>{let{sx:e,TooltipProps:t}=o,{t:r}=v(["client"]),{hideFloatingContextMenu:n}=ts(),{betaSettings:i}=Sr();if(i?.appearance_v2_enabled)return null;let a=async()=>{let s=Xu();if(s){n(),na();let l=await oh(s,'button[data-testid="maxai--sidebar--contextmenu_tab"]',50,5e3);if(!l)return;l?.click(),await new Promise(u=>setTimeout(u,1e3)),(await oh(s,'button[data-testid="maxai-chat-history-button"]',50,5e3))?.click()}};return Qf.default.createElement(Ln,{title:r("client:sidebar__speed_dial__chat_history__button"),placement:"bottom",...t},Qf.default.createElement(je,{onClick:a,"data-testid":"maxai-context-window-history-button",sx:{width:"28px",height:"28px",color:"text.primary",minWidth:"unset",borderRadius:"8px",border:"1px solid",borderColor:"border.main",...e},TouchRippleProps:{center:!1}},Qf.default.createElement(z,{icon:"History",sx:{fontSize:"20px"}})))};var Ki=S(M());var Jf={ChatInSidebar:{value:"chat-in-sidebar",label:"client:context_menu__button__chat_in_sidebar__title",icon:Ki.default.createElement(z,{icon:"ChatInSidebar"})},AlwaysChatInSidebar:{value:"always-chat-in-sidebar",label:"client:context_menu__button__always_chat_in_sidebar__title",icon:Ki.default.createElement(z,{icon:"AlwaysResponsesInSidebar"})}},Kg=()=>{let{t:o}=v(),{setUserSettings:e,userSettings:t}=en(),{conversationId:r,conversationMessages:n}=Tt(),{continueConversationInSidebar:i}=jl(),a=(0,Ki.useMemo)(()=>Object.values(Jf).map(c=>({...c,label:o(c.label)})),[o]),s=(0,Ki.useMemo)(()=>t?.alwaysContinueInSidebar?Jf.AlwaysChatInSidebar:Jf.ChatInSidebar,[t]),l=async c=>{r&&(i(r),c===Jf.AlwaysChatInSidebar.value&&await e({...t,alwaysContinueInSidebar:!0}))};return n.length?Ki.default.createElement(Ga,{isMirror:!0,hoverOpen:!0,placement:"bottom-start",headless:!0,referenceElement:Ki.default.createElement(ee,{"data-testid":"maxai-context-window-continue-chat-button",onClick:c=>{c.stopPropagation(),l(s.value)}},s.icon,Ki.default.createElement(T,{sx:{fontSize:"14px"}},o(s.label))),sx:{zIndex:2147483602},modifiers:[{name:"offset",options:{offset:[0,6]}}]},Ki.default.createElement(vi,{sx:{width:"240px"},defaultValue:s.value,options:a,onSelectOption:l})):null};var jg=S(M());var IB=S(M());var r9=S(bi()),Ts=S(M());var jSe=o=>Ts.default.createElement(r9.default,{...o},Ts.default.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ts.default.createElement("path",{d:"M6.38095 14.8256L5.71627 11.8449H6.39567L6.78114 13.8211L7.24333 11.8449H7.82387L8.2904 13.8233L8.67364 11.8449H9.35093L8.68626 14.8256H7.98793L7.53225 12.9908L7.08348 14.8256H6.38095Z",fill:"currentColor"}),Ts.default.createElement("path",{d:"M10.9345 14.8256L10.2699 11.8449H10.9493L11.3347 13.8211L11.7969 11.8449H12.3775L12.844 13.8233L13.2272 11.8449H13.9045L13.2398 14.8256H12.5415L12.0858 12.9908L11.6371 14.8256H10.9345Z",fill:"currentColor"}),Ts.default.createElement("path",{d:"M15.4881 14.8256H16.1906L16.6394 12.9908L17.0951 14.8256H17.7934L18.4581 11.8449H17.7808L17.3976 13.8233L16.931 11.8449H16.3505L15.8883 13.8211L15.5028 11.8449H14.8234L15.4881 14.8256Z",fill:"currentColor"}),Ts.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.6308 10.0915H19.7672C20.2492 10.0915 20.6399 10.484 20.6399 10.9682V15.3516C20.6399 15.8358 20.2492 16.2283 19.7672 16.2283H17.7263C16.6592 18.2615 14.5343 19.6474 12.0872 19.6474C9.64007 19.6474 7.5152 18.2615 6.44802 16.2283H4.40718C3.92519 16.2283 3.53446 15.8358 3.53446 15.3516V10.9682C3.53446 10.484 3.92519 10.0915 4.40718 10.0915H6.54358C7.63879 8.15442 9.71108 6.84773 12.0872 6.84773C14.4633 6.84773 16.5356 8.15442 17.6308 10.0915ZM10.4088 7.6193C9.05129 8.02721 7.90098 8.91722 7.15483 10.0915H9.04299C9.18875 9.61479 9.36687 9.17588 9.5724 8.78527C9.81055 8.33266 10.0917 7.93482 10.4088 7.6193ZM9.59245 10.0915H11.8254V7.39749C11.1699 7.51643 10.5359 8.07982 10.0353 9.03108C9.86806 9.349 9.71911 9.70472 9.59245 10.0915ZM12.349 10.0915H14.5819C14.4553 9.70472 14.3063 9.349 14.139 9.03108C13.6385 8.07982 13.0045 7.51643 12.349 7.39749V10.0915ZM15.1314 10.0915H17.0195C16.2734 8.91722 15.1231 8.02721 13.7655 7.6193C14.0826 7.93482 14.3638 8.33266 14.602 8.78527C14.8075 9.17588 14.9856 9.61479 15.1314 10.0915ZM7.04767 16.2283C7.78831 17.4892 8.98451 18.4479 10.4088 18.8759C10.0917 18.5603 9.81055 18.1625 9.5724 17.7099C9.34191 17.2718 9.14588 16.773 8.99133 16.2283H7.04767ZM9.5372 16.2283C9.67503 16.6833 9.84308 17.0987 10.0353 17.4641C10.5359 18.4153 11.1699 18.9787 11.8254 19.0977V16.2283H9.5372ZM12.349 16.2283V19.0977C13.0045 18.9787 13.6385 18.4153 14.139 17.4641C14.3313 17.0987 14.4993 16.6833 14.6372 16.2283H12.349ZM15.183 16.2283C15.0285 16.773 14.8325 17.2718 14.602 17.7099C14.3638 18.1625 14.0826 18.5603 13.7655 18.8759C15.1899 18.4479 16.3861 17.4892 17.1267 16.2283H15.183ZM4.05809 10.9682C4.05809 10.7745 4.21439 10.6175 4.40718 10.6175H19.7672C19.96 10.6175 20.1163 10.7745 20.1163 10.9682V15.3516C20.1163 15.5453 19.96 15.7023 19.7672 15.7023H4.40718C4.21439 15.7023 4.05809 15.5453 4.05809 15.3516V10.9682Z",fill:"currentColor"}),Ts.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.96355 2.72728C1.48159 2.72728 1.09082 3.11978 1.09082 3.60397V20.0858C1.09082 20.7636 1.63785 21.3131 2.31264 21.3131H21.6872C22.362 21.3131 22.909 20.7636 22.909 20.0858V3.60397C22.909 3.11978 22.5182 2.72728 22.0363 2.72728H1.96355ZM1.789 20.0858V5.88337H22.2108V20.0858C22.2108 20.3763 21.9764 20.6118 21.6872 20.6118H2.31264C2.02344 20.6118 1.789 20.3763 1.789 20.0858ZM3.18537 4.30532C3.18537 4.59584 2.95091 4.83134 2.66173 4.83134C2.37255 4.83134 2.13809 4.59584 2.13809 4.30532C2.13809 4.01481 2.37255 3.77931 2.66173 3.77931C2.95091 3.77931 3.18537 4.01481 3.18537 4.30532ZM4.58173 4.30532C4.58173 4.59584 4.34727 4.83134 4.05809 4.83134C3.76892 4.83134 3.53446 4.59584 3.53446 4.30532C3.53446 4.01481 3.76892 3.77931 4.05809 3.77931C4.34727 3.77931 4.58173 4.01481 4.58173 4.30532ZM5.45446 4.83134C5.74363 4.83134 5.97809 4.59584 5.97809 4.30532C5.97809 4.01481 5.74363 3.77931 5.45446 3.77931C5.16528 3.77931 4.93082 4.01481 4.93082 4.30532C4.93082 4.59584 5.16528 4.83134 5.45446 4.83134ZM20.1163 4.30532C20.1163 4.20849 20.1944 4.12999 20.2908 4.12999H21.6872C21.7836 4.12999 21.8617 4.20849 21.8617 4.30532C21.8617 4.40215 21.7836 4.48066 21.6872 4.48066H20.2908C20.1944 4.48066 20.1163 4.40215 20.1163 4.30532Z",fill:"currentColor"})));var $g=S(M());var Vo=S(M());var qg=({onRegenerate:o})=>{let{conversationId:e}=Tt(),t=ge(e),r=(0,Vo.useRef)(!1),{currentFloatingContextMenuDraft:n}=Vr(),i=(0,Vo.useMemo)(()=>!!(t&&n),[t,n]),{stopGenerate:a,regenerate:s}=Re(),l=(0,Vo.useRef)(s),c=(0,Vo.useRef)(a);l.current=s,c.current=a;let u=(0,Vo.useCallback)(async p=>{p==="s"&&(r.current=!1,await c.current()),p==="r"&&(r.current=!0,await c.current(),o?.(),await l.current(e))},[e]);return(0,Vo.useEffect)(()=>{if(!i)return;let p=async m=>{let d=m.key;Pm()&&["r","s","o","c"].includes(d)&&(m.preventDefault(),m.stopPropagation(),await u(d))};return window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}},[i,u]),i?Vo.default.createElement(g,{direction:"row",spacing:1,sx:{ml:"auto!important","& .usechatgpt-floating-menu__button__shortcut":{fontSize:"12px",opacity:.7,ml:"4px"}}},Vo.default.createElement(le,{sx:{height:"24px"},variant:"text",onClick:async()=>{await u("r")}},Vo.default.createElement(T,{component:"span",fontSize:"14px",color:"primary.main"},"Try again",Vo.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"R"))),Vo.default.createElement(le,{sx:{height:"24px"},variant:"text",onClick:async()=>{await u("s")}},Vo.default.createElement(T,{component:"span",fontSize:"14px",color:"primary.main"},"Stop",Vo.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"S")))):Vo.default.createElement(Vo.default.Fragment,null)};var mt=S(M());var n9=(0,mt.forwardRef)((o,e)=>{let{t}=v(["prompt","client"]),{draftUserMessage:r}=Vr(),n=(0,mt.useMemo)(()=>{let i=r?.meta?.MaxAIPromptActionConfig?.prompt_id;if(i)return mt.default.createElement(g,{fontSize:"14px",direction:"column",alignItems:"flex-start"},mt.default.createElement(L,null,t(`prompt:${i}`)),mt.default.createElement(L,null,t("client:floating_menu__contextmenu__click_to_retry")));let a=r?.text?.replace(/^(.*?)\s*:\s*""".*?"""/s,"$1");return a?mt.default.createElement(g,{fontSize:"14px",direction:"column",alignItems:"flex-start"},mt.default.createElement(L,null,a),mt.default.createElement(L,null,t("client:floating_menu__contextmenu__click_edit_prompt_and_retry"))):""},[r]);return mt.default.createElement(Ln,{title:n,placement:"right",floatingMenuTooltip:!0,slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,3]}}]}}},mt.default.createElement(Vm,{...o,label:t("package__features:context_menu__prompt__6b9f9cb4-b1b1-4897-9156-903dbc52b2a1"),menuItem:o.menuItem,ref:e}))});n9.displayName="TryAgainItem";var Qc=(0,mt.forwardRef)((o,e)=>{let{menuItem:t,root:r,referenceElement:n,referenceElementOpen:i,rootMenu:a,customOpen:s,onClickContextMenu:l,menuWidth:c,...u}=o,{t:p}=v(),m=(0,mt.useCallback)(h=>{let f=`context_menu__prompt__${h.prompt_id.replace(sr,"")}`,_=`package__features:${f}`,x=p(_);return x!==_&&x!==f?x:h.prompt_title},[p]),d=(0,mt.useMemo)(()=>m(t),[t.prompt_title,m]);return t.type==="group"?mt.default.createElement(nc,{zIndex:o.zIndex,ref:e,root:r,label:d,menuWidth:c,onClickContextMenu:l,referenceElement:mt.default.createElement(Vm,{...u,label:d,menuItem:t}),needAutoUpdate:u.needAutoUpdate},(t.children??[]).map(h=>mt.default.createElement(Qc,{...u,root:r,key:h.prompt_id,menuItem:h}))):t.prompt_id===Rl.TRY_AGAIN?mt.default.createElement(n9,{...u,menuItem:t,ref:e}):mt.default.createElement(Vm,{...u,label:d,menuItem:t,ref:e})});Qc.displayName="RenderDropdownItem";var e1=o=>mt.default.createElement(L,{"data-testid":"max-ai-context-menu-divider","aria-disabled":!0,key:`${o}_group_spector`,onClick:e=>{e.stopPropagation(),e.preventDefault()},component:"div",sx:{pointerEvents:"none",borderTop:"1px solid",borderColor:"border.main",my:.5}}),SB=o=>{let{root:e,referenceElement:t,referenceElementOpen:r,referenceElementRef:n,menuList:i,customOpen:a,needAutoUpdate:s,defaultPlacement:l,defaultFallbackPlacements:c,onClickContextMenu:u,menuWidth:p,onClickReferenceElement:m,hoverOpen:d,hoverIcon:h,isFirstLevelFlatten:f=!0,..._}=o,{t:x}=v(),C=(0,mt.useMemo)(()=>{let y=[];return i.forEach((b,w)=>{let I=`context_menu__prompt__${b.prompt_id.replace(sr,"")}`,E=`package__features:${I}`,P=x(E);P=P!==E&&P!==I?P:b.prompt_title,b.type==="group"&&f?(w>0&&y.push(e1(b.prompt_id)),y.push(mt.default.createElement(L,{key:b.prompt_id+"_group_name",component:"div","aria-disabled":!0,"data-testid":`max-ai-context-menu-group-label__${b.prompt_id}`,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",boxSizing:"border-box",direction:"row",pl:"8px"},onMouseDownCapture:O=>{O.stopPropagation(),O.preventDefault()}},mt.default.createElement(L,{sx:{p:"6px 0 8px 0",pointerEvents:"none"}},mt.default.createElement(T,{textAlign:"left",fontSize:12,color:"text.secondary"},P)),b.prompt_id===sr&&mt.default.createElement(up,null))),(b.children??[]).forEach((O,N)=>{Z1.includes(O.prompt_id)&&y.push(e1(b.prompt_id)),y.push(mt.default.createElement(Qc,{menuWidth:p,hoverIcon:h,onClickContextMenu:u,zIndex:2147483602,needAutoUpdate:s,..._,key:O.prompt_id,menuItem:O,root:e}))})):b.type==="chat_complete"?(w>0&&y.push(e1(b.prompt_id)),y.push(mt.default.createElement(Qc,{menuWidth:p,hoverIcon:h,onClickContextMenu:u,needAutoUpdate:s,key:b.prompt_id,menuItem:b,root:e,zIndex:2147483602}))):(Z1.includes(b.prompt_id)&&y.push(e1(b.prompt_id)),y.push(mt.default.createElement(Qc,{menuWidth:p,hoverIcon:h,onClickContextMenu:u,needAutoUpdate:s,key:b.prompt_id,menuItem:b,root:e,zIndex:2147483602})))}),y},[i,x,f]);return mt.default.createElement(nc,{zIndex:2147483601,label:"",root:e,customOpen:a,needAutoUpdate:s,referenceElement:t,referenceElementOpen:r,referenceElementRef:n,defaultPlacement:l,defaultFallbackPlacements:c,onClickContextMenu:u,onClickReferenceElement:m,hoverOpen:d,menuWidth:p,hoverIcon:h},r===!1?null:C)},i9=SB;var Yn=S(M());var a9="context-menu-dom-event-manager";var p9=S(Cr()),c9=S(s9()),u9=S(l9());var ji=S(M());var AB=({loading:o})=>{let{t:e}=v(["common","client"]),{hideFloatingContextMenu:t}=Fm(),{floatingDropdownMenuPin:r,setFloatingDropdownMenuPin:n}=iy(),i=()=>{n(!r)};return ji.default.createElement(ji.default.Fragment,null,ji.default.createElement(Ln,{title:e(r?"client:floating_menu__pin_button__pinned__title":"client:floating_menu__pin_button__unpinned__title"),placement:"top",floatingMenuTooltip:!0},ji.default.createElement(je,{"data-testid":"maxai-context-window-pin-button",size:"small",sx:{width:28,height:28,color:"text.secondary","&:hover":{color:"text.primary"},padding:"0 3px"},onClick:i},r?ji.default.createElement(c9.default,{sx:{fontSize:16,transform:"rotate(45deg)"},color:"primary"}):ji.default.createElement(u9.default,{sx:{fontSize:16,transform:"rotate(45deg)"}}))),ji.default.createElement(Ln,{title:e("client:floating_menu__close_button__title"),description:"Esc",placement:"top",floatingMenuTooltip:!0},ji.default.createElement(je,{"data-testid":"maxai-context-window-close-button",size:"small",sx:{width:28,height:28,color:"text.secondary","&:hover":{color:"text.primary"},padding:"3px",marginRight:"-3px"},disabled:o,onClick:()=>t(!0)},ji.default.createElement(p9.default,{sx:{fontSize:17}}))))},r1=AB;var f9=S(m9()),h9=S(d9());var al=S(M());var FB=()=>{let{activeResponseMessageIndex:o,goToNextMessage:e,goToPreviousMessage:t,totalResponseCount:r}=Vr(),{conversationId:n}=Tt(),i=ge(n),a=o===0,s=o===r-1;return r===0?null:al.default.createElement(g,{flexShrink:0,direction:"row",gap:.5,height:"32px",lineHeight:"32px",alignItems:"center"},al.default.createElement(je,{sx:{width:"24px",height:"24px"},disabled:i||a,onClick:t},al.default.createElement(f9.default,{sx:{fontSize:"20px",p:"2px",color:"text.secondary",cursor:"pointer",opacity:a?.4:1}})),al.default.createElement(T,{fontSize:"12px",color:"text.secondary",fontWeight:400,lineHeight:"24px"},`${o+1} of ${r}`),al.default.createElement(je,{sx:{width:"24px",height:"24px"},disabled:i||s,onClick:e},al.default.createElement(h9.default,{sx:{fontSize:"20px",p:"2px",color:"text.secondary",cursor:"pointer",opacity:s?.4:1}})))},g9=FB;var NB=({showModelSelector:o,showUsageButton:e,loading:t})=>{let{conversationMessages:r}=Tt(),{localSettings:n}=_t(),i=n?.chatMode==="pro_chat",a=()=>{let c=br()?.querySelector(`#${Ci}`);c&&c?.focus()},s=()=>{a()},l=()=>{a()};return Yn.default.createElement(g,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{wordBreak:"break-word",color:c=>c.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)",paddingBottom:r.length?"0":"4px",paddingTop:r.length?"10px":"0"},component:"div"},Yn.default.createElement(g,{direction:"row",gap:"4px",alignItems:"center",flexWrap:"wrap"},Yn.default.createElement(us,{hideOnboarding:!0,disabled:t}),o&&i&&Yn.default.createElement(hs,{onChanged:s,disabled:!o||t,size:"small",tooltipProps:{placement:"top"},domEventManagerId:a9}),i&&Yn.default.createElement(ms,{onChanged:l,tooltipProps:{placement:"top"},disabled:t}),Yn.default.createElement(g,{direction:"row",alignItems:"center",gap:"4px","data-testid":"maxai--chat-box--tools--left-container--portal-root",sx:{display:i?"flex":"none","&:empty":{display:"none"}}})),Yn.default.createElement(g,{direction:"row",justifyContent:"end",alignItems:"center",sx:{alignSelf:"flex-start",height:32,gap:.5}},Yn.default.createElement(g,{direction:"row",alignItems:"center"},Yn.default.createElement(Gg,{TooltipProps:{placement:"top",floatingMenuTooltip:!0},sx:{mr:1}}),!t&&!r.length&&Yn.default.createElement(r1,{loading:t}),Yn.default.createElement(g9,null))))},x9=NB;var Pt=S(M());var W8e=3*24,Xg=o=>{let e=o.scrollTop,t=o.scrollHeight,r=o.clientHeight;return Math.abs(r+e-t)>8},VB=({onChange:o,contextMenuDefaultHeight:e})=>{let t=gl(),r=bt(Wl),n=Qt(oy),{conversationId:i}=Tt(),a=ge(i),{currentFloatingContextMenuDraft:s,activeResponseMessage:l}=Vr(),c=(0,Pt.useRef)(null),u=(0,Pt.useRef)(null),p=(0,Pt.useRef)(),[m,d]=(0,Pt.useState)(!1),h=()=>{let C=u.current;C&&(C.scrollTo(0,C.scrollHeight),d(!1))},f=(0,Pt.useMemo)(()=>s.replace(/^\s+/,""),[s]);(0,Pt.useEffect)(()=>{a||(n(C=>({...C,lastOutput:s})),o?.(s))},[s,r,a]),(0,Pt.useEffect)(()=>{let C=y=>{if((y.metaKey||y.ctrlKey)&&(y.stopPropagation(),y.key==="C"||y.key==="c"||y.key==="x"||y.key==="X")){let b=window.getSelection();if(b&&b.rangeCount>0){let I=b.getRangeAt(0).toString()||b.toString();I&&(y.preventDefault(),navigator.clipboard.writeText(I))}}};u.current?.addEventListener("keydown",C,!0)},[]),(0,Pt.useEffect)(()=>{let C=u.current;if(!C)return;let y=new ResizeObserver(()=>{d(Xg(C))});y.observe(C);let b=oi(()=>{d(Xg(C))},100);return C.addEventListener("wheel",b),()=>{y.disconnect(),C.removeEventListener("wheel",b)}},[]);let _=(0,Pt.useRef)(a);(0,Pt.useEffect)(()=>{_.current=a},[a]),(0,Pt.useEffect)(()=>{let C=u.current;C&&d(Xg(C))},[f]);let x=l&&wi(l);return Pt.default.createElement(g,{ref:c,className:"chat-message--text max-ai__writing-message-box",whiteSpace:"pre-wrap",width:"100%",sx:{position:"relative",wordBreak:"break-word",borderBottomLeftRadius:0,flex:1,overflowY:"auto",color:C=>C.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)","& .markdown-body":{userSelect:"text",overflowY:"auto","*":{fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important'}}},component:"div"},x&&Pt.default.createElement(Cf,{message:l,sx:{boxSizing:"border-box",my:1}}),Pt.default.createElement(g,{"data-testid":"maxai--contextmenu--writing-message-box","data-disabled-button-clicked":!0,tabIndex:-1,ref:u,sx:{flex:1,height:0,width:"100%",overflowY:"auto"}},l&&mn(l)&&Pt.default.createElement(of,{message:l},Pt.default.createElement(df,{message:l})),!x&&Pt.default.createElement("div",{style:{textAlign:"left",overflowY:"unset",padding:f?"16px 0":"0"},className:`markdown-body ${t.palette.mode==="dark"?"markdown-body-dark":""}`},f?Pt.default.createElement(Ya,{message:l||void 0},f):e?Pt.default.createElement(Pt.default.Fragment,null,Pt.default.createElement(vt,{variant:"text",sx:{fontSize:"1.5rem"}}),Pt.default.createElement(vt,{variant:"text",sx:{fontSize:"1.5rem"},width:"70%"}),e>218&&Pt.default.createElement(vt,{variant:"text",sx:{fontSize:"1.5rem"},width:"50%"})):null),m&&Pt.default.createElement(Tf,{onClick:()=>h()})))},_9=VB;var ws=S(M());var Jc={sceneType:"FLOATING_CONTEXT_MENU_INPUT_BOX_AFTER_AI_RESPONSE",id:"ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_INPUT_BOX_AFTER_AI_RESPONSE",anchorElementSelectors:"div#ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_INPUT_BOX__REFERENCE_ELEMENT",CtaButtonClickedName:"Onboarding > ContextMenu > RewriteMenu > Got it"},RB=o=>{let{showStateTrigger:e,...t}=o,{t:r}=v(),[n,i]=(0,ws.useState)(!1);return(0,ws.useEffect)(()=>{e?$l(500).then(async()=>{if(!await dn(Jc.sceneType)){let s=br();if(ic("FLOATING_CONTEXT_MENU_REPLACE_SELECTION_MENUITEM",s)||ic("FLOATING_CONTEXT_MENU_LIST_BOX",s))return;Hn(Jc.sceneType).then(()=>{i(!0)})}}):i(!1)},[e]),ws.default.createElement(Bt,{hideBackdrop:!0,sx:{visibility:"hidden"},placement:"left",fallbackPlacements:["bottom-start","top-start"],offset:[0,8],trigger:n,anchorElementSelectors:Jc.anchorElementSelectors,CtaButtonProps:{"data-button-clicked-name":Jc.CtaButtonClickedName},arrowSx:{'&[data-custom-popover-placement*="bottom"]':{marginLeft:"15px"}},id:Jc.id,...t},ws.default.createElement(g,null,ws.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_INPUT_BOX_AFTER_AI_RESPONSE__text1"))))},C9=RB;var Es=S(M());var eu={sceneType:"FLOATING_CONTEXT_MENU_INPUT_BOX",id:"ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_INPUT_BOX",anchorElementSelectors:"div#ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_INPUT_BOX__REFERENCE_ELEMENT",CtaButtonClickedName:"Onboarding > ContextMenu > RewriteMenu > Got it"},zB=o=>{let{showStateTrigger:e,...t}=o,{t:r}=v(),[n,i]=(0,Es.useState)(!1);return(0,Es.useEffect)(()=>{e?Promise.all([dn(eu.sceneType),dn("FLOATING_CONTEXT_MENU_LIST_BOX")]).then(async([a,s])=>{if(!a){await $l(50);let l=br(),c=!!ic("FLOATING_CONTEXT_MENU_LIST_BOX",l);if(!s||c)return;Hn(eu.sceneType).then(()=>{i(!0)})}}):i(!1)},[e]),Es.default.createElement(Bt,{hideBackdrop:!0,sx:{visibility:"hidden"},placement:"left",fallbackPlacements:["bottom-start","top-start"],trigger:n,anchorElementSelectors:eu.anchorElementSelectors,CtaButtonProps:{"data-button-clicked-name":eu.CtaButtonClickedName},arrowSx:{'&[data-custom-popover-placement*="bottom"]':{marginLeft:"10px"}},id:eu.id,...t},Es.default.createElement(g,null,Es.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_INPUT_BOX__text2"))))},y9=zB;var Ca=S(M());var tu={sceneType:"FLOATING_CONTEXT_MENU_REPLACE_SELECTION_MENUITEM",id:"ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_REPLACE_SELECTION_MENUITEM",anchorElementSelectors:`div[data-id="${Rl.REPLACE_SELECTION}"].floating-context-menu-item`,CtaButtonClickedName:"Onboarding > ContextMenu > ReplaceSelection > Got it"},UB=o=>{let{showStateTrigger:e,...t}=o,{t:r}=v(),[n,i]=(0,Ca.useState)(!1);(0,Ca.useEffect)(()=>{e?dn(tu.sceneType).then(s=>{s||Hn(tu.sceneType).then(()=>{i(!0)})}):i(!1)},[e]);let a={bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.16) !important":"rgba(0, 0, 0, 0.08) !important",color:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.7) !important":"rgba(0, 0, 0, 0.7) !important"};return Ca.default.createElement(Bt,{hideBackdrop:!0,sx:{visibility:"hidden"},placement:"right-start",fallbackPlacements:["right-end","left-start","left-end"],offset:[0,8],trigger:n,anchorElementSelectors:tu.anchorElementSelectors,CtaButtonProps:{"data-button-clicked-name":tu.CtaButtonClickedName},arrowSx:{'&[data-custom-popover-placement*="bottom"]':{marginLeft:"15px"}},id:tu.id,...t},Ca.default.createElement(g,{gap:1},Ca.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_REPLACE_SELECTION_MENUITEM__text1")),Ca.default.createElement(Ba,{sx:a},"Enter")))},b9=UB;var I9=S(W7()),S9=S(G7());var vo=S(M());var ou={sceneType:"FLOATING_CONTEXT_MENU_LIST_BOX",id:"ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_LIST_BOX",anchorElementSelectors:"div[role=menu].dropdown-menu",CtaButtonClickedName:"Onboarding > ContextMenu > RewriteMenu > Got it"},WB=o=>{let{showStateTrigger:e,...t}=o,{t:r}=v(),[n,i]=(0,vo.useState)(!1),a={bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.16) !important":"rgba(0, 0, 0, 0.08) !important",color:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.7) !important":"rgba(0, 0, 0, 0.7) !important"};return(0,vo.useEffect)(()=>{e?$l(500).then(()=>{dn(ou.sceneType).then(s=>{s||Hn(ou.sceneType).then(()=>{i(!0)})})}):i(!1)},[e]),vo.default.createElement(Bt,{hideBackdrop:!0,sx:{visibility:"hidden"},placement:"left",fallbackPlacements:["right","bottom","top"],trigger:n,anchorElementSelectors:ou.anchorElementSelectors,CtaButtonProps:{"data-button-clicked-name":ou.CtaButtonClickedName},id:ou.id,...t},vo.default.createElement(g,{spacing:"4px"},vo.default.createElement(g,{direction:"row",alignItems:"center",spacing:.5},vo.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text1__part1")),vo.default.createElement(Ba,{sx:a},vo.default.createElement(I9.default,{sx:{fontSize:"12px",transform:"scale(1.6)"}})),vo.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text1__part2"))),vo.default.createElement(g,{direction:"row",alignItems:"center",spacing:.5},vo.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text2__part1")),vo.default.createElement(Ba,{sx:a},vo.default.createElement(S9.default,{sx:{fontSize:"12px",transform:"scale(1.6)"}})),vo.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text2__part2"))),vo.default.createElement(g,{direction:"row",alignItems:"center",spacing:.5},vo.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text3__part1")),vo.default.createElement(Ba,{sx:a},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text3__part2")),vo.default.createElement(T,{fontSize:14,lineHeight:1.5},r("onboarding:onboarding_tooltip__FLOATING_CONTEXT_MENU_LIST_BOX__text3__part3")))))},v9=WB;var Tn=S(M());var k9=S(nm()),L9=S(Ig());var Xt=S(M());var ya=S(M()),T9=S(L7());var ru=S(M());var GB=o=>{let{title:e,placement:t,TooltipProps:r,loading:n=!1,children:i,PopperProps:a,...s}=o;return ru.default.createElement(Ln,{placement:t||"top",title:e,PopperProps:{sx:{},...a},...r},ru.default.createElement("span",{className:"TextOnlyTooltip_IconButton_wrapper"},ru.default.createElement(je,{...s},n?ru.default.createElement(Jt,{size:16,sx:{m:"0 auto"}}):i)))},M9=GB;var KB=o=>{let{copyText:e,onCopy:t,sx:r,defaultIconSx:n,icon:i,copyToClipboardTooltip:a,copiedTooltip:s,TooltipProps:l,PopperProps:c,tooltipPlacement:u,...p}=o,{t:m}=v(["common"]),[d,h]=(0,ya.useState)(!1),f=(0,ya.useMemo)(()=>m(d?s||"common:copied":a||"common:copy_to_clipboard"),[m,d,a,s]);return ya.default.createElement(T9.CopyToClipboard,{text:e,options:{message:"Copied!",format:"text/plain"},onCopy:()=>{t?.(),h(!0),setTimeout(()=>{h(!1)},1e3)}},ya.default.createElement(M9,{title:f,sx:r,className:o.className,TooltipProps:l,PopperProps:c,placement:u,...p},d?ya.default.createElement(z,{icon:"Check",sx:{fontSize:"20px",...n}}):i||ya.default.createElement(z,{icon:"CopyTextOnly",sx:{fontSize:"20px",...n}}),o.children))},a1=KB;var ho=S(M());var hr=S(M()),E9=S(M());function w9(o){return o.substring(2).toLowerCase()}function jB(o,e){return e.documentElement.clientWidth<o.clientX||e.documentElement.clientHeight<o.clientY}function $B(o,e){typeof o=="function"?o(e):o&&(o.current=e)}function qB(...o){return hr.useMemo(()=>o.every(e=>e==null)?null:e=>{o.forEach(t=>{$B(t,e)})},o)}var Yg=o=>{if(o){let e=Xu();if(e&&e.contains(o))return e;if(e=br(),e){let t=e.querySelector(`#${hl}`);return t instanceof HTMLElement?t:e}}return document.documentElement};function XB(o){let{children:e,disableReactTree:t=!1,mouseEvent:r="onClick",onClickAway:n,touchEvent:i="onTouchEnd"}=o,a=hr.useRef(!1),s=hr.useRef(null),l=hr.useRef(!1),c=hr.useRef(!1);hr.useEffect(()=>(setTimeout(()=>{l.current=!0},0),()=>{l.current=!1}),[]);let u=qB(e.ref,s),p=(0,E9.useCallback)(h=>{let f=c.current;c.current=!1;let _=Yg(s.current);if(!l.current||!s.current||"clientX"in h&&jB(h,_.ownerDocument))return;if(a.current){a.current=!1;return}let x;h.composedPath?x=h.composedPath().indexOf(s.current)>-1:x=!_.ownerDocument.documentElement.contains(h.target)||s.current.contains(h.target),!x&&(t||!f)&&n(h)},[]),m=h=>f=>{c.current=!0;let _=e.props[h];_&&_(f)},d={ref:u};return i!==!1&&(d[i]=m(i)),hr.useEffect(()=>{if(i!==!1){let h=w9(i),f=Yg(s.current),_=()=>{a.current=!0};return f.addEventListener(h,p),f.addEventListener("touchmove",_),()=>{f.removeEventListener(h,p),f.removeEventListener("touchmove",_)}}},[p,i]),r!==!1&&(d[r]=m(r)),hr.useEffect(()=>{if(r!==!1){let h=w9(r),f=Yg(s.current);return f.addEventListener(h,p),()=>{f.removeEventListener(h,p)}}},[p,r]),hr.createElement(hr.Fragment,null,hr.cloneElement(e,d))}var P9=XB;var YB=Jr(({className:o,...e})=>ho.default.createElement(kn,{...e,classes:{popper:o}}))(({theme:o})=>({[`& > .${Br.tooltip}`]:{background:o.palette.mode==="dark"?"#2C2C2C":"#ffffff",color:"rgba(0, 0, 0, 0.87)",fontSize:12,boxShadow:"0px 12px 16px -4px rgba(0, 0, 0, 0.08), 0px 4px 6px -2px rgba(0, 0, 0, 0.03)",maxWidth:"none",borderRadius:o.spacing(1),border:`1px solid ${o.palette.border.main}`,backgroundClip:"padding-box"},[`& .${Br.arrow}`]:{color:o.palette.mode==="dark"?"#2C2C2C":"#ffffff","&::before":{border:`1px solid ${o.palette.border.main}`,background:o.palette.mode==="dark"?"#2C2C2C":"#ffffff",backgroundClip:"padding-box"}}})),ZB=(0,ho.forwardRef)(function({variable:e,sx:t,container:r,children:n,virtualRect:i,popperSx:a,suffix:s,anchorElSx:l,descriptionEl:c},u){let[p,m]=(0,ho.useState)(!1),d=(0,ho.useRef)(null);(0,ho.useImperativeHandle)(u,()=>({close:()=>m(!1)}));let h=e.key==="Selected Text"||e.key==="Draft"?"Context":e.key,f={container:r,sx:{zIndex:2147483619,...a},transition:!0};return i&&(f.anchorEl={getBoundingClientRect(){return i}}),ho.default.createElement(P9,{onClickAway:_=>{p&&_.target instanceof HTMLElement&&(d.current?.contains(_.target)||d.current===_.target)||m(!1)}},ho.default.createElement(g,{direction:"row",width:"100%",sx:t},ho.default.createElement(YB,{open:p,PopperProps:f,title:ho.default.createElement(g,{direction:"column",maxHeight:"min(500px, 40vh)",overflow:"hidden",height:"max-content"},ho.default.createElement(g,{direction:"row",width:"100%",gap:1.25,p:1.25,ref:d,boxSizing:"border-box",flexGrow:1,overflow:"hidden"},ho.default.createElement(L,{width:"2px",minWidth:"2px",bgcolor:_=>_.palette.mode==="dark"?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)"}),ho.default.createElement(g,{direction:"column",flexGrow:1,overflow:"hidden"},ho.default.createElement(g,{direction:"row",gap:1.25,alignItems:"center",maxWidth:"100%"},ho.default.createElement(T,{fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",noWrap:!0,color:_=>_.palette.mode==="dark"?"rgba(255, 255, 255, 0.50)":"rgba(0, 0, 0, 0.38)"},h),ho.default.createElement(a1,{sx:{padding:"5px",fontSize:"20px",borderRadius:"4px",color:"text.secondary"},defaultIconSx:{fontSize:"15px"},PopperProps:{container:r,placement:"top"},copyText:e.value})),c,ho.default.createElement(T,{width:"100%",whiteSpace:"pre-wrap",color:"text.primary",textAlign:"left",lineHeight:"24px",fontSize:"16px",flexGrow:1,overflow:"auto"},e.value))),s),placement:"top",arrow:!0,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0},ho.default.createElement(L,{onClick:()=>{m(!p)},sx:l},typeof n=="function"?n({variable:e,open:p}):n))))}),A9=ZB;var QB=Jr(({className:o,...e})=>Xt.default.createElement(kn,{...e,classes:{popper:o}}))(({theme:o})=>({[`& > .${Br.tooltip}`]:{background:o.palette.mode==="dark"?"#2C2C2C":"#ffffff",color:"rgba(0, 0, 0, 0.87)",fontSize:12,boxShadow:"0px 12px 16px -4px rgba(0, 0, 0, 0.08), 0px 4px 6px -2px rgba(0, 0, 0, 0.03)",maxWidth:"none",borderRadius:o.spacing(1),backgroundClip:"padding-box",border:`1px solid ${o.palette.border.main}`},[`& .${Br.arrow}`]:{color:o.palette.mode==="dark"?"#2C2C2C":"#ffffff","&::before":{border:`1px solid ${o.palette.border.main}`,background:o.palette.mode==="dark"?"#2C2C2C":"#ffffff",backgroundClip:"padding-box"}}})),JB=({quoteText:o,variables:e,container:t,title:r})=>{let{t:n}=v(["client"]),[i,a]=(0,Xt.useState)(!1),s=(0,Xt.useRef)(null),l=2147483617,c=2147483618;(0,Xt.useEffect)(()=>{let p=br()?.querySelector(`#${hl}`);if(p instanceof HTMLElement){let m=()=>{a(!1)};return p?.addEventListener("click",m),document.body.addEventListener("click",m),()=>{p?.removeEventListener("click",m),document.body.removeEventListener("click",m)}}},[]);let u=(0,Xt.useMemo)(()=>o?Xt.default.createElement(L,{sx:{display:"flex",flexDirection:"row",justifyContent:"flex-end",width:"100%"}},Xt.default.createElement(A9,{variable:{key:"Quote",value:o},sx:{width:"auto"},popperSx:{boxSizing:"border-box",zIndex:c,maxWidth:s.current?.clientWidth??"500px"},container:t},Xt.default.createElement(g,{gap:1,direction:"row",color:p=>p.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)",width:"100%"},Xt.default.createElement(L9.default,{sx:{fontSize:"18px"}}),Xt.default.createElement(wC,{maxLine:2,fontSize:"14px",flex:1},o.trim())))):null,[o,c,t]);return Xt.default.createElement(QB,{open:i,PopperProps:{container:t,sx:{zIndex:l}},disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,placement:"top",arrow:!0,title:Xt.default.createElement(g,{component:"div",direction:"column",maxWidth:"500px",maxHeight:"min(50vh, 500px)",ref:s,padding:"10px",boxSizing:"border-box",onClick:p=>p.stopPropagation(),sx:{boxSizing:"border-box",background:p=>p.palette.mode==="dark"?"#2C2C2C":"#ffffff"}},u,Xt.default.createElement(g,{maxWidth:"100%",width:"auto",direction:"row",sx:{"& .maxai-user-message-copy-icon":{opacity:0,transition:"opacity 0.2s ease-in-out"},"&:hover .maxai-user-message-copy-icon":{opacity:1}}},Xt.default.createElement(L,null,Xt.default.createElement(a1,{tabIndex:-1,tooltipPlacement:"top",sx:{marginRight:"5px",padding:"5px",fontSize:"20px",borderRadius:"4px",color:"text.secondary"},defaultIconSx:{fontSize:"15px"},className:"maxai-user-message-copy-icon",PopperProps:{container:t,sx:{zIndex:c}},copyText:r})),Xt.default.createElement(g,{direction:"column",gap:1,sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",p:p=>p.spacing(1.5),bgcolor:p=>p.palette.background.secondary,borderRadius:p=>p.spacing(1),color:"text.primary",flexWrap:"wrap",flexGrow:1,overflow:"hidden"}},Xt.default.createElement(T,{fontSize:"16px"},r),e.map(p=>Xt.default.createElement(bf,{key:p.key,variable:p,getMessageContainer:()=>s.current,container:t,zIndex:c})))))},Xt.default.createElement(le,{variant:"text",sx:{gap:"4px",padding:"6px"},onClick:p=>{a(!i),p.stopPropagation()}},Xt.default.createElement(T,{color:"text.primary",fontSize:"14px",noWrap:!0},n("floating_menu__button__show_detail")),Xt.default.createElement(k9.default,{sx:{color:"#D9D9D9",height:"16px",width:"16px",transition:"all 0.2s",transform:`rotate(${i?.5:0}turn)`}})))},O9=JB;var eD=({loading:o=!1})=>{let e=(0,Tn.useRef)(br()),{draftUserMessage:t}=Vr(),{conversationMessages:r}=Tt(),n=(0,Tn.useMemo)(()=>{if(!t)return"";let a=a_(t),s=a.indexOf(`:
"""
`);return s===-1?a:a.slice(0,s)},[t]),i=(0,Tn.useMemo)(()=>jc(t?.meta?.contexts,t?.meta?.MaxAIPromptActionConfig?.variables),[t?.meta?.contexts,t?.meta?.MaxAIPromptActionConfig?.variables]);return Tn.default.createElement(Cu,{in:!!t},Tn.default.createElement(g,{direction:"row",gap:"8px",alignItems:"center",height:"auto",width:"100%",paddingBottom:"4px"},Tn.default.createElement(g,{direction:"row",flex:1,alignItems:"center",overflow:"hidden",gap:"8px"},Tn.default.createElement(T,{color:"text.primary",fontSize:"18px",fontWeight:600,lineHeight:"150%"},n),Tn.default.createElement(T,{overflow:"hidden",textOverflow:"ellipsis",color:a=>a.palette.mode==="dark"?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.38)",flex:1,fontSize:"14px",sx:{whiteSpace:"nowrap",userSelect:"none",cursor:"default"}},i?.text)),Tn.default.createElement(O9,{quoteText:i?.text,variables:i?.userVariables??[],container:e.current,title:n}),r.length&&Tn.default.createElement(r1,{loading:o})))},B9=eD;var ba=S(M()),D9=S(M());var tD=()=>{let{currentSelection:o}=ia(),{draftUserMessage:e}=Vr(),{conversation:t,conversationId:r}=Tt(),n=ge(r),i=(0,D9.useMemo)(()=>(o?.selectionElement?.editableElementSelectionText||o?.selectionElement?.selectionText||"").trim().replace(/\u200B/g,""),[o]),[a,s]=(0,ba.useState)(!1);return(0,ba.useEffect)(()=>{let l=!!(!i||n||t?.lastMessageId&&e);s(l)},[i,n,t?.lastMessageId,e]),{showDraftTextPanel:!a,draftText:i}},oD=()=>{let{showDraftTextPanel:o,draftText:e}=tD(),{conversationMessages:t}=Tt();return t.length?null:ba.default.createElement(Cu,{in:o},ba.default.createElement(L,{sx:{display:"flex",flexDirection:"row",boxSizing:"border-box",padding:"8px",margin:"10px 0 0 0",borderRadius:"8px",alignItems:"center",gap:"8px",bgcolor:r=>r.palette.mode==="dark"?"rgba(59, 61, 62, 1)":"rgba(244, 244, 244, 1)",color:r=>r.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)",width:"100%"}},ba.default.createElement(OC,{sx:{fontSize:"16px"}}),ba.default.createElement(T,{sx:{flex:1,whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"14px",fontWeight:"400",overflow:"hidden",textAlign:"left",cursor:"default",userSelect:"none"}},e)))},H9=oD;var Xo=S(M());var rD=o=>{let{anchorSize:e="10px",onStart:t,onResize:r,onStop:n,disabledResizeHeight:i}=o,a=(0,Xo.useRef)(),s=(0,Xo.useRef)({onStart:t,onResize:r,onStop:n});s.current.onStart=t,s.current.onResize=r,s.current.onStop=n;let l=(0,Xo.useRef)(1);function c(C,y){l.current=Yu(),a.current=y,document.body.style.cursor="se-resize",t?.(y),C.stopPropagation(),C.preventDefault()}(0,Xo.useEffect)(()=>{function C(b){a.current&&(s.current.onResize?.(b.movementX/l.current,b.movementY/l.current,a.current),b.stopPropagation())}function y(){a.current&&(s.current.onStop?.(),a.current=void 0,document.body.style.cursor="inherit")}return window.addEventListener("mousemove",C),window.addEventListener("mouseup",y),window.addEventListener("contextmenu",y),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",y),window.removeEventListener("contextmenu",y)}},[]);let{top:u,bottom:p,left:m,right:d,topLeft:h,topRight:f,bottomLeft:_,bottomRight:x}=(0,Xo.useMemo)(()=>{let C={position:"absolute",height:e,width:e,background:"none",backgroundColor:"none",zIndex:1};return{top:{...C,cursor:"n-resize",width:"100%",top:0,left:0},bottom:{...C,cursor:"s-resize",width:"100%",bottom:0,left:0},left:{...C,cursor:"w-resize",height:"100%",top:0,left:0},right:{...C,cursor:"e-resize",height:"100%",top:0,right:0},topLeft:{...C,cursor:"nw-resize",top:0,left:0},topRight:{...C,cursor:"ne-resize",top:0,right:0},bottomLeft:{...C,cursor:"sw-resize",bottom:0,left:0},bottomRight:{...C,cursor:"se-resize",bottom:0,right:0}}},[e]);return Xo.default.createElement(Xo.default.Fragment,null,!i&&Xo.default.createElement(L,{sx:u,onMouseDown:C=>c(C,"top")}),!i&&Xo.default.createElement(L,{sx:p,onMouseDown:C=>c(C,"bottom")}),Xo.default.createElement(L,{sx:m,onMouseDown:C=>c(C,"left")}),Xo.default.createElement(L,{sx:d,onMouseDown:C=>c(C,"right")}),!i&&Xo.default.createElement(L,{sx:h,onMouseDown:C=>c(C,"top-left")}),!i&&Xo.default.createElement(L,{sx:f,onMouseDown:C=>c(C,"top-right")}),!i&&Xo.default.createElement(L,{sx:_,onMouseDown:C=>c(C,"bottom-left")}),!i&&Xo.default.createElement(L,{sx:x,onMouseDown:C=>c(C,"bottom-right")}))},F9=rD;var nD=!0,iD={x:0,y:0,top:0,left:0,right:0,bottom:0,width:0,height:0},N9=o=>{let{root:e}=o,{t}=v(["common","client"]),{loading:r,askAIWithContextWindow:n,inputValue:i,contextWindowList:a,isSettingCustomVariables:s,setIsSettingCustomVariables:l,setIsEditedCustomVariables:c}=ay(),{open:u}=ju(),{mode:p,changeMode:m}=lo(),{refetch:d}=Lo(),{closeContextMenu:h,hideFloatingContextMenu:f}=Fm(),{currentFloatingContextMenuDraft:_,activeResponseMessage:x}=Vr(),{floatingDropdownMenuPin:C}=ts(),y=bt(ii),b=Hm(y),[w,I]=(0,pe.useState)(!1),E=x||r,{defaultWidth:P,defaultHeight:O,updateLayout:N}=ly(y.rootRect),V=E&&O?Math.max(O,200):0,A=E?200:142,D=(0,pe.useMemo)(()=>{let q="bottom-start",de="bottom-start";if(y.rootRect&&P){let se=["bottom","top","left","right"];if(y.miniMenuPlacement)switch(y.miniMenuPlacement){case"bottom-end":{se=["bottom","right","top","left"];break}case"top-start":{se=["top","left","bottom","right"];break}case"top-end":{se=["top","right","bottom","left"];break}}let Se=HC(y.rootRect,P,(V||A)+400,{offset:8,directions:se});Se.y>y.rootRect.top?(q="bottom-start",de="bottom-start"):Se.y<y.rootRect.top&&(q="top-start",de="top-start"),Se.x>y.rootRect.left+300?q="right-start":Se.x<y.rootRect.left-300&&(q="left-start")}return{inputPlacement:q,contextMenuPlacement:de}},[y.rootRect,y.miniMenuPlacement,P]),W=(0,pe.useRef)(null),k=(0,pe.useRef)({x:0,y:0,dragged:!1}),U=(0,pe.useRef)({dx:0,dy:0,width:0,height:0,minWidth:550,maxWidth:0,minHeight:200,maxHeight:620,resized:!1,resizeDir:"",startWidth:0,startHeight:0,startLeft:0,startRight:0,startTop:0,startBottom:0});U.current.width=P,U.current.height=V,U.current.minHeight=A,E||(U.current.height=0);let K=(0,pe.useCallback)((q,de,se)=>_l(q,de,se,{animationFrame:!0}),[]),H=(0,pe.useRef)(!1),{x:R,y:F,strategy:Y,refs:$,context:ie,update:G}=Ua({open:y.open,strategy:"fixed",onOpenChange:async(q,de,se)=>{if(!(q||!y.open||H.current||w)&&!(!q&&de?.target instanceof Element&&T2()?.contains(de.target))&&!R1("#MAX_AI_PRICING_MODAL")&&!(se!=="escape-key"&&C)&&(se==="outside-press"||se==="escape-key")){if(R1(`#${X2}`)?.getAttribute("data-status")==="open"){q2();return}if(se==="outside-press"){let To=br();if(To){let ar=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});To.dispatchEvent(ar)}}if(u||r||s&&se==="outside-press")return;if(se==="escape-key"){f(!0);return}H.current=!0,h().catch(()=>{}).finally(()=>{H.current=!1});return}},placement:D.inputPlacement,middleware:UC(k,W,U),whileElementsMounted:K}),B=em(ie),ae=tm(ie,{capture:{escapeKey:!0,outsidePress:!0},outsidePressEvent:"pointerdown"}),{getFloatingProps:X}=wl([ae,B]),oe=pe.default.useRef(!1),ue=(0,pe.useRef)(1),Z=q=>{q.preventDefault(),oe.current=!0,ue.current=Yu()},{floatingPosition:J,startResize:j,handleResize:ce,stopResize:ke}=py({x:R,y:F,refs:$,update:G,dragOffsetRef:k,floatingSizeOffsetRef:U,rootRect:y.rootRect}),{refreshChatAIModelSelector:at}=Nl();(0,pe.useEffect)(()=>{y.open?(at(),d()):(k.current={x:0,y:0,dragged:!1},U.current.dx=0,U.current.dy=0,U.current.resized=!1,U.current.resizeDir="",G(),m("list"))},[y.open,at]),(0,pe.useEffect)(()=>{let q=se=>{oe.current&&(se.preventDefault(),oe.current=!1)},de=se=>{if(!oe.current)return;let Se=se.movementX/ue.current,To=se.movementY/ue.current;k.current={x:k.current.x+Se,y:k.current.y+To,dragged:!0},W.current&&(W.current.style.marginLeft?W.current.style.marginLeft="":W.current.style.marginLeft="0.5px"),G(),se.preventDefault()};return document.addEventListener("mousemove",de),document.addEventListener("mouseup",q),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",q)}},[G,y.open]),(0,pe.useEffect)(()=>{if(y.rootRect){let q=FC(y.rootRect);if(!nD){document.querySelector("#rangeBorderBox")?.remove();let de=document.createElement("div");de.id="rangeBorderBox",Object.assign(de.style,{position:"absolute",left:q.left+"px",top:q.top+window.scrollY+"px",width:q.width+"px",height:q.height+"px",border:"1px solid green",zIndex:"9999",pointerEvents:"none"}),document.body.appendChild(de)}}},[y.rootRect]),(0,pe.useEffect)(()=>{$.setPositionReference({getBoundingClientRect(){return He(b.current.rootRect)||iD}})},[b]);let we=(0,pe.useMemo)(()=>y.open?t(x?"client:floating_menu__input__placeholder__after_ai_response":"client:floating_menu__input__placeholder"):"",[t,y.open,x]);(0,pe.useEffect)(()=>{},[P,V]),(0,pe.useEffect)(()=>{E||(U.current.dx=0,U.current.dy=0,U.current.resized=!1,U.current.resizeDir=""),G()},[E]);let{draftUserMessage:tt}=Vr(),At=Ot("floatingMenuInputMediator"),Zt=async()=>{await Fe({emitEvent:!0})&&await n()},[yt,Zo]=(0,pe.useState)(!0),zt=(0,pe.useCallback)(()=>{Zo(!1),setTimeout(()=>{Zo(!0)},50)},[]);return pe.default.createElement(Ju,{root:e},pe.default.createElement("div",{ref:$.setFloating,id:hl,"data-testid":"maxai--floating-context-menu-reference-element","data-disabled-button-clicked":!0,onKeyUp:q=>q.stopPropagation(),onKeyDown:q=>{q.key!=="Escape"&&q.stopPropagation()},style:{position:Y,zIndex:y.open?2147483601:-1,opacity:y.open?1:0,visibility:y.open?"visible":"hidden",...J,width:P,height:V},"aria-hidden":y.open?"false":"true",...X()},E?pe.default.createElement(F9,{onStart:j,onResize:ce,onStop:()=>{ke(),N(E?{width:U.current.width,height:U.current.height}:{width:U.current.width})}}):null,pe.default.createElement(i9,{customOpen:!0,defaultPlacement:D.contextMenuPlacement,needAutoUpdate:!0,hoverOpen:!1,menuList:a,isFirstLevelFlatten:!_||!!_&&i.length!==0,referenceElementOpen:y.open,referenceElementRef:W,referenceElement:pe.default.createElement(L,{ref:W,component:"div",sx:{boxSizing:"border-box",background:q=>q.palette.background.paper,borderRadius:"8px",border:q=>q.palette.mode==="dark"?"1px solid rgba(255,255,255,0.08)":"1px solid rgba(0,0,0,0.08)",boxShadow:"0px 4px 6px -2px rgba(16, 24, 40, 0.03), 0px 12px 16px -4px rgba(16, 24, 40, 0.08)",overflow:"hidden",isolation:"isolate",display:"flex",flexDirection:"column",width:"100%",padding:"10px"},onKeyDown:q=>{q.stopPropagation()}},y.open&&pe.default.createElement(pe.default.Fragment,null,r||s?null:pe.default.createElement(L,{id:"ONBOARDING_TOOLTIP__FLOATING_CONTEXT_MENU_INPUT_BOX__REFERENCE_ELEMENT",sx:{width:10,height:10,position:"absolute",left:0,bottom:"20px",pointerEvents:"none",zIndex:-1}})),pe.default.createElement(L,{sx:{position:"absolute",width:"100%",left:0,top:0,cursor:"grab",height:"28px"},onMouseDown:Z}),s?pe.default.createElement(L,{sx:{flex:1}}):y.open&&pe.default.createElement(pe.default.Fragment,null,pe.default.createElement(B9,{loading:r}),pe.default.createElement(_9,{contextMenuDefaultHeight:V})),y.open&&pe.default.createElement(pe.default.Fragment,null,pe.default.createElement(x9,{showModelSelector:y.showModelSelector,showUsageButton:!0,loading:r})),pe.default.createElement(H9,null),y.open&&pe.default.createElement(zd,{showCloseButton:!1,onInputCustomVariable:({data:q,variables:de})=>{let se=de?.some(Se=>Se.name?!1:q[Se.name]);c(Se=>Se||!!se)},onBeforeRunShortcuts:()=>l(!1),onClose:q=>{l(!1)},onShow:()=>{l(!0)},modelKey:"FloatingContextMenu",autoFocusAfterBlur:!0}),(!s||r)&&pe.default.createElement(g,{width:"100%",gap:.5,sx:{marginTop:"8px"}},pe.default.createElement(g,{direction:"row",justifyContent:"flex-end",alignItems:"end",gap:1},pe.default.createElement(g,{direction:"row",width:0,flex:1,alignItems:"center",spacing:1,justifyContent:"left",marginBottom:"4px",sx:{display:w?"none":"flex"}},r?pe.default.createElement(pe.default.Fragment,null,pe.default.createElement(T,{fontSize:"16px",color:q=>q.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)"},t(tt?"client:floating_menu__input__running_placeholder":"client:floating_menu__input__reading_placeholder")),pe.default.createElement(Jt,{size:"16px",sx:{color:q=>q.palette.mode==="dark"?"rgba(255, 255, 255, 0.38)":"rgba(0, 0, 0, 0.38)"}})):pe.default.createElement(pe.default.Fragment,null,pe.default.createElement(o9,{minLine:1,maxHeight:U.current.height?U.current.height/2:void 0,stopPropagation:!0,autoFocus:y.open,onKeydownCapture:q=>y.open&&a.length?!1:q.key==="ArrowUp"||q.key==="ArrowDown"?(q.stopPropagation(),!0):!1,placeholder:we,InputId:Ci,sx:{border:"none","& > div":{"& > div":{p:0},"& > textarea":{p:0},"& > .max-ai-user-input__expand":{"&:has(> div)":{pr:1}}},borderRadius:0,minHeight:s?0:"24px",height:s?"0!important":"unset",visibility:s?"hidden":"visible"},onEnter:async()=>{a.length>0&&p==="list"||(m("list"),await Zt())},onControlledValueChange:(q,de)=>{de===Ci&&q.length<1&&At.resetInputValue()}})),pe.default.createElement(qg,null)),!r&&pe.default.createElement(pe.default.Fragment,null,!w&&pe.default.createElement(pe.default.Fragment,null,y.open&&pe.default.createElement(Kg,null),pe.default.createElement(Wg,null)),pe.default.createElement(ls,{value:{isVoiceInput:w,setIsVoiceInput:I,isUseInternalState:!1}},pe.default.createElement(pp,{inputMediator:At,onClick:Zt,onSpeechToTextSuccess:q=>{At.updateInputValue(At.getInputValue()+q)},tooltipProps:{placement:"bottom"},disabled:i.length===0})))))),root:e})),a.length>0&&pe.default.createElement(v9,{showStateTrigger:y.open&&a.length>0,onClose:()=>{zt()}}),pe.default.createElement(b9,{showStateTrigger:y.open&&a.length>0&&a.some(q=>q.prompt_id===Rl.REPLACE_SELECTION)}),!r&&!s?pe.default.createElement(pe.default.Fragment,null,pe.default.createElement(y9,{showStateTrigger:y.open&&!x&&!s&&a.length>0&&a.some(q=>q.prompt_id==="30f27496-1faf-4a00-87cf-b53926d35bfd")&&(_===""||i.length>0)&&yt})):null,r?null:pe.default.createElement(pe.default.Fragment,null,pe.default.createElement(C9,{showStateTrigger:y.open&&!!x&&x.type==="ai"})))};var Qg=S(M());var Yo=S(M());var V9=S(M()),aD=o=>{let{sx:e,...t}=o;return V9.default.createElement(le,{sx:Fx({transition:"all 0.15s",height:"32px",padding:"0px",minWidth:"initial",color:r=>r.palette.mode==="dark"?"#fff":"rgba(0, 0, 0, 0.6)","&:hover":{backgroundColor:r=>r.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.06)",color:r=>r.palette.mode==="dark"?"#fff":"rgba(0, 0, 0, 0.87)"}},e),...t},o.children)},Ps=aD;var hi=S(M());var Zg=S(M());var sD=o=>{let{sx:e,...t}=o,{t:r}=v(["client","common"]),{hideMenu:n}=Kl(),{updateAppSettings:i}=cy(),a=c=>{c.stopPropagation(),Va({key:"options",query:"?id=floating-image-mini-menu#/appearance"})},s=async c=>{c.stopPropagation();let u=await $p.getAppSettings();await $p.setAppSettings({floatingImageMiniMenu:{visibility:{...u.floatingImageMiniMenu.visibility,blacklist:[...u.floatingImageMiniMenu.visibility.blacklist,Wa()]}}}),i(),n()},l=async c=>{c.stopPropagation();let u=await $p.getAppSettings();await $p.setAppSettings({floatingImageMiniMenu:{visibility:{...u.floatingImageMiniMenu.visibility,isWhitelistMode:!0}}}),i(),n()};return Zg.default.createElement(L,{sx:{marginLeft:"0px!important",color:"#fff",position:"absolute",top:"calc(100% - 6px)",left:"0px",...e},...t},Zg.default.createElement(Rm,{sx:{marginTop:"10px"},hideThisSiteItemDataButtonClickedName:"max_ai__floating_image_menu__hide_menu__this_site",hideThisSiteItemText:r("client:floating_menu__mini_menu__image__close_item__hide_on_this_site"),hideThisSiteConfirmCardTitle:r("client:floating_menu__mini_menu__image__confirm_card__hide_this_site__title"),hideThisSiteConfirmCardOkText:r("client:floating_menu__mini_menu__image__close_item__hide_on_this_site"),hideThisSiteConfirmCardCancelText:r("common:cancel"),onHideThisSiteConfirmCardClickOk:s,onHideThisSiteConfirmCardClickCancel:()=>{},hideAllSitesItemDataButtonClickedName:"max_ai__floating_image_menu__hide_menu__all_sites",hideAllSitesItemText:r("client:floating_menu__mini_menu__image__close_item__hide_always"),hideAllSitesConfirmCardTitle:r("client:floating_menu__mini_menu__image__confirm_card__hide_all_sites__title"),hideAllSitesConfirmCardOkText:r("client:floating_menu__mini_menu__image__close_item__hide_always"),hideAllSitesConfirmCardCancelText:r("common:cancel"),onHideAllSitesConfirmCardClickOk:l,onHideAllSitesConfirmCardClickCancel:()=>{},openSettingsItemTextI18nKey:"client:floating_menu__mini_menu__image__close_item__settings_tips",onClickSettings:a}))},R9=sD;var lD=()=>{let{floatingImageMiniMenuKey:o}=(0,hi.useContext)(Ja),{t:e}=v(["client"]),{hideMenu:t}=Kl(),r=n=>{n.stopPropagation(),Dm(o).disable=!0,t()};return hi.default.createElement(g,{sx:{flexDirection:"row",alignItems:"center","&:hover":{".maxai_close_button":{borderRadius:"6px"},".maxai_more_close_options":{margin:"0px",opacity:"1"}}}},hi.default.createElement(me,{placement:"top",title:e("client:floating_menu__mini_menu__image__close_item__hide_until_next_visit")},hi.default.createElement("span",null,hi.default.createElement(Ps,{onClick:r,className:"maxai_close_button",sx:{width:"32px",fontSize:"16px",borderRadius:"4px 16px 16px 4px",backgroundColor:n=>n.palette.mode==="dark"?"transparent":"#fff",zIndex:"1"}},hi.default.createElement(z,{size:18,icon:"Close"})))),hi.default.createElement(Ps,{className:"maxai_more_close_options",sx:{marginLeft:"-32px",opacity:"0",width:"32px",fontSize:"16px",borderRadius:"4px 16px 16px 4px",backgroundColor:n=>n.palette.mode==="dark"?"transparent":"#fff","&:hover":{".maxai__floating_image_menu__close_menu":{transform:"scale(1)"}}},disableRipple:!0},hi.default.createElement(z,{icon:"Power"}),hi.default.createElement(R9,{className:"maxai__floating_image_menu__close_menu",sx:{zIndex:"1",transform:"scale(0)",transformOrigin:"left top"}})))},z9=lD;var pD=Yo.default.forwardRef(function({sx:e,className:t},r){let{t:n}=v(["client"]);return Yo.default.createElement(L,{sx:{overflow:"hidden",transition:"width 0.2s",marginLeft:"0px!important",...e||{}},ref:r,className:t},Yo.default.createElement(L,{sx:{height:"100%",fontSize:"12px",fontWeight:"initial",color:i=>i.palette.mode==="dark"?"#fff":"rgba(0, 0, 0, 0.87)",lineHeight:"16px",overflow:"hidden",marginLeft:"0px!important",whiteSpace:"nowrap"}},n("client:floating_menu__mini_menu__image__menu_item__chat_with_image")))}),s1=o=>{let{filterImage:e,dataTestId:t}=o,{floatingImageMiniMenuKey:r}=(0,Yo.useContext)(Ja),n=bt(Bm(r)),{showMenu:i,hideMenu:a}=Kl(),s=(0,Yo.useRef)(null),l=Dm(r),{hover:c,onMouseEnter:u,onMouseLeave:p}=Nm(100);uy({filterImage:e}),(0,Yo.useEffect)(()=>{c?(s.current&&clearTimeout(s.current),l.mouseInMenu=!0,i()):(l.mouseInMenu=!1,s.current=setTimeout(()=>{l.mouseInImage||a()},50))},[c]);let m=async()=>{a(),es()||na(),sm("ContextMenuChatWithImage",{image:l.currentHoverImage,imageSrc:l.currentHoverImageSrc})};return Yo.default.createElement(g,{className:"MAX_AI_FLOATING_IMAGE_MINI_MENU","data-testid":t,onMouseEnter:u,onMouseLeave:p,alignItems:"center",justifyContent:"center",sx:{boxSizing:"border-box",zIndex:2147483601,display:n.show?"flex":"none",cursor:"pointer",position:"fixed",top:`calc(${n.position.top} + 15px)`,left:`calc(${n.position.left} + 15px)`,...c&&{".max_ai_floating_image_dot_button":{opacity:"0",transform:"scale(5)"},".max_ai_floating_image_text_button":{opacity:"1",transform:"scale(1)"}}}},Yo.default.createElement(g,{sx:{transition:"all 0.15s",justifyContent:"center",alignItems:"center",width:"16px",height:"16px",boxSizing:"border-box"}},Yo.default.createElement(L,{className:"max_ai_floating_image_dot_button",sx:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"rgba(144, 101, 176, 1)",border:"1px solid rgba(255, 255, 255, 0.08)",boxSizing:"border-box"}})),Yo.default.createElement(g,{direction:"row",className:"max_ai_floating_image_text_button",sx:{opacity:"0",transform:"scale(0)",transformOrigin:"15px 15px",transition:"all 0.15s",position:"absolute",top:"0px",left:"0px",boxSizing:"border-box",alignItems:"center",padding:"2px",height:"36px",borderRadius:"18px",bgcolor:d=>d.palette.mode==="dark"?"rgba(44,44,44,0.95)":"#fff",backdropFilter:"blur(4px)",margin:"-8px",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.12), 0px 0px 1px 0px rgba(0, 0, 0, 0.08)"}},Yo.default.createElement(Ps,{onClick:()=>m(),sx:{borderRadius:"16px 4px 4px 16px",padding:"0px 8px",[`.${ea.startIcon}`]:{margin:"0px",marginRight:"8px"}},startIcon:Yo.default.createElement(oa,{sx:{boxSizing:"border-box",fontSize:"16px!important"}})},Yo.default.createElement(pD,null)),Yo.default.createElement(It,{orientation:"vertical",sx:{height:"18px",mx:"4px"}}),Yo.default.createElement(z9,null)))};var uD=()=>Qg.default.createElement(Ja.Provider,{value:{floatingImageMiniMenuKey:"ALL_IMAGE"}},Qg.default.createElement(s1,{filterImage:o=>Gl.commonFirstEnterImage!==o})),U9=uD;var $i=S(M());var Ia=S(M());var nu={sceneType:"FLOATING_IMAGE_MENU_BUTTON",id:"ONBOARDING_TOOLTIP__FLOATING_IMAGE_MENU_BUTTON",anchorElementSelectors:'[data-testid="maxai__floating_image_mini_menu__first_enter_image"]',CtaButtonClickedName:"Onboarding > ChatWithImage > Got it"},mD=o=>{let{showStateTrigger:e,onClosed:t,onOpened:r,...n}=o,{t:i}=v(),[a,s]=(0,Ia.useState)(!1);return(0,Ia.useEffect)(()=>{e?dn(nu.sceneType).then(l=>{l||Hn(nu.sceneType).then(()=>{s(!0),r?.()})}):s(!1)},[r,e]),Ia.default.createElement(Bt,{hideBackdrop:!0,sx:{visibility:"hidden"},placement:"bottom-start",fallbackPlacements:["top-start"],trigger:a,anchorElementSelectors:nu.anchorElementSelectors,CtaButtonProps:{"data-button-clicked-name":nu.CtaButtonClickedName},id:nu.id,footerLeft:Ia.default.createElement(zm,null),onClose:t,...n},Ia.default.createElement(g,{spacing:.5},Ia.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},i("onboarding:onboarding_tooltip__FLOATING_IMAGE_MENU_BUTTON__text"))))},W9=mD;var dD=()=>{let[o,e]=(0,$i.useState)(!1),t=bt(Bm("ON_BOARDING"));(0,$i.useEffect)(()=>{t.show&&e(!0)},[t.show]);let r=()=>{Gl.onboardingTooltipShowing=!1},n=()=>{Gl.onboardingTooltipShowing=!0};return $i.default.createElement($i.default.Fragment,null,$i.default.createElement(Ja.Provider,{value:{floatingImageMiniMenuKey:"ON_BOARDING"}},$i.default.createElement(s1,{dataTestId:"maxai__floating_image_mini_menu__first_enter_image",filterImage:i=>Gl.commonFirstEnterImage===i})),t.show&&$i.default.createElement(W9,{showStateTrigger:o,onClosed:r,onOpened:n}))},G9=dD;var xt=S(M());var qi=S(M());var iu={sceneType:"CONTEXT_MENU_CTA_MINI_ICON_BUTTON",id:"ONBOARDING_TOOLTIP__CONTEXT_MENU_CTA_MINI_ICON_BUTTON",anchorElementSelectors:"#max_ai__floating_context_menu__mini_hide_button",CtaButtonClickedName:"Onboarding > ContextMenu > MiniIconButton > Got it"},fD=o=>{let{showStateTrigger:e,...t}=o,{t:r}=v(),{chatBoxShortCutKey:n}=rc(),[i,a]=(0,qi.useState)(!1);(0,qi.useEffect)(()=>{e?dn(iu.sceneType).then(l=>{l||Hn(iu.sceneType).then(()=>{a(!0)})}):a(!1)},[e]);let s={bgcolor:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.16) !important":"rgba(0, 0, 0, 0.08) !important",color:l=>l.palette.mode==="dark"?"rgba(255, 255, 255, 0.7) !important":"rgba(0, 0, 0, 0.7) !important"};return qi.default.createElement(Bt,{hideBackdrop:!0,sx:{visibility:"hidden"},placement:"bottom-start",fallbackPlacements:["top-start"],trigger:i,anchorElementSelectors:iu.anchorElementSelectors,CtaButtonProps:{"data-button-clicked-name":iu.CtaButtonClickedName},id:iu.id,footerLeft:qi.default.createElement(zm,null),...t},qi.default.createElement(g,{spacing:.5},qi.default.createElement(T,{fontSize:14,lineHeight:1.4,color:"text.primary",fontWeight:400,textAlign:"left"},r("client:floating_menu__button__cta__tooltip")),n&&qi.default.createElement(Ba,{sx:s},n)))},K9=fD;var hD={"top-start":[-3,0],"top-end":[-3,0],"bottom-start":[-3,0],"bottom-end":[-3,0]},j9=o=>hD[o]||[0,0];var Sa=S(M());var Jg=S(M()),gD=({showDivider:o=!0,boxSx:e,dividerProps:t})=>{let{orientation:r="vertical"}=t||{};return o?Jg.default.createElement(g,{flex:1,sx:{p:"7px 4px",...e}},Jg.default.createElement(It,{orientation:r,...t})):null},au=gD;var xD=o=>{let{placement:e,onClick:t,btnGroupSx:r}=o,{t:n}=v(["common","client","prompt"]),{contextMenuPath:i}=lo(),{contextMenuSuggestions:a}=Qa(i||"",3),s=a.sort((l,c)=>+!!c.prompt_icon-+!!l.prompt_icon);return Sa.default.createElement(Sa.default.Fragment,null,Sa.default.createElement(g,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box","data-button-clicked-name":"max_ai__floating_context_menu__favorite_menu_group",sx:r},s?.map(l=>{let c=l.prompt_title,u=l.prompt_id.replace(sr,""),p=`prompt:${u}`;n(p)!==u&&(c=n(p));let m=String(c[0]||"").toUpperCase();return Sa.default.createElement(ql,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom"},title:c,key:l.prompt_id,sx:{minWidth:"unset",p:l.prompt_icon?"8px!important":"6px!important"},onMouseUp:d=>{d.stopPropagation(),d.preventDefault()},onMouseDown:d=>{d.stopPropagation(),d.preventDefault()},onClick:async d=>{d.stopPropagation(),d.preventDefault(),await Fe({emitEvent:!0})&&t?.(l)}},l.prompt_icon?Sa.default.createElement(z,{icon:l.prompt_icon,sx:{fontSize:"18px",color:"primary.main"}}):Sa.default.createElement(g,{className:"max-ai__click-menu-button--box__text-icon",alignItems:"center",justifyContent:"center",sx:{width:"16px",height:"16px",boxSizing:"border-box",borderRadius:"4px",bgcolor:d=>d.palette.mode==="dark"?"#4f4f4f":"#F5F6F7",color:d=>d.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}},Sa.default.createElement(T,{component:"span",fontSize:"13px",color:"inherit"},m)))})),s?.length>0&&Sa.default.createElement(au,null))},$9=xD;var va=S(M());var e0=S(M());var _D=o=>{let{parentX:e,parentY:t,sx:r,...n}=o,{t:i}=v(["common","client"]),{hideRangy:a}=ia(),{updateButtonSettingsWithDomain:s,toggleButtonSettings:l}=km(),c=d=>{d.stopPropagation(),Va({key:"options",query:"#/mini-menu"})},u=async()=>{await s("textSelectPopupButton")},p=async()=>{await l("textSelectPopupButton",!1)},m=e&&t&&e+DC+240>window.innerWidth;return e0.default.createElement(L,{sx:{marginLeft:"0px!important",color:"#fff",position:"absolute",top:"calc(100% - 6px)",left:m?"auto":0,right:m?0:"auto",zIndex:2147483611,...r},...n},e0.default.createElement(Rm,{sx:{marginTop:"10px"},hideThisSiteItemDataButtonClickedName:"max_ai__floating_context_menu__hide_menu__this_site",hideThisSiteItemText:i("client:floating_menu__button__hide_menu__this_site"),hideThisSiteConfirmCardTitle:i("client:floating_menu__button__hide_menu__this_site__tooltip__title"),hideThisSiteConfirmCardOkText:i("client:floating_menu__button__hide_menu__this_site__tooltip__confirm"),hideThisSiteConfirmCardCancelText:i("common:cancel"),onHideThisSiteConfirmCardClickOk:u,onHideThisSiteConfirmCardClickCancel:()=>a(),hideAllSitesItemDataButtonClickedName:"max_ai__floating_context_menu__hide_menu__all_sites",hideAllSitesItemText:i("client:floating_menu__button__hide_menu__all_sites"),hideAllSitesConfirmCardTitle:i("client:floating_menu__button__hide_menu__all_sites__tooltip__title"),hideAllSitesConfirmCardOkText:i("client:floating_menu__button__hide_menu__all_sites__tooltip__confirm"),hideAllSitesConfirmCardCancelText:i("common:cancel"),onHideAllSitesConfirmCardClickOk:p,onHideAllSitesConfirmCardClickCancel:()=>a(),openSettingsItemTextI18nKey:"client:floating_menu__button__menu_settings",onClickSettings:c}))},q9=_D;var CD=({parentX:o,parentY:e})=>{let{t}=v(["client"]),r=Qt(Lm),n=Qt(ii),i=async()=>{n({open:!1,rootRect:null,showModelSelector:!1,miniMenuPlacement:null}),r(a=>({...a,closeBeforeRefresh:!0}))};return va.default.createElement(g,{component:"div",sx:{flexDirection:"row",alignItems:"center","&:hover":{".maxai_close_button":{borderRadius:"6px"},".maxai_more_close_options":{margin:"0px",opacity:"1"}}}},va.default.createElement(me,{placement:"top",title:t("client:floating_menu__button__hide_menu__until_next_visit")},va.default.createElement("span",null,va.default.createElement(Ps,{onClick:i,className:"maxai_close_button",sx:{width:"32px",fontSize:"16px",borderRadius:"4px 16px 16px 4px",backgroundColor:a=>a.palette.mode==="dark"?"transparent":"#fff",zIndex:"1"}},va.default.createElement(z,{size:18,icon:"Close"})))),va.default.createElement(Ps,{className:"maxai_more_close_options",sx:{marginLeft:"-32px",opacity:"0",width:"32px",fontSize:"16px",borderRadius:"4px 16px 16px 4px",backgroundColor:a=>a.palette.mode==="dark"?"transparent":"#fff","&:hover":{".maxai__floating_mini_menu__close_menu":{transform:"scale(1)"}}},disableRipple:!0},va.default.createElement(z,{icon:"Power"}),va.default.createElement(q9,{parentX:o,parentY:e,className:"maxai__floating_mini_menu__close_menu",sx:{transform:"scale(0)",transformOrigin:"left top"}})))},X9=CD;var l1=S(M());var yD=o=>{let{placement:e,TooltipProps:t,selectionText:r,btnGroupSx:n}=o,{t:i}=v(["common","client"]),{hideRangy:a}=ia();return l1.default.createElement(g,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:n},l1.default.createElement(ql,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom",...t},id:"max_ai__floating_context_menu__ai_search_button",title:i("client:floating_menu__mini_menu__ai_search__button__tooltip"),sx:{minWidth:"unset",p:"8px!important"},onMouseUp:s=>{s.stopPropagation(),s.preventDefault()},onMouseDown:s=>{s.stopPropagation(),s.preventDefault()},onClick:async s=>{if(s.stopPropagation(),s.preventDefault(),!await Fe({emitEvent:!0}))return;let l=window.getSelection()?.toString();a(),na();for(let c=0;c<30&&(await h0(200),!es());c++);(l||r)&&sm("ContextMenuQuickSearchSelectedText",{question:l||r})}},l1.default.createElement(z,{icon:"Search",sx:{fontSize:"18px",color:s=>s.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}})))},Y9=yD;var t0={div:{display:"flex"},position:"relative",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"transparent","&:hover":{"&:has(button)&::after":{display:"none"}},"& button":{minWidth:"unset",padding:"7px 8px!important",boxSizing:"border-box",borderRadius:"6px","&:hover":{bgcolor:o=>o.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.06)"},"&:has(.max-ai__click-menu-button--box__text-icon)":{height:"32px",width:"34px"}}},bD=()=>{let{t:o}=v(["common","client"]),{tempSelection:e,lastMousePosition:t,show:r,hideRangy:n}=ia(),{chatBoxShortCutKey:i}=rc(),{buttonSettings:a}=km(),s=(0,xt.useMemo)(()=>a?.textSelectPopupButton.visibility?Zx(a.textSelectPopupButton.visibility):!0,[a?.textSelectPopupButton.visibility]),l=Qt(ry),{conversationId:c}=Tt(),u=ge(c),p=Qt(Om),{closeBeforeRefresh:m}=bt(Lm),{showFloatingContextMenu:d}=ts(),[h,f]=En(ii),_=(0,xt.useMemo)(()=>r&&s&&!m&&!h.open,[r,s,m,h.open]),{hover:x,onMouseEnter:C,onMouseLeave:y}=Nm(100);(0,xt.useEffect)(()=>{y()},[s,y]),(0,xt.useEffect)(()=>{_||y()},[_,y]);let{scrollState:b,inParentScrollView:w}=g2(e?.activeElement??null,e,-1),I=B=>({name:"miniMiniMiddleware",fn:ae=>{let{rects:X}=ae,oe=X.reference,Z=[{placement:"top-start",x:oe.x,y:oe.y},{placement:"top-end",x:oe.x+oe.width,y:oe.y},{placement:"bottom-start",x:oe.x,y:oe.y+oe.height},{placement:"bottom-end",x:oe.x+oe.width,y:oe.y+oe.height}].filter(({x:zt,y:q})=>!(zt>window.innerWidth+window.scrollX||zt<0||q>window.innerHeight+window.scrollY||q<0)).map(zt=>({...zt,distance:Math.pow(zt.x-B.x,2)+Math.pow(zt.y-B.y,2)})),J=Nx(Z,zt=>zt.distance);if(!J)return{x:oe.x-vr,y:oe.y+oe.height};let{placement:j,x:ce,y:ke}=J,at=ce-vr<0,we=ce+vr>window.innerWidth+window.scrollX,tt=ke-vr<0,At=ke+vr>window.innerHeight+window.scrollY,Zt=()=>{let zt={"top-start":{x:at?ce+12:ce-vr*.5,y:tt?ke+12:ke-vr*.5},"top-end":{x:we?ce-vr:ce,y:tt?ke+12:ke-vr*.5},"bottom-start":{x:at?ce+12:ce-vr*.5,y:At?ke-vr:ke},"bottom-end":{x:we?ce-vr:ce,y:At?ke-vr:ke}};return zt[j]||zt["bottom-start"]},{x:yt,y:Zo}=Zt();return{x:yt,y:Zo,reset:{placement:j}}}}),{x:E,y:P,strategy:O,refs:N,placement:V}=Ua({placement:"bottom-start",middleware:t?[I(t)]:[]});(0,xt.useEffect)(()=>{_&&f(B=>({...B,miniMenuPlacement:V}))},[V,_]);let A=(0,xt.useRef)(null);(0,xt.useEffect)(()=>{if(!e?.selectionRect||!_){A.current?.remove(),A.current=null;return}let B=NC(e.selectionRect);ta||(A.current||(A.current=document.createElement("div"),A.current.style.position="absolute",A.current.style.zIndex="9999",A.current.style.pointerEvents="none",document.body.appendChild(A.current)),A.current.style.display=w?"block":"none",A.current.style.left=B.left+b.x+"px",A.current.style.top=B.top+window.scrollY+b.y+"px",A.current.style.width=B.width+"px",A.current.style.height=B.height+"px",A.current.style.border="2px solid red",A.current.style.zIndex="9999",A.current.style.pointerEvents="none"),N.setPositionReference({getBoundingClientRect(){return{...B,x:B.left,y:B.top}}})},[_,e,b,w]);let D=()=>{if(N.floating.current){if(getComputedStyle(N.floating.current).opacity==="0")return;n(),sy()}};(0,xt.useEffect)(()=>{let B=ae=>{ae.key==="Escape"&&D()};return document.addEventListener("keydown",B,!0),()=>{document.removeEventListener("keydown",B,!0)}},[]),(0,xt.useEffect)(()=>{u&&setTimeout(()=>{D()},1e3)},[u]),(0,xt.useEffect)(()=>{let B=()=>{y()};return window.addEventListener("blur",B),window.removeEventListener("blur",B)},[]);let W=B=>({popper:{modifiers:[{name:"offset",options:{offset:({placement:X})=>j9(X)}},{name:"flip",enabled:!0,options:{fallbackPlacements:B?["top","bottom-start","bottom"]:["top","bottom","bottom-start"]}}]}}),{contextMenuPath:k}=lo(),{contextMenuSuggestions:U}=Qa(k||"",3),K=4*vr+2*Q1,H=K+U.length*vr+Q1,R=E+K>window.innerWidth+window.scrollX,F=E+H>window.innerWidth+window.scrollX,Y=(0,xt.useRef)(null),$=E+b.x,ie=P+b.y,{open:G}=ju();return xt.default.createElement(L,{component:"div",ref:B=>{Y.current=B,N.setFloating(B)},className:`max-ai__click-context-menu ${_?"open":"close"}`,sx:{zIndex:_?2147483600:-1,position:O,top:ie||0,left:$||0,cursor:"pointer"}},xt.default.createElement(L,{onMouseEnter:C,onMouseLeave:()=>{G||y()},sx:{position:"relative",overflow:"visible","&:hover":{".mini-icon-button":{visibility:"hidden",userSelect:"none",zIndex:-1}}}},_&&x&&xt.default.createElement(g,{className:"max_ai_floating_mini_menu_content",direction:"row",alignItems:"center",sx:{display:"flex",transformOrigin:"15px 15px",borderRadius:"18px",position:"absolute",left:0,top:0,margin:"-8px",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.12), 0px 0px 1px 0px rgba(0, 0, 0, 0.08)",bgcolor:B=>B.palette.mode==="dark"?"rgba(44,44,44,0.95)":"#fff",backdropFilter:"blur(4px)",alignItems:"stretch",p:"2px"}},xt.default.createElement(L,{component:"div",sx:{...t0,"&:first-of-type":{"& button":{borderRadius:R?"16px":"16px 4px 4px 16px"}}}},xt.default.createElement(ql,{TooltipProps:{floatingMenuTooltip:!0,placement:"top-start",description:i,sx:{maxWidth:340},slotProps:W(!0)},title:o("client:floating_menu__button__cta__tooltip"),className:"usechatgpt-ai__context-menu--handle-button",id:"max_ai__floating_context_menu__cta_button","data-testid":"max_ai__floating_context_menu__cta_button",size:"small",variant:"text",onMouseUp:B=>{B.stopPropagation(),B.preventDefault()},onMouseDown:B=>{B.stopPropagation(),B.preventDefault()},onClick:B=>{B.stopPropagation(),B.preventDefault();let ae=window.getSelection()?.rangeCount;if(ae&&ae>0){let X=window.getSelection()?.getRangeAt(0)?.cloneRange();p({range:X||null,selectionText:window?.getSelection()?.toString()||""})}e&&d()}},xt.default.createElement(oa,{sx:{fontSize:"18px"}}))),!R&&xt.default.createElement(xt.default.Fragment,null,xt.default.createElement(au,null),!F&&xt.default.createElement($9,{btnGroupSx:t0,placement:"top",onClick:B=>{l(ae=>({...ae,selectedContextMenuId:B.prompt_id})),e&&d({openAutoExecute:!0})}}),xt.default.createElement(Y9,{btnGroupSx:t0,placement:"top",selectionText:e?.selectionText,TooltipProps:{slotProps:W(!1)}}),xt.default.createElement(au,null),xt.default.createElement(X9,{parentX:E??0,parentY:P??0}))),xt.default.createElement(g,{className:"mini-icon-button",sx:{top:2,left:2,position:"absolute",width:"16px",height:"16px",visibility:x?"hidden":"inherit",opacity:_&&w?1:0,transition:_?"opacity .25s":"none"},alignItems:"center",justifyContent:"center",id:"max_ai__floating_context_menu__mini_hide_button"},xt.default.createElement(L,{sx:{borderRadius:"50%",height:"8px",width:"8px",backgroundColor:"rgba(144, 101, 176, 1)"}}))),xt.default.createElement(K9,{showStateTrigger:_}))},Z9=bD;var Xi=S(M()),e7=S(Vp());var p1=S(M()),o0=(0,p1.createContext)({caret:null,selection:null,focus:!1}),Q9=()=>(0,p1.useContext)(o0);var gr=S(M());var c1=class{constructor(){this._events=new Map}on(e,t){this._events.has(e)||this._events.set(e,[]),this._events.get(e).push(t)}off(e,t){let r=this._events.get(e);r&&r.length&&this._events.set(e,r.filter(n=>n!==t))}emit(e,...t){let r=this._events.get(e);r&&r.length&&r.forEach(n=>{n(...t)})}addListener(e,t){this.on(e,t)}removeListener(e,t){this.off(e,t)}removeAllListeners(e){e?this._events.delete(e):this._events.clear()}};var Zn=new $u("ContextMenu/GoogleDocHelper");var u1=class extends c1{constructor(){super();this.disabled=!1;this.editable=!0;this.initialized=!1;this.lastCaret=null;this.lastSelection=null;this.observer=null;this.debounceCaretOrSelectionChange=Dr(()=>{this.checkCaretChange(),this.checkSelectionChange()},20);this._onScroll=t=>{Zn.info("onScroll"),this.emit("scroll",t)};this._onMouseUp=t=>{Zn.info("onMouseUp"),t.MAX_AI_IGNORE=!0,this.emit("mouseup",t)};this.onKeyUp=t=>{Zn.info("onKeyUp"),t.MAX_AI_IGNORE=!0,this.emit("keyup",t)};this._onFocus=t=>{Zn.info("onFocus"),this.emit("focus",t)};this._onBlur=t=>{Zn.info("onBlur"),this.emit("blur",t)};this.disabled=!location.href.startsWith("https://docs.google.com/document"),this.editable=!!document.querySelector("#docs-insert-menu")}init(){this.disabled||this.initialized||(this.initElement(),this.initListener())}initElement(){this.editorElement=document.querySelector("div.kix-appview-editor"),this.scrollElement=document.querySelector("div.kix-scrollareadocumentplugin"),this.iframeElement=document.querySelector("iframe.docs-texteventtarget-iframe"),this.inputElement=this.iframeElement?.contentDocument?.querySelector('div[contenteditable="true"]'),this.caretElement=document.querySelector("#kix-current-user-cursor-caret")}initListener(){let t=document.querySelector("div.kix-cursor");this.observer=new MutationObserver(r=>{r.some(n=>n.target.classList?.contains("kix-cursor"))&&(Zn.info("\u5149\u6807\u79FB\u52A8"),this.debounceCaretOrSelectionChange())}),t&&this.observer.observe(t,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1}),this.editorElement?.addEventListener("scroll",this._onScroll),this.editorElement?.addEventListener("mouseup",this._onMouseUp),this.inputElement?.addEventListener("keyup",this.onKeyUp),this.inputElement?.addEventListener("focus",this._onFocus),this.inputElement?.addEventListener("blur",this._onBlur)}destroy(){this.initialized=!1,this.observer?.disconnect(),this.editorElement?.addEventListener("scroll",this._onScroll),this.editorElement?.removeEventListener("mouseup",this._onMouseUp),this.inputElement?.removeEventListener("keyup",this.onKeyUp),this.inputElement?.removeEventListener("focus",this._onFocus),this.inputElement?.removeEventListener("blur",this._onBlur),this.removeAllListeners()}isSelectionChange(t,r){return!(t===r||t&&r&&t.layouts.length===r.layouts.length&&t.layouts.every((n,i)=>!J1(n,r.layouts[i])))}isCaretChange(t,r){if(t===r)return!1;if(!(t&&r&&!J1(t.layout,r.layout)))return!0}isFocus(){return document.activeElement===this.iframeElement}checkSelectionChange(){let t=this.getCurrentSelection();this.isSelectionChange(t,this.lastSelection)&&(this.lastSelection=t,this.emit("selection-change",this.lastSelection))}checkCaretChange(){let t=this.getCurrentCaret();this.isCaretChange(t,this.lastCaret)&&(this.lastCaret=t,this.emit("caret-change",this.lastCaret))}calculateRelativeLayout(t){return this.scrollElement?zC(this.scrollElement?.getBoundingClientRect(),t):VC}replaceSelection(t){Zn.info(t);let r=new DataTransfer;r.setData("text/plain",t),this.inputElement?.focus(),this.inputElement?.dispatchEvent(new ClipboardEvent("paste",{clipboardData:r,bubbles:!0,cancelable:!0}))}insertBelowSelection(t){if(Zn.info(t),this.inputElement?.focus(),this.lastSelection){let r={code:"ArrowRight",key:"ArrowRight",keyCode:39,bubbles:!0,repeat:!1};this.inputElement?.dispatchEvent(new KeyboardEvent("keydown",r))}this.replaceSelection(`
${t}`)}insertAboveSelection(t){if(Zn.info(t),this.inputElement?.focus(),this.lastSelection){let r={charCode:0,code:"ArrowLeft",key:"ArrowLeft",keyCode:37,bubbles:!0,repeat:!1};this.inputElement?.dispatchEvent(new KeyboardEvent("keydown",r))}this.replaceSelection(`${t}
`)}copySelection(t=!1){Zn.info(t),this.inputElement?.focus(),t?this.iframeElement?.contentDocument?.execCommand("copy"):this.inputElement?.dispatchEvent(new ClipboardEvent("copy",{bubbles:!0,cancelable:!0}));let r=this.inputElement?.innerText||"";return r.endsWith(`
`)?r.slice(0,-1):r}selectContent(t){if(!this.editorElement||!this.inputElement)return;let r=t<0?"ArrowLeft":"ArrowRight",n=t<0?37:39;this.inputElement.focus();for(let i=0;i<Math.abs(t);i++)this.inputElement.dispatchEvent(new KeyboardEvent("keydown",{charCode:0,code:r,key:r,keyCode:n,bubbles:!0,repeat:!1,shiftKey:!0}))}getCaretBeforeContent(t){if(!this.editorElement||!this.inputElement)return"";let r=t.rect.left+t.rect.width/2,n=t.rect.top+t.rect.height/2,i="";return this.getParagraphElements().sort((a,s)=>a.getBoundingClientRect().bottom-s.getBoundingClientRect().bottom).some(a=>{let s="",l=null;return this.getTextElements(a).some(c=>{let u=this.parseTextElement(c);if(u.rect.bottom<n||u.rect.top<n&&u.rect.right<r)l&&u.rect.top>=l.rect.bottom?s+=`
${u.content}`:s+=u.content,l=u;else if(oc(r,n,[u.rect])){let p=this.getCaretOffset(u,t.rect);if(p>0){let m=u.content.slice(0,p);s+=m}return!0}}),s&&(i?i+=`

${s}`:i=s),a.getBoundingClientRect().bottom>n}),i}getCaretAfterContent(t){if(!this.editorElement||!this.inputElement)return"";let r=t.rect.left+t.rect.width/2,n=t.rect.top+t.rect.height/2,i="";return this.getParagraphElements().sort((a,s)=>a.getBoundingClientRect().bottom-s.getBoundingClientRect().bottom).filter(a=>a.getBoundingClientRect().bottom>n).forEach(a=>{let s="",l=null;this.getTextElements(a).forEach(c=>{let u=this.parseTextElement(c);if(u.rect.top>n||u.rect.bottom>n&&u.rect.left>r)l&&u.rect.top>=l.rect.bottom?s+=`
${u.content}`:s+=u.content,l=u;else if(oc(r,n,[u.rect])){let p=this.getCaretOffset(u,t.rect);if(p>0){let m=u.content.slice(p);s+=m}return!0}}),s&&(i?i+=`

${s}`:i=s)}),i}async selectSelection(t){if(!this.editorElement||!this.scrollElement)return;let{layouts:r}=t,n=r[0],i=r[r.length-1],a=this.scrollElement.getBoundingClientRect(),s={bubbles:!0,clientX:a.left+n.left,clientY:a.top+n.top+n.height/2},l={bubbles:!0,clientX:a.left+i.right,clientY:a.top+i.top+i.height/2},c=Math.max(n.bottom,i.bottom),u=Math.max(n.top,i.top);if(this.editorElement.scrollTop+this.editorElement.offsetHeight<c)return this.editorElement.scrollTo({top:u,behavior:"auto"}),await new Promise(m=>setTimeout(m,50)),this.selectSelection(t);[new MouseEvent("click",s),new MouseEvent("mousedown",s),new MouseEvent("mousemove",l),new MouseEvent("mouseup",l)].forEach(m=>this.editorElement?.dispatchEvent(m)),await new Promise(m=>setTimeout(m,50)),this.inputElement?.dispatchEvent(new KeyboardEvent("keyup",{shiftKey:!0,key:"Shift",code:"ShiftLeft"}))}getCurrentSelection(){if(!this.editorElement)return null;let t=[],r=[],n=this.getSelectionElements();if(n.forEach(s=>{let l=s.getBoundingClientRect().toJSON();t.push(this.calculateRelativeLayout(l)),r.push(l)}),!n.length)return null;let i=this.getParagraphElements().filter(s=>r.some(l=>RC(l,s.getBoundingClientRect()))).map(s=>this.parseParagraphElement(s)),a=this.copySelection();return Zn.info({paragraphs:i,rects:r,layouts:t,content:a}),{elements:n,rects:r,paragraphs:i,layouts:t,content:a}}getCurrentCaret(){if(!this.editorElement||!this.caretElement)return null;let t=this.caretElement,r=this.caretElement.getBoundingClientRect(),n=this.calculateRelativeLayout(r);return Zn.info({element:t,rect:r,layout:n}),{element:t,rect:r,layout:n}}getCaretOffset(t,r){let{left:n,top:i,width:a,height:s}=r,l=n+a/2,c=i+s/2;if(l<t.rect.left||c<t.rect.top)return 0;if(l>t.rect.right||c>t.rect.bottom)return t.content.length;let{element:u,content:p}=t,m=document.createTextNode(p),d=this.createTextOverlay(u,m);if(!d)return 0;let{width:h,left:f}=d.getBoundingClientRect(),_=document.createRange(),x=m.nodeValue?.length||0,C=h/x,y={},b=Math.floor((l-f)/C);for(;b<=x;){_.setStart(m,0),_.setEnd(m,b);let w=_.getClientRects()[0].toJSON(),I=y[b-1],E=I?I.right+(w.right-I.right)/2:w.left+w.width;if(l<E)if(I){b=Math.max(b-1,0);break}else{b--;continue}y[b]=w,b++}return d.remove(),b}parseTextElement(t){let r=t.getAttribute("aria-label")||"",n=t.getAttribute("data-font-css")||"",[i,a,s]=n.split(" "),l=t.getBoundingClientRect().toJSON(),c=this.calculateRelativeLayout(l);return{element:t,content:r,rect:l,layout:c,style:{top:c.top,left:c.left,width:c.width,height:c.height,fontWeight:i,fontSize:a,fontFamily:s?.replaceAll('"',"")}}}parseParagraphElement(t){let r=t.getBoundingClientRect().toJSON(),n=this.calculateRelativeLayout(r),i=this.getTextElements(t).map(a=>this.parseTextElement(a));return{element:t,rect:r,layout:n,texts:i,style:{top:n.top,left:n.left,width:n.width,height:n.height}}}getSelectionElements(){return this.editorElement?Array.from(this.editorElement.querySelectorAll(".kix-canvas-tile-selection rect")).filter(t=>t.parentElement?.tagName!=="clipPath"&&["rgba(118,167,250,0.5)","rgba(0,0,0,0.15)"].includes(t.getAttribute("fill")||"")):[]}getParagraphElements(){return this.editorElement?Array.from(this.editorElement.querySelectorAll('canvas ~ .kix-canvas-tile-content:not(.kix-canvas-tile-selection) g[role="paragraph"]')):[]}getTextElements(t){return t?Array.from(t.querySelectorAll("rect")).filter(r=>r.parentElement?.tagName!=="clipPath"):this.editorElement?Array.from(this.editorElement.querySelectorAll('canvas ~ .kix-canvas-tile-content:not(.kix-canvas-tile-selection) g[role="paragraph"] rect')).filter(r=>r.parentElement?.tagName!=="clipPath"):[]}getTextElementFromPoint(t,r){let n=this.getParagraphElements().find(i=>oc(t,r,[i.getBoundingClientRect()]));return n?this.getTextElements(n).find(i=>oc(t,r,[i.getBoundingClientRect()])):null}getElementFromPoint(t,r){this.styleElement||(this.styleElement=document.createElement("style"),this.styleElement.id="enable-pointer-events-on-rect",this.styleElement.textContent=[".kix-canvas-tile-content{pointer-events:none!important;}","#kix-current-user-cursor-caret{pointer-events:none!important;}",".kix-canvas-tile-content svg>g>rect{pointer-events:all!important; stroke-width:7px !important;}"].join(`
`),(document.head||document.documentElement).appendChild(this.styleElement)),this.styleElement.disabled=!1;let n=document.elementFromPoint(t,r);return this.styleElement.disabled=!0,n}createTextOverlay(t,r){if(!t||t.tagName!=="rect")return null;let n=document.createElementNS("http://www.w3.org/2000/svg","text"),i=t.getAttribute("transform")||"",a=t.getAttribute("data-font-css")||"";n.setAttribute("x",t.getAttribute("x")||""),n.setAttribute("y",t.getAttribute("y")||""),n.appendChild(r),n.style.setProperty("all","initial","important"),n.style.setProperty("transform",i,"important"),n.style.setProperty("font",a,"important"),n.style.setProperty("text-anchor","start","important"),t.parentNode?.appendChild(n);let s=t.getBoundingClientRect(),l=n.getBoundingClientRect(),c=(s.top-l.top+(s.bottom-l.bottom))*.5;return n.style.setProperty("transform",`translate(0px,${c}px) ${i}`,"important"),n}};var m1=Eo(),SD=()=>{let{control:o,focus:e,caret:t,selection:r}=Q9(),n=bt(Wl),i=Qt(ii),[a,s]=En(ey),l=Qt(Om),c=(0,gr.useRef)({}),u=(0,gr.useRef)(null),p=(0,gr.useRef)(a);p.current=a;let m=(0,gr.useRef)(r);m.current=r;let d=(0,gr.useCallback)(()=>eh(Object.values(c.current).filter(Boolean).map(C=>C.getBoundingClientRect().toJSON())),[]),h=(0,gr.useCallback)(()=>u.current?.getBoundingClientRect().toJSON(),[]),f=(0,gr.useCallback)((C,y,b=y,w="")=>{window.postMessage({id:E1,type:"iframeSelection",data:{virtual:!0,iframeId:m1,tagName:"",id:m1,className:"",windowRect:document.body.getBoundingClientRect().toJSON(),targetRect:C,selectionRect:C,iframeSelectionRect:C,iframePosition:[0,0],selectionText:y,selectionHTML:y,editableElementSelectionText:b,editableElementSelectionHTML:b,eventType:"keyup",isEmbedPage:!1,isEditableElement:!!o?.editable,caretOffset:1,startMarkerId:"",endMarkerId:"",relatedContent:w}},"*")},[]);(0,gr.useEffect)(()=>{if(!n){let C=[];return l(y=>(y.range&&C.push(setTimeout(()=>{let b=new KeyboardEvent("keyup",{key:" ",code:"Space",bubbles:!0,cancelable:!0});b.MAX_AI_IGNORE=!0,document.body.dispatchEvent(b)},1)),y)),o?.inputElement?.focus(),()=>{C.forEach(y=>clearTimeout(y))}}},[n]),(0,gr.useEffect)(()=>{if(!o)return;let C=Dr(()=>{if((p.current.currentSelection?.selectionElement||p.current.tempSelection?.selectionElement)?.id!==m1)return;let b=m.current?.content?d():h();i(w=>({...w,rootRect:b})),s(w=>({...w,tempSelection:w.tempSelection?{...w.tempSelection,selectionRect:b}:w.tempSelection}))},200);return o.addListener("scroll",C),()=>{o.removeListener("scroll",C),C.cancel()}},[o]),(0,gr.useEffect)(()=>{if(!(!e||!o)){if(r&&r.content){let C="",y=r.rects[0],b=r.rects[r.rects.length-1],w=2e3;if(y&&b&&r.content.length<=w*.75){let I={element:null,rect:{...y,width:1,right:y.left+1},layout:{...y,width:1,right:y.left+1}},E={element:null,rect:{...b,width:1,left:b.right-1},layout:{...b,width:1,left:b.right-1}},P=o.getCaretBeforeContent(I),O=o.getCaretAfterContent(E),N=Math.ceil((w-r.content.length)/2),V=P.slice(-N),A=w-N,D=O.slice(0,A);C=`${V}${r.content}${D}`.trim()}f(eh(r.rects),r.content,r.content,C);return}if(t&&e&&o?.editable){f(t.rect,o?.getCaretBeforeContent(t)||"","");return}p.current.show&&(o?.editable||f(d(),"",""),s({show:!1,tempSelection:null,currentSelection:null,lastCursorPosition:null}))}},[r,t,e,o]),zl(async(C,y,b)=>{if(C!=="Client_listenUpdateIframeInput"||y.id!==m1)return;let{type:w,value:I}=y;switch(w){case"INSERT_BELOW":o?.insertBelowSelection(I);break;case"INSERT":o?.replaceSelection(I);break;case"INSERT_ABOVE":o?.insertAboveSelection(I);break;case"REPLACE_SELECTION":o?.replaceSelection(I);break}});let _=ta?0:1,x=ta?-1:9999;return gr.default.createElement("div",{style:{opacity:_}},r?.layouts.map((C,y)=>gr.default.createElement("div",{ref:b=>{c.current[y]=b},key:y,style:{position:"absolute",border:ta?void 0:"1px solid red",opacity:_,zIndex:x,...C}})),t&&gr.default.createElement("div",{ref:u,style:{position:"absolute",border:ta?void 0:"1px solid blue",opacity:_,zIndex:x,...t.layout}}))},J9=SD;var vD=()=>{let o=(0,Xi.useMemo)(()=>new u1,[]),[e,t]=(0,Xi.useState)(o.lastCaret),[r,n]=(0,Xi.useState)(o.lastSelection),[i,a]=(0,Xi.useState)(!1);return Ro(()=>{if(o.init(),o.disabled)return;let s=p=>{n(p)},l=p=>{t(p)},c=()=>{a(!0)},u=()=>{a(!1)};return o.addListener("selection-change",s),o.addListener("caret-change",l),o.addListener("focus",c),o.addListener("blur",u),o.isFocus()&&(o.checkSelectionChange(),o.checkCaretChange(),a(!0)),()=>{o.removeListener("selection-change",s),o.removeListener("caret-change",l),o.removeListener("focus",c),o.removeListener("blur",u),o.destroy()}}),!o||!o.scrollElement||o.disabled?null:Xi.default.createElement(o0.Provider,{value:{control:o,caret:e,selection:r,focus:i}},(0,e7.createPortal)(Xi.default.createElement(J9,null),o.scrollElement))},t7=Xi.default.memo(vD);var Mo=S(M());var MD=o=>{let{...e}=o,{onResetConversation:t,onCreateConversation:r,onUpdateConversation:n,onSwitchConversation:i,onStopShortcutsActions:a,onRunShortcutsActions:s,onAskAIQuestion:l}=e,c=te(_=>_.setOnCreateConversation),u=te(_=>_.setOnUpdateConversation),p=te(_=>_.setOnSwitchConversation),m=te(_=>_.setOnResetConversation),d=te(_=>_.setOnAskAIQuestion),h=te(_=>_.setOnRunShortcutsActions),f=te(_=>_.setOnStopShortcutsActions);return(0,Mo.useEffect)(()=>{r&&c(r)},[r]),(0,Mo.useEffect)(()=>{n&&u(n)},[n]),(0,Mo.useEffect)(()=>{i&&p(i)},[i]),(0,Mo.useEffect)(()=>{t&&m(t)},[t]),(0,Mo.useEffect)(()=>{l&&d(l)},[l]),(0,Mo.useEffect)(()=>{s&&h(s)},[s]),(0,Mo.useEffect)(()=>{a&&f(a)},[a]),TD(),Mo.default.createElement(Mo.default.Fragment,null)},o7=new Map,TD=()=>{let o=te(f=>f.conversationIds),{getConversation:e}=Ve(),{addMessagesToPagination:t,syncLocalMessages:r,updateMessagesToPagination:n,removeMessagesToPagination:i}=Li(),[a,s]=(0,Mo.useState)(o),{paywallShowDebounce:l}=za();(0,Mo.useEffect)(()=>{s(f=>z0(f.concat(o)))},[o]);let c=(0,Mo.useRef)(null),u=Rp(({set:f,snapshot:_})=>async(x,C)=>{c.current&&(clearTimeout(c.current),c.current=null);let y=await _.getPromise(G1(x));f(G1(x),C===null?null:Qo([y,C]))}),p=Rp(({set:f})=>(_,x)=>{f(gm(_),x)});(0,Mo.useEffect)(()=>{o.length>0&&o.map(f=>{e(f)})},[o]);let{debounceRefreshModelUsage:m}=Mi();(0,Mo.useEffect)(()=>{a.forEach(f=>{if(o7.has(f))return;let _=ri.getShortcutsEngine(f),x=async(C,y)=>{if(C==="shortcutsEngineStatus"&&((y.shortcutsEngine.status==="complete"||y.shortcutsEngine.status==="stop")&&(u(f,null),e(f)),p(f,y.shortcutsEngine.status)),C==="actionCustomEvent"&&y.actionCustomEventName==="updateWritingMessage"){let b=y.actionCustomEventData;b?u(f,{...b,conversationId:f}):c.current=setTimeout(()=>{u(f,null)},1e3)}if(C==="shortcutsExternalEngine"){if(y.shortcutsExternalEngineType==="shortcutsExternalEngineChatConversationService"){let{functionName:b,params:w}=y.shortcutsExternalEngineData;b==="addOrUpdateConversation"&&e(w[0])}if(y.shortcutsExternalEngineType==="shortcutsExternalEngineChatMessageService"){let{functionName:b,params:w}=y.shortcutsExternalEngineData;if(b==="addMessages"){let I=w[1].map(N=>N.messageId),E=await Dn.getService().getMessagesByMessageIds(f,I),P=E.find(N=>wi(N)&&N.meta.paywallData||mn(N)&&N.originalMessage?.metadata?.embeddedPaywall);if(P&&wi(P)){let N=P.meta.paywallData;l({conversationId:f,paywallType:"response",paywallData:N}),Bs.flush(),u(f,null)}P&&mn(P)&&(l({conversationId:f,paywallType:"response",paywallReason:"ProChat"}),Bs.flush());let O=E.find(N=>wi(N)&&N.meta?.status==="error");if(O){let N=await Dn.getService().getMessageByType(f,"user","latest");b_("ask_ai",{conversationId:f,latestUserMessage:N,errorMessage:O.text,AIModel:O.meta?.AIModel,chatMode:O.meta?.chatMode})}t(f,E),await r(f),e(f)}else if(b==="updateMessages"){let I=w[1].map(P=>P.messageId),E=await Dn.getService().getMessagesByMessageIds(f,I);n(f,E),await r(f),e(f)}else if(b==="deleteMessages"){let I=w[1];i(f,I),await r(f),e(f)}}}(C==="afterRunAction"&&(y.currentAction?.type==="ASK_CHATGPT"||y.currentAction?.type==="MAXAI_RESPONSE_RELATED")&&y.currentAction?.status==="complete"||y.shortcutsEngine?.status==="stop")&&m()};o7.set(f,x),_.addListener(x)})},[a]);let{refreshChatAIModelSelector:d,refreshChatHubAIModelSelector:h}=Nl();(0,Mo.useEffect)(()=>{d(),h()},[d,h])},r7=(0,Mo.memo)(MD);var ir=S(M());var wD=()=>(Zu(),am("floatingMenu"),ir.default.createElement(ir.default.Fragment,null,ir.default.createElement(ED,null))),ED=()=>{let{conversationType:o,setConversationIds:e,setConversationType:t}=te(y=>({conversationType:y.conversationType,setConversationIds:y.setConversationIds,setConversationType:y.setConversationType})),{appSettings:r}=en(),{betaSettings:n}=Sr(),{getLocalSettings:i,setLocalSettings:a}=_t(),{refreshModelUsageOnce:s}=Wu(),[l,c]=En(ty),{createConversation:u,updateConversation:p,getConversation:m}=Ve(),[d]=En(ii),h=Ol(l),f=(0,ir.useRef)(h);f.current=h,(0,ir.useEffect)(()=>{r.userSettings&&(n?.appearance_v2_enabled?t("Chat"):t("ContextMenu"))},[r.userSettings,n?.appearance_v2_enabled]),(0,ir.useEffect)(()=>{l&&e([l])},[l]);let _=(0,ir.useCallback)(()=>{u(o,{reason:"initCreate",conversation:{meta:{isContextMenu:!0}}}).then(y=>{c(y[0]?.id||"")}).catch(y=>{})},[o,u,c]);(0,ir.useEffect)(()=>{d.open?(o==="Chat"&&xm("Chat").then(y=>{let b=y[0];f.current&&b&&f.current.meta.AIModel!==b.value&&p(f.current.id,{meta:{AIProvider:b.AIProvider,AIModel:b.value,maxTokens:b.maxTokens}},{syncToRemote:!1})}),s()):_()},[o,d.open,_]),bl(async()=>{if(l){let{sidebarSettings:y}=await i(),b=y?.contextMenu?.currentAIModel,w=await m(l);if(w||_(),b&&w?.type==="ContextMenu"&&w?.meta.AIModel!==b){let I=Ir(void 0,b);I&&await p(l,{meta:{AIProvider:I.AIProvider,AIModel:I.value,maxTokens:I.maxTokens}},{syncToRemote:!1})}}});let x=(0,ir.useCallback)(async y=>{let{sidebarSettings:b}=await i();if(y.type==="ContextMenu"){let w=b?.contextMenu?.currentAIModel;if(w){let I=Ir(void 0,w);if(I)return{...y,meta:{...y.meta,AIProvider:I.AIProvider,AIModel:I.value,maxTokens:I.maxTokens}}}}return y},[i]),C=(0,ir.useCallback)(y=>{a({sidebarSettings:{contextMenu:{currentAIModel:y.meta.AIModel}}})},[a]);return ir.default.createElement(ir.default.Fragment,null,ir.default.createElement(r7,{onCreateConversation:x,onUpdateConversation:C}),d.open&&ir.default.createElement(f6,null))},n7=wD;var PD=()=>(my(),Or.default.createElement(Y2,{containerId:U0,wrapperId:W0},({rootContainer:o})=>Or.default.createElement(Bx,{shadowRootElement:o},Or.default.createElement(A2,{conversationType:"ContextMenu"},Or.default.createElement(n7,null),Or.default.createElement(J8,{variant:"custom"},Or.default.createElement(TC,null,Or.default.createElement(is,{defaultContextMenuPath:"/rewrite"},Or.default.createElement(N9,{root:o}),Or.default.createElement(Z9,null)),Or.default.createElement(U9,null),Or.default.createElement(G9,null),Or.default.createElement(t7,null),Or.default.createElement(e9,null))))))),i7=(0,Or.memo)(PD);var f1=S(M());var p7=S(M());var AD={inviteLink:o=>(document.querySelector("#appMaxAIReferralShareOneClickText")?.innerText||"").trim()||`Sign up on MaxAI using my link and both of us will get a free week of MaxAI Pro rewards. It lets you use AI on any webpage with one click, powered by ChatGPT, Claude, Bard, and Bing AI. Here is my link: https://app.maxai.me?invite=${o}`},sl=AD;var r0=S(a7()),s7=S(c0());var Op=async(o,e,t="",r)=>{let n=await zu.getUserInfo(),i=n?.user_id||"",a=n?.email||"",{getBrowser:s,getOS:l}=new r0.UAParser,c=s(),u=l(),p={env:ta?"prod":"dev",type:o,app:"MAXAI",data:{title:e,message:t,...r},user_id:i,email:a,app_version:Dx,browser:c.name,browser_version:c.version,platform:u.name,platform_version:u.version,languages:navigator.languages},m=u0(p,"MaxAI");return fy("https://api.extensions-hub.com/extensionhub/send_notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({msg:m})}).then().catch()},l7=async()=>{let{getBrowser:o,getOS:e}=new r0.UAParser;await s7.default.storage.local.set({MAXAI_BROWSER_INFO:JSON.stringify({browser:o(),os:e()})})};var kD=()=>{let{userInfo:o}=Mt(),{conversationId:e}=Tt(),{createConversation:t}=Ve(),{askAIWithShortcuts:r}=Re(),n=ge(e);return{autoFacebookReferral:(0,p7.useCallback)(async()=>{if(!n){let a=sl.inviteLink(o?.referral_code||""),s=(p,m)=>{let d=m.currentAction;if(p==="afterRunAction"&&d?.type==="SET_VARIABLE"&&d.parameters?.VariableKey==="AutoTwitterReferralResult"){let h=d.parameters.WFFormValues?.Value===!0;Op("REFERRAL",`[Referral] One-click button [Facebook] ${h?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:h},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),h&&Xl("/user/complete_referral",{referral_types:["FACEBOOK_SHARE"]}).then()}},c=(await t("Chat",{reason:"manualClick",syncToRemote:!1}))[0].id,u=ri.getShortcutsEngine(c);return u?.addListener(s),await r([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/sharer/sharer.php?u=https://app.maxai.me"}},{type:"SET_VARIABLE",parameters:{VariableKey:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["textarea[title]"],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:sl.inviteLink(o?.referral_code||"")},beforeDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['button[name="__CONFIRM__"]'],actionType:"click",afterDelay:3e3}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/profile.php"}},{type:"SET_VARIABLE",parameters:{VariableKey:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-ad-preview="message"]','div[data-ad-comet-preview="message"]'],executeElementCount:10,actionType:"getText",beforeDelay:2e3}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:a.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableKey:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableKey:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}],{conversationId:c}),u?.removeListener(s),!0}return!1},[n,r,o?.referral_code,o?.email]),autoFacebookReferralLoading:n}},c7=kD;var u7=S(M());var LD=()=>{let{userInfo:o}=Mt(),{conversationId:e}=Tt(),{createConversation:t}=Ve(),{askAIWithShortcuts:r}=Re(),n=ge(e);return{autoLinkedinReferral:(0,u7.useCallback)(async()=>{if(!n){let a=sl.inviteLink(o?.referral_code||""),s="",l=(m,d)=>{let h=d.currentAction;if(m==="afterRunAction"&&h?.type==="SET_VARIABLE"){if(h.parameters?.VariableKey==="SHARE_POST_LINK")s=h.output;else if(h.parameters?.VariableKey==="AutoTwitterReferralResult"){let f=h.parameters.WFFormValues?.Value===!0;Op("REFERRAL",`[Referral] One-click button [Linkedin] ${f?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:f,shareLink:`[ ${s} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),f&&Xl("/user/complete_referral",{referral_types:["LINKEDIN_SHARE"]})}}},u=(await t("Chat",{reason:"manualClick",syncToRemote:!1}))[0].id,p=ri.getShortcutsEngine(u);return p?.addListener(l),await r([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.linkedin.com/shareArticle/?url=https%3A%2F%2Fapp.maxai.me%3Finvite%3DIPn7Xnby"}},{type:"SET_VARIABLE",parameters:{VariableKey:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.artdeco-button"],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[contenteditable="true"]'],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:a},afterDelay:1e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.share-actions__primary-action"],actionType:"click",afterDelay:3e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__view-btn"],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableKey:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__continue-btn"],actionType:"getText"}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:"linkedin",WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableKey:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableKey:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}],{conversationId:u}),p?.removeListener(l),!0}return!1},[r,n,o?.referral_code,o?.email]),autoLinkedinReferralLoading:n}},m7=LD;var d7=S(M());var OD=()=>{let{userInfo:o}=Mt(),{conversationId:e}=Tt(),{createConversation:t}=Ve(),{askAIWithShortcuts:r}=Re(),n=ge(e);return{autoTwitterReferral:(0,d7.useCallback)(async()=>{if(!n){let a=sl.inviteLink(o?.referral_code||""),s="",l=(m,d)=>{let h=d?.currentAction;if(m==="afterRunAction"&&h?.type==="SET_VARIABLE"){if(h.parameters?.VariableKey==="SHARE_POST_LINK")s=h.output;else if(h.parameters?.VariableKey==="AutoTwitterReferralResult"){let f=h.parameters.WFFormValues?.Value===!0;Op("REFERRAL",`[Referral] One-click button [Linkedin] ${f?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:f,shareLink:`[ ${s} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),f&&Xl("/user/complete_referral",{referral_types:["TWITTER_SHARE"]})}}},u=(await t("Chat",{reason:"manualClick",syncToRemote:!1}))[0].id,p=ri.getShortcutsEngine(u);return p?.addListener(l),await r([{type:"OPEN_URLS",parameters:{URLActionURL:`https://twitter.com/intent/tweet?text=${a}`}},{type:"SET_VARIABLE",parameters:{VariableKey:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['button[data-testid="tweetButton"]'],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['a[data-testid="AppTabBar_Profile_Link"]'],actionType:"click",afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['article[data-testid="tweet"] div[data-testid="User-Name"] a[role="link"]'],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableKey:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetText"]'],actionType:"getText",executeElementCount:10}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:a.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableKey:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://twitter.com/MaxAI_HQ"}},{type:"SET_VARIABLE",parameters:{VariableKey:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['[data-testid="1667007582270296064-follow"]'],actionType:"click",beforeDelay:2e3,afterDelay:3e3}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableKey:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}],{conversationId:u,isSaveLastRunShortcuts:!1}),p?.removeListener(l),!0}return!1},[n,r,o?.referral_code,o?.email]),autoTwitterReferralLoading:n}},f7=OD;var BD=()=>{let{autoTwitterReferral:o}=f7(),{autoFacebookReferral:e}=c7(),{autoLinkedinReferral:t}=m7(),r=(0,f1.useRef)({});(0,f1.useEffect)(()=>{r.current={twitter:o,linkedin:t,facebook:e}},[o,t,e]),Ro(()=>{Zr&&location.href.includes(Zr)&&setInterval(()=>{let i=document.querySelector("#appMaxAIReferralShareOneClickContainer"),a=document.querySelector("#appMaxAIReferralShareOneClickButton");if(i&&a){if(!i.classList.contains("loaded"))i.classList.add("loaded");else return;a.addEventListener("click",async()=>{let s=Array.from(document.querySelectorAll('.app-maxai-me__one-click-share-status-card[data-checked="true"]'));for(let u=0;u<s.length;u++){let m=s[u].getAttribute("data-name"),d=r.current?.[m];d&&await d()}await Os(3e3);let l=new URL(window.location.href),c=new URLSearchParams(l.search);c.set("show_completed","true"),l.search=c.toString(),window.location.href=l.toString()})}},1e3)})},h7=BD;var n0=S(c0());var g7=async(o,e)=>{let{rootElementSelector:t,isShadowElement:r=!1,elementSelectors:n,beforeDelay:i=0,afterDelay:a=0,executeElementCount:s=1,durationTimes:l=30*1e3,rotationTimes:c=3e3,rotationInterval:u=1e3,actionType:p="click",actionExtraData:m}=e||{},d={success:!1,elementsInnerText:"",link:""},h=document,f=t?h.querySelector(t):h;if(r&&(f=f.shadowRoot),!n||n?.length===0||!f){n0.default.runtime.sendMessage({event:"ShortCuts_OperationPageElementResponse",data:{taskId:o,success:d.success,data:d}});return}if(f){let _=async()=>{await Os(i);let x=[],C=0;for(;x.length===0&&C<c;)x=Hx(...n.map(y=>Array.from(f.querySelectorAll(y)))),x.length===0&&(C+=u,await Os(u));return x.length===0||(x=x.slice(0,s),x.forEach(y=>{switch(p){case"click":y.click();break;case"insertText":{let b=m?.text||m?.value.toString()||"";if(y.focus(),y.getAttribute("contenteditable")==="true"){let w=window.getSelection(),I=document.createRange();I.selectNodeContents(y),w?.removeAllRanges(),w?.addRange(I)}m?.clearBeforeInsertText&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA")&&(y.select(),h.execCommand("Delete",!1,"")),h.execCommand("insertText",!1,b)}break;case"getText":{let b=y?.innerText||"";d.elementsInnerText+=b}break;case"getLink":y.tagName==="A"?(d.link&&(d.link+=","),d.link+=y.href):y.tagName==="IMG"||y.tagName==="VIDEO"||y.tagName==="IFRAME"||y.tagName==="EMBED"||y.tagName==="SOURCE"||y.tagName==="TRACK"?(d.link&&(d.link+=","),d.link+=y.src):(d.link&&(d.link+=","),d.link+=y?.innerText||"");break;default:break}}),d.success=!0,await Os(a)),d};await Promise.race([_(),Os(l)]),n0.default.runtime.sendMessage({event:"ShortCuts_OperationPageElementResponse",data:{taskId:o,data:{success:d.success,message:d.success?"ok":"error",data:d}}})}};var x7=()=>{Am(async(o,e,t)=>{switch(o){case"ShortCuts_ClientExecuteOperationPageElement":{let{taskId:r,OperationElementConfig:n}=e;return r?(await g7(r,n),{success:!0,data:!0,message:"ok"}):{success:!1,message:"No taskId",data:null}}break;default:break}})};var Xr=S(M());var DD=new qu({runtime:"client"}),HD=()=>{let{pageUrl:o,startListen:e}=nf(),t=(0,Xr.useRef)(""),r=(0,Xr.useRef)({}),n=(0,Xr.useRef)({}),i=(0,Xr.useRef)(!1),a=(0,Xr.useCallback)(m=>{t.current!==m&&(r.current={},n.current={},t.current=m)},[]),s=(0,Xr.useCallback)(m=>{r.current["6ccd02db210a323454547913a88d465d0a08630e"]?r.current["6ccd02db210a323454547913a88d465d0a08630e"].indexOf(m)===-1&&r.current["6ccd02db210a323454547913a88d465d0a08630e"].push(m):r.current["6ccd02db210a323454547913a88d465d0a08630e"]=[m]},[]),l=(0,Xr.useCallback)(m=>{r.current.f31d0f92fbcd0d80473bfebb56bc33071b09dcb7?r.current.f31d0f92fbcd0d80473bfebb56bc33071b09dcb7.indexOf(m)===-1&&r.current.f31d0f92fbcd0d80473bfebb56bc33071b09dcb7.push(m):r.current.f31d0f92fbcd0d80473bfebb56bc33071b09dcb7=[m]},[]),c=(0,Xr.useCallback)(m=>{r.current.b7c238015309231550a4aee6b6e2bb382eb6fd17?r.current.b7c238015309231550a4aee6b6e2bb382eb6fd17.indexOf(m)===-1&&r.current.b7c238015309231550a4aee6b6e2bb382eb6fd17.push(m):r.current.b7c238015309231550a4aee6b6e2bb382eb6fd17=[m]},[]),u=(0,Xr.useCallback)(m=>{r.current.ed31666fb5d75e1637ea42ab1988a4f7daa374ac?r.current.ed31666fb5d75e1637ea42ab1988a4f7daa374ac.indexOf(m)===-1&&r.current.ed31666fb5d75e1637ea42ab1988a4f7daa374ac.push(m):r.current.ed31666fb5d75e1637ea42ab1988a4f7daa374ac=[m]},[]),p=(0,Xr.useCallback)(()=>{let m={},d=[],h=0;if(Object.keys(r.current).forEach(f=>{let _=r.current[f]||[];n.current[f]||(n.current[f]=[]);let x=n.current[f],C=_.filter(y=>!x.includes(y)).slice(0,20);h+=C.length,C.length>0&&(m[f]=C),d.push(()=>{n.current[f].push(...C)})}),h>=1){i.current=!0;let f=0;d.forEach(_=>_()),setTimeout(()=>{pn.setItem(lt("4d415841495f4150495f4b45595f37346262313966652d663631392d343165352d616532332d313765386664373539643564"),mu(JSON.stringify({...m,"93011c6a4cf334810533dc067238764a0b4b39ff":t.current}))).then(()=>{DD.postMessage({event:"Client_sendContextUpdate",data:{}})})},f)}},[]);(0,Xr.useEffect)(()=>{e()},[]),(0,Xr.useEffect)(()=>{if(o){i.current=!1;let m=setTimeout(()=>{let d=Np();if(i.current)return;let h=mu(d);if(!["696e7374616772616d2e636f6d","747769747465722e636f6d","782e636f6d","74696b746f6b2e636f6d","796f75747562652e636f6d","6c696e6b6564696e2e636f6d","66616365626f6f6b2e636f6d"].includes(h))return;let f=mu(o);if(Np())switch(h){case"696e7374616772616d2e636f6d":{if(a("9958532dbed0fe0b5997f55cb43ccba1edf19015"),f==="68747470733a2f2f7777772e696e7374616772616d2e636f6d"||f==="68747470733a2f2f7777772e696e7374616772616d2e636f6d2f"){let _=Array.from(document.querySelectorAll('div[data-visualcompletion="ignore-dynamic"] a')).reverse()[0],x=_&&_.getAttribute("href")?.split("/")?.[1]||"";x&&s(x);let C=[...new Set(Array.from(document.querySelectorAll("article a:has(>div>div>span)")).map(y=>y.getAttribute("href")?.split("/")?.[1]||"").filter(Boolean))];C.length>0&&C.forEach(c)}if(/\/p\/\w{11}\//.test(o)){let _=Array.from(document.querySelectorAll("article:has(header) header a")).map(x=>x.getAttribute("href")?.split("/")?.[1]||"").filter(Boolean)[0]||document.querySelector('meta[name="twitter:title"]')?.getAttribute("content")?.split("(@")[1]?.split(")")[0];_&&l(_)}break}case"747769747465722e636f6d":case"782e636f6d":{if(a("b56d7211de49aa1b8a73ee960d7dc8cea32643d8"),f==="68747470733a2f2f782e636f6d2f686f6d65"||f==="68747470733a2f2f782e636f6d2f686f6d652f"){let _=document.querySelector(lt("6469765b646174612d7465737469645e3d557365724176617461722d436f6e7461696e65725d"))?.getAttribute("data-testid")?.slice(21)||"";_&&s(_);let x=[...new Set(Array.from(document.querySelectorAll("article:not(:has(a[id]))")).filter(C=>!Array.from(C.querySelectorAll('div[style^="color"] span')).find(b=>b.innerText.trim()==="Ad")).map(C=>C.querySelector('div[data-testid="User-Name"] a')?.getAttribute("href")?.split("/")?.[1]||"").filter(Boolean))];x.length>0&&x.forEach(c)}if(/\/status\/\d+/.test(o)){let _=[...new Set(Array.from(document.querySelectorAll("article:not(:has(a[id]))")).filter(x=>!Array.from(x.querySelectorAll('div[style^="color"] span')).find(y=>y.innerText.trim()==="Ad")).map(x=>x.querySelector('div[data-testid="User-Name"] a')?.getAttribute("href")?.split("/")?.[1]||"").filter(Boolean))][0]||"";_&&l(_)}break}case"74696b746f6b2e636f6d":{if(a("ab11cfb35cdd097e03d1d8f76189e59de871317e"),f==="68747470733a2f2f7777772e74696b746f6b2e636f6d"||f==="68747470733a2f2f7777772e74696b746f6b2e636f6d2f"){let _=document.querySelector(lt("615B646174612D6532653D226E61762D70726F66696C65225D"))?.getAttribute("href")?.split("/")?.[1]||"";s(_);let x=[...new Set(Array.from(document.querySelectorAll(lt("615B646174612D6532653D22766964656F2D617574686F722D617661746172225D"))).map(C=>C.getAttribute("href")?.split("/")?.[1]||"").filter(Boolean))];x.length>0&&x.forEach(c)}if(/\/video\/\d+/.test(o)){let _=o.split("@")?.[1]?.split("/")?.[0]||"";_&&l(`@${_}`)}break}case"796f75747562652e636f6d":{if(a("67393bf26626a32781ecd6a86af58b8e73e3ffa4"),f==="68747470733a2f2f7777772e796f75747562652e636f6d2f666565642f796f75"||f==="68747470733a2f2f7777772e796f75747562652e636f6d2f666565642f796f752f"){let _=Array.from(document.querySelectorAll(lt("79742D636F6E74656E742D6D657461646174612D766965772D6D6F64656C207370616E"))).map(x=>x.innerText.trim()).find(x=>x.startsWith("@"));_&&s(_)}if(V0.retrieveVideoId(o)){let _=document.querySelector(lt("7974642D766964656F2D6F776E65722D72656E646572657220612E7974642D766964656F2D6F776E65722D72656E6465726572"))?.getAttribute("href")?.split("/")?.[1]||"";_&&l(_)}if(f==="68747470733a2f2f7777772e796f75747562652e636f6d"||f==="68747470733a2f2f7777772e796f75747562652e636f6d2f"){let _=[...new Set(Array.from(document.querySelectorAll(lt("23636F6E74656E7473207974642D726963682D677269642D6D656469613A68617328236176617461722D636F6E7461696E65722920236176617461722D6C696E6B"))).map(x=>x.getAttribute("href")?.split("/")?.[1]||"").filter(Boolean))];_.length>0&&_.forEach(c)}break}case"6c696e6b6564696e2e636f6d":{a("32cbb537fc5dc82cd024931689ba47571f5f9c46");let _=()=>{let x=lt("6469762e666565642d7368617265642d7570646174652d76325f5f636f6e74726f6c2d6d656e752d636f6e7461696e6572"),C=lt("2e7570646174652d636f6d706f6e656e74732d6163746f725f5f6465736372697074696f6e202e76697375616c6c792d68696464656e2c202e7570646174652d636f6d706f6e656e74732d6163746f725f5f7375622d6465736372697074696f6e202e76697375616c6c792d68696464656e");return Array.from(document.querySelectorAll(x)).filter(b=>!Array.from(b.querySelectorAll(C)).find(I=>I.innerText===lt("50726F6D6F746564"))).map(b=>{let w=b?.querySelector("a:has(img)")?.getAttribute("href")||"";if(w){if(w.startsWith(lt("68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f636f6d70616e792f"))){let I=w.replace(lt("68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f636f6d70616e792f"),"")?.split("/")?.[0]?.split("?")?.[0];if(I)return lt("2f636f6d70616e792f")+I}if(w.startsWith(lt("68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f696e2f"))){let I=w.replace(lt("68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f696e2f"),"")?.split("/")?.[0]?.split("?")?.[0];if(I)return lt("2f696e2f")+I}}return""}).filter(Boolean)};if(f==="68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f66656564"||f==="68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f666565642f"){let x=Array.from(document.querySelectorAll("code"))?.map(y=>y?.innerText)?.find(y=>y?.includes(lt("7075626C69634964656E746966696572")))?.split(lt("7075626C69634964656E746966696572"))?.[1]?.split(':"')?.[1]?.split('"')?.[0];x&&s(x);let C=_();C.length>0&&C.forEach(c)}if(/\/in\/\w+/.test(o)){let x=o.replace(lt("68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f696e2f"),"")?.split("/")?.[0]?.split("?")?.[0];x&&l(x)}if(/\/company\/\w+/.test(o)){let x=o.replace(lt("68747470733a2f2f7777772e6c696e6b6564696e2e636f6d2f636f6d70616e792f"),"")?.split("/")?.[0]?.split("?")?.[0];x&&l(`${lt("2f636f6d70616e792f")}${x}`)}if(/\/posts\/\w+/.test(o)){let x=_();x.length>0&&l(x[0])}break}case"66616365626f6f6b2e636f6d":{a("9ec34cffb43810b9099303039ceee8e704ac4533");let _=lt("2f67726f7570732f");if(f==="68747470733a2f2f7777772e66616365626f6f6b2e636f6d"||f==="68747470733a2f2f7777772e66616365626f6f6b2e636f6d2f"||f==="68747470733a2f2f7777772e66616365626f6f6b2e636f6d2f67726f7570732f66656564"||f==="68747470733a2f2f7777772e66616365626f6f6b2e636f6d2f67726f7570732f666565642f"){let x=Array.from(document.querySelectorAll('div[role="navigation"] div[data-visualcompletion="ignore-dynamic"] a')).map(b=>b.getAttribute("href")?.split("/")?.reverse()?.[0]||"")[0];x&&s(x);let C=lt("6469765b726f6c653d2261727469636c65225d3a6e6f74283a68617328615b687265665e3d222f616473225d2929206469765b646174612d61642d72656e646572696e672d726f6c653d2270726f66696c655f6e616d65225d20683420612c206469765b726f6c653d2261727469636c65225d3a6e6f74283a68617328615b687265665e3d222f616473225d2929206469765b646174612d61642d72656e646572696e672d726f6c653d2270726f66696c655f6e616d65225d2068332061"),y=Array.from(document.querySelectorAll(C)).map(b=>{let w=(b.getAttribute("href")||"").replace(lt("68747470733a2f2f7777772e66616365626f6f6b2e636f6d"),"");if(!w)return"";if(w.startsWith(_))return _+(w.split(_)?.[1]?.split("/")?.[0]||"");if(w.startsWith("/")){let I=lt("70726F66696C652E7068703F69643D");return w.split(I).length===2?I+(w.split(I)?.[1]?.split("?")?.[0]?.split("&")?.[0]||""):w?.split("/")?.[1]?.split("?")?.[0]||""}return""}).filter(Boolean);y.length>0&&y.forEach(b=>b.startsWith(_)?u(b):c(b))}else{let x=lt("70726F66696C652E7068703F69643D");if(o.split(x).length===2){let b=o.replace(lt("68747470733a2f2f7777772e66616365626f6f6b2e636f6d"),"").split(x)?.[1]?.split("?")?.[0]?.split("&")?.[0];b&&l(`${x}${b}`)}let C=o.replace(lt("68747470733a2f2f7777772e66616365626f6f6b2e636f6d2f"),"")?.split("/")?.[0]?.split("?")?.[0];C&&(document.querySelector(`a[href*="/${C}/${lt("667269656e64735f6c696b6573")}/"]`)||document.querySelector(`a[href*="/${C}/${lt("666f6c6c6f77657273")}/"]`)||document.querySelector(`a[href*="/${C}/${lt("666F6C6C6F77696E67")}/"]`))&&l(C);let y=o.replace(lt("68747470733a2f2f7777772e66616365626f6f6b2e636f6d"),"")?.split(_)?.[1]?.split("/")?.[0]?.split("?")?.[0];/\d+/.test(y)&&l(`${_}${y}`)}}}p()},5e3);return()=>clearTimeout(m)}},[o])},_7=HD;var h1=S(M());var C7=xi({key:"HaveFilledOutSurveyAtom",default:{feedback:!1}}),y7=xi({key:"firstFetchSurveyStatusLoadedAtom",default:!1}),VAe=xi({key:"FunnelSurveyPopupOpenStateAtom",default:{}}),RAe=xi({key:"FunnelSurveyPopupOpenTimerAtom",default:{}});var FD=()=>{let o=Qt(C7),e=Qt(y7),{isLogin:t}=Po(),r=(0,h1.useRef)(!1),n=async(i=!1)=>{let a=await gy(i);a&&Object.keys(a).length>0&&o(s=>({...s,...a}))};return(0,h1.useEffect)(()=>{r.current||t&&xy().then(i=>{n(!i).then(()=>{e(!0),r.current=!0})})},[t]),zl(async(i,a)=>{if(r.current&&i==="Client_listenSurveyStatusUpdated"){let s=a;return o(l=>({...l,...s})),{success:!0,message:"ok",data:{}}}}),null},b7=FD;var ND=Dr(()=>{if(Wa()==="youtube.com"){es()&&(document.body.style.position=""),document.documentElement.style.position==="relative"&&(document.documentElement.style.position="unset",document.querySelector(`#${y1}`)?.classList.replace("open","close"));let e=document.querySelector(`#${b1}`);e&&(e.style.display="none")}},100),VD=Dr(()=>{if(Wa()==="youtube.com"){document.documentElement.style.position==="unset"&&(document.documentElement.style.position="relative",document.querySelector(`#${y1}`)?.classList.replace("close","open")),es()&&(document.body.style.position="relative");let e=document.querySelector(`#${b1}`);e&&(e.style.display=""),setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300)}},100),RD=()=>{let o=Wa();Ro(()=>{if(o==="youtube.com"){let e=new MutationObserver(r=>{r.forEach(n=>{n.target&&(n.target.hasAttribute("scrolling")?ND():VD())})}),t=document.querySelector("ytd-app");t&&e.observe(t,{attributes:!0,childList:!1,subtree:!1})}})},I7=RD;var Bp=S(M());var zD=({children:o,...e})=>{let t=Bp.default.useRef(null);return Bp.default.createElement(Jx,{maxSnack:3,preventDuplicate:!0,hideIconVariant:!0,autoHideDuration:3e3,ref:t,anchorOrigin:{vertical:"bottom",horizontal:"left"},action:r=>Bp.default.createElement("svg",{focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24",style:{width:"1em",height:"1em",display:"inline-block",fill:"currentcolor",fontSize:18,cursor:"pointer"},onClick:()=>{if(t?.current){let n=t?.current;n.closeSnackbar&&n.closeSnackbar(r)}}},Bp.default.createElement("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),...e},Bp.default.createElement(e2,null),o)},S7=zD;var Dp=S(M()),v7=S(P7());var UD="MAXAI_SNACKBAR_CONTAINER";var WD=()=>Dp.default.createElement(S7,{classes:{containerRoot:"maxai-snackbar-container-root"}},Dp.default.createElement("span",null)),M7=()=>{let o=document.createElement("div");o.id=UD,o.style.zIndex="21474836470",o.style.color="#fff",o.style.position="absolute",document.body.appendChild(o),(0,v7.createRoot)(o).render(Dp.default.createElement(Dp.default.StrictMode,null,Dp.default.createElement(WD,null)))};var GD=new $u("AppInit"),KD=()=>window.location.host==="www.usechatgpt.ai"||window.location.host==="www.maxai.me"||window.location.host==="www.maxai.co"||window.location.host==="app.maxai.me"?xr.default.createElement(le,{onClick:()=>{Va({key:"shortcuts"})},id:"usechatgpt-www-to-shortcuts",sx:{position:"absolute",width:1,height:1,zIndex:-1,opacity:0}}):xr.default.createElement(xr.default.Fragment,null),jD=()=>{let{setAppSettingsState:o}=en(),{getLocalSettings:e}=_t(),{isLogin:t}=Po();return dy(),(0,xr.useEffect)(()=>{let r=async()=>{let n=await z1();n&&(o({...n}),GD.info(" get appSettings",n)),e()};return r(),window.addEventListener("focus",r),()=>{window.removeEventListener("focus",r)}},[]),(0,xr.useEffect)(()=>{t&&setTimeout(()=>{z1().then(r=>{r&&o({...r})})},1e3)},[t]),xr.default.createElement(xr.default.Fragment,null)},$D=()=>{let{syncUserInfo:o}=Mt(),{fetchPlanPricing:e}=Qu(!0);return Ro(()=>{if(o().then(),String(Zr).includes(Wa())){let t=window.location.pathname;["/account/your-plan/","/pricing/","/account/get-started/","/payment/error/","/payment/success/"].includes(t)&&setTimeout(()=>{o(!0).then().catch()},500),["/account/your-plan/","/pricing/"].includes(t)&&setTimeout(()=>{e().then()},500)}}),null},qD=()=>{let o=Qt(jx),e=Qt(Kx),{syncUserInfo:t,setUserInfo:r}=Mt();return zl(async(n,i)=>{if(n==="Client_AuthMaxAITokenComplete"){if(i?.hasToken){let a=await Ha.getAuthTokens(),l=!(a?.refreshToken?Ha.isTokenExpired(a.refreshToken):!0)&&!!a;a&&l?(t(),e(c=>c.isLogin===l?c:{...c,isLogin:l,authTokens:a})):e(c=>c.isLogin===l?c:{...c,isLogin:!1,authTokens:null})}else e(a=>({...a,isLogin:!1,authTokens:null}));return o(!0),r(a=>({...a,user:null})),{success:!0,message:"ok",data:{}}}}),null},XD=()=>{I7(),C2(),hy(),u2(!1),c2(!1),Il(),qD(),xI(),S2(),Ro(()=>{Jp()&&na(),M7(),x7(),l7().then().catch(),hI()}),h7(),b7(),_6(),am(),w2(),Zu(),_7(),h6(),SC(),WC(),gC(),hC();let o=Jp();return xr.default.createElement(xr.default.Fragment,null,xr.default.createElement($D,null),!o&&xr.default.createElement(i7,null),xr.default.createElement(jD,null),xr.default.createElement(KD,null),xr.default.createElement(Z2,null),xr.default.createElement(Q2,null))},Jke=XD;export{_y as a,is as b,qy as c,a6 as d,s6 as e,f6 as f,h6 as g,QM as h,NE as i,on as j,kR as k,zG as l,$h as m,Od as n,ds as o,nf as p,lf as q,c3 as r,u3 as s,gg as t,OS as u,NS as v,uv as w,fv as x,qc as y,CO as z,H_e as A,ol as B,M8 as C,J8 as D,jSe as E,i9 as F,r7 as G,a7 as H,Op as I,C7 as J,y7 as K,M7 as L,jD as M,Jke as N};
/*! Bundled license information:

chnl/dist/channel.cjs.js:
  (* chnl v1.2.0 by Vitaliy Potapov @preserve *)
*/
